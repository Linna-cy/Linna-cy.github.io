<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Go on Linner&#39;s Blog</title>
    <link>/tags/go/</link>
    <description>Recent content in Go on Linner&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <copyright>Copyright Â© 2020-2026 Linner. All Rights Reserved.
</copyright>
    <lastBuildDate>Tue, 02 Jul 2024 14:49:41 +0000</lastBuildDate><atom:link href="/tags/go/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Gin Cookie å’Œ Session</title>
      <link>/docs/golang/gin/cookie-and-session/</link>
      <pubDate>Tue, 02 Jul 2024 14:49:41 +0000</pubDate>
      
      <guid>/docs/golang/gin/cookie-and-session/</guid>
      <description><![CDATA[Cookie åœ¨ Gin ä¸­ï¼Œä½¿ç”¨ Cookie æ¶‰åŠåˆ°ä¸¤ä¸ªæ–¹æ³•ï¼ŒContext.Cookie() å’Œ Context.SetCookie()ï¼š func SetCookie(c *gin.Context) { // è®¾ç½® Cookie c.SetCookie(&#34;gin-cookie&#34;, &#34;test&#34;, 3600, &#34;/&#34;, &#34;localhost&#34;, false, false) c.JSON(http.StatusOK, gin.H{]]></description>
      <content:encoded><![CDATA[<h1 id="cookie" data-numberify>Cookie<a class="anchor ms-1" href="#cookie"></a></h1>
<p>åœ¨ Gin ä¸­ï¼Œä½¿ç”¨ Cookie æ¶‰åŠåˆ°ä¸¤ä¸ªæ–¹æ³•ï¼Œ<code>Context.Cookie()</code> å’Œ <code>Context.SetCookie()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">SetCookie</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è®¾ç½® Cookie
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">c</span><span class="p">.</span><span class="nf">SetCookie</span><span class="p">(</span><span class="s">&#34;gin-cookie&#34;</span><span class="p">,</span> <span class="s">&#34;test&#34;</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="s">&#34;localhost&#34;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;code&#34;</span><span class="p">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;data&#34;</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">GetCookie</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å– Cookie
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Cookie</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;code&#34;</span><span class="p">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;data&#34;</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/cookie&#34;</span><span class="p">,</span> <span class="nx">SetCookie</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/cookie&#34;</span><span class="p">,</span> <span class="nx">GetCookie</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼š</p>
<ul>
<li>
<p><code>Context.Cookie()</code>ï¼šè·å–æŒ‡å®šåç§°çš„ Cookieã€‚</p>
</li>
<li>
<p><code>Context.SetCookie()</code>ï¼šè®¾ç½® Cookieã€‚å®ƒçš„æ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">SetCookie</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">maxAge</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">domain</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">secure</span><span class="p">,</span> <span class="nx">httpOnly</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code>
‚æ•°è§£é‡Šå¦‚ä¸‹ï¼š

`name`ï¼šè®¾ç½® Cookie çš„åç§°ã€‚
`value`ï¼šè®¾ç½® Cookie çš„å€¼ã€‚
`maxAge`ï¼šCookie çš„æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚å¦‚æœä¸ºè´Ÿæ•°ï¼Œåˆ™è¡¨ç¤ºä¼šè¯ Cookieï¼ˆåœ¨æµè§ˆå™¨å…³é—­ä¹‹ååˆ é™¤ï¼‰ï¼›å¦‚æœä¸ºé›¶ï¼Œåˆ™è¡¨ç¤ºç«‹å³åˆ é™¤Cookieã€‚
`path`ï¼šCookie çš„ç”Ÿæ•ˆè·¯å¾„ã€‚å¦‚æœä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåˆ™ä½¿ç”¨å½“å‰è¯·æ±‚çš„ URI è·¯å¾„ä½œä¸ºé»˜è®¤å€¼ã€‚å¦‚æœæ˜¯ `&#34;/&#34;`ï¼Œé‚£ä¹ˆæ‰€æœ‰è·¯å¾„éƒ½è®¿é—®è¯¥ Cookieã€‚
`domain`ï¼šCookie çš„ç”Ÿæ•ˆåŸŸã€‚å¦‚æœä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåˆ™ä¸è®¾ç½®åŸŸåã€‚
`secure`ï¼šCookie æ˜¯å¦ä»…ç”¨äº HTTPS è¿æ¥ã€‚å¦‚æœä¸º `true`ï¼Œåˆ™ä»…é€šè¿‡ HTTPS è¿æ¥å‘é€ Cookieï¼›å¦åˆ™ï¼Œä½¿ç”¨ HTTP æˆ– HTTPS è¿æ¥éƒ½å¯ä»¥å‘é€ Cookieã€‚
`httpOnly`ï¼šCookie æ˜¯å¦å…è®¸é€šè¿‡å®¢æˆ·ç«¯ç¨‹åºè®¿é—®ã€‚å¦‚æœä¸º `true`ï¼Œåˆ™æ— æ³•é€šè¿‡å®¢æˆ·ç«¯ç¨‹åºè®¿é—® Cookieï¼›å¦åˆ™ï¼Œå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯ç¨‹åºè®¿é—® Cookieã€‚
</code></pre></li>
</ul>
<blockquote>
<p><code>httpOnly</code> æ˜¯å¾®è½¯å¯¹ Cookie åšçš„æ‰©å±•ã€‚å¦‚æœåœ¨ Cookie ä¸­è®¾ç½®äº† <code>httpOnly</code> å±æ€§ï¼Œåˆ™é€šè¿‡ç¨‹åºï¼ˆJS è„šæœ¬ã€Applet ç­‰ï¼‰å°†æ— æ³•è¯»å–åˆ° Cookie ä¿¡æ¯ï¼Œé˜²æ­¢ XSS æ”»å‡»äº§ç”Ÿã€‚</p>
</blockquote>
<h2 id="å¤šä¸ªäºŒçº§åŸŸåå…±äº«-cookie" data-numberify>å¤šä¸ªäºŒçº§åŸŸåå…±äº« Cookie<a class="anchor ms-1" href="#å¤šä¸ªäºŒçº§åŸŸåå…±äº«-cookie"></a></h2>
<p>æœåŠ¡å™¨çš„ IP é…ç½®äº†å¤šä¸ªåŸŸåè§£æï¼Œæ­¤æ—¶è®¾ç½® Cookie å°±éœ€è¦é…ç½®å¤šä¸ªç”Ÿæ•ˆåŸŸã€‚</p>
<p>ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨çš„ IP é…ç½®äº†åŸŸåæ³›è§£æ <code>*.linner.com</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">c</span><span class="p">.</span><span class="nf">SetCookie</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="s">&#34;.linner.com&#34;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
</span></span></code></pre></div><hr>
<h1 id="session" data-numberify>Session<a class="anchor ms-1" href="#session"></a></h1>
<p>Gin æ˜¯ä¸€ä¸ªè½»é‡çš„ Web æ¡†æ¶ï¼Œåœ¨ Gin ä¸­å¹¶ä¸ç›´æ¥å¯¹ Session æä¾›æ”¯æŒï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å…¶ä»–ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶è®© Gin æ”¯æŒ Sessionã€‚</p>
<p>åœ¨ä½¿ç”¨ Session å‰ï¼Œéœ€è¦ <code>get</code> å¯¹åº”çš„æ¨¡å—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get github.com/gin-contrib/sessions
</span></span></code></pre></div><p>ç„¶ååœ¨éœ€è¦ä½¿ç”¨åˆ° Session çš„åœ°æ–¹å¼•å…¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;github.com/gin-contrib/sessions&#34;</span>
</span></span></code></pre></div><p>æ¥ç€è®¾ç½® Session ä¸­é—´ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// åˆ›å»ºåŸºäº Cookie çš„å­˜å‚¨å¼•æ“ï¼Œsecret å‚æ•°æ˜¯åŠ å¯†å¯†é’¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">store</span> <span class="o">:=</span> <span class="nx">cookie</span><span class="p">.</span><span class="nf">NewStore</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&#34;secret&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">// é…ç½® Session ä¸­é—´ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">sessions</span><span class="p">.</span><span class="nf">Sessions</span><span class="p">(</span><span class="s">&#34;mysession&#34;</span><span class="p">,</span> <span class="nx">store</span><span class="p">))</span>
</span></span></code></pre></div><p>å…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">SetSession</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ä» Context ä¸­è·å– Session æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">session</span> <span class="o">:=</span> <span class="nx">sessions</span><span class="p">.</span><span class="nf">Default</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è®¾ç½® Session
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">session</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">,</span> <span class="s">&#34;lisi&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">session</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;nickname&#34;</span><span class="p">,</span> <span class="s">&#34;æå››&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ä¿å­˜è®¾ç½®çš„ Sessionï¼Œè®¾ç½®å®Œæˆä¹‹åå¿…é¡»è¦è°ƒç”¨ Save()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">session</span><span class="p">.</span><span class="nf">Save</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">GetSession</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ä» Context ä¸­è·å– Session æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">session</span> <span class="o">:=</span> <span class="nx">sessions</span><span class="p">.</span><span class="nf">Default</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å– Session
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">username</span> <span class="o">:=</span> <span class="nx">session</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">nickname</span> <span class="o">:=</span> <span class="nx">session</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;nickname&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;code&#34;</span><span class="p">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;data&#34;</span><span class="p">:</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;username&#34;</span><span class="p">:</span> <span class="nx">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;nickname&#34;</span><span class="p">:</span> <span class="nx">nickname</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">store</span> <span class="p">=</span> <span class="nx">cookie</span><span class="p">.</span><span class="nf">NewStore</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&#34;secret&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// è®¾ç½® Session ä¸­é—´ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">sessions</span><span class="p">.</span><span class="nf">Sessions</span><span class="p">(</span><span class="s">&#34;mysession&#34;</span><span class="p">,</span> <span class="nx">store</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/session&#34;</span><span class="p">,</span> <span class="nx">SetSession</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/session&#34;</span><span class="p">,</span> <span class="nx">GetSession</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="redis" data-numberify>Redis<a class="anchor ms-1" href="#redis"></a></h2>
<p><code>github.com/gin-contrib/sessions</code> æ”¯æŒé€šè¿‡ Redis ç¼“å­˜ Sessionï¼Œä½¿å…¶èƒ½å¤Ÿæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿã€‚</p>
<p>åœ¨ä½¿ç”¨å‰éœ€è¦å…ˆå¼•å…¥å…¶ Redis åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="err">$</span> <span class="k">go</span> <span class="nx">get</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">gin</span><span class="o">-</span><span class="nx">contrib</span><span class="o">/</span><span class="nx">sessions</span><span class="o">/</span><span class="nx">redis</span>
</span></span></code></pre></div><p>æ¥ç€é…ç½® Redis Storeï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// é…ç½® Redis Store
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">RedisStore</span><span class="p">()</span> <span class="p">(</span><span class="nx">store</span> <span class="nx">sessions</span><span class="p">.</span><span class="nx">Store</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">store</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">redis</span><span class="p">.</span><span class="nf">NewStore</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s">&#34;tcp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;localhost:6379&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;123456&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&#34;secret&#34;</span><span class="p">));</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">store</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">store</span> <span class="p">=</span> <span class="nf">RedisStore</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// è®¾ç½® Session ä¸­é—´ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">sessions</span><span class="p">.</span><span class="nf">Sessions</span><span class="p">(</span><span class="s">&#34;mysession&#34;</span><span class="p">,</span> <span class="nx">store</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/session&#34;</span><span class="p">,</span> <span class="nx">SetSession</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/session&#34;</span><span class="p">,</span> <span class="nx">GetSession</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>redis.NewStore()</code> çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewStore</span><span class="p">(</span><span class="nx">size</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">network</span><span class="p">,</span> <span class="nx">address</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">keyPairs</span> <span class="o">...</span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="nx">Store</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>size</code>ï¼šæœ€å¤§è¿æ¥æ•°ï¼›</li>
<li><code>network</code>ï¼šè¿æ¥æ–¹å¼ï¼Œå€¼ä¸º <code>tcp</code> æˆ– <code>udp</code>ï¼›</li>
<li><code>address</code>ï¼šæœåŠ¡å™¨åœ°å€ï¼Œéœ€è¦æŒ‡å®šç«¯å£å·ï¼›</li>
<li><code>username</code>ï¼šRedis ç”¨æˆ·åï¼Œæ²¡æœ‰é…ç½®ç”¨æˆ·åå¯ä¼ å…¥ç©ºå­—ç¬¦ä¸²ï¼›</li>
<li><code>password</code>ï¼šRedis å¯†ç ï¼Œæ²¡æœ‰é…ç½®å¯†ç å¯ä¼ å…¥ç©ºå­—ç¬¦ä¸²ï¼›</li>
<li><code>keyPairs</code>ï¼šSession åŠ å¯†å¯†é’¥ã€‚</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>Gin ä¸­é—´ä»¶</title>
      <link>/docs/golang/gin/middlewares/</link>
      <pubDate>Sun, 30 Jun 2024 07:12:14 +0000</pubDate>
      
      <guid>/docs/golang/gin/middlewares/</guid>
      <description><![CDATA[Gin ä¸­é—´ä»¶çš„é…ç½®æ–¹å¼æœ‰è®¸å¤šç§ï¼Œå¤§è‡´ä¸ºï¼š åœ¨ Handle()ã€Any()ã€Match()ã€GET() ç­‰åŸºæœ¬è·¯ç”±æ–¹æ³•ä¸­é…ç½® HandlerFuncã€‚ åœ¨]]></description>
      <content:encoded><![CDATA[<p>Gin ä¸­é—´ä»¶çš„é…ç½®æ–¹å¼æœ‰è®¸å¤šç§ï¼Œå¤§è‡´ä¸ºï¼š</p>
<ol>
<li>åœ¨ <code>Handle()</code>ã€<code>Any()</code>ã€<code>Match()</code>ã€<code>GET()</code> ç­‰åŸºæœ¬è·¯ç”±æ–¹æ³•ä¸­é…ç½® <code>HandlerFunc</code>ã€‚</li>
<li>åœ¨ <code>RouterGroup</code> çš„ <code>Group()</code> æ–¹æ³•ä¸­é…ç½® <code>HandlerFunc</code>ã€‚</li>
<li>ä½¿ç”¨ <code>Use()</code> æ–¹æ³•é…ç½® <code>HandlerFunc</code>ã€‚</li>
</ol>
<hr>
<h1 id="ç‰¹å®šè¯·æ±‚çš„ä¸­é—´ä»¶" data-numberify>ç‰¹å®šè¯·æ±‚çš„ä¸­é—´ä»¶<a class="anchor ms-1" href="#ç‰¹å®šè¯·æ±‚çš„ä¸­é—´ä»¶"></a></h1>
<p>ä¸ºç‰¹å®šè¯·æ±‚é…ç½®ä¸­é—´ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨è¯·æ±‚è·¯ç”±çš„ <code>HandlerFunc</code> å‚æ•°ä¸­é…ç½®ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>
<p><code>controllers/user</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">userController</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">UserController</span> <span class="nx">userController</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">userController</span><span class="p">)</span> <span class="nf">GetUser</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">Param</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// è·å– Context å†…éƒ¨å­—å…¸çš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">token</span><span class="p">,</span> <span class="nx">exists</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">middlewares</span><span class="p">.</span><span class="nx">TOKEN</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">!</span><span class="nx">exists</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;error&#34;</span><span class="p">:</span> <span class="s">&#34;Unauthorized...&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">PureJSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;id&#34;</span><span class="p">:</span> <span class="nx">id</span><span class="p">,</span> <span class="s">&#34;username&#34;</span><span class="p">:</span> <span class="s">&#34;zhangsan&#34;</span><span class="p">,</span> <span class="s">&#34;token&#34;</span><span class="p">:</span> <span class="nx">token</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p><code>middlewares/user</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">userMiddlewares</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">UserMiddlewares</span> <span class="nx">userMiddlewares</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">const</span> <span class="nx">Authorization</span> <span class="p">=</span> <span class="s">&#34;Authorization&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">userMiddlewares</span><span class="p">)</span> <span class="nf">VerifyToken</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">auth</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">TrimSpace</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">GetHeader</span><span class="p">(</span><span class="nx">Authorization</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">auth</span> <span class="o">==</span> <span class="s">&#34;Bearer 123456&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä½¿ç”¨ Context.Set() è®¾ç½®é”®å€¼å¯¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// è¿™ä¸ªé”®å€¼å¯¹åªèƒ½åœ¨å½“å‰å¤„ç†é“¾ä¸­æŒ‰é¡ºåºæµè½¬
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªé”®å€¼å¯¹åªæ˜¯å­˜å‚¨åœ¨å½“å‰ Context ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">ctx</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">TOKEN</span><span class="p">,</span> <span class="s">&#34;123456&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;error&#34;</span><span class="p">:</span> <span class="s">&#34;Unauthorized...&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nf">Abort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p>ä¸­é—´ä»¶ä¹Ÿå¯ä¸“é—¨ä¸ºå…¶å®šä¹‰ä¸€ä¸ª <code>middlewares</code> åŒ…æ¥å­˜æ”¾é¡¹ç›®ä¸­æ‰€æœ‰çš„ä¸­é—´ä»¶ã€‚</p>
<p>å¤„ç†é“¾ï¼šå³ä¸€ç»„æŒ‰é¡ºåºæ‰§è¡Œçš„ä¸­é—´ä»¶å’Œå¤„ç†å‡½æ•°ã€‚</p>
</blockquote>
</li>
<li>
<p><code>routers/user.go</code>ï¼š</p>
<p>å°†ä¸­é—´å‡½æ•°å’Œå¤„ç†å‡½æ•°ç»‘å®šåˆ°è·¯ç”±ä¸Šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">UserRoutersInit</span><span class="p">(</span><span class="nx">engin</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Engine</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">engin</span><span class="p">.</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;/user&#34;</span><span class="p">,</span> <span class="nx">middlewares</span><span class="p">.</span><span class="nx">UserMiddleware</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">		<span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/:id&#34;</span><span class="p">,</span> <span class="nx">middlewares</span><span class="p">.</span><span class="nx">UserMiddlewares</span><span class="p">.</span><span class="nx">VerifyToken</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">controllers</span><span class="p">.</span><span class="nx">UserController</span><span class="p">.</span><span class="nx">GetUser</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
</ul>
<hr>
<h1 id="å…¨å±€ä¸­é—´ä»¶" data-numberify>å…¨å±€ä¸­é—´ä»¶<a class="anchor ms-1" href="#å…¨å±€ä¸­é—´ä»¶"></a></h1>
<p>å…¨å±€ä¸­é—´ä»¶å°±æ˜¯ç»‘å®šåœ¨æ ¹è·¯ç”±ä¸Šçš„ã€å…¨å±€ç”Ÿæ•ˆçš„ä¸­é—´ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>RouterGroup.Use()</code> æ–¹æ³•ç»‘å®šå…¨å±€ä¸­é—´ä»¶ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Router</span><span class="p">()</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Engine</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">engine</span> <span class="p">=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è®¾ç½®å…¨å±€ä¸­é—´ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">engine</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">middlewares</span><span class="p">.</span><span class="nx">GlobalMiddlewares</span><span class="p">.</span><span class="nx">VerifyToken</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>å¦‚æœéœ€è¦ç»‘å®šçš„ä¸­é—´ä»¶è¿‡å¤šï¼Œé™¤äº†å¤šæ¬¡è°ƒç”¨ <code>User()</code> æ–¹æ³•ç»‘å®šæˆ–åœ¨ <code>User()</code> æ–¹æ³•ä¸­ä¼ å…¥å¤šä¸ªä¸­é—´ä»¶å¤–ï¼Œè¿˜èƒ½ä½¿ç”¨ <code>gin.HandlersChain</code> ç±»å‹ã€‚<code>gin.HandlersChain</code> çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">HandlersChain</span> <span class="p">[]</span><span class="nx">HandlerFunc</span>
</span></span></code></pre></div><p>ä½¿ç”¨ <code>gin.HandlersChain</code> æ¥èšé›†å¤šä¸ªä¸­é—´ä»¶ï¼Œç„¶åå°†å®ƒä»¬ä¸€æ¬¡æ€§ä¼ å…¥ <code>User()</code> ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">globalMiddlewares</span> <span class="p">=</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">HandlersChain</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">middlewares</span><span class="p">.</span><span class="nx">GlobalMiddlewares</span><span class="p">.</span><span class="nx">VerifyToken</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">middlewares</span><span class="p">.</span><span class="nx">GlobalMiddlewares</span><span class="p">.</span><span class="nx">VerifyAuthorization</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> 	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Router</span><span class="p">()</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Engine</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">engine</span> <span class="p">=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è®¾ç½®å…¨å±€ä¸­é—´ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">engine</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">globalMiddlewares</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>é€šè¿‡ä½¿ç”¨ <code>gin.HandlersChain</code> èšé›†å¹¶æ³¨å†Œå…¨å±€ä¸­é—´ä»¶åï¼Œä¸­é—´å‡½æ•°çš„æ‰§è¡Œé¡ºåºå°†æŒ‰ç…§ <code>gin.HandlersChain</code> ä¸­çš„é¡ºåºæ‰§è¡Œã€‚</p>
<hr>
<h1 id="åˆ†ç»„ä¸­é—´ä»¶" data-numberify>åˆ†ç»„ä¸­é—´ä»¶<a class="anchor ms-1" href="#åˆ†ç»„ä¸­é—´ä»¶"></a></h1>
<p>åˆ†ç»„ä¸­é—´ä»¶åŒæ ·å¯ä»¥ä½¿ç”¨ <code>RouterGroup.Use()</code> æ–¹æ³•ï¼Œä¸åŒçš„æ˜¯è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡æ˜¯å…·ä½“çš„è·¯ç”±åˆ†ç»„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ <code>Engin.Group()</code> è°ƒç”¨ä¹‹åè¿”å›çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">engin</span><span class="p">.</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;/user&#34;</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Use</span><span class="p">(</span><span class="nx">middlewares</span><span class="p">.</span><span class="nx">UserMiddlewares</span><span class="p">.</span><span class="nx">VerifyToken</span><span class="p">)</span>
</span></span></code></pre></div><p>é™¤äº†ä½¿ç”¨ <code>RouterGroup.Use()</code> æ–¹æ³•ï¼Œåˆ†ç»„ä¸­é—´ä»¶è¿˜å¯ä»¥åœ¨ <code>Engin.Group()</code> è°ƒç”¨çš„æ—¶å€™æ³¨å†Œã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">engin</span><span class="p">.</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;/user&#34;</span><span class="err">ï¼Œ</span> <span class="nx">middlewares</span><span class="p">.</span><span class="nx">UserMiddlewares</span><span class="p">.</span><span class="nx">VerifyToken</span><span class="p">)</span>
</span></span></code></pre></div><p>åŒæ ·åœ°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>gin.HandlersChain</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">groupMiddlewares</span> <span class="p">=</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">HandlersChain</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">middlewares</span><span class="p">.</span><span class="nx">UserMiddlewares</span><span class="p">.</span><span class="nx">VerifyToken</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> 	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">engin</span><span class="p">.</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;/user&#34;</span><span class="err">ï¼Œ</span> <span class="o">...</span><span class="nx">groupMiddlewares</span><span class="p">)</span>
</span></span></code></pre></div><blockquote>
<p>æ³¨ï¼š<code>User()</code> æ–¹æ³•æ³¨å†Œçš„ä¸­é—´ä»¶ï¼Œå’Œä½¿ç”¨å…¶å®ƒè·¯ç”±æ–¹æ³•ï¼ˆå¦‚ <code>Handle()</code>ã€<code>Any()</code>ã€<code>GET()</code>ã€<code>Match()</code> ç­‰ç­‰ï¼‰æ³¨å†Œçš„ä¸­é—´ä»¶ã€å¤„ç†å‡½æ•°å®ƒä»¬ä¹‹é—´çš„è°ƒç”¨é¡ºåºä¹Ÿæ˜¯æŒ‰ç…§æ³¨å†Œçš„é¡ºåºæ‰§è¡Œã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">engin</span><span class="p">.</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;/user&#34;</span><span class="p">,</span> <span class="nx">middlewares</span><span class="p">.</span><span class="nx">UserMiddlewares</span><span class="p">.</span><span class="nx">VerifyToken</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">	<span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/info/:username&#34;</span><span class="p">,</span> <span class="nx">controllers</span><span class="p">.</span><span class="nx">UserController</span><span class="p">.</span><span class="nx">GetInfo</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">	<span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/list&#34;</span><span class="p">,</span> <span class="nx">controllers</span><span class="p">.</span><span class="nx">UserController</span><span class="p">.</span><span class="nx">GetList</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// åœ¨æ­¤ä¹‹å‰çš„è·¯ç”±ï¼Œåœ¨æ‰§è¡Œæ—¶ä¸ä¼šè°ƒç”¨ middlewares.UserMiddlewares.VerifyAuthorization
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// åªä¼šè°ƒç”¨ middlewares.UserMiddlewares.VerifyToken
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">Use</span><span class="p">(</span><span class="nx">middlewares</span><span class="p">.</span><span class="nx">UserMiddlewares</span><span class="p">.</span><span class="nx">VerifyAuthorization</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// åœ¨æ­¤ä¹‹å‰çš„è·¯ç”±ï¼Œåœ¨æ‰§è¡Œæ—¶ä¼šæŒ‰é¡ºåºè°ƒç”¨ middlewares.UserMiddlewares.VerifyToken
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// å’Œ middlewares.UserMiddlewares.VerifyAuthorization
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/:id&#34;</span><span class="p">,</span> <span class="nx">controllers</span><span class="p">.</span><span class="nx">UserController</span><span class="p">.</span><span class="nx">GetUser</span><span class="p">)</span>
</span></span></code></pre></div></blockquote>
<hr>
<h1 id="ä¸­é—´ä»¶-context" data-numberify>ä¸­é—´ä»¶ Context<a class="anchor ms-1" href="#ä¸­é—´ä»¶-context"></a></h1>
<p>åœ¨ä¸­é—´ä»¶ä¸­ï¼Œ<code>Context</code> æœ‰ä¸€äº›æ–¹æ³•å¯ç”¨äºä¸­é—´ä»¶çš„ç¼–å†™ï¼š</p>
<ul>
<li>
<p><code>Context.Next()</code>ï¼šå°†æ§åˆ¶æƒä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æˆ–å¤„ç†å‡½æ•°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">MyMiddleware</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ‰§è¡ŒæŸäº›é¢„å¤„ç†é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ‰§è¡ŒæŸäº›åå¤„ç†é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code></code></pre></li>
<li>
<p><code>Context.Abort()</code>ï¼šç«‹å³åœæ­¢æ‰§è¡Œåç»­çš„ä¸­é—´ä»¶å’Œå¤„ç†å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†é”™è¯¯æˆ–ç‰¹æ®Šè¯·æ±‚ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">ErrorMiddleware</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s">&#34;error&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#34;true&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">Abort</span><span class="p">()</span>	<span class="c1">// åœæ­¢æ‰§è¡Œåç»­çš„ä¸­é—´ä»¶å’Œå¤„ç†å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code></code></pre></li>
<li>
<p><code>Context.Set()</code> å’Œ <code>Context.Get()</code>ï¼šåœ¨å½“å‰è¯·æ±‚å¤„ç†é“¾ä¸­å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ï¼Œå…è®¸åœ¨å¤„ç†é“¾ä¸­ä¸åŒçš„ä¸­é—´ä»¶å’Œå¤„ç†å‡½æ•°ä¹‹é—´å…±äº«ä¿¡æ¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">StoreDataMiddleware</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å­˜å‚¨æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">c</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;user_id&#34;</span><span class="p">,</span> <span class="mi">123</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">RetrieveDataMiddleware</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å–æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">userId</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;user_id&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ä½¿ç”¨ userId ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code>
`Context.Set()` å’Œ `Context.Get()` å­˜å‚¨å’Œè·å–çš„æ•°æ®ï¼Œæ˜¯å­˜å‚¨åœ¨å½“å‰ `Context` å¯¹è±¡çš„å†…éƒ¨å­—å…¸ï¼ˆ`store` å­—æ®µï¼‰ä¸­ã€‚åœ¨ Gin ä¸­ï¼Œå¯¹äºä¸€æ¡å¤„ç†é“¾ä¸­æ‰€æœ‰çš„ä¸­é—´ä»¶å’Œå¤„ç†å‡½æ•°å…±äº«åŒä¸€ä¸ª `Context` å¯¹è±¡ã€‚
</code></pre></li>
</ul>
<blockquote>
<p><code>Contex</code> ä¸­é™¤äº†ä¸Šè¿°çš„ 4 ä¸ªæ–¹æ³•å¤–ï¼Œè¿˜æœ‰å…¶å®ƒå¯ä»¥ç”¨äºæ§åˆ¶ä¸­é—´ä»¶æˆ–å¤„ç†å‡½æ•°æ‰§è¡Œæµçš„æ–¹æ³•ã€‚ä¾‹å¦‚ä»¥ <code>Abort</code> å¼€å¤´çš„ <code>Abort</code> ç³»æ–¹æ³•ï¼Œå®ƒä»¬åœ¨ç»ˆæ­¢æ‰§è¡Œé“¾æ‰§è¡Œçš„åŒæ—¶ï¼Œè¿˜æä¾›äº†å…¶å®ƒä¸€äº›é¢å¤–çš„æ“ä½œã€‚æ¯”å¦‚è¯´ <code>Context.AbortWithStatus()</code>ï¼Œåœ¨ä¸­æ­¢æ‰§è¡Œé“¾çš„åŒæ—¶è®¾ç½®å“åº”çŠ¶æ€ç ã€‚</p>
</blockquote>
]]></content:encoded>
    </item>
    
    <item>
      <title>Gin è·¯ç”±</title>
      <link>/docs/golang/gin/routers/</link>
      <pubDate>Sun, 30 Jun 2024 05:42:11 +0000</pubDate>
      
      <guid>/docs/golang/gin/routers/</guid>
      <description><![CDATA[Gin ä¸­è®¸å¤šç±»å‹éƒ½å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªè·¯ç”±ï¼ˆIRoutesï¼‰ç±»å‹ï¼Œè¿™åŒ…æ‹¬äº† RouterGroupã€Engineç­‰ã€‚å¹¶ä¸” IRoutes æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•éƒ½ä¼šæœ‰ä¸€ä¸ª IRoutes]]></description>
      <content:encoded><![CDATA[<p>Gin ä¸­è®¸å¤šç±»å‹éƒ½å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªè·¯ç”±ï¼ˆ<code>IRoutes</code>ï¼‰ç±»å‹ï¼Œè¿™åŒ…æ‹¬äº† <code>RouterGroup</code>ã€<code>Engine</code>ç­‰ã€‚å¹¶ä¸” <code>IRoutes</code> æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•éƒ½ä¼šæœ‰ä¸€ä¸ª <code>IRoutes</code> ç±»å‹çš„è¿”å›å€¼ï¼Œä½¿å¾— Gin Routers å¯ä»¥æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œè®©ä»£ç æ›´åŠ ç®€æ´ã€‚</p>
<hr>
<h1 id="è·¯ç”±åˆ†ç»„" data-numberify>è·¯ç”±åˆ†ç»„<a class="anchor ms-1" href="#è·¯ç”±åˆ†ç»„"></a></h1>
<p><code>RouterGroup</code> æ˜¯ä¸€ç§è·¯ç”±ç»„å¯¹è±¡ï¼ˆ<code>Engine</code> ç»§æ‰¿è‡ª <code>RouterGroup</code>ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªè·¯ç”±ç»„ï¼‰ã€‚é€šè¿‡ <code>Group()</code> æ–¹æ³•å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>RouterGroup</code>ã€‚<code>Group()</code> æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">Group</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="o">*</span><span class="nx">RouterGroup</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">RouterGroup</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Handlers</span><span class="p">:</span> <span class="nx">group</span><span class="p">.</span><span class="nf">combineHandlers</span><span class="p">(</span><span class="nx">handlers</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">basePath</span><span class="p">:</span> <span class="nx">group</span><span class="p">.</span><span class="nf">calculateAbsolutePath</span><span class="p">(</span><span class="nx">relativePath</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="nx">engine</span><span class="p">:</span>   <span class="nx">group</span><span class="p">.</span><span class="nx">engine</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>relativePath</code>ï¼šè·¯ç”±ç»„çš„ç›¸å¯¹è·¯å¾„ã€‚ä¸ <a href="../request#handle-%e5%92%8c-match"><code>handle()</code> æ–¹æ³•</a> ç›¸åŒï¼Œ<code>relativePath</code> åŒæ ·éœ€è¦ä½¿ç”¨ <code>group.calculateAbsolutePath()</code> æ¥è®¡ç®—å‡ºç»å¯¹è·¯å¾„ã€‚</li>
<li><code>handlers</code>ï¼šè·¯ç”±ç»„çš„å¤„ç†æ–¹æ³•ï¼Œä¸€èˆ¬æ˜¯å°†å…¶ä½œä¸ºä¸­é—´å¤„ç†å‡½æ•°ï¼ˆä¸­é—´ä»¶ï¼‰æ¥å®šä¹‰ã€‚</li>
</ul>
<p><code>RouterGroup</code> ç±»å‹çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">RouterGroup</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Handlers</span> <span class="nx">HandlersChain</span>
</span></span><span class="line"><span class="cl">	<span class="nx">basePath</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">engine</span>   <span class="o">*</span><span class="nx">Engine</span>
</span></span><span class="line"><span class="cl">	<span class="nx">root</span>     <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>root</code> å’Œ <code>engine</code> å­—æ®µæ¥æ ‡è®°å½“å‰è·¯ç”±ç»„æ˜¯å¦ä¸ºæ ¹è·¯ç”±ï¼Œä»¥åŠæ ¹è·¯ç”±çš„åœ°å€ï¼ˆ<code>Engine</code> å¯ä»¥è®¤ä¸ºæ˜¯å½“å‰ Gin ç¨‹åºä¸­æ‰€æœ‰è·¯ç”±ç»„çš„æ ¹è·¯ç”±ç»„ï¼‰ï¼›</li>
<li><code>Handlers</code> è®°å½•äº†å½“å‰è·¯ç”±ç»„ä¸­æ‰€éœ€è¦çš„ä¸€ç³»åˆ—è·¯ç”±å¤„ç†å‡½æ•°ï¼ˆå…¶ä¸­ä¹ŸåŒ…æ‹¬äº†å®ƒä¸Šå±‚è·¯ç”±çš„å¤„ç†å‡½æ•°ï¼‰ï¼›</li>
<li><code>basePath</code> æŒ‡æ˜äº†å½“å‰è·¯ç”±ç»„çš„ç»å¯¹è·¯å¾„ã€‚</li>
</ul>
<p>è·¯ç”±ç»„çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// åˆ›å»ºè·¯ç”±ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">user</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;/user&#34;</span><span class="p">,</span> <span class="nx">middlewares</span><span class="p">.</span><span class="nx">UserMiddleware</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">user</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">context</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">context</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;User get\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">user</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">context</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">context</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;User post\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">user</span><span class="p">.</span><span class="nf">PUT</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">context</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">context</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;User put\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">user</span><span class="p">.</span><span class="nf">DELETE</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">context</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">context</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;User delete\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å¯¹äºä»»ä½•ä¸€ä¸ª <code>RouterGroup</code> æ¥è¯´ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ <code>Group()</code> æ–¹æ³•åˆ›å»ºè·¯ç”±ï¼Œå³ä½¿è¯¥ <code>RouterGroup</code> ä¹Ÿæ˜¯ç”±å…¶å®ƒ <code>RouterGroup</code> åˆ›å»ºçš„ã€‚</p>
<hr>
<h1 id="routers-åŒ…" data-numberify>Routers åŒ…<a class="anchor ms-1" href="#routers-åŒ…"></a></h1>
<p>ä¸€èˆ¬åœ¨é¡¹ç›®ä¸­ï¼Œä¼šä¸“é—¨åˆ›å»ºä¸€ä¸ª <code>routers</code> åŒ…æ¥å­˜æ”¾é¡¹ç›®ä¸­è·¯ç”±é…ç½®çš„ç›¸å…³ä»£ç ã€‚</p>
<p>å°†ä¸€ç³»åˆ—ç›¸å…³çš„è·¯ç”±æŠ½å–ä¸ºç†ç”±ç»„åï¼Œå¯ä»¥ä¸“é—¨ä¸ºå…¶åœ¨ <code>routers</code> åŒ…ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ¥å­˜æ”¾è¿™ä¸€ç³»åˆ—è·¯ç”±çš„é…ç½®ã€‚ä¾‹å¦‚å¯ä»¥å°† <code>user</code> è·¯ç”±ä¸­çš„å†…å®¹é…ç½®åœ¨ <code>user.go</code> ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">UserRoutersInit</span><span class="p">(</span><span class="nx">engin</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Engine</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">user</span> <span class="o">:=</span> <span class="nx">engin</span><span class="p">.</span><span class="nf">Group</span><span class="p">(</span><span class="s">&#34;/user&#34;</span><span class="p">,</span> <span class="nx">middlewares</span><span class="p">.</span><span class="nx">UserMiddleware</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">user</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">context</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">context</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;User get\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">user</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">context</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">context</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;User post\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">user</span><span class="p">.</span><span class="nf">PUT</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">context</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">context</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;User put\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="nx">user</span><span class="p">.</span><span class="nf">DELETE</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">context</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">context</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;User delete\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// ç›¸å¯¹è·¯å¾„ä¼ å…¥ç©ºä¸²ï¼Œè¡¨ç¤ºè¯·æ±‚è·¯å¾„ä¸è·¯ç”±ç»„çš„è·¯å¾„ç›¸åŒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// éœ€è¦æ³¨æ„ï¼Œä¸èƒ½ä½¿ç”¨ &#34;/&#34; æ¥è¡¨ç¤º â€œå½“å‰è¯·æ±‚è·¯å¾„ä¸è·¯ç”±ç»„çš„è·¯å¾„ç›¸åŒâ€ è¿™ä¸€å«ä¹‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>åœ¨ <code>routers</code> åŒ…ä¸­å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>routers.go</code> æ¥é…ç½®æ ¹è·¯ç”±ã€è®¾ç½®å…¨å±€ä¸­é—´ä»¶ä»¥åŠåˆå§‹åŒ–å…¶å®ƒè·¯ç”±ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Router</span><span class="p">()</span> <span class="p">(</span><span class="nx">engine</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Engine</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// åˆ›å»ºæ ¹è·¯ç”±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">engine</span> <span class="p">=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// åˆå§‹åŒ–å…¶å®ƒå­è·¯ç”±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">UserRoutersInit</span><span class="p">(</span><span class="nx">engine</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ ¹è·¯ç”±çš„åˆ›å»ºé™¤äº†ä½¿ç”¨ <code>gin.Default()</code> å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>gin.New()</code>ã€‚<code>gin.Default()</code> é»˜è®¤ä½¿ç”¨äº† <code>gin.Logger()</code> å’Œ <code>gin.Recovery()</code>ã€‚ä½¿ç”¨ <code>gin.New()</code> æ¥åˆ›å»ºè·¯ç”±ï¼Œéœ€è¦è‡ªå·±æ‰‹åŠ¨é…ç½® <code>Logger</code> å’Œ <code>Recovery</code> ä¸­é—´ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">engine</span> <span class="p">=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">engine</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">gin</span><span class="p">.</span><span class="nf">Logger</span><span class="p">(),</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Recovery</span><span class="p">())</span>
</span></span></code></pre></div><blockquote>
<ul>
<li><code>gin.Logger()</code>ï¼šæ—¥å¿—ã€‚</li>
<li><code>gin.Recovery()</code>ï¼šé”™è¯¯ç®¡ç†ï¼Œå®ƒä¼š <code>recover()</code> ä»»ä½• <code>panic()</code>ï¼Œå¹¶ä¸”è¿”å›ç»™å®¢æˆ·ç«¯ <code>500</code> å“åº”ç ã€‚</li>
</ul>
</blockquote>
<hr>
<h1 id="controllers-åŒ…" data-numberify>Controllers åŒ…<a class="anchor ms-1" href="#controllers-åŒ…"></a></h1>
<p>é™¤äº†è·¯ç”±ï¼Œè·¯ç”±å¤„ç†å™¨ä¹Ÿå¯ä»¥å®šä¹‰åœ¨ä¸“é—¨çš„ <code>controllers</code> åŒ…ä¸­ã€‚ä¾‹å¦‚ï¼Œ<code>user</code> è·¯ç”±ï¼Œé¦–å…ˆåœ¨ <code>controllers</code> åŒ…ä¸­åˆ›å»º <code>user.go</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// userController ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">userController</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// UserController ç¤ºä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡å†…éƒ¨ç±»å‹ï¼Œä»¥åŠå®šä¹‰å¤–éƒ¨å®ä¾‹ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªç®€å•çš„å•ä¾‹æ¨¡å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">UserController</span> <span class="nx">userController</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">userController</span><span class="p">)</span> <span class="nf">GetUser</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">context</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;User get\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">userController</span><span class="p">)</span> <span class="nf">AddUser</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">context</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;User post\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">userController</span><span class="p">)</span> <span class="nf">UpdateUser</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">context</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;User put\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">userController</span><span class="p">)</span> <span class="nf">DeleteUser</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">context</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;User delete\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ¥ç€ï¼Œä¿®æ”¹ <code>routers/user.go</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">user</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nx">controllers</span><span class="p">.</span><span class="nx">UserController</span><span class="p">.</span><span class="nx">GetUser</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">user</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nx">controllers</span><span class="p">.</span><span class="nx">UserController</span><span class="p">.</span><span class="nx">AddUser</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">user</span><span class="p">.</span><span class="nf">PUT</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nx">controllers</span><span class="p">.</span><span class="nx">UserController</span><span class="p">.</span><span class="nx">UpdateUser</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">user</span><span class="p">.</span><span class="nf">DELETE</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nx">controllers</span><span class="p">.</span><span class="nx">UserController</span><span class="p">.</span><span class="nx">DeleteUser</span><span class="p">)</span>
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
    <item>
      <title>Gin è·å–è¯·æ±‚</title>
      <link>/docs/golang/gin/request/</link>
      <pubDate>Sat, 29 Jun 2024 17:03:06 +0000</pubDate>
      
      <guid>/docs/golang/gin/request/</guid>
      <description><![CDATA[Gin è¯·æ±‚åœ¨ Gin ä»‹ç» ä¸­åšäº†ç®€å•çš„ä»‹ç»ã€‚ Gin è¯·æ±‚ä¸ RouterGroup å’Œ IRoutes æ¯æ¯ç›¸å…³ã€‚IRoutesæ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œå®ƒå®šä¹‰äº†ä¸€ç³»åˆ—ç”¨äºé…ç½®è·¯ç”±å¤„ç†çš„æ–¹æ³•ï¼š type IRoutes interface { // ç”¨äºé…]]></description>
      <content:encoded><![CDATA[<p>Gin è¯·æ±‚åœ¨ <a href="../introduction#gin-%e8%af%b7%e6%b1%82">Gin ä»‹ç»</a> ä¸­åšäº†ç®€å•çš„ä»‹ç»ã€‚</p>
<p>Gin è¯·æ±‚ä¸ <code>RouterGroup</code> å’Œ <code>IRoutes</code> æ¯æ¯ç›¸å…³ã€‚<code>IRoutes</code>æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œå®ƒå®šä¹‰äº†ä¸€ç³»åˆ—ç”¨äºé…ç½®è·¯ç”±å¤„ç†çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">IRoutes</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ç”¨äºé…ç½®è·¯ç”±ä¸­é—´ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">Use</span><span class="p">(</span><span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// è·¯ç”±å¤„ç†æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">Handle</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Any</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">	<span class="nf">GET</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">	<span class="nf">POST</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">	<span class="nf">DELETE</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">	<span class="nf">PATCH</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">	<span class="nf">PUT</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">	<span class="nf">OPTIONS</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">	<span class="nf">HEAD</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Match</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// é™æ€æ–‡ä»¶å¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">StaticFile</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">	<span class="nf">StaticFileFS</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">FileSystem</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Static</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">	<span class="nf">StaticFS</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">FileSystem</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>è€Œ <code>RouterGroup</code> æ˜¯ <code>IRoutes</code> çš„ä¸€ä¸ªå®ç°ã€‚</p>
<blockquote>
<p>åœ¨ Gin ä¸­ï¼Œè·¯ç”±ç±»å‹çš„ç»§æ‰¿å…³ç³»ä¸º <code>IRoutes</code> $\leftarrow$ <code>RouterGroup</code> $\leftarrow$ <code>Engine</code>ã€‚</p>
</blockquote>
<hr>
<h1 id="åŸºæœ¬è¯·æ±‚è·¯ç”±æ–¹æ³•" data-numberify>åŸºæœ¬è¯·æ±‚è·¯ç”±æ–¹æ³•<a class="anchor ms-1" href="#åŸºæœ¬è¯·æ±‚è·¯ç”±æ–¹æ³•"></a></h1>
<p><code>net/http</code> ä¸­æ”¯æŒçš„è¯·æ±‚æ–¹å¼ï¼ŒGin å‡æ”¯æŒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">const</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MethodGet</span>     <span class="p">=</span> <span class="s">&#34;GET&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MethodHead</span>    <span class="p">=</span> <span class="s">&#34;HEAD&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MethodPost</span>    <span class="p">=</span> <span class="s">&#34;POST&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MethodPut</span>     <span class="p">=</span> <span class="s">&#34;PUT&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MethodPatch</span>   <span class="p">=</span> <span class="s">&#34;PATCH&#34;</span> <span class="c1">// RFC 5789
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">MethodDelete</span>  <span class="p">=</span> <span class="s">&#34;DELETE&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MethodConnect</span> <span class="p">=</span> <span class="s">&#34;CONNECT&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MethodOptions</span> <span class="p">=</span> <span class="s">&#34;OPTIONS&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">MethodTrace</span>   <span class="p">=</span> <span class="s">&#34;TRACE&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼ŒGin ç»™ <code>GET</code>ã€<code>HEAD</code>ã€<code>POST</code>ã€<code>PUT</code>ã€<code>PATCH</code>ã€<code>DELETE</code>ã€<code>OPTIONS</code> æä¾›äº†å¯¹åº”å¿«æ·çš„è·¯ç”±æ–¹æ³•ï¼Œå®ƒä»¬çš„å®šä¹‰å¤§è‡´å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">POST</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodPost</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">GET</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodGet</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">DELETE</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodDelete</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">PATCH</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodPatch</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">PUT</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodPut</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">OPTIONS</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodOptions</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">HEAD</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodHead</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>é™¤æ­¤ä¹‹å¤–ï¼ŒGin è¿˜æä¾›äº†ä¸€ä¸ªå¯ä»¥æ¥æ”¶æ‰€æœ‰è¯·æ±‚æ–¹å¼çš„è·¯ç”±æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// å¯ä»¥æ¥æ”¶å¦‚ä¸‹è¯·æ±‚æ–¹å¼ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1">// GET, POST, PUT, PATCH, HEAD, OPTIONS, DELETE, CONNECT, TRACE.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">Any</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">method</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">anyMethods</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">returnObj</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ä¸Šæ–¹ <code>Any()</code>ã€<code>GET()</code> ç­‰ä¸€ç³»åˆ—æ–¹æ³•çš„ä½¿ç”¨æ–¹å¼å‡ç›¸åŒï¼š</p>
<ul>
<li>
<p><code>relativePath</code>ï¼šè¡¨ç¤ºè·¯ç”±æ¥æ”¶çš„è¯·æ±‚ç›¸å¯¹è·¯å¾„ã€‚ä¾‹å¦‚ <code>/hello</code>ã€‚</p>
</li>
<li>
<p><code>handlers</code>ï¼šæ˜¯ä¸€ç³»åˆ—è¯·æ±‚å¤„ç†å‡½æ•° <code>HandlerFunc</code>ã€‚å¯ä»¥æŒ‡å®šå¤šä¸ª <code>HandlerFunc</code>ï¼Œå®ƒä»¬å°†æŒ‰ç…§æŒ‡å®šçš„é¡ºåºæ‰§è¡Œã€‚ä¸­é—´ä»¶ï¼ˆmiddlewareï¼‰ã€è¿‡æ»¤å™¨ï¼ˆfilterï¼‰ã€æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰ç­‰ï¼Œéƒ½å¯ä»¥åŸºäºæ­¤è¿›è¡Œå®ç°ã€‚</p>
<p><code>HandlerFunc</code> çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">HandlerFunc</span> <span class="kd">func</span><span class="p">(</span><span class="o">*</span><span class="nx">Context</span><span class="p">)</span>
</span></span></code></pre></div></li>
<li>
<p><code>IRoutes</code>ï¼šå®šä¹‰äº†ä¸€ç³»åˆ—è·¯ç”±è¯·æ±‚æ–¹æ³•ã€‚</p>
</li>
</ul>
<hr>
<h1 id="handle-å’Œ-match" data-numberify>Handle å’Œ Match<a class="anchor ms-1" href="#handle-å’Œ-match"></a></h1>
<p>é€šè¿‡è§‚å¯Ÿä¸Šæ–¹ä¸€ç³»åˆ—è¯·æ±‚è·¯ç”±æ–¹æ³•ï¼Œå¯ä»¥å‘ç°å®ƒä»¬éƒ½è°ƒç”¨äº† <code>group.handle()</code> æ–¹æ³•ã€‚<code>group.handle()</code> æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">httpMethod</span><span class="p">,</span> <span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="nx">HandlersChain</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">absolutePath</span> <span class="o">:=</span> <span class="nx">group</span><span class="p">.</span><span class="nf">calculateAbsolutePath</span><span class="p">(</span><span class="nx">relativePath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">handlers</span> <span class="p">=</span> <span class="nx">group</span><span class="p">.</span><span class="nf">combineHandlers</span><span class="p">(</span><span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">group</span><span class="p">.</span><span class="nx">engine</span><span class="p">.</span><span class="nf">addRoute</span><span class="p">(</span><span class="nx">httpMethod</span><span class="p">,</span> <span class="nx">absolutePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">returnObj</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>httpMethod</code>ï¼šå®ƒçš„å‚æ•°ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯ <code>net/http</code> åŒ…ä¸‹çš„ <code>MethodXxx</code> å¸¸é‡ã€‚</li>
<li><code>relativePath</code>ï¼šè¯·æ±‚çš„ç›¸å¯¹è·¯å¾„ã€‚é€šè¿‡ <code>group.calculateAbsolutePath()</code> è®¡ç®—å‡º<u>ç»å¯¹è·¯å¾„</u>ï¼Œå…¶å†…éƒ¨æ˜¯ä½¿ç”¨ <code>path</code> åŒ…ä¸‹çš„ <code>Join()</code> å®ç°çš„ã€‚</li>
<li><code>handlers</code>ï¼šè·¯ç”±å¤„ç†æ–¹æ³•ã€‚<code>HandlersChain</code> çš„å®šä¹‰æ˜¯ <code>type HandlersChain []HandlerFunc</code>ã€‚</li>
</ul>
<p>æœ€ç»ˆæ˜¯é€šè¿‡ <code>group.engine.addRoute()</code>ï¼Œä¹Ÿå°±æ˜¯ <code>gin.Engine</code> çš„ <code>addRoute()</code> æ–¹æ³•ï¼Œä¼ å…¥è¯·æ±‚æ–¹å¼ã€ç»å¯¹è·¯å¾„ä»¥åŠè¯·æ±‚å¤„ç†å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„è·¯ç”±ã€‚</p>
<h2 id="handle" data-numberify>Handle<a class="anchor ms-1" href="#handle"></a></h2>
<p>Gin å¯¹å¤–æä¾›äº†ä¸€ä¸ªæ¥å£ <code>Handle()</code> è®©ç”¨æˆ·èƒ½å¤Ÿç›´æ¥ä½¿ç”¨æ›´åŠ åŸºç¡€çš„ <code>handle()</code> æ–¹æ³•ã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">Handle</span><span class="p">(</span><span class="nx">httpMethod</span><span class="p">,</span> <span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">matched</span> <span class="o">:=</span> <span class="nx">regEnLetter</span><span class="p">.</span><span class="nf">MatchString</span><span class="p">(</span><span class="nx">httpMethod</span><span class="p">);</span> <span class="p">!</span><span class="nx">matched</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="s">&#34;http method &#34;</span> <span class="o">+</span> <span class="nx">httpMethod</span> <span class="o">+</span> <span class="s">&#34; is not valid&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">httpMethod</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨ <code>Handle()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">Handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodGet</span><span class="p">,</span> <span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;Hello World!&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>ç­‰ä»·äºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;Hello World!&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><blockquote>
<p>ä¸Šè¿°ä¸¤ç§è·å– GET è¯·æ±‚çš„æ–¹å¼å¹¶æ²¡æœ‰ä»»ä½•æ˜æ˜¾çš„åŒºåˆ«ã€‚ä¸è¿‡ <code>Handle()</code> å¯ä»¥æ”¯æŒå…¶å®ƒæ›´å¤šçš„è¯·æ±‚æ–¹å¼ï¼Œä¾‹å¦‚è¦æ¥æ”¶ Gin æ²¡æœ‰æä¾›ç®€ä¾¿è·¯ç”±æ–¹æ³•çš„ <code>TRACE</code> è¯·æ±‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">Handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodTrace</span><span class="p">,</span> <span class="s">&#34;/trace&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;Success!&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div></blockquote>
<h2 id="match" data-numberify>Match<a class="anchor ms-1" href="#match"></a></h2>
<p>å¯¹äº <code>Handle()</code>ã€<code>All()</code>ã€<code>GET()</code> è¿™äº›è·¯ç”±æ–¹æ³•æ¥è¯´ï¼Œå®ƒä»¬æ¯æ¬¡è°ƒç”¨éƒ½åªèƒ½é…ç½®ä¸€ç§è¯·æ±‚æ–¹å¼ï¼Œè€Œ Gin æä¾›äº† <code>Match()</code> æ¥æ”¯æŒåŒæ—¶é…ç½®å¤šç§è¯·æ±‚æ–¹å¼çš„è·¯ç”±ã€‚<code>Match()</code> çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">Match</span><span class="p">(</span><span class="nx">methods</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">method</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">methods</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">returnObj</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å¯ä»¥å‘ç° <code>methods</code> å‚æ•°æ˜¯ä¸€ä¸ª <code>[]string</code> ç±»å‹çš„ã€‚<code>Match()</code> é€šè¿‡éå† <code>methods</code>ï¼Œç„¶åä¸ºå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´  <code>method</code> è°ƒç”¨ <code>group.handle()</code> æ–¹æ³•ã€‚</p>
<p><code>Match()</code> çš„ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">Match</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">http</span><span class="p">.</span><span class="nx">MethodPut</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">MethodPost</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;Hello World!&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><hr>
<h1 id="è·å–è¯·æ±‚æ•°æ®" data-numberify>è·å–è¯·æ±‚æ•°æ®<a class="anchor ms-1" href="#è·å–è¯·æ±‚æ•°æ®"></a></h1>
<p>è¯·æ±‚æ•°æ®çš„è·å–ä¹Ÿéœ€è¦ä½¿ç”¨åˆ° <code>gin.Context</code>ã€‚</p>
<h2 id="query-å‚æ•°" data-numberify>Query å‚æ•°<a class="anchor ms-1" href="#query-å‚æ•°"></a></h2>
<p>Query å‚æ•°ä¸€èˆ¬å’Œ GET è¯·æ±‚ä¸€åŒä½¿ç”¨ï¼Œè·å–æŒ‡å®šçš„ Query å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ <code>Query()</code> æˆ– <code>DefaultQuery()</code> æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/user/info&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é€šè¿‡ Query() æ–¹æ³•è·å–æŒ‡å®šçš„ Query å‚æ•°å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">idStr</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ç±»å‹è½¬æ¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">id</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">ParseInt</span><span class="p">(</span><span class="nx">idStr</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">username</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å–å¹¶æŒ‡å®šé»˜è®¤å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">sexStr</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">DefaultQuery</span><span class="p">(</span><span class="s">&#34;sex&#34;</span><span class="p">,</span> <span class="s">&#34;0&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ç±»å‹è½¬æ¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">sex</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">ParseInt</span><span class="p">(</span><span class="nx">sexStr</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// å“åº”æ•°æ®å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">user</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;id&#34;</span><span class="p">:</span>       <span class="nx">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;username&#34;</span><span class="p">:</span> <span class="nx">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;sex&#34;</span><span class="p">:</span>      <span class="nx">sex</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// å“åº”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>è¯·æ±‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X GET <span class="s1">&#39;http://127.0.0.1:8080/user/info?id=123456&amp;username=zhangsan&amp;sex=1&#39;</span>
</span></span></code></pre></div><ul>
<li><code>Query()</code>ï¼šè·å– Query å‚æ•°ä½†ä¸æŒ‡å®šé»˜è®¤å€¼ã€‚å½“è¯·æ±‚æ—¶æ²¡æœ‰ä¼ é€’æŒ‡å®šçš„å‚æ•°ï¼Œæˆ–æŒ‡å®šå‚æ•°ä¸ºç©ºæ—¶ï¼Œå…¶è¿”å›å€¼å°†æ˜¯ä¸€ä¸ªç©ºä¸²ã€‚</li>
<li><code>DefaultQuery()</code>ï¼šè·å– Query å‚æ•°ä¸”ä¸ºå…¶æŒ‡å®šé»˜è®¤å€¼ã€‚å½“è¯·æ±‚æ—¶æ²¡æœ‰ä¼ é€’æŒ‡å®šçš„å‚æ•°ï¼Œå…¶è¿”å›å€¼å°†æ˜¯æŒ‡å®šçš„é»˜è®¤å€¼ï¼›å¦‚æœæŒ‡å®šçš„å‚æ•°æ˜¯ç©ºä¸²ï¼Œé‚£ä¹ˆè·å–åˆ°çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªç©ºä¸²ã€‚</li>
</ul>
<p><code>Query()</code> å’Œ <code>DefaultQuery()</code> å†…éƒ¨æ˜¯é€šè¿‡ <code>GetQuery()</code> å®ç°çš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>GetQuery()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">id</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡ GetQuery() è·å– id å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">GetQuery</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å¦‚æœè·å–æˆåŠŸï¼Œå°±å°†å…¶è½¬ä¸º int64
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">ParseInt</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">id</span> <span class="p">=</span> <span class="nx">result</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="ç»‘å®š-query" data-numberify>ç»‘å®š Query<a class="anchor ms-1" href="#ç»‘å®š-query"></a></h3>
<p>å¯¹äºä¸€äº›ç»“æ„å›ºå®šçš„ Query è¯·æ±‚å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥å®šä¹‰ä¸€ä¸ªç»“æ„ä½“å¹¶ç»‘å®šå…¶å®ä¾‹ï¼Œè€Œæ— éœ€ä½¿ç”¨ <code>Query()</code>ã€<code>DefaultQuery()</code> æˆ– <code>GetQuery()</code> æ‰‹åŠ¨è·å–è¡¨å•ä¸­çš„æ¯ä¸€ä¸ªå­—æ®µã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// å­—æ®µä½¿ç”¨æŒ‡é’ˆç±»å‹ï¼Œä»¥ä¾¿è·å– null å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">UserQuery</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Username</span> <span class="o">*</span><span class="kt">string</span> <span class="s">`form:&#34;username&#34; json:&#34;username&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Sex</span>      <span class="o">*</span><span class="kt">uint8</span>  <span class="s">`form:&#34;sex&#34; json:&#34;sex&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/user&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">query</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">UserQuery</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">BindQuery</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">query</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æˆ–è€…ï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//err := ctx.ShouldBindQuery(&amp;query)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//err := ctx.ShouldBindWith(&amp;query, binding.Query)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">query</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><blockquote>
<p>åœ¨ Gin ä¸­ï¼Œç»‘å®š Query å®ä¾‹æ—¶ï¼ŒåŒæ ·éœ€è¦åœ¨ç»“æ„ä½“å­—æ®µä¸­ä½¿ç”¨ Tags æŒ‡å®šå­—æ®µçš„ Query å‚æ•°åç§°ï¼Œå¦åˆ™å®ƒå°†æŒ‰ç…§åŸæœ‰çš„é¦–å­—æ¯å¤§å†™å½¢å¼è·å–å¯¹åº”å€¼ã€‚åœ¨æŒ‡å®šç»“æ„ä½“å­—æ®µ Query å‚æ•°åˆ«åæ—¶ï¼Œä½¿ç”¨çš„æ˜¯ <code>form</code> è¿™ä¸€ Tagã€‚</p>
</blockquote>
<h2 id="form-å‚æ•°" data-numberify>Form å‚æ•°<a class="anchor ms-1" href="#form-å‚æ•°"></a></h2>
<p>é€šè¿‡ <code>PostForm()</code> æˆ– <code>DefaultPostForm()</code> å¯ä»¥è·å–ä»»ä½•ç±»å‹çš„ Form è¡¨å•æ•°æ®ï¼ŒåŒ…æ‹¬ <code>multipart/form-data</code> å’Œ <code>application/x-www-form-urlencoded</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/user/info&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// é€šè¿‡ PostForm() æ–¹æ³•è·å–æŒ‡å®šçš„ Form å‚æ•°å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">idStr</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">PostForm</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">id</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">ParseInt</span><span class="p">(</span><span class="nx">idStr</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">username</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">PostForm</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sexStr</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">DefaultPostForm</span><span class="p">(</span><span class="s">&#34;sex&#34;</span><span class="p">,</span> <span class="s">&#34;0&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">sex</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">ParseInt</span><span class="p">(</span><span class="nx">sexStr</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// å“åº”æ•°æ®å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">user</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;id&#34;</span><span class="p">:</span>       <span class="nx">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;username&#34;</span><span class="p">:</span> <span class="nx">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;sex&#34;</span><span class="p">:</span>      <span class="nx">sex</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><code>PostForm()</code> å’Œ <code>DefaultPostForm()</code> ä¸ <code>Query()</code> å’Œ <code>DefaultQuery()</code> çš„ç”¨æ³•ç±»ä¼¼ã€‚<code>PostForm()</code> å’Œ <code>DefaultPostForm()</code> å†…éƒ¨åŒæ ·éƒ½æœ‰ä¸€ä¸ªç›¸åŒçš„å®ç°ï¼Œå®ƒå°±æ˜¯ <code>GetPostForm()</code>ã€‚<code>GetPostForm()</code> çš„ç”¨æ³•ä¸ <code>GetQuery()</code> çš„ç”¨æ³•ç›¸ä¼¼ã€‚</p>
<blockquote>
<p>è™½ç„¶ <code>PostForm()</code>ã€<code>DefaultPostForm()</code> å’Œ <code>GetPostForm()</code> åç§°ä¸­æ˜¾å¼æŒ‡å®šäº†æ˜¯è·å–åœ¨ POST è¯·æ±‚ä¸­æäº¤çš„è¡¨å•ï¼Œä½†åœ¨ Gin ä¸­ï¼Œ<code>PostForm()</code> åŒæ ·å¯ä»¥ç”¨äºå…¶å®ƒè¯·æ±‚æ–¹æ³•æ¥æ”¶ Form æ•°æ®ã€‚</p>
</blockquote>
<h3 id="ç»‘å®šè¡¨å•" data-numberify>ç»‘å®šè¡¨å•<a class="anchor ms-1" href="#ç»‘å®šè¡¨å•"></a></h3>
<p>å¯¹äºä¸€äº›ç»“æ„å›ºå®šçš„è¡¨å•è¯·æ±‚å¯¹è±¡ï¼ŒåŒæ ·å¯ä»¥ç›´æ¥å®šä¹‰ä¸€ä¸ªç»“æ„ä½“å¹¶ç»‘å®šå…¶å®ä¾‹ï¼Œæ— éœ€æ‰‹åŠ¨è·å–è¡¨å•ä¸­çš„æ¯ä¸€ä¸ªå­—æ®µã€‚æ–¹æ³•ä¸ç»‘å®š Query å®ä¾‹ç›¸ä¼¼ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">UserForm</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Username</span> <span class="o">*</span><span class="kt">string</span> <span class="s">`form:&#34;username&#34; json:&#34;username&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Nickname</span> <span class="o">*</span><span class="kt">string</span> <span class="s">`form:&#34;nickname&#34; json:&#34;nickname&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Sex</span>      <span class="o">*</span><span class="kt">uint8</span>  <span class="s">`form:&#34;sex&#34; json:&#34;sex&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/user&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">form</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">UserForm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">err</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">ShouldBind</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">form</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// æˆ–è€…ä½¿ç”¨ ShouldBindWith() æ˜¾ç¤ºå£°æ˜ç»‘å®š Form
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">//err := ctx.ShouldBindWith(&amp;form, binding.Form)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">form</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><h2 id="è·å–-json-æ•°æ®" data-numberify>è·å– JSON æ•°æ®<a class="anchor ms-1" href="#è·å–-json-æ•°æ®"></a></h2>
<p>è¦è·å– JSON æ•°æ®ï¼Œéœ€è¦ç»‘å®šå®ä¾‹ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">UserDto</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Username</span> <span class="o">*</span><span class="kt">string</span> <span class="s">`form:&#34;username&#34; json:&#34;username&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Nickname</span> <span class="o">*</span><span class="kt">string</span> <span class="s">`form:&#34;nickname&#34; json:&#34;nickname&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Sex</span>      <span class="o">*</span><span class="kt">uint8</span>  <span class="s">`form:&#34;sex&#34; json:&#34;sex&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/user&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">form</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">UserDto</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">err</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">ShouldBindJSON</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">form</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// æˆ–è€…ä½¿ç”¨ ShouldBindWith() æ˜¾å¼å£°æ˜ç»‘å®š JSON
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">//err := ctx.ShouldBindWith(&amp;form, binding.JSON)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">form</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><h2 id="è·å–-uri-å‚æ•°" data-numberify>è·å– URI å‚æ•°<a class="anchor ms-1" href="#è·å–-uri-å‚æ•°"></a></h2>
<p>è·å– URI å‚æ•°å¯ä»¥ä½¿ç”¨ <code>Param()</code> æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello/:username&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">username</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">Param</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;Hello, %s!&#34;</span><span class="p">,</span> <span class="nx">username</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><h3 id="ç»‘å®š-uri" data-numberify>ç»‘å®š URI<a class="anchor ms-1" href="#ç»‘å®š-uri"></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">ArticleQo</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Username</span>    <span class="o">*</span><span class="kt">string</span> <span class="s">`uri:&#34;username&#34; json:&#34;username&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ArticleName</span> <span class="o">*</span><span class="kt">string</span> <span class="s">`uri:&#34;article-name&#34; json:&#34;article-name&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/article/:username/:article-name&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">query</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">ArticleQo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">ShouldBindUri</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">query</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">query</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><h2 id="æ•°æ®ç»‘å®šçš„æ³¨æ„äº‹é¡¹" data-numberify>æ•°æ®ç»‘å®šçš„æ³¨æ„äº‹é¡¹<a class="anchor ms-1" href="#æ•°æ®ç»‘å®šçš„æ³¨æ„äº‹é¡¹"></a></h2>
<h3 id="contextshouldbindwith" data-numberify>Context.ShouldBindWith<a class="anchor ms-1" href="#contextshouldbindwith"></a></h3>
<p><code>Context.Bind()</code> å’Œ <code>Context.ShouldBind()</code> å¯ä»¥ç»‘å®šä»»æ„ç±»å‹çš„è¯·æ±‚æ•°æ®ï¼ŒåŒ…æ‹¬ Queryã€Formã€JSON ç­‰ç­‰ã€‚å®ƒä»¬éƒ½æ˜¯é€šç”¨çš„æ•°æ®ç»‘å®šæ–¹æ³•ï¼Œä¼šæ ¹æ®è¯·æ±‚çš„å†…å®¹ç±»å‹ï¼ˆContent-Typeï¼‰è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„æ•°æ®ç»‘å®šå™¨ã€‚</p>
<p>æ¯”èµ· <code>Context.Bind()</code>ï¼Œ<code>Context.ShouldBind()</code> æ˜¯ä¸€ç§æ›´é«˜çº§ã€æ›´çµæ´»çš„æ•°æ®ç»‘å®šæ–¹æ³•ï¼Œå®ƒæä¾›äº†é¢å¤–çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚<code>Context.Bind()</code> åœ¨ç»‘å®šå¤±è´¥æ—¶ä¼šç›´æ¥ç»“æŸå¤„ç†æµç¨‹ï¼Œè€Œ<code>Context.ShouldBind()</code> åœ¨ç»‘å®šå¤±è´¥æ—¶ä¸ç›´æ¥ç»“æŸè¯·æ±‚å¤„ç†æµç¨‹ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œè¿™å…è®¸æˆ‘ä»¬åœ¨å¤„ç†å‡½æ•°ä¸­æ ¹æ®è¿™ä¸ªé”™è¯¯åšå‡ºè¿›ä¸€æ­¥çš„å“åº”æ“ä½œã€‚æ›´ç¡®åˆ‡åœ°è¯´ï¼Œ<code>ShouldBind</code> ç³»åˆ—çš„æ•°æ®ç»‘å®šæ–¹æ³•ï¼Œåœ¨é‡åˆ°ç»‘å®šé”™è¯¯æ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³ä¸­æ–­è¯·æ±‚å¤„ç†æµç¨‹ï¼›è€Œ <code>Bind</code> ç³»åˆ—ä¼šç«‹å³ç»ˆæ­¢æ‰§è¡Œåç»­çš„å¤„ç†é€»è¾‘ã€‚</p>
<p>ä» Gin å®ç°ä¸­æ¥è¯´ï¼Œ<code>Bind</code> ç³»åˆ—çš„ç»‘å®šæ–¹æ³•å‡ ä¹éƒ½æ˜¯ä½¿ç”¨ <code>Context.MustBindWith()</code> å®ç°çš„ï¼Œè€Œ <code>Context.MustBindWith()</code> å†…éƒ¨æ˜¯ä½¿ç”¨ <code>Context.ShouldBindWith()</code> å®ç°çš„ã€‚å¹¶ä¸” <code>ShouldBind</code>ï¼ˆä¸åŒ…æ‹¬ <code>ShouldBindBody</code>ï¼‰ç³»åˆ—çš„ç»‘å®šæ–¹æ³•å‡ ä¹éƒ½æ˜¯ä½¿ç”¨ <code>Context.ShouldBindWith()</code> æ–¹æ³•å®ç°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>Context.ShouldBindWith()</code> å®ç°äº† <code>Context</code> ä¸­å¤§éƒ¨ä»½çš„ç»‘å®šæ–¹æ³•ã€‚</p>
<h3 id="binding-tag" data-numberify>Binding Tag<a class="anchor ms-1" href="#binding-tag"></a></h3>
<p>åœ¨ä½¿ç”¨æ•°æ®ç»‘å®šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>binding</code> Tag æ¥è®¾å®šå­—æ®µçš„çº¦æŸæ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œåœ¨å­—æ®µä¸Šè®¾ç½® <code>binding:&quot;required&quot;</code> æ¥è§„å®šè¯¥å­—æ®µæ˜¯å¿…é¡»çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">ArticleQo</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Username</span>    <span class="o">*</span><span class="kt">string</span> <span class="s">`form:&#34;name&#34; json:&#34;username&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ArticleName</span> <span class="o">*</span><span class="kt">string</span> <span class="s">`form:&#34;article-name&#34; json:&#34;article-name&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ArticleID</span>   <span class="o">*</span><span class="kt">uint64</span> <span class="s">`form:&#34;article-id&#34; json:&#34;article-id&#34; binding:&#34;required&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/article&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">query</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">ArticleQo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">err</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">ShouldBind</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">query</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">query</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>åœ¨å‘é€è¯·æ±‚æ—¶ï¼Œå¿…é¡»ä¼ å…¥ <code>article-id</code> è¿™ä¸ªå­—æ®µï¼Œå¦åˆ™å°†ä¼šå‡ºç°é”™è¯¯ã€‚</p>
<h3 id="shouldbind-å’Œ-shouldbindbodywith" data-numberify>ShouldBind å’Œ ShouldBindBodyWith<a class="anchor ms-1" href="#shouldbind-å’Œ-shouldbindbodywith"></a></h3>
<ul>
<li>
<p><code>Context.ShouldBind()</code>ï¼šåŒ…æ‹¬ <code>Context.ShouldBindWith()</code>ã€<code>Context.Bind()</code> ç­‰ã€‚å®ƒä»¬ä½¿ç”¨çš„æ˜¯ <code>ctx.Request.Body</code> ç»‘å®šæ•°æ®ï¼Œåªèƒ½è¿›è¡Œä¸€æ¬¡æ•°æ®ç»‘å®šï¼Œå¤šæ¬¡è°ƒç”¨æ—¶å°†ä¼šå‡ºç°é”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºç¬¬ä¸€ç»‘å®šæ•°æ®åï¼Œ<code>ctx.Request.Body</code> ä¸­çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ï¼Œ<code>ctx.Request.Body</code> ä¸­åªå‰©ä¸‹äº† <code>EOF</code>ã€‚</p>
</li>
<li>
<p><code>Context.ShouldBindBodyWith()</code>ï¼šæ”¯æŒå¤šæ¬¡ç»‘å®šã€‚è¿™æ˜¯å› ä¸º <code>Context.ShouldBindBodyWith()</code> ä¼šåœ¨ç»‘å®šä¹‹å‰å°† <code>body</code> å­˜å‚¨åˆ°ä¸Šä¸‹æ–‡ä¸­ã€‚ä¹Ÿå°±æ˜¯ç›¸å½“äºåœ¨ <code>body</code> çš„å‰¯æœ¬ä¸Šè¿›è¡Œè¯»å–ã€‚ä½†è¿™ä¼šå¯¹æ€§èƒ½é€ æˆè½»å¾®å½±å“ï¼Œåº”è¯¥å°½é‡é¿å…å¤šæ¬¡è°ƒç”¨å®ƒã€‚</p>
<blockquote>
<p>åªæœ‰æŸäº›æ ¼å¼éœ€è¦æ­¤åŠŸèƒ½ï¼Œå¦‚ JSON, XML, MsgPack, ProtoBufã€‚ å¯¹äºå…¶ä»–æ ¼å¼, å¦‚ Query, Form, FormPost, FormMultipart å¯ä»¥å¤šæ¬¡è°ƒç”¨ c.ShouldBind() è€Œä¸ä¼šé€ æˆä»»ä»»ä½•æ€§èƒ½æŸå¤±ã€‚</p>
</blockquote>
</li>
</ul>
<hr>
<h1 id="æ–‡ä»¶ä¸Šä¼ " data-numberify>æ–‡ä»¶ä¸Šä¼ <a class="anchor ms-1" href="#æ–‡ä»¶ä¸Šä¼ "></a></h1>
<h2 id="å•æ–‡ä»¶ä¸Šä¼ " data-numberify>å•æ–‡ä»¶ä¸Šä¼ <a class="anchor ms-1" href="#å•æ–‡ä»¶ä¸Šä¼ "></a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">imageFilesPath</span> <span class="p">=</span> <span class="nf">absPath</span><span class="p">(</span><span class="s">&#34;./static/images&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">maxMultipartMemory</span> <span class="kt">int64</span> <span class="p">=</span> <span class="mi">8</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span> <span class="c1">// 8MiB
</span></span></span><span class="line"><span class="cl"><span class="c1">// å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">allowExtMap</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;.jpg&#34;</span><span class="p">:</span>  <span class="kc">true</span><span class="p">,</span> <span class="s">&#34;.png&#34;</span><span class="p">:</span>  <span class="kc">true</span><span class="p">,</span> <span class="s">&#34;.gif&#34;</span><span class="p">:</span>  <span class="kc">true</span><span class="p">,</span> <span class="s">&#34;.jpeg&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è®¾ç½®å†…å­˜é™åˆ¶ä¸º 8MiBï¼ˆå…¨å±€ï¼‰ï¼Œé»˜è®¤ä¸º 32MiB
</span></span></span><span class="line"><span class="cl"><span class="c1">// è¿™ä¸ªå†…å­˜é™åˆ¶æ˜¯é™åˆ¶æ¯æ¬¡å¤„ç†æ–‡ä»¶æ‰€å ç”¨çš„æœ€å¤§å†…å­˜ï¼Œé˜²æ­¢å› æ–‡ä»¶è¿‡å¤§å ç”¨å¤ªå¤šå†…å­˜
</span></span></span><span class="line"><span class="cl"><span class="c1">//r.MaxMultipartMemory = maxMultipartMemory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/upload&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// åœ¨è¯·æ±‚ä¸­é™åˆ¶æ¯æ¬¡å¤„ç†å†…å­˜å¤§å°ï¼ˆä½œç”¨åŒä¸Šï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nf">ParseMultipartForm</span><span class="p">(</span><span class="nx">maxMultipartMemory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å–ä»å®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">image</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">FormFile</span><span class="p">(</span><span class="s">&#34;image&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å–æ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">filename</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">Filename</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// é™åˆ¶æ–‡ä»¶ä¸Šä¼ ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// è·å–æ–‡ä»¶ååç¼€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">extname</span> <span class="o">:=</span> <span class="nx">path</span><span class="p">.</span><span class="nf">Ext</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// åˆ¤æ–­æ–‡ä»¶ååç¼€æ˜¯å¦å­˜åœ¨ä¸”åˆæ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">allowed</span><span class="p">,</span> <span class="nx">isExisted</span> <span class="o">:=</span> <span class="nx">allowExtMap</span><span class="p">[</span><span class="nx">extname</span><span class="p">];</span> <span class="p">!(</span><span class="nx">isExisted</span> <span class="o">&amp;&amp;</span> <span class="nx">allowed</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">msg</span> <span class="o">:=</span> <span class="s">&#34;The file type is not valid&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Infof</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="nx">msg</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// æ ¹æ®æ—¥æœŸåˆ›å»ºå›¾ç‰‡ä¿å­˜ç›®å½•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">today</span> <span class="o">:=</span> <span class="nx">utils2</span><span class="p">.</span><span class="nf">Today</span><span class="p">(</span><span class="s">&#34;20060102&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">dir</span> <span class="o">:=</span> <span class="nf">absPath</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="nx">imageFilesPath</span><span class="p">,</span> <span class="nx">today</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// åˆ›å»ºåŸºç¡€ç›®å½•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">MkdirAll</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="mo">0666</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;Server error&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ç”Ÿæˆå”¯ä¸€çš„æ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">uniqueFilename</span> <span class="o">:=</span> <span class="nf">generateUniqueFilename</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// æ‹¼æ¥æ–‡ä»¶ä¿å­˜è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">dst</span> <span class="o">:=</span> <span class="nx">path</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="nx">uniqueFilename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å°†æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">SaveUploadedFile</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span> <span class="nx">dst</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">logrus</span><span class="p">.</span><span class="nf">Infof</span><span class="p">(</span><span class="s">&#34;Save image %v&#34;</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;originFilename&#34;</span><span class="p">:</span> <span class="nx">filename</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;savedFilename&#34;</span><span class="p">:</span>  <span class="nx">uniqueFilename</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;size&#34;</span><span class="p">:</span>           <span class="nx">image</span><span class="p">.</span><span class="nx">Size</span><span class="p">,</span> <span class="c1">// æ–‡ä»¶å¤§å°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="s">&#34;saved_dir&#34;</span><span class="p">:</span>      <span class="nx">dir</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;Success!&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>å…¶ä¸­ <code>absPath()</code> å’Œ <code>generateUniqueFilename()</code> çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">absPath</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">dir</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">filepath</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">dir</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">generateUniqueFilename</span><span class="p">(</span><span class="nx">originalName</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å–æ—¶é—´æˆ³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">timestamp</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">UnixNano</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ç”Ÿæˆéšæœºå­—ç¬¦ä¸²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">randomBytes</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="nx">randomBytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">randomStr</span> <span class="o">:=</span> <span class="nx">base64</span><span class="p">.</span><span class="nx">URLEncoding</span><span class="p">.</span><span class="nf">EncodeToString</span><span class="p">(</span><span class="nx">randomBytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å–æ–‡ä»¶æ‰©å±•å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">extension</span> <span class="o">:=</span> <span class="nx">filepath</span><span class="p">.</span><span class="nf">Ext</span><span class="p">(</span><span class="nx">originalName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å–æ–‡ä»¶åï¼ˆå»é™¤æ‰©å±•åï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">baseName</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">TrimSuffix</span><span class="p">(</span><span class="nx">originalName</span><span class="p">,</span> <span class="nx">extension</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ç”Ÿæˆä¸å†²çªçš„æ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s_%d_%s%s&#34;</span><span class="p">,</span> <span class="nx">baseName</span><span class="p">,</span> <span class="nx">timestamp</span><span class="p">,</span> <span class="nx">randomStr</span><span class="p">[:</span><span class="mi">8</span><span class="p">],</span> <span class="nx">extension</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ä» Form è¡¨å•ä¸­è·å–å•ä¸ªæ–‡ä»¶ï¼Œéœ€è¦ä½¿ç”¨ <code>Context.FormFile()</code> è·å– <code>multipart.FileHeader</code> å®ä¾‹çš„åœ°å€ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">image</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">FormFile</span><span class="p">(</span><span class="s">&#34;image&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>é€šè¿‡è¿™ä¸ªå®ä¾‹ï¼Œå¯ä»¥è·å–åˆ° <code>Filename</code>ã€<code>Size</code> ç­‰ä¿¡æ¯ï¼Œä½¿ç”¨ <code>Context.SaveUploadedFile()</code> å¯ä»¥å°† <code>multipart.FileHeader</code> ä¸­çš„æ–‡ä»¶å†…å®¹ä¿å­˜åˆ°æœ¬åœ°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// è·å–æ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">filename</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">Filename</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// å°†æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">SaveUploadedFile</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span> <span class="nx">dst</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">logrus</span><span class="p">.</span><span class="nf">Infof</span><span class="p">(</span><span class="s">&#34;Save image %v&#34;</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;originFilename&#34;</span><span class="p">:</span> <span class="nx">filename</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;savedFilename&#34;</span><span class="p">:</span>  <span class="nx">uniqueFilename</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;size&#34;</span><span class="p">:</span>           <span class="nx">image</span><span class="p">.</span><span class="nx">Size</span><span class="p">,</span> <span class="c1">// æ–‡ä»¶å¤§å°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="s">&#34;saved_dir&#34;</span><span class="p">:</span>      <span class="nx">dir</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>ç„¶åä½¿ç”¨ <code>path</code> åŒ…ä¸­çš„æ–¹æ³•å¯¹æ–‡ä»¶åã€æ–‡ä»¶ååç¼€ä»¥åŠæ–‡ä»¶è·¯å¾„è¿›è¡Œå¤„ç†ã€‚</p>
<h2 id="å¤šæ–‡ä»¶ä¸Šä¼ " data-numberify>å¤šæ–‡ä»¶ä¸Šä¼ <a class="anchor ms-1" href="#å¤šæ–‡ä»¶ä¸Šä¼ "></a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">imageFilesPath</span> <span class="p">=</span> <span class="nf">absPath</span><span class="p">(</span><span class="s">&#34;./static/images&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/upload&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å–è¡¨å•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">form</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">MultipartForm</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è¯»å–ä¸Šä¼ çš„å¤šä¸ªæ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">images</span> <span class="o">:=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">File</span><span class="p">[</span><span class="s">&#34;images[]&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">image</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">images</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">filename</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">Filename</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// ç”Ÿæˆå”¯ä¸€çš„æ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">uniqueFilename</span> <span class="o">:=</span> <span class="nf">generateUniqueFilename</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// æ‹¼æ¥æ–‡ä»¶ä¿å­˜è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">dst</span> <span class="o">:=</span> <span class="nx">path</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="nx">imageFilesPath</span><span class="p">,</span> <span class="nx">uniqueFilename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// å°†æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">SaveUploadedFile</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span> <span class="nx">dst</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Infof</span><span class="p">(</span><span class="s">&#34;Save image %v&#34;</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;originFilename&#34;</span><span class="p">:</span> <span class="nx">filename</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;savedFilename&#34;</span><span class="p">:</span>  <span class="nx">uniqueFilename</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;size&#34;</span><span class="p">:</span>           <span class="nx">image</span><span class="p">.</span><span class="nx">Size</span><span class="p">,</span> <span class="c1">// æ–‡ä»¶å¤§å°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;Success!&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>è¯»å–ä¸Šä¼ çš„å¤šä¸ªæ–‡ä»¶ï¼Œé¦–å…ˆéœ€è¦è·å– <code>multipart.Form</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">form</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">MultipartForm</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç„¶åå†é€šè¿‡ <code>multipart.Form</code> è¯»å–ä¸Šä¼ çš„å¤šä¸ªæ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">images</span> <span class="o">:=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">File</span><span class="p">[</span><span class="s">&#34;images[]&#34;</span><span class="p">]</span>
</span></span></code></pre></div><h2 id="æ–‡ä»¶è¯»å–" data-numberify>æ–‡ä»¶è¯»å–<a class="anchor ms-1" href="#æ–‡ä»¶è¯»å–"></a></h2>
<p>é€šè¿‡è°ƒç”¨ <code>multipart.FileHeader</code> çš„ <code>Open()</code> æ–¹æ³•ï¼Œå¯ä»¥è·å–åˆ°ä¸€ä¸ª <code>multipart.File</code>ã€‚<code>multipart.File</code> å®ç°äº† <code>io.ReadCloser</code> æ¥å£ã€‚é€šè¿‡ <code>multipart.File</code>ï¼Œå¯ä»¥å¯¹ä¸Šä¼ åçš„æ–‡ä»¶è¿›è¡Œä¸€äº›æ“ä½œã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/handle-image&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å–ä»å®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">image</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">FormFile</span><span class="p">(</span><span class="s">&#34;image&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// æ‰“å¼€ä¸Šä¼ çš„æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">Open</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ç»“æŸæ—¶å…³é—­æ–‡ä»¶æµ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">defer</span> <span class="kd">func</span><span class="p">(</span><span class="nx">file</span> <span class="nx">multipart</span><span class="p">.</span><span class="nx">File</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}(</span><span class="nx">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// åˆ›å»ºä¸€ä¸ªç¼“å†²åŒºæ¥è¯»å–æ–‡ä»¶å†…å®¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kd">var</span> <span class="nx">buffer</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">io</span><span class="p">.</span><span class="nf">Copy</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">buffer</span><span class="p">,</span> <span class="nx">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// å‡è®¾å¯¹æ–‡ä»¶è¿›è¡Œäº†ä¸€äº›æ“ä½œ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è®¾ç½®æ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ctx</span><span class="p">.</span><span class="nf">Header</span><span class="p">(</span><span class="s">&#34;Content-Disposition&#34;</span><span class="p">,</span> <span class="s">&#34;attachment; filename=&#34;</span><span class="o">+</span><span class="nx">image</span><span class="p">.</span><span class="nx">Filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// å“åº”å­—èŠ‚æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ctx</span><span class="p">.</span><span class="nf">Data</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;application/octet-stream&#34;</span><span class="p">,</span> <span class="nx">buffer</span><span class="p">.</span><span class="nf">Bytes</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å¦‚æœæ“ä½œçš„æ–‡ä»¶è¿‡äºåºå¤§ï¼Œå°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜ä¸è¶³çš„é—®é¢˜ã€‚å¯¹äºå¤§æ–‡ä»¶ï¼Œæ¨èä½¿ç”¨æµå¼å¤„ç†ï¼Œå³é€å—è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§è¯»å–æ‰€æœ‰æ•°æ®ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/handle-image&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å–ä»å®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">image</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">FormFile</span><span class="p">(</span><span class="s">&#34;image&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// æ‰“å¼€ä¸Šä¼ çš„æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">Open</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">defer</span> <span class="kd">func</span><span class="p">(</span><span class="nx">file</span> <span class="nx">multipart</span><span class="p">.</span><span class="nx">File</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}(</span><span class="nx">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ä½¿ç”¨ä¸€ä¸ªç¼“å†²åŒºæ¥é€å—è¯»å–å’Œå“åº”æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">buffer</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// å¾ªç¯è¯»å–æ•°æ®å¹¶å†™å…¥å“åº”ï¼Œæ¯æ¬¡æœ€å¤šè¯»å– 1024 byte æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">size</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span> <span class="c1">// è¯»å–åˆ°æ•°æ®æµç»“å°¾ï¼Œç»“æŸå¾ªç¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// å°†è¯»å–çš„æ•°æ®å†™å…¥å“åº”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">writeErr</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">Writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="nx">buffer</span><span class="p">[:</span><span class="nx">size</span><span class="p">]);</span> <span class="nx">writeErr</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">writeErr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ctx</span><span class="p">.</span><span class="nf">Header</span><span class="p">(</span><span class="s">&#34;Content-Disposition&#34;</span><span class="p">,</span> <span class="s">&#34;attachment; filename=&#34;</span><span class="o">+</span><span class="nx">image</span><span class="p">.</span><span class="nx">Filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ctx</span><span class="p">.</span><span class="nf">Header</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;application/octet-stream&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
    <item>
      <title>Gin å“åº”æ•°æ®</title>
      <link>/docs/golang/gin/response/</link>
      <pubDate>Sat, 29 Jun 2024 07:48:18 +0000</pubDate>
      
      <guid>/docs/golang/gin/response/</guid>
      <description><![CDATA[Gin æ”¯æŒå„ç§å“åº”æ•°æ®ç±»å‹ï¼šJSONã€XMLã€HTMLã€YAMLã€Text ç­‰ç­‰ã€‚å“åº”æ•°æ®éœ€è¦ä½¿ç”¨åˆ° gin.Context ç±»å‹ã€‚gin.Context ç±»å‹çš„ä½œç”¨æœ‰ï¼š è·]]></description>
      <content:encoded><![CDATA[<p>Gin æ”¯æŒå„ç§å“åº”æ•°æ®ç±»å‹ï¼šJSONã€XMLã€HTMLã€YAMLã€Text ç­‰ç­‰ã€‚å“åº”æ•°æ®éœ€è¦ä½¿ç”¨åˆ° <code>gin.Context</code> ç±»å‹ã€‚<code>gin.Context</code> ç±»å‹çš„ä½œç”¨æœ‰ï¼š</p>
<ul>
<li>è·å–è¯·æ±‚æ•°æ®ï¼ŒåŒ…æ‹¬è¯·æ±‚å¤´ã€Query å‚æ•°ã€Form æ•°æ®ã€Path å‚æ•°ã€è¯·æ±‚ä½“ç­‰ã€‚</li>
<li>å“åº”ç®¡ç†ï¼ŒåŒ…æ‹¬è®¾ç½® HTTP çŠ¶æ€ç ã€ç¼–å†™å“åº”ä½“ã€è®¾ç½®å“åº”å¤´ç­‰ã€‚</li>
<li>ä¸­é—´ä»¶æ”¯æŒã€‚<code>Context</code> å¯ä»¥æºå¸¦å½“å‰å¤„ç†å‡½æ•°çš„ä¿¡æ¯ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œç›´åˆ°è¾¾åˆ°æœ€ç»ˆçš„å¤„ç†å‡½æ•°ã€‚åœ¨ä¸­é—´ä»¶ä¸­å¯ä»¥ä½¿ç”¨ <code>Context</code> è¯»å–ã€ä¿®æ”¹ <code>Context</code> çš„å†…å®¹æˆ–ç»ˆæ­¢è¯·æ±‚å¤„ç†æµç¨‹ã€‚</li>
<li>Cookie æ“ä½œã€‚</li>
<li>è¯»å†™è¯·æ±‚å’Œå“åº”ä½“çš„åŸå§‹å­—èŠ‚æµï¼Œä»¥æ­¤æ¥å¤„ç†è‡ªå®šä¹‰åè®®æˆ–äºŒè¿›åˆ¶æ•°æ®ä¼ è¾“ã€‚</li>
<li>é”™è¯¯å¤„ç†ã€‚å¯ä»¥è®°å½•é”™è¯¯å¹¶ä¸­æ–­è¯·æ±‚å¤„ç†æµç¨‹ã€‚</li>
</ul>
<p>å“åº”æ•°æ®ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSONP</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">Response</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Code</span><span class="p">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Date</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å¸¸è§çš„å“åº”æ•°æ®æ–¹æ³•æœ‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="c1">// String writes the given string into the response body.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">String</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">values</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">render</span><span class="p">.</span><span class="nx">String</span><span class="p">{</span><span class="nx">Format</span><span class="p">:</span> <span class="nx">format</span><span class="p">,</span> <span class="nx">Data</span><span class="p">:</span> <span class="nx">values</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// JSON serializes the given struct as JSON into the response body.
</span></span></span><span class="line"><span class="cl"><span class="c1">// It also sets the Content-Type as &#34;application/json&#34;.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">JSON</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">obj</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">render</span><span class="p">.</span><span class="nx">JSON</span><span class="p">{</span><span class="nx">Data</span><span class="p">:</span> <span class="nx">obj</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// PureJSON serializes the given struct as JSON into the response body.
</span></span></span><span class="line"><span class="cl"><span class="c1">// PureJSON, unlike JSON, does not replace special html characters with their unicode entities.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">PureJSON</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">obj</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">render</span><span class="p">.</span><span class="nx">PureJSON</span><span class="p">{</span><span class="nx">Data</span><span class="p">:</span> <span class="nx">obj</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// XML serializes the given struct as XML into the response body.
</span></span></span><span class="line"><span class="cl"><span class="c1">// It also sets the Content-Type as &#34;application/xml&#34;.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">XML</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">obj</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">render</span><span class="p">.</span><span class="nx">XML</span><span class="p">{</span><span class="nx">Data</span><span class="p">:</span> <span class="nx">obj</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// YAML serializes the given struct as YAML into the response body.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">YAML</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">obj</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">render</span><span class="p">.</span><span class="nx">YAML</span><span class="p">{</span><span class="nx">Data</span><span class="p">:</span> <span class="nx">obj</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// JSONP serializes the given struct as JSON into the response body.
</span></span></span><span class="line"><span class="cl"><span class="c1">// It adds padding to response body to request data from a server residing in a different domain than the client.
</span></span></span><span class="line"><span class="cl"><span class="c1">// It also sets the Content-Type as &#34;application/javascript&#34;.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">JSONP</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">obj</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">callback</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">DefaultQuery</span><span class="p">(</span><span class="s">&#34;callback&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">callback</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">render</span><span class="p">.</span><span class="nx">JSON</span><span class="p">{</span><span class="nx">Data</span><span class="p">:</span> <span class="nx">obj</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">render</span><span class="p">.</span><span class="nx">JsonpJSON</span><span class="p">{</span><span class="nx">Callback</span><span class="p">:</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">Data</span><span class="p">:</span> <span class="nx">obj</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Data writes some data into the body stream and updates the HTTP code.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">Data</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">contentType</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">data</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">render</span><span class="p">.</span><span class="nx">Data</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">ContentType</span><span class="p">:</span> <span class="nx">contentType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Data</span><span class="p">:</span>        <span class="nx">data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// HTML renders the HTTP template specified by its file name.
</span></span></span><span class="line"><span class="cl"><span class="c1">// It also updates the HTTP code and sets the Content-Type as &#34;text/html&#34;.
</span></span></span><span class="line"><span class="cl"><span class="c1">// See http://golang.org/doc/articles/wiki/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">HTML</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">obj</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">instance</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">engine</span><span class="p">.</span><span class="nx">HTMLRender</span><span class="p">.</span><span class="nf">Instance</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">instance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>é€šè¿‡ä¸Šè¿°å“åº”æ•°æ®æ–¹æ³•çš„å®šä¹‰å¯ä»¥å‘ç°ï¼Œå®ƒä»¬éƒ½æ˜¯è°ƒç”¨äº† <code>Render()</code> è¿™ä¸ªæ–¹æ³•ã€‚</p>
<hr>
<h1 id="å“åº”-text-ç±»å‹æ•°æ®" data-numberify>å“åº” Text ç±»å‹æ•°æ®<a class="anchor ms-1" href="#å“åº”-text-ç±»å‹æ•°æ®"></a></h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å“åº” Text ç±»å‹æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">ctx</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;Hello World!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>å…¶ä¸­ <code>http.StatusOK</code> æ˜¯ <code>net/http</code> åŒ…ä¸­ <code>200</code> å“åº”çŠ¶æ€ç å¸¸é‡ã€‚</p>
<hr>
<h1 id="å“åº”-xml-ç±»å‹æ•°æ®" data-numberify>å“åº” XML ç±»å‹æ•°æ®<a class="anchor ms-1" href="#å“åº”-xml-ç±»å‹æ•°æ®"></a></h1>
<p>å“åº”å’Œæ¸²æŸ“ XML ç±»å‹æ•°æ®å¯ä»¥ä½¿ç”¨ <code>ctx.XML()</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">XML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;Hello World!&#34;</span><span class="p">,</span> <span class="s">&#34;status&#34;</span><span class="p">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>å“åº”ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;map&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;message&gt;</span>
</span></span><span class="line"><span class="cl">        Hello World!
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/message&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;status&gt;</span>
</span></span><span class="line"><span class="cl">        200
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/status&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/map&gt;</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼Œ<code>ctx.XML()</code> æ–¹æ³•çš„å‚æ•° 2 æ˜¯æ¸²æŸ“ XML çš„æ•°æ®å¯¹è±¡ã€‚å…¶ç±»å‹ä¸º <code>any</code>ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">any</span> <span class="p">=</span> <span class="kd">interface</span><span class="p">{}</span>
</span></span></code></pre></div><p>ä½¿ç”¨ <code>any</code> å¯ä»¥æ¥æ”¶ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</p>
<p><code>gin.H</code> æ˜¯ <code>map</code> ç±»å‹ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">H</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">any</span>
</span></span></code></pre></div><hr>
<h1 id="å“åº”-html-ç±»å‹æ•°æ®" data-numberify>å“åº” HTML ç±»å‹æ•°æ®<a class="anchor ms-1" href="#å“åº”-html-ç±»å‹æ•°æ®"></a></h1>
<p>æ–¹å¼ 1ï¼šä½¿ç”¨ <code>ctx.Header()</code> å’Œ <code>ctx.String()</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">Header</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;text/html; charset=utf-8&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;&lt;h2&gt;Hello World!&lt;/h2&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>æ–¹å¼ 2ï¼š<code>ctx.HTML()</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ä» templates ç›®å½•ä¸­åŠ è½½æ‰€æœ‰çš„ HTML æ¨¡æ¿æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">r</span><span class="p">.</span><span class="nf">LoadHTMLGlob</span><span class="p">(</span><span class="s">&#34;templates/*&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;index.html&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>åœ¨ä½¿ç”¨ <code>ctx.HTML()</code> æ–¹æ³•ä¹‹å‰ï¼Œå¿…é¡»å…ˆåŠ è½½ HTML æ¨¡æ¿æ–‡ä»¶ã€‚åŠ è½½ HTML æ¨¡æ¿æ–‡ä»¶çš„æ–¹å¼æœ‰ï¼š</p>
<ol>
<li>
<p>æŒ‰æ–‡ä»¶åç§°åŠ è½½ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">LoadHTMLFiles</span><span class="p">(</span><span class="s">&#34;templates/index.html&#34;</span><span class="p">,</span> <span class="s">&#34;templates/welcome.html&#34;</span><span class="p">)</span>
</span></span></code></pre></div></li>
<li>
<p>æŒ‰è·¯å¾„é…å¯¹è¡¨è¾¾å¼åŠ è½½ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">LoadHTMLGlob</span><span class="p">(</span><span class="s">&#34;templates/*&#34;</span><span class="p">)</span>
</span></span></code></pre></div></li>
</ol>
<h2 id="html-æ¸²æŸ“" data-numberify>HTML æ¸²æŸ“<a class="anchor ms-1" href="#html-æ¸²æŸ“"></a></h2>
<p>Gin æ”¯æŒå¯¹ HTML æ¨¡æ¿è¿›è¡Œæ¸²æŸ“ã€‚</p>
<p>ä¾‹å¦‚ <code>templates/welcome.html</code>ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!doctype html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;zh&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;ie=edge&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Welcome!<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>{{ .name }}, Welcome!<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>å…¶ä¸­ <code>{{ .name }}</code> è¡¨ç¤ºå°† <code>name</code> å±æ€§ä¸­çš„æ•°æ®æ¸²æŸ“äºæ­¤ã€‚</p>
<p>ç„¶åç¼–å†™ä¸€ä¸ªè·¯ç”±ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">LoadHTMLFiles</span><span class="p">(</span><span class="s">&#34;templates/welcome.html&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/welcome&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;welcome.html&#34;</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;å¼ ä¸‰&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><code>ctx.HTML()</code> æ–¹æ³•çš„ç¬¬ 3 ä¸ªå‚æ•°å°±æ˜¯è¦æ¸²æŸ“åˆ° HTML æ¨¡æ¿ä¸­çš„æ•°æ®å¯¹è±¡ã€‚</p>
<p>è®¿é—® <code>GET /welcome</code>ï¼Œè·å–åˆ°çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!doctype html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;zh&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;ie=edge&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Welcome!<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>å¼ ä¸‰, Welcome!<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><h2 id="æ¸²æŸ“å¤šä¸ªæ¨¡æ¿" data-numberify>æ¸²æŸ“å¤šä¸ªæ¨¡æ¿<a class="anchor ms-1" href="#æ¸²æŸ“å¤šä¸ªæ¨¡æ¿"></a></h2>
<p>åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»º <code>templates/index.html</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>é¦–é¡µ<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>ç½‘ç«™é¦–é¡µ: {{ .data }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>åˆ›å»º <code>templates/login.html</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>ç™»å½•<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>ç™»å½•é¡µ: {{ .data }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>æ¥ç€åœ¨ Golang ä¸­åŠ è½½ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŠ è½½ templates ç›®å½•ä¸‹æ‰€æœ‰çš„é¡µé¢æ¨¡æ¿ï¼ˆéœ€è¦åœ¨ gin.Default() åç«‹å³è°ƒç”¨ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">r</span><span class="p">.</span><span class="nf">LoadHTMLGlob</span><span class="p">(</span><span class="s">&#34;templates/*&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/index&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ¸²æŸ“æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ctx</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;index.html&#34;</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;data&#34;</span><span class="p">:</span> <span class="s">&#34;æ¸²æŸ“æ•°æ®&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/login&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// æ¸²æŸ“æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ctx</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;login.html&#34;</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;data&#34;</span><span class="p">:</span> <span class="s">&#34;æ¸²æŸ“æ•°æ®&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="æ¸²æŸ“å¤šå±‚é¡µé¢" data-numberify>æ¸²æŸ“å¤šå±‚é¡µé¢<a class="anchor ms-1" href="#æ¸²æŸ“å¤šå±‚é¡µé¢"></a></h2>
<p>ä½¿ç”¨ <code>r.LoadHTMLGlob(&quot;templates/*&quot;)</code> åªèƒ½æ¸²æŸ“ <code>templates</code> ç›®å½•ä¸‹çš„ HTML æ–‡ä»¶ï¼Œå¦‚æœåœ¨ <code>templates</code> ç›®å½•ä¸‹å»ºç«‹å¤šå±‚ç›®å½•ï¼Œç¼–è¯‘æ—¶ä¼šæŠ¥é”™ã€‚è¦æ¸²æŸ“å¤šå±‚é¡µé¢éœ€è¦ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ï¼š</p>
<p>é‡æ–°åˆ›å»ºä¸€ä¸ª <code>templates</code>ï¼Œåˆ›å»º <code>templates/login/index.html</code> å’Œ <code>templates/home/index.html</code>ã€‚</p>
<p><code>templates/login/index.html</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="c">&lt;!-- é€šè¿‡ define ç»™æ¨¡æ¿æŒ‡å®šåç§°ï¼Œdefine å’Œ end éœ€æˆå¯¹å‡ºç° --&gt;</span>
</span></span><span class="line"><span class="cl">{{ define &#34;login/index.html&#34; }}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>ç™»å½•<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>ç™»å½•é¡µé¢ï¼š{{ .data }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{{ end }}
</span></span></code></pre></div><p><code>templates/home/index.html</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">{{ define &#34;home/index.html&#34; }}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>é¦–é¡µ<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>ç½‘ç«™é¦–é¡µ: {{ .data }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{{ end }}
</span></span></code></pre></div><p><code>main.go</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åªèƒ½åŠ è½½ templates ä¸‹ä¸€çº§ç›®å½•çš„é¡µé¢æ¨¡æ¿
</span></span></span><span class="line"><span class="cl"><span class="c1">// å½“éœ€è¦é€šé…ç›®å½•æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ â€œ**â€ï¼Œé€šé…é¡µé¢æ¨¡æ¿æ–‡ä»¶ä»…éœ€ â€œ*â€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">r</span><span class="p">.</span><span class="nf">LoadHTMLGlob</span><span class="p">(</span><span class="s">&#34;templates/**/*&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/login&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ctx</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;login/index.html&#34;</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;data&#34;</span><span class="p">:</span> <span class="s">&#34;è¯·ç™»å½•&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/home&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ctx</span><span class="p">.</span><span class="nf">HTML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;home/index.html&#34;</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;data&#34;</span><span class="p">:</span> <span class="s">&#34;æ¸²æŸ“æ•°æ®&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><hr>
<h1 id="å“åº”-yaml-ç±»å‹æ•°æ®" data-numberify>å“åº” YAML ç±»å‹æ•°æ®<a class="anchor ms-1" href="#å“åº”-yaml-ç±»å‹æ•°æ®"></a></h1>
<p>å“åº”å’Œæ¸²æŸ“ YAML ç±»å‹æ•°æ®å¯ä»¥ä½¿ç”¨ <code>ctx.YAML()</code> æ–¹æ³•ã€‚å…¶ä½¿ç”¨æ–¹å¼ä¸ <code>ctx.XML()</code> ç›¸åŒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">YAML</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;Hello World!&#34;</span><span class="p">,</span> <span class="s">&#34;status&#34;</span><span class="p">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>å…¶ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="l">Hello World!</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="m">200</span><span class="w">
</span></span></span></code></pre></div><hr>
<h1 id="å“åº”-json-ç±»å‹æ•°æ®" data-numberify>å“åº” JSON ç±»å‹æ•°æ®<a class="anchor ms-1" href="#å“åº”-json-ç±»å‹æ•°æ®"></a></h1>
<p>å“åº” JSON æ•°æ®æœ‰å¤šç§æ–¹å¼ï¼š</p>
<ol>
<li><code>ctx.JSON()</code></li>
<li><code>ctx.AsciiJSON()</code></li>
<li><code>ctx.PureJSON()</code></li>
<li><code>ctx.SecureJSON()</code></li>
</ol>
<h2 id="ctxjson" data-numberify>ctx.JSON<a class="anchor ms-1" href="#ctxjson"></a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;&lt;h2&gt;ä½ å¥½ï¼Œä¸–ç•Œ!&lt;/h2&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;status&#34;</span><span class="p">:</span>  <span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>å…¶ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;\u003ch2\u003eä½ å¥½ï¼Œä¸–ç•Œ!\u003c/h2\u003e&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p><code>ctx.JSON()</code> ä¼šä½¿ç”¨ Unicode æ›¿æ¢ç‰¹æ®Š HTML å­—ç¬¦ã€‚</p>
</blockquote>
<p>å¸¸è§çš„ <code>ctx.JSON()</code> ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// é€šå¸¸æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ map[string]interface{} ä¼ é€’
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/json1&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ç”±äº any çš„å®šä¹‰æ˜¯ interface{} æ‰€ä»¥ä¹Ÿå¯ä»¥å†™æˆ map[string]any
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;code&#34;</span><span class="p">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;data&#34;</span><span class="p">:</span> <span class="s">&#34;Hello Gin!&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Gin ç»™ map[string]interface{} æä¾›äº†ä¸€ä¸ªç®€ä¾¿çš„ç±»å‹å®šä¹‰ gin.H
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/json2&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;code&#34;</span><span class="p">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;data&#34;</span><span class="p">:</span> <span class="s">&#34;Hello Gin!&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ctx.JSON ä¹Ÿæ”¯æŒä¼ å…¥ç»“æ„ä½“ç±»å‹å®ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Response</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Code</span> <span class="kt">uint8</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Data</span> <span class="kd">interface</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/json3&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">Response</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Code</span><span class="p">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Data</span><span class="p">:</span> <span class="s">&#34;Hello Gin!&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><h2 id="ctxasciijson" data-numberify>ctx.AsciiJSON<a class="anchor ms-1" href="#ctxasciijson"></a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">AsciiJSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;&lt;h2&gt;ä½ å¥½ï¼Œä¸–ç•Œ!&lt;/h2&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;status&#34;</span><span class="p">:</span>  <span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>å“åº”ç»“æœä¸ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;\u003ch2\u003e\u4f60\u597d\uff0c\u4e16\u754c!\u003c/h2\u003e&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>ctx.AsciiJSON()</code> å³ä¸º ASCII-only JSONï¼Œå®ƒä¼šå°†é ASCII æ ‡å‡†å­—ç¬¦è¿›è¡Œ Unicode è½¬ä¹‰ã€‚å®ƒåŒæ ·ä¼šä½¿ç”¨ Unicode æ›¿æ¢ç‰¹æ®Š HTML å­—ç¬¦ã€‚</p>
<h2 id="ctxpurejson" data-numberify>ctx.PureJSON<a class="anchor ms-1" href="#ctxpurejson"></a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">PureJSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;&lt;h2&gt;ä½ å¥½ï¼Œä¸–ç•Œ!&lt;/h2&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;status&#34;</span><span class="p">:</span>  <span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;h2&gt;ä½ å¥½ï¼Œä¸–ç•Œ!&lt;/h2&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>ctx.PureJSON()</code> ä¸ä¸Šæ–¹ä¸¤ä¸ªæ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œå®ƒä¸ä¼šå¯¹ JSON ä¸²è¿›è¡Œä»»ä½•è½¬ä¹‰ï¼Œè€Œæ˜¯ç›´æ¥å°†å®ƒæŒ‰ç…§åŸæ•°æ®è¾“å‡ºã€‚</p>
<h2 id="json-åŠ«æŒ" data-numberify>JSON åŠ«æŒ<a class="anchor ms-1" href="#json-åŠ«æŒ"></a></h2>
<p>JSON åŠ«æŒæ˜¯ XSS æ”»å‡»çš„ä¸€ç§å½¢å¼ï¼Œå®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªæ¶æ„ç”¨æˆ·èƒ½å¤Ÿæ’å…¥è‡ªå·±çš„ JavaScript ä»£ç åˆ° JSON å“åº”ä¸­ï¼Œä»è€Œåœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šæ‰§è¡Œéæ³•çš„è„šæœ¬ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ª HTML é¡µé¢å°†è¯·æ±‚åçš„ç»“æœæ’å…¥åˆ°é¡µé¢æ ‡ç­¾ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!doctype html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;zh&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;ie=edge&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://code.jquery.com/jquery-3.6.0.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Hello!<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Hello World!<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://localhost:8080/hello&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>å‡è®¾ <code>GET /hello``GET /hello</code>  è¯·æ±‚å“åº”çš„ <code>message</code> ä¸­åŒ…å«äº†éæ³•çš„è„šæœ¬ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">messages</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Hello!&#34;</span><span class="p">,</span> <span class="s">&#34;Hi!&#34;</span><span class="p">,</span> <span class="s">&#34;Welcome!&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;&lt;script&gt;alert(&#39;You have been hacked!&#39;)&lt;/script&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">messages</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><code>GET /hello</code> è¯·æ±‚å“åº”æˆåŠŸåï¼Œ<code>alert('You have been hacked!')</code> è¿™éƒ¨åˆ†ä»£ç å°†ä¼šè¢«æ‰§è¡Œï¼š</p>
<p><picture><img class="img-fluid " alt="æ¼”ç¤º JSON æ³¨å…¥" src="/docs/golang/gin/response/1719672731900.png" loading="lazy" width="563" height="162" />
</picture>

</p>
<h2 id="ctxsecurejson" data-numberify>ctx.SecureJSON<a class="anchor ms-1" href="#ctxsecurejson"></a></h2>
<p><code>ctx.SecureJSON()</code> èƒ½é˜²æ­¢ JSON åŠ«æŒã€‚å¦‚æœç»™å®šçš„ç»“æ„æ˜¯æ•°ç»„å€¼ï¼Œåˆ™é»˜è®¤é¢„ç½® <code>&quot;while(1);&quot;</code> åˆ°å“åº”ä½“ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">messages</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Hello!&#34;</span><span class="p">,</span> <span class="s">&#34;Hi!&#34;</span><span class="p">,</span> <span class="s">&#34;Welcome!&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;&lt;script&gt;alert(&#39;You have been hacked!&#39;)&lt;/script&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">SecureJSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">messages</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><blockquote>
<p>æ³¨ï¼š<code>ctx.SecureJSON()</code> å¹¶ä¸èƒ½å½»åº•é˜²èŒƒ XSS æ”»å‡»ã€‚</p>
</blockquote>
<h2 id="struct-çš„-json-åºåˆ—åŒ–" data-numberify>Struct çš„ JSON åºåˆ—åŒ–<a class="anchor ms-1" href="#struct-çš„-json-åºåˆ—åŒ–"></a></h2>
<p>ç”±äº <code>ctx.JSON()</code> ç­‰æ–¹æ³•ï¼Œçš„æ•°æ®å‚æ•° <code>obj</code> æ˜¯ <code>any</code> ç±»å‹çš„ï¼Œå› æ­¤å¯ä»¥ä¼ å…¥è‡ªå®šä¹‰çš„ç±»å‹çš„å®ä¾‹ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Id</span>       <span class="kt">uint64</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Username</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Sex</span>      <span class="kt">uint8</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/user/info&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">User</span><span class="p">{</span><span class="nx">Id</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span> <span class="nx">Username</span><span class="p">:</span> <span class="s">&#34;zhangsan&#34;</span><span class="p">,</span> <span class="nx">Sex</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>å‘é€è¯·æ±‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X GET <span class="err">&#39;</span>http://127.0.0.1:8080/user/info
</span></span></code></pre></div><p>ç»“æœä¸ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Id&#34;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Username&#34;</span><span class="p">:</span> <span class="s2">&#34;zhangsan&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Sex&#34;</span><span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç”±äº Golang ç»“æ„ä½“å­—æ®µå¿…é¡»å¾—é¦–å­—æ¯å¤§å†™ï¼Œæ‰èƒ½åœ¨å…¶å®ƒåŒ…ä¸­è®¿é—®ã€‚æ‰€ä»¥ï¼Œè¦åºåˆ—åŒ–çš„ç»“æ„ä½“å­—æ®µï¼Œå…¶é¦–å­—æ¯å¿…é¡»å¾—æ˜¯å¤§å†™çš„ã€‚ä½†è¿™ä¹Ÿå¯¼è‡´äº†åºåˆ—åŒ–åçš„ JSON ä¸²ï¼Œå­—æ®µé¦–å­—æ¯ä¹ŸåŒæ ·æ˜¯å¤§å†™çš„ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥é€šè¿‡ä¸ºç»“æ„ä½“å­—æ®µæŒ‡å®š Tags æ¥è®¾ç½® JSON åºåˆ—åŒ–åçš„å­—æ®µåç§°ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">User</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Id</span>       <span class="kt">uint64</span> <span class="s">`json:&#34;id&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Username</span> <span class="kt">string</span> <span class="s">`json:&#34;username&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Sex</span>      <span class="kt">uint8</span>  <span class="s">`json:&#34;sex&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å†æ¬¡æ‰§è¡Œè¯·æ±‚ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;zhangsan&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;sex&#34;</span><span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><hr>
<h1 id="å“åº”å­—èŠ‚æ•°æ®" data-numberify>å“åº”å­—èŠ‚æ•°æ®<a class="anchor ms-1" href="#å“åº”å­—èŠ‚æ•°æ®"></a></h1>
<p>é€šè¿‡ <code>Context.Data()</code> æ–¹æ³•å¯ä»¥å¾€ <code>ResponseBody</code> ä¸­å†™å…¥å­—èŠ‚æ•°æ®ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/favicon&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">favicon</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="s">&#34;./static/favicon.ico&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ç»“æŸæ—¶å…³é—­æ–‡ä»¶æµ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">defer</span> <span class="kd">func</span><span class="p">(</span><span class="nx">file</span> <span class="nx">multipart</span><span class="p">.</span><span class="nx">File</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}(</span><span class="nx">favicon</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// è·å–å­—èŠ‚æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">bytes</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">io</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">(</span><span class="nx">favicon</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// å‡è®¾å¯¹æ–‡ä»¶è¿›è¡Œäº†ä¸€äº›æ“ä½œ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å“åº”å­—èŠ‚æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">ctx</span><span class="p">.</span><span class="nf">Data</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="s">&#34;application/octet-stream&#34;</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>ä¹Ÿå¯ä»¥é€šè¿‡ <code>Context.Writer.Write()</code> æ–¹æ³•åˆ†æ¬¡æ•°å¾€ <code>ResponseBody</code> ä¸­å†™å…¥å­—èŠ‚æ•°æ®ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/favicon&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">favicon</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="s">&#34;./static/favicon.ico&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ç»“æŸæ—¶å…³é—­æ–‡ä»¶æµ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">defer</span> <span class="kd">func</span><span class="p">(</span><span class="nx">file</span> <span class="nx">multipart</span><span class="p">.</span><span class="nx">File</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">file</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}(</span><span class="nx">favicon</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// ä½¿ç”¨ä¸€ä¸ªç¼“å†²åŒºæ¥é€å—è¯»å–å’Œå“åº”æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">buffer</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// å¾ªç¯è¯»å–æ•°æ®å¹¶å†™å…¥å“åº”ï¼Œæ¯æ¬¡æœ€å¤šè¯»å– 1024 byte æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">size</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">favicon</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span> <span class="c1">// è¯»å–åˆ°æ•°æ®æµç»“å°¾ï¼Œç»“æŸå¾ªç¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å°†è¯»å–çš„æ•°æ®å†™å…¥å“åº”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">writeErr</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">Writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="nx">buffer</span><span class="p">[:</span><span class="nx">size</span><span class="p">]);</span> <span class="nx">writeErr</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">_</span> <span class="p">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">AbortWithError</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span> <span class="nx">writeErr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">.</span><span class="nf">Header</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;application/octet-stream&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><hr>
<h1 id="é™æ€æ–‡ä»¶" data-numberify>é™æ€æ–‡ä»¶<a class="anchor ms-1" href="#é™æ€æ–‡ä»¶"></a></h1>
<p>é™æ€æ–‡ä»¶æœåŠ¡ä½¿ç”¨çš„æ˜¯ <code>IRoutes</code>ï¼ˆæˆ– <code>RouterGroup</code>ï¼‰ä¸­çš„ <code>Static</code> ä¸­å¼€å¤´çš„æ–¹æ³•è¿›è¡Œç»‘å®šã€‚</p>
<ul>
<li>
<p>æŒ‚è½½ç›®å½•ï¼š</p>
<ul>
<li>
<p><code>RouterGroup.Static()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">Static</span><span class="p">(</span><span class="s">&#34;/static&#34;</span><span class="p">,</span> <span class="s">&#34;./static&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>å½“è®¿é—® <code>GET /static</code> æ—¶ï¼Œé»˜è®¤ä¼šè®¿é—®åˆ°æŒ‚è½½ç›®å½•ä¸‹çš„ <code>index.html</code> æ–‡ä»¶ã€‚å‡è®¾ <code>static</code> ç›®å½•ä¸­æœ‰ <code>welcome.html</code> æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>GET /static/welcome.html</code> è®¿é—®åˆ°è¯¥æ–‡ä»¶ã€‚</p>
</li>
<li>
<p><code>RouterGroup.StaticFS()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">StaticFS</span><span class="p">(</span><span class="s">&#34;/static&#34;</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nf">Dir</span><span class="p">(</span><span class="s">&#34;./static&#34;</span><span class="p">))</span>
</span></span></code></pre></div><p>æˆ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">MyFileSystem</span> <span class="kd">struct</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ ¹æ®å®é™…æƒ…å†µå®ç°ä¸€ä¸ª Open(string) (http.File, error) æ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">MyFileSystem</span><span class="p">)</span> <span class="nf">Open</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">file</span> <span class="nx">http</span><span class="p">.</span><span class="nx">File</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="s">&#34;./static&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">fs</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">MyFileSystem</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">StaticFS</span><span class="p">(</span><span class="s">&#34;/static&#34;</span><span class="p">,</span> <span class="nx">fs</span><span class="p">)</span>
</span></span></code></pre></div></li>
</ul>
</li>
<li>
<p>æŒ‚è½½æ–‡ä»¶ï¼š</p>
<ul>
<li>
<p><code>RouterGroup.StaticFile()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nf">StaticFile</span><span class="p">(</span><span class="s">&#34;/home&#34;</span><span class="p">,</span> <span class="s">&#34;./static/index.html&#34;</span><span class="p">)</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>Gin</title>
      <link>/docs/golang/gin/introduction/</link>
      <pubDate>Sat, 29 Jun 2024 07:15:50 +0000</pubDate>
      
      <guid>/docs/golang/gin/introduction/</guid>
      <description><![CDATA[Gin æ˜¯ä¸€ä¸ªç”¨ Golang ç¼–å†™çš„ Web æ¡†æ¶ã€‚å…·æœ‰é€Ÿåº¦å¿«ã€å†…å­˜å ç”¨å°ç­‰ç‰¹ç‚¹ã€‚ ä½¿ç”¨ Gin ä¸‹è½½å¹¶å®‰è£… Ginï¼š $ go get -u github.com/gin-gonic/gin å¼•å…¥ Ginï¼š import &#34;github.com/gin-gonic/gin&#34; å¦‚æœéœ€è¦ä½¿ç”¨è¯¸å¦‚ http.StatusOK ä¹‹ç±»çš„ HTTP çŠ¶æ€ç å¸¸]]></description>
      <content:encoded><![CDATA[<p>Gin æ˜¯ä¸€ä¸ªç”¨ Golang ç¼–å†™çš„ Web æ¡†æ¶ã€‚å…·æœ‰é€Ÿåº¦å¿«ã€å†…å­˜å ç”¨å°ç­‰ç‰¹ç‚¹ã€‚</p>
<hr>
<h1 id="ä½¿ç”¨-gin" data-numberify>ä½¿ç”¨ Gin<a class="anchor ms-1" href="#ä½¿ç”¨-gin"></a></h1>
<ol>
<li>ä¸‹è½½å¹¶å®‰è£… Ginï¼š</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ go get -u github.com/gin-gonic/gin
</span></span></code></pre></div><ol start="2">
<li>å¼•å…¥ Ginï¼š</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span></code></pre></div><p>å¦‚æœéœ€è¦ä½¿ç”¨è¯¸å¦‚ <code>http.StatusOK</code> ä¹‹ç±»çš„ HTTP çŠ¶æ€ç å¸¸é‡ï¼Œå¯ä»¥å¼•å…¥ <code>net/http</code> åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;net/http&#34;</span>
</span></span></code></pre></div><ol start="3">
<li>å¼€å§‹ä½¿ç”¨ Ginã€‚</li>
</ol>
<p><code>main.go</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// è·å– gin.Engine å®ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">routers</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// æ¥æ”¶ GET /hello è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">routers</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/hello&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;message&#34;</span><span class="p">:</span> <span class="s">&#34;Hello World!&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// æ•è·å¹¶è®°å½•é”™è¯¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// ç›‘å¬å¹¶åœ¨ 0.0.0.0:8080 ä¸Šå¯åŠ¨æœåŠ¡ï¼ˆé»˜è®¤å³ä¸º 8080ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">routers</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ¥ç€è¿è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ go run main.go
</span></span></code></pre></div><p>æˆ–è€…ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ä¹Ÿå¯è·å– Gin å®˜æ–¹ä»£ç ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ curl https://raw.githubusercontent.com/gin-gonic/examples/master/basic/main.go &gt; main.go
</span></span></code></pre></div><blockquote>
<p>åœ¨ä¸Šæ–¹ä»£ç ç¤ºä¾‹ä¸­ï¼Œ<code>logrus.Error(err)</code> çš„ä½œç”¨æ˜¯è¾“å‡º <code>Error</code> çº§æ—¥å¿—ã€‚åœ¨ä½¿ç”¨å®ƒä¹‹å‰éœ€è¦å…ˆè·å– <code>logrus</code> åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ go get -u github.com/sirupsen/logrus
</span></span></code></pre></div></blockquote>
<hr>
<h1 id="gin-è¯·æ±‚" data-numberify>Gin è¯·æ±‚<a class="anchor ms-1" href="#gin-è¯·æ±‚"></a></h1>
<p>åœ¨å¦‚ä¸Šç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ <code>routers.GET()</code> åˆ›å»ºäº†ä¸€ä¸ªæ¥æ”¶ <code>GET /hello</code> è¯·æ±‚çš„è·¯ç”±ï¼Œå¹¶ä¸”ç»‘å®šäº†å…¶è·¯ç”±çš„å¤„ç†å‡½æ•°ã€‚<code>GET()</code> çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">GET</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodGet</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼š</p>
<ul>
<li>
<p><code>RouterGroup</code>ï¼šå³ <code>gin.RouterGroup</code>ã€‚è¡¨ç¤ºä¸€ä¸ªè·¯ç”±ç»„å®ä¾‹ã€‚</p>
<p>ç”±äº <code>gin.Engine</code> ç»§æ‰¿äº† <code>gin.RouterGroup</code>ï¼Œæ‰€ä»¥ <code>gin.Engine</code> æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªè·¯ç”±ç»„å®ä¾‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Engine</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">RouterGroup</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p><code>relativePath</code>ï¼šè¡¨ç¤ºè·¯ç”±æ¥æ”¶çš„è¯·æ±‚ç›¸å¯¹è·¯å¾„ã€‚ä¾‹å¦‚ <code>/hello</code>ã€‚</p>
</li>
<li>
<p><code>handlers</code>ï¼šæ˜¯ä¸€ç³»åˆ—è¯·æ±‚å¤„ç†å‡½æ•° <code>HandlerFunc</code>ã€‚åœ¨ <code>GET()</code> ä¸­å¯ä»¥æŒ‡å®šå¤šä¸ª <code>HandlerFunc</code>ï¼Œå®ƒä»¬å°†æŒ‰ç…§æŒ‡å®šçš„é¡ºåºæ‰§è¡Œã€‚ä¸­é—´ä»¶ï¼ˆmiddlewareï¼‰ã€è¿‡æ»¤å™¨ï¼ˆfilterï¼‰ã€æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰ç­‰ï¼Œå¯ä»¥åŸºäºæ­¤è¿›è¡Œå®ç°ã€‚</p>
</li>
<li>
<p><code>IRoutes</code>ï¼šå®šä¹‰äº†ä¸€ç³»åˆ—è·¯ç”±è¯·æ±‚æ–¹æ³•ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">IRoutes</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Use</span><span class="p">(</span><span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nf">Handle</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Any</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">  <span class="nf">GET</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">  <span class="nf">POST</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">  <span class="nf">DELETE</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">  <span class="nf">PATCH</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">  <span class="nf">PUT</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">  <span class="nf">OPTIONS</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">  <span class="nf">HEAD</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Match</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nf">StaticFile</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">  <span class="nf">StaticFileFS</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">FileSystem</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Static</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl">  <span class="nf">StaticFS</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">FileSystem</span><span class="p">)</span> <span class="nx">IRoutes</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>é€šè¿‡è¿”å› <code>IRoutes</code>ï¼Œå¯ä»¥ä½¿ç”¨é“¾å¼è°ƒç”¨é£æ ¼æ¥é…ç½®è·¯ç”±æˆ–ä¸­é—´ä»¶ã€‚</p>
</li>
</ul>
<p>Gin é™¤äº† Get è¯·æ±‚ä¹‹å¤–ï¼Œè¿˜æœ‰å¯ä»¥é…ç½®å…¶å®ƒè¯·æ±‚æ–¹å¼ï¼Œå®ƒä»¬çš„ä½¿ç”¨æ–¹å¼å·®è·ä¸å¤§ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">POST</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodPost</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">GET</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodGet</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">DELETE</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodDelete</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">PATCH</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodPatch</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">PUT</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodPut</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">OPTIONS</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodOptions</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">group</span> <span class="o">*</span><span class="nx">RouterGroup</span><span class="p">)</span> <span class="nf">HEAD</span><span class="p">(</span><span class="nx">relativePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">handlers</span> <span class="o">...</span><span class="nx">HandlerFunc</span><span class="p">)</span> <span class="nx">IRoutes</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">group</span><span class="p">.</span><span class="nf">handle</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodHead</span><span class="p">,</span> <span class="nx">relativePath</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
    <item>
      <title>åˆ›å»º Go Module</title>
      <link>/docs/golang/create-module/</link>
      <pubDate>Sat, 08 Jun 2024 06:27:21 +0000</pubDate>
      
      <guid>/docs/golang/create-module/</guid>
      <description><![CDATA[Go Path åœ¨ Golang 1.11 ä¹‹å‰ï¼ŒGo é‡‡ç”¨çš„æ˜¯æ‰‹åŠ¨ä¾èµ–ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ Go Path çš„æ–¹å¼ç®¡ç†ä¾èµ–ã€‚ ä½¿ç”¨ Go Path ä¼šæœ‰ä»¥ä¸‹é—®é¢˜ï¼š ä»£ç å¼€å‘å¿…é¡»åœ¨ Go Path çš„ src ç›®å½•ä¸‹ã€‚ ä¾èµ–æ‰‹åŠ¨ç®¡ç†ã€‚ ä¾]]></description>
      <content:encoded><![CDATA[<h1 id="go-path" data-numberify>Go Path<a class="anchor ms-1" href="#go-path"></a></h1>
<p>åœ¨ Golang 1.11 ä¹‹å‰ï¼ŒGo é‡‡ç”¨çš„æ˜¯æ‰‹åŠ¨ä¾èµ–ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ Go Path çš„æ–¹å¼ç®¡ç†ä¾èµ–ã€‚</p>
<p>ä½¿ç”¨ Go Path ä¼šæœ‰ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li>ä»£ç å¼€å‘å¿…é¡»åœ¨ Go Path çš„ <code>src</code> ç›®å½•ä¸‹ã€‚</li>
<li>ä¾èµ–æ‰‹åŠ¨ç®¡ç†ã€‚</li>
<li>ä¾èµ–åŒ…æ²¡æœ‰ç‰ˆæœ¬å¯è¨€ã€‚</li>
</ol>
<hr>
<h1 id="go-modules" data-numberify>Go Modules<a class="anchor ms-1" href="#go-modules"></a></h1>
<p>Go Modules æ˜¯ Golang 1.11 æ–°åŠ çš„ç‰¹æ€§ã€‚Go Modules çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ¨¡å—æ˜¯ç›¸å…³ Go åŒ…çš„é›†åˆã€‚</li>
<li>Modules æ˜¯æºä»£ç äº¤æ¢å’Œç‰ˆæœ¬æ§åˆ¶çš„å•å…ƒã€‚</li>
<li>Go å‘½ä»¤ç›´æ¥æ”¯æŒä½¿ç”¨ Modulesï¼ŒåŒ…æ‹¬è®°å½•å’Œè§£æå¯¹å…¶ä»–æ¨¡å—çš„ä¾èµ–æ€§ã€‚</li>
<li>Modules æ›¿æ¢äº†æ—§çš„ Go Path æ–¹æ³•ã€‚</li>
</ul>
<p>åœ¨ä½¿ç”¨ Go Modules ä¹‹å‰éœ€è¦å¯¹ç¯å¢ƒå˜é‡è¿›è¡Œä¸€äº›è®¾ç½®ï¼š</p>
<ul>
<li>è®¾ç½® <code>GO111MODULE</code> ä¸º <code>on</code>ï¼›</li>
<li>è®¾ç½® <code>GOPROXY</code> ä¸º <code>https://goproxy.cn</code>ï¼ˆä¸ƒç‰›äº‘çš„ Go ä»£ç†ï¼Œï¼‰ã€‚</li>
</ul>
<p>æ ¹æ®ä¸åŒå¹³å°æœ‰ä¸åŒçš„è®¾ç½®æ–¹å¼ï¼š</p>
<ul>
<li>
<p>Golang 1.13 åŠä»¥ä¸Šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ go env -w <span class="nv">GO111MODULE</span><span class="o">=</span>on
</span></span><span class="line"><span class="cl">$ go env -w <span class="nv">GOPROXY</span><span class="o">=</span>https://goproxy.cn,direct
</span></span></code></pre></div></li>
<li>
<p>MacOS æˆ– Linux</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">GO111MODULE</span><span class="o">=</span>on
</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">GOPROXY</span><span class="o">=</span>https://goproxy.cn
</span></span></code></pre></div><p>æˆ–è€…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;export GO111MODULE=on&#34;</span> &gt;&gt; ~/.profile
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;export GOPROXY=https://goproxy.cn&#34;</span> &gt;&gt; ~/.profile
</span></span><span class="line"><span class="cl">$ <span class="nb">source</span> ~/.profile
</span></span></code></pre></div></li>
<li>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">C:<span class="se">\&gt;</span> <span class="nv">$env</span>:GO111MODULE <span class="o">=</span> <span class="s2">&#34;on&#34;</span>
</span></span><span class="line"><span class="cl">C:<span class="se">\&gt;</span> <span class="nv">$env</span>:GOPROXY <span class="o">=</span> <span class="s2">&#34;https://goproxy.cn&#34;</span>
</span></span></code></pre></div><p>æˆ–è€…ï¼Œç›´æ¥åœ¨â€œé«˜çº§ç³»ç»Ÿè®¾ç½®â€ä¸­çš„â€œç¯å¢ƒå˜é‡â€ä¸­æ·»åŠ å¯¹åº”çš„ç¯å¢ƒå˜é‡ã€‚</p>
</li>
</ul>
<hr>
<h1 id="åˆ›å»ºæ¨¡å—" data-numberify>åˆ›å»ºæ¨¡å—<a class="anchor ms-1" href="#åˆ›å»ºæ¨¡å—"></a></h1>
<p>åˆ›å»º <code>greetings</code> æ¨¡å—ï¼š</p>
<ol>
<li>
<p>åˆ›å»ºä¸€ä¸ªæ¨¡å—ç›®å½•ï¼ˆåœ¨ä»»æ„ä½ç½®éƒ½å¯ä»¥ï¼Œæ­¤æ—¶ä¸ç”¨æŒ‡å®šåœ¨ Go Path ä¸‹ï¼‰ï¼Œå¹¶åˆ‡æ¢åˆ°ç›®å½•ä¸­ã€‚</p>
<p>å‡è®¾å·¥ä½œç›®å½•ä¸º <code>example.com</code>ï¼Œåœ¨å·¥ä½œç›®å½•ä¸‹åˆ›å»º <code>greetings</code> æ¨¡å—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ <span class="nb">cd</span> example.com
</span></span><span class="line"><span class="cl">$ mkdir greetings
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> greetings
</span></span></code></pre></div></li>
<li>
<p>ä½¿ç”¨ <code>go mod init &lt;module-name&gt;</code> åˆå§‹åŒ–æ¨¡å—ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ go mod init example.com/greetings
</span></span></code></pre></div><p><code>go mod init</code> ä¼šåœ¨ <code>greetings</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>go.mod</code> æ–‡ä»¶ã€‚<code>go.mod</code> ç”¨äºè®°å½•å½“å‰æ¨¡å—çš„åç§°ã€Golang SDK ç‰ˆæœ¬ä»¥åŠé¡¹ç›®ä¾èµ–ç­‰ä¿¡æ¯ã€‚</p>
<p><code>go.mod</code> çš„åŸºæœ¬å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go.mod" data-lang="go.mod"><span class="line"><span class="cl"><span class="c1">// æ¨¡å—å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">module</span> <span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">greetings</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Golang SDK ç‰ˆæœ¬
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">go</span> <span class="mf">1.22</span><span class="p">.</span><span class="mi">4</span>
</span></span></code></pre></div><p>åœ¨åç»­çš„ä½¿ç”¨ä¸­ï¼Œ<code>go.mod</code> è¿˜å¯èƒ½åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go.mod" data-lang="go.mod"><span class="line"><span class="cl"><span class="c1">// é¡¹ç›®æ‰€éœ€ä¾èµ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">require</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="o">//</span> <span class="err">ä¾èµ–çš„æ ¼å¼å¦‚ä¸‹ï¼š</span>
</span></span><span class="line"><span class="cl">  <span class="n">dependencyName</span> <span class="n">vision</span>
</span></span><span class="line"><span class="cl">  <span class="o">//</span> <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é¡¹ç›®ä¸­æ’é™¤çš„ä¾èµ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">exclude</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="o">//</span> <span class="err">æ ¼å¼åŒä¸Š</span>
</span></span><span class="line"><span class="cl">  <span class="n">dependencyName</span> <span class="n">vision</span>
</span></span><span class="line"><span class="cl">  <span class="o">//</span> <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ›¿æ¢ç¬¬ä¸‰æ–¹ä¾èµ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">replace</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">sourceName</span> <span class="n">vision</span> <span class="o">=&gt;</span> <span class="n">targetName</span> <span class="n">vision</span>
</span></span><span class="line"><span class="cl">  <span class="o">//</span> <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ’¤å›å½“å‰é¡¹ç›®ä¸­æœ‰é—®é¢˜çš„ç‰ˆæœ¬
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">retract</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">version</span>
</span></span><span class="line"><span class="cl">  <span class="o">//</span> <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div></li>
<li>
<p>åœ¨ <code>greetings</code> åˆ›å»ºå¯¹åº”çš„ <code>greetings.go</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">grettings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Hello</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">message</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">message</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;Hi, %v. Welcome!&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">message</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
</ol>
<p>åˆ›å»º <code>hello</code> æ¨¡å—ï¼š</p>
<ol>
<li>
<p>åœ¨ <code>example.com</code> åˆ›å»º <code>hello</code> ç›®å½•å¹¶åˆå§‹åŒ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ mkdir hello
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> hello
</span></span><span class="line"><span class="cl">$ go mod init example.com/hello
</span></span></code></pre></div></li>
<li>
<p>åœ¨ <code>hello</code> ç›®å½•ä¸‹åˆ›å»º <code>hello.go</code> å¹¶ç¼–å†™ <code>main()</code> æ¥è°ƒç”¨ <code>greetings.Hello(name string)</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s">&#34;example.com/greetings&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">message</span> <span class="o">:=</span> <span class="nx">greetings</span><span class="p">.</span><span class="nf">Hello</span><span class="p">(</span><span class="s">&#34;Linner&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p>ç”±äº <code>hello.go</code> ä½¿ç”¨åˆ°äº† <code>example.com/greetings</code>ï¼Œæ‰€ä»¥éœ€è¦å¯¹å…¶è¿›è¡Œå¯¼å…¥ã€‚ç”±äº <code>example.com/greetings</code> æ˜¯å½“å‰ <code>example.com</code> ä¸­çš„å­æ¨¡å—ï¼Œ<code>example.com/greetings</code> å¹¶æœªä½¿ç”¨ä»»ä½•ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ <code>mod replace</code> ä¸ºå…¶æŒ‡å®šè·¯å¾„ã€‚</p>
<p>åœ¨ <code>hello</code> ç›®å½•ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æŒ‡å®šæ¨¡å—è·¯å¾„ï¼ˆä¸€èˆ¬å®åœ¨å¼€å‘ç¯å¢ƒä¸‹ä½¿ç”¨ï¼‰</span>
</span></span><span class="line"><span class="cl">$ go mod edit -replace example.com/greetings<span class="o">=</span>../greetings
</span></span><span class="line"><span class="cl"><span class="c1"># å¯¼å…¥ example.com/greetings</span>
</span></span><span class="line"><span class="cl">$ go get example.com/greetings
</span></span></code></pre></div><p>æ‰§è¡Œä»¥ä¸Šå‘½ä»¤åï¼Œåœ¨ <code>hello/go.mod</code> ä¸­ä¼šæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go.mod" data-lang="go.mod"><span class="line"><span class="cl"><span class="n">replace</span> <span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">greetings</span> <span class="o">=&gt;</span> <span class="p">..</span><span class="o">/</span><span class="n">greetings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">require</span> <span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">greetings</span> <span class="n">v0</span><span class="p">.</span><span class="mf">0.0</span><span class="o">-</span><span class="mi">00010101000000</span><span class="o">-</span><span class="mi">000000000000</span> <span class="o">//</span> <span class="n">indirect</span>
</span></span></code></pre></div><p>ç”±äºæ²¡ç”¨ä½¿ç”¨ç‰ˆæœ¬å·¥å…·å‘å¸ƒç‰ˆæœ¬ï¼ˆå¦‚ä½¿ç”¨ Git Tagï¼‰ï¼Œæ‰€ä»¥å¯¼å…¥ä¹‹åï¼ŒGo Get ä¼šä½¿ç”¨ä¸€ä¸ªä¼ªç‰ˆæœ¬å·ï¼ˆpseudo-version numberï¼‰æš‚æ›¿ã€‚</p>
</li>
</ol>
<p>å®Œæˆåˆ›å»ºåï¼Œå¯ä»¥åœ¨ <code>hello</code> ç›®å½•ä¸­ <code>run</code> æˆ– <code>build</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">go run .
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ go build
</span></span><span class="line"><span class="cl">$ ./hello.exe
</span></span></code></pre></div><blockquote>
<p>Go ä¸­çš„ä¼ªç‰ˆæœ¬å·çš„æ ¼å¼éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶çš„åŸåˆ™ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ äº†ä¸€æ®µé¢å¤–çš„ä¿¡æ¯æ¥å”¯ä¸€æ ‡è¯†Gitæäº¤ã€‚é€šå¸¸ä¼ªç‰ˆæœ¬å·ä½¿ç”¨å¦‚ä¸‹æ ¼å¼ç”Ÿæˆï¼š</p>
<pre tabindex="0"><code>v0.0.0-YYYYMMDDHHMMSS-CommitHash
</code></pre><ul>
<li><code>v0.0.0</code> è¡¨ç¤ºæ¨¡å—å°šæœªå®šä¹‰æ­£å¼ç‰ˆæœ¬ï¼Œæˆ–ä¾èµ–çš„æ˜¯ä¸€ä¸ªæ— æ ‡ç­¾çš„æäº¤ï¼›</li>
<li><code>YYYYMMDDHHMMSS</code> æ˜¯æäº¤æ—¥æœŸçš„æ—¶é—´æˆ³ï¼Œç²¾ç¡®åˆ°ç§’ï¼Œç¡®ä¿äº†æ—¶é—´ä¸Šçš„å”¯ä¸€æ€§ï¼›</li>
<li><code>CommitHash</code> æ˜¯ Git æäº¤çš„å‰å‡ ä½å“ˆå¸Œå€¼ï¼Œè¿›ä¸€æ­¥ç¡®ä¿äº†æ¯ä¸ªæäº¤çš„å”¯ä¸€æ€§ã€‚</li>
</ul>
<p>ç”±äº <code>example.com/greetings</code> æ¨¡å—å¹¶æœªä½¿ç”¨ Gitï¼Œæ‰€ä»¥ä¼ªç‰ˆæœ¬å·æ˜¯å›ºå®šçš„ <code>v0.0.0-00010101000000-000000000000</code>ã€‚</p>
</blockquote>
<hr>
<h1 id="go-mod-å‘½ä»¤" data-numberify>go mod å‘½ä»¤<a class="anchor ms-1" href="#go-mod-å‘½ä»¤"></a></h1>
<p>ä½¿ç”¨ <code>go help mod</code> å¯ä»¥æŸ¥çœ‹ <code>go mod</code> å‘½ä»¤çš„ä¿¡æ¯ï¼š</p>
<pre tabindex="0"><code>$ go mod
Go mod provides access to operations on modules.

Note that support for modules is built into all the go commands,
not just &#39;go mod&#39;. For example, day-to-day adding, removing, upgrading,
and downgrading of dependencies should be done using &#39;go get&#39;.
See &#39;go help modules&#39; for an overview of module functionality.

Usage:

        go mod &lt;command&gt; [arguments]

The commands are:

        download    download modules to local cache
        edit        edit go.mod from tools or scripts
        graph       print module requirement graph
        init        initialize new module in current directory
        tidy        add missing and remove unused modules
        vendor      make vendored copy of dependencies
        verify      verify dependencies have expected content
        why         explain why packages or modules are needed

Use &#34;go help mod &lt;command&gt;&#34; for more information about a command.
</code></pre><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>download</code></td>
<td>ä¸‹è½½ä¾èµ–åŒ…åˆ°æœ¬åœ°ç¼“å­˜</td>
</tr>
<tr>
<td><code>edit</code></td>
<td>ç¼–è¾‘ <code>go.mod</code></td>
</tr>
<tr>
<td><code>graph</code></td>
<td>æ‰“å°æ¨¡å—ä¾èµ–å›¾</td>
</tr>
<tr>
<td><code>verify</code></td>
<td>åœ¨å½“å‰ç›®å½•åˆå§‹åŒ–æ–°çš„æ¨¡å—</td>
</tr>
<tr>
<td><code>tidy</code></td>
<td>æ‹‰å–ç¼ºå°‘çš„æ¨¡å—ï¼Œç§»é™¤ä¸ç”¨çš„æ¨¡å—</td>
</tr>
<tr>
<td><code>vendor</code></td>
<td>å°†ä¾èµ–å¤åˆ¶åˆ° <code>vendor</code> ä¸‹</td>
</tr>
<tr>
<td><code>verify</code></td>
<td>éªŒè¯ä¾èµ–æ˜¯å¦æ­£ç¡®</td>
</tr>
<tr>
<td><code>why</code></td>
<td>è§£é‡Šä¸ºä»€ä¹ˆåŒ…æˆ–æ¨¡å—ä¾èµ–è¢«ä¾èµ–</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="ä»£ç ä»“åº“" data-numberify>ä»£ç ä»“åº“<a class="anchor ms-1" href="#ä»£ç ä»“åº“"></a></h1>
<p>é€šå¸¸æƒ…å†µä¸‹ Go Modules æ˜¯å’Œ Git ä¸€åŒä½¿ç”¨çš„ï¼Œåœ¨ Go ä¸­åˆ›å»ºä¸€ä¸ªæ¨¡å—çš„æ ‡å‡†æµç¨‹å®é™…æ˜¯ï¼š</p>
<ol>
<li>
<p>åˆå§‹åŒ–ã€‚</p>
<p>åœ¨æ¨¡å—ç›®å½•ä¸­è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ go mod init &lt;module-name&gt;
</span></span><span class="line"><span class="cl">$ git init
</span></span><span class="line"><span class="cl">$ git commit -am <span class="s2">&#34;init&#34;</span>
</span></span><span class="line"><span class="cl">$ git remote add origin &lt;remote-url&gt;
</span></span><span class="line"><span class="cl">$ git push -u origin main
</span></span></code></pre></div></li>
<li>
<p>å¼€å‘æ¨¡å—ã€‚</p>
<p>æ¨¡å—å¼€å‘å®Œæˆåï¼Œéœ€è¦è¿›è¡Œå‘å¸ƒã€‚Go Modules ä¸­çš„å‘å¸ƒå®é™…å°±æ˜¯ä½¿ç”¨ Git æäº¤ä»£ç ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git push
</span></span></code></pre></div></li>
<li>
<p>åœ¨ä»»æ„æœºå™¨ä¸Šè¿è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯è‡ªåŠ¨å®‰è£…ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">go get &lt;module-name&gt;<span class="o">[</span>@version<span class="o">]</span>
</span></span></code></pre></div></li>
</ol>
<p>åœ¨å‘å¸ƒæ¨¡å—çš„æ—¶å€™éœ€è¦æ³¨æ„ã€‚æ¨¡å—å¯¹åº”çš„è¿œç¨‹ä»“åº“éœ€è¦è®¾ç½®ä¸º Publicã€‚å¦‚æœè¦å¯¼å…¥çš„æ¨¡å—å­˜æ”¾åœ¨ä½ çš„ç§æœ‰ä»“åº“ä¸­ï¼Œéœ€è¦å°†ç¯å¢ƒå˜é‡ <code>GOPRIVATE</code> è®¾ç½®ä¸ºä½ çš„è¿œç¨‹ä»“åº“çš„ç”¨æˆ·ç›®å½•ã€‚ä¾‹å¦‚æˆ‘çš„ Github ä¸»é¡µæ˜¯ <a href="https://github.com/Linna-cy/" target="_blank" rel="noopener noreferrer">https://github.com/Linna-cy/<i class="fas fa-external-link-square-alt ms-1"></i></a> é‚£ä¹ˆæˆ‘éœ€è¦è®¾ç½® <code>GOPRIVATE=github.com/Linna-cy/*</code>ã€‚å†æ¬¡è¿è¡Œ <code>go get</code> å‘½ä»¤ï¼Œåœ¨é€šè¿‡ç”¨æˆ·åå¯†ç éªŒè¯åå°±èƒ½æ­£å¸¸ä»æˆ‘çš„ç§æœ‰ä»“åº“ä¸‹è½½ä¾èµ–åˆ°æœ¬åœ°ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨åˆ›å»ºæ¨¡å—å’Œè¿œç¨‹ä»“åº“çš„æ—¶å€™ï¼Œä¼šå°†æ¨¡å—åç§°è®¾ç½®ä¸º <code>è¿œç¨‹ä»“åº“åœ°å€/ç”¨æˆ·å/ä»“åº“å</code> çš„å½¢å¼ã€‚</p>
<hr>
<h1 id="ç‰ˆæœ¬ç®¡ç†" data-numberify>ç‰ˆæœ¬ç®¡ç†<a class="anchor ms-1" href="#ç‰ˆæœ¬ç®¡ç†"></a></h1>
<p>Go Modules ä¸­å¹¶æ²¡æœ‰ä¸ç‰ˆæœ¬ç›¸å…³çš„é…ç½®é¡¹ï¼Œè€Œæ˜¯ä¾é äº Git è¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€‚</p>
<p>å¦‚ä¸Šä¾‹ï¼Œå‡è®¾æ¨¡å—åç§°ä¸º <code>github.com/Linna-cy/go-utils</code>ï¼Œè¿è¡Œ <code>go get github.com/Linna-cy/go-utils</code> æ—¶ï¼Œåœ¨ <code>go.mod</code> ä¸­çš„ç»“æœå¯èƒ½å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>require github.com/Linna-cy/go-utils v0.0.0-20240608124125-a86730578714
</code></pre><p>å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œå½“æ²¡æœ‰ä½¿ç”¨ Git ç»™æ¨¡å—æŒ‡å®šç‰ˆæœ¬æ—¶ï¼Œé»˜è®¤çš„ç‰ˆæœ¬å·ï¼ˆä¼ªç‰ˆæœ¬å·ï¼‰æ˜¯é€šè¿‡æ—¶é—´æˆ³ç­‰ä¿¡æ¯ç”Ÿæˆçš„ã€‚</p>
<blockquote>
<p><code>go get github.com/Linna-cy/go-utils</code> åœ¨æ²¡æœ‰æŒ‡å®šç‰ˆæœ¬æ—¶ï¼Œä¼šè‡ªåŠ¨è·å– <code>github.com/Linna-cy/go-utils</code> çš„æœ€æ–°ç‰ˆæœ¬ã€‚è€Œæ¨¡å— <code>github.com/Linna-cy/go-utils</code> æ°å·§æ²¡æœ‰ä½¿ç”¨ Gti è®¾ç½®ä»»ä½•ç‰ˆæœ¬ï¼Œæ‰€ä»¥è·å–åˆ°çš„æœ€æ–°çš„ç‰ˆæœ¬å°±æ˜¯ Go è‡ªåŠ¨ç”Ÿæˆçš„ã€‚</p>
</blockquote>
<h2 id="è®¾ç½®ç‰ˆæœ¬å·" data-numberify>è®¾ç½®ç‰ˆæœ¬å·<a class="anchor ms-1" href="#è®¾ç½®ç‰ˆæœ¬å·"></a></h2>
<p>è¦è®¾ç½®ç‰ˆæœ¬ï¼Œéœ€è¦é€šè¿‡ Git Tag è¿›è¡Œè®¾ç½®ã€‚ä¾‹å¦‚ç»™ <code>github.com/Linna-cy/go-utils</code> è®¾ç½®ä¸€ä¸ª <code>v1.0.0</code> çš„ç‰ˆæœ¬å·å¹¶è¿›è¡Œå‘å¸ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ git tag v1.0.0
</span></span><span class="line"><span class="cl">$ git push --tags
</span></span></code></pre></div><p>Git Tag åˆ›å»ºæ ‡ç­¾æ—¶ï¼Œä¹Ÿå¯ä»¥åœ¨æ ‡ç­¾ä¸­åŒ…å«ä¸€äº›ä¿¡æ¯ï¼ˆè¿™ç§æ ‡ç­¾ç§°ä¸ºé™„æ³¨æ ‡ç­¾ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git tag -a &lt;tagname&gt; -m <span class="s2">&#34;Tag message describing the version.&#34;</span>
</span></span></code></pre></div><h2 id="å¯¼å…¥ä¾èµ–" data-numberify>å¯¼å…¥ä¾èµ–<a class="anchor ms-1" href="#å¯¼å…¥ä¾èµ–"></a></h2>
<p>ç„¶åå°±å¯ä»¥å¯¼å…¥æŒ‡å®šç‰ˆæœ¬çš„ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ go get github.com/Linna-cy/go-utils@v1.0.0
</span></span><span class="line"><span class="cl">go: downloading github.com/Linna-cy/go-utils v1.0.0
</span></span><span class="line"><span class="cl">go: upgraded github.com/Linna-cy/go-utils v0.0.0-20240608124125-a86730578714 <span class="o">=</span>&gt; v1.0.0
</span></span></code></pre></div><p><code>go.mod</code> ä¸­ <code>github.com/Linna-cy/go-utils</code> å°†æ›´æ–°ä¸ºï¼š</p>
<pre tabindex="0"><code>require github.com/Linna-cy/go-utils v1.0.0
</code></pre><p>åœ¨ <code>go.mod</code> æ›´æ–°çš„åŒæ—¶ï¼Œè¿˜ç”Ÿæˆäº† <code>go.sum</code>ï¼Œå…¶ä¸­é™¤äº†è½¯ä»¶åŒ…åå’Œç‰ˆæœ¬å·ï¼Œè¿˜åŒ…å«äº†è½¯ä»¶åŒ…çš„å“ˆå¸Œå€¼ï¼Œä»¥ç¡®ä¿å…·æœ‰æ­£ç¡®çš„ç‰ˆæœ¬å’Œæ–‡ä»¶ã€‚</p>
<p>ä¾èµ–å¯¼å…¥æˆåŠŸåï¼Œå°±å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨ <code>import</code> è¿›è¡Œå¯¼å…¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;github.com/Linna-cy/go-utils&#34;</span>
</span></span></code></pre></div><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç‰ˆæœ¬å·ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ï¼ˆSemantic Versioningï¼ŒSemVerï¼‰ã€‚SemVer çš„æ ¼å¼é€šå¸¸ä¸º <code>MAJOR.MINOR.PATCH</code>ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œå¹¶ä¸”åœ¨æ•°å€¼ä¸Šé€’å¢ã€‚å…¶å…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ol>
<li><code>MAJOR</code>ï¼ˆä¸»ç‰ˆæœ¬å·ï¼‰ï¼šå½“åšäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹æ—¶ï¼Œä¸»ç‰ˆæœ¬å·åº”è¯¥é€’å¢ã€‚è¿™è¡¨æ˜æ–°ç‰ˆæœ¬æ— æ³•å‘åå…¼å®¹æ—§ç‰ˆæœ¬ï¼Œä½¿ç”¨è€…å¯èƒ½éœ€è¦ä¿®æ”¹ä»£ç æ‰èƒ½é€‚é…æ–°ç‰ˆæœ¬ã€‚</li>
<li><code>MINOR</code>ï¼ˆæ¬¡ç‰ˆæœ¬å·ï¼‰ï¼šå½“æ–°å¢äº†å‘åå…¼å®¹çš„åŠŸèƒ½æ—¶ï¼Œæ¬¡ç‰ˆæœ¬å·åº”è¯¥é€’å¢ã€‚è¿™æ„å‘³ç€æ–°ç‰ˆæœ¬æ·»åŠ äº†åŠŸèƒ½ï¼Œä½†æ‰€æœ‰å…¬å…±æ¥å£ä¿æŒä¸æ—§ç‰ˆæœ¬å…¼å®¹ï¼Œç”¨æˆ·æ— éœ€ä¿®æ”¹ä»£ç å³å¯å®‰å…¨å‡çº§ã€‚</li>
<li><code>PATCH</code>ï¼ˆä¿®è®¢å·ï¼‰ï¼šå½“è¿›è¡Œäº†å‘åå…¼å®¹çš„é”™è¯¯ä¿®æ­£æ—¶ï¼Œä¿®è®¢å·åº”è¯¥é€’å¢ã€‚è¿™ç±»æ›´æ–°ä¿®å¤äº†é—®é¢˜ï¼Œä½†ä¸å¯¹å…¬å¼€çš„ API åšä»»ä½•æ”¹å˜ï¼Œå› æ­¤å¯¹ç”¨æˆ·è€Œè¨€æ˜¯é€æ˜çš„å‡çº§ã€‚</li>
</ol>
<h2 id="åˆ†æ”¯" data-numberify>åˆ†æ”¯<a class="anchor ms-1" href="#åˆ†æ”¯"></a></h2>
<p>åœ¨ä½¿ç”¨ Git Tag ç»™æäº¤æ ‡è®°ä¸Šç‰ˆæœ¬å·åï¼Œå‡è®¾å½“å‰æ ‡è®°çš„ç‰ˆæœ¬å·æ˜¯å½“å‰ä¸»ç‰ˆæœ¬ä¸‹çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šç»™å½“å‰ä¸»ç‰ˆæœ¬åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œç”¨äºå½“å‰ä¸»ç‰ˆæœ¬åç»­çš„ä¿®å¤æ¨é€ã€‚ä¾‹å¦‚ <code>github.com/Linna-cy/go-utils</code>ï¼Œåœ¨æ¨é€ç‰ˆæœ¬å·ä¹‹åï¼Œè¿˜å¯ä»¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ git checkout -b v1 v1.0.0
</span></span><span class="line"><span class="cl">$ git push -u origin v1
</span></span></code></pre></div><p>å…¶ä¸­ï¼Œ<code>checkout</code> çš„å«ä¹‰å¦‚ä¸‹ï¼ˆ<code>tag-name</code> æ˜¯å¯é€‰çš„ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git checkout -b &lt;new-branch&gt; <span class="o">[</span>tag-name<span class="o">]</span>
</span></span></code></pre></div><h2 id="è¿­ä»£å’Œä¿®å¤" data-numberify>è¿­ä»£å’Œä¿®å¤<a class="anchor ms-1" href="#è¿­ä»£å’Œä¿®å¤"></a></h2>
<p>ä¸€èˆ¬ç‰ˆæœ¬åç»­çš„è¿­ä»£å’Œä¿®å¤ï¼Œä¸ä¼šç›´æ¥åœ¨ä¸»åˆ†æ”¯ï¼ˆ<code>main</code>ã€<code>master</code>ï¼‰ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œè€Œæ˜¯åˆ›å»ºæ–°çš„åˆ†æ”¯è¿›è¡Œä¿®æ”¹ã€‚å½“ä¿®æ”¹åçš„å†…å®¹é€šè¿‡æµ‹è¯•ï¼Œå†å°†å…¶åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸Šã€‚</p>
<p>ä¾‹å¦‚ <code>github.com/Linna-cy/go-utils v1.0.0</code> æœ‰ Bugã€‚å½“æˆ‘ä»¬ä¿®å¤å®Œæˆåï¼Œå¯ä»¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æäº¤ç¤ºä¾‹ï¼ˆæ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ï¼‰</span>
</span></span><span class="line"><span class="cl">$ git commit -am <span class="s2">&#34;fix: ä¿®å¤äº† xxx é—®é¢˜&#34;</span>
</span></span><span class="line"><span class="cl">$ git tag v1.0.1
</span></span><span class="line"><span class="cl">$ git push --tags origin v1
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœå·²ç» git push -u origin v1ï¼Œå¯ä»¥ç›´æ¥ git push --tags</span>
</span></span><span class="line"><span class="cl">$ git push origin v1:v1
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœå·²ç» git push -u origin v1ï¼Œå¯ä»¥ç›´æ¥ git push</span>
</span></span></code></pre></div><p>å½“ä¿®å¤å®Œæˆåï¼Œåœ¨ä½¿ç”¨äº† <code>github.com/Linna-cy/go-utils v1.0.0</code> çš„æ¨¡å—ä¸­ï¼Œéœ€è¦å¯¹ <code>github.com/Linna-cy/go-utils</code> è¿›è¡Œæ›´æ–°ã€‚æ›´æ–°é€šå¸¸æœ‰ä»¥ä¸‹æ–¹å¼ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å¯¹æ‰€æœ‰ä¾èµ–è¿›è¡Œæ›´æ–°å‡çº§</span>
</span></span><span class="line"><span class="cl">$ go get -u
</span></span><span class="line"><span class="cl">$ go get -u<span class="o">=</span>patch
</span></span><span class="line"><span class="cl"><span class="c1"># æŒ‡å®šåŒ…å’Œç‰ˆæœ¬è¿›è¡Œæ›´æ–°å‡çº§</span>
</span></span><span class="line"><span class="cl">$ go get github.com/Linna-cy/go-utils@v1.0.1
</span></span></code></pre></div><p>å¦‚æœè¦å¯¹ä¸»ç‰ˆæœ¬è¿›è¡Œè¿­ä»£ï¼Œå³å‘å¸ƒæ–°çš„ä¸»ç‰ˆæœ¬ï¼Œä¸€èˆ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>ä¿®æ”¹ <code>go.mod</code>ã€‚</p>
<p>ç”±äºä¸»è¦ç‰ˆæœ¬å¯èƒ½ä¼šç ´åå‘åå…¼å®¹æ€§ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¿®æ”¹ <code>go.mod</code> çš„ <code>module</code> é¡¹çš„æ–¹å¼ï¼Œå‘ŠçŸ¥ä¸¤ä¸ªç‰ˆæœ¬å¹¶ä¸å…¼å®¹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go.mod" data-lang="go.mod"><span class="line"><span class="cl"><span class="n">module</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;/&lt;</span><span class="n">major</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">go</span> <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span>
</span></span></code></pre></div><p>ä¾‹å¦‚åœ¨ <code>github.com/Linna-cy/go-utils</code> ä¸­æ·»åŠ äº†ä¸€ç³»åˆ—æ–°çš„æ¥å£ï¼Œæˆ–å¯¹åŸæœ‰çš„æ¥å£è¿›è¡Œä¿®æ”¹ï¼Œä¸”ä¿®æ”¹åçš„æ¥å£ä¸å…¼å®¹æ—§ç‰ˆæœ¬ã€‚æ­¤æ—¶å°±éœ€è¦å¯¹ä¸»ç‰ˆæœ¬è¿›è¡Œè¿­ä»£ã€‚å‡è®¾å°†ä¸»ç‰ˆæœ¬è¿­ä»£åˆ° <code>v2</code>ï¼Œå¹¶ä¸”å‘å¸ƒäº†æ–°çš„ç‰ˆæœ¬ <code>v2.0.0</code>ï¼Œæ­¤æ—¶å¯¹åº”çš„ <code>go.mod</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go.mod" data-lang="go.mod"><span class="line"><span class="cl"><span class="n">module</span> <span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">Linna</span><span class="o">-</span><span class="n">cy</span><span class="o">/</span><span class="n">go</span><span class="o">-</span><span class="n">utils</span><span class="o">/</span><span class="n">v2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">go</span> <span class="mf">1.22</span><span class="p">.</span><span class="mi">4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// çœç•¥å…¶å®ƒå†…å®¹...
</span></span></span></code></pre></div></li>
<li>
<p>å‘å¸ƒæ–°ç‰ˆæœ¬</p>
<p>å‡è®¾è¦å‘å¸ƒ <code>github.com/Linna-cy/go-utils v2.0.0</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æäº¤ç¤ºä¾‹ï¼ˆæ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ï¼‰</span>
</span></span><span class="line"><span class="cl">$ git commit -am <span class="s2">&#34;feat: å‘å¸ƒæ–°ç‰ˆæœ¬ v2.0.0ï¼Œxxx&#34;</span>
</span></span><span class="line"><span class="cl">$ git tag -a v2.0.0 -m <span class="s2">&#34;æ·»åŠ äº† xxxï¼Œä¿®æ”¹äº† xxxï¼Œæ–°ç‰ˆæ”¯æŒ xxx&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ç­¾å‡ºåˆ†æ”¯</span>
</span></span><span class="line"><span class="cl">$ git checkout -b v2 v2.0.0
</span></span><span class="line"><span class="cl">$ git push --tags origin v2
</span></span></code></pre></div></li>
<li>
<p>ä½¿ç”¨æ–°ç‰ˆæœ¬ã€‚</p>
</li>
</ol>
<p>åŸå…ˆä½¿ç”¨äº† <code>github.com/Linna-cy/go-utils</code> çš„æ¨¡å—å¹¶ä¸ä¼šå—åˆ°å½±å“ã€‚å¦‚æœéœ€è¦å‡çº§æ¨¡å—çš„ä¸»ç‰ˆæœ¬ï¼Œæˆ–åœ¨å…¶å®ƒæ¨¡å—ä¸­ä½¿ç”¨  <code>github.com/Linna-cy/go-utils/v2</code> éœ€è¦å°† <code>import &quot;github.com/Linna-cy/go-utils&quot;</code> ä¿®æ”¹ä¸º <code>import &quot;github.com/Linna-cy/go-utils/v2&quot;</code>ã€‚</p>
<hr>
<h1 id="go-list" data-numberify>Go List<a class="anchor ms-1" href="#go-list"></a></h1>
<p>Go List ç”¨äºåˆ—å‡ºå½“å‰æ¨¡å—ä¸‹çš„åŒ…ã€‚å¸¸ç”¨çš„å‘½ä»¤æœ‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># åˆ—å‡ºå½“å‰æ¨¡å—çš„åç§°</span>
</span></span><span class="line"><span class="cl">$ go list
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ—å‡ºå½“å‰æ¨¡å—ä¸‹æ‰€æœ‰çš„åŒ…</span>
</span></span><span class="line"><span class="cl">$ go list all
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
  </channel>
</rss>

