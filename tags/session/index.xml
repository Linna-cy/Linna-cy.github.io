<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Session on Linner&#39;s Blog</title>
    <link>/tags/session/</link>
    <description>Recent content in Session on Linner&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <copyright>Copyright Â© 2020-2026 Linner. All Rights Reserved.
</copyright>
    <lastBuildDate>Tue, 02 Jul 2024 14:49:41 +0000</lastBuildDate><atom:link href="/tags/session/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Gin Cookie å’Œ Session</title>
      <link>/docs/golang/gin/cookie-and-session/</link>
      <pubDate>Tue, 02 Jul 2024 14:49:41 +0000</pubDate>
      
      <guid>/docs/golang/gin/cookie-and-session/</guid>
      <description><![CDATA[Cookie åœ¨ Gin ä¸­ï¼Œä½¿ç”¨ Cookie æ¶‰åŠåˆ°ä¸¤ä¸ªæ–¹æ³•ï¼ŒContext.Cookie() å’Œ Context.SetCookie()ï¼š func SetCookie(c *gin.Context) { // è®¾ç½® Cookie c.SetCookie(&#34;gin-cookie&#34;, &#34;test&#34;, 3600, &#34;/&#34;, &#34;localhost&#34;, false, false) c.JSON(http.StatusOK, gin.H{]]></description>
      <content:encoded><![CDATA[<h1 id="cookie" data-numberify>Cookie<a class="anchor ms-1" href="#cookie"></a></h1>
<p>åœ¨ Gin ä¸­ï¼Œä½¿ç”¨ Cookie æ¶‰åŠåˆ°ä¸¤ä¸ªæ–¹æ³•ï¼Œ<code>Context.Cookie()</code> å’Œ <code>Context.SetCookie()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">SetCookie</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è®¾ç½® Cookie
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">c</span><span class="p">.</span><span class="nf">SetCookie</span><span class="p">(</span><span class="s">&#34;gin-cookie&#34;</span><span class="p">,</span> <span class="s">&#34;test&#34;</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="s">&#34;localhost&#34;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;code&#34;</span><span class="p">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;data&#34;</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">GetCookie</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å– Cookie
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Cookie</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;code&#34;</span><span class="p">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;data&#34;</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/cookie&#34;</span><span class="p">,</span> <span class="nx">SetCookie</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/cookie&#34;</span><span class="p">,</span> <span class="nx">GetCookie</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼š</p>
<ul>
<li>
<p><code>Context.Cookie()</code>ï¼šè·å–æŒ‡å®šåç§°çš„ Cookieã€‚</p>
</li>
<li>
<p><code>Context.SetCookie()</code>ï¼šè®¾ç½® Cookieã€‚å®ƒçš„æ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Context</span><span class="p">)</span> <span class="nf">SetCookie</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">maxAge</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">domain</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">secure</span><span class="p">,</span> <span class="nx">httpOnly</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code>
‚æ•°è§£é‡Šå¦‚ä¸‹ï¼š

`name`ï¼šè®¾ç½® Cookie çš„åç§°ã€‚
`value`ï¼šè®¾ç½® Cookie çš„å€¼ã€‚
`maxAge`ï¼šCookie çš„æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚å¦‚æœä¸ºè´Ÿæ•°ï¼Œåˆ™è¡¨ç¤ºä¼šè¯ Cookieï¼ˆåœ¨æµè§ˆå™¨å…³é—­ä¹‹ååˆ é™¤ï¼‰ï¼›å¦‚æœä¸ºé›¶ï¼Œåˆ™è¡¨ç¤ºç«‹å³åˆ é™¤Cookieã€‚
`path`ï¼šCookie çš„ç”Ÿæ•ˆè·¯å¾„ã€‚å¦‚æœä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåˆ™ä½¿ç”¨å½“å‰è¯·æ±‚çš„ URI è·¯å¾„ä½œä¸ºé»˜è®¤å€¼ã€‚å¦‚æœæ˜¯ `&#34;/&#34;`ï¼Œé‚£ä¹ˆæ‰€æœ‰è·¯å¾„éƒ½è®¿é—®è¯¥ Cookieã€‚
`domain`ï¼šCookie çš„ç”Ÿæ•ˆåŸŸã€‚å¦‚æœä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåˆ™ä¸è®¾ç½®åŸŸåã€‚
`secure`ï¼šCookie æ˜¯å¦ä»…ç”¨äº HTTPS è¿æ¥ã€‚å¦‚æœä¸º `true`ï¼Œåˆ™ä»…é€šè¿‡ HTTPS è¿æ¥å‘é€ Cookieï¼›å¦åˆ™ï¼Œä½¿ç”¨ HTTP æˆ– HTTPS è¿æ¥éƒ½å¯ä»¥å‘é€ Cookieã€‚
`httpOnly`ï¼šCookie æ˜¯å¦å…è®¸é€šè¿‡å®¢æˆ·ç«¯ç¨‹åºè®¿é—®ã€‚å¦‚æœä¸º `true`ï¼Œåˆ™æ— æ³•é€šè¿‡å®¢æˆ·ç«¯ç¨‹åºè®¿é—® Cookieï¼›å¦åˆ™ï¼Œå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯ç¨‹åºè®¿é—® Cookieã€‚
</code></pre></li>
</ul>
<blockquote>
<p><code>httpOnly</code> æ˜¯å¾®è½¯å¯¹ Cookie åšçš„æ‰©å±•ã€‚å¦‚æœåœ¨ Cookie ä¸­è®¾ç½®äº† <code>httpOnly</code> å±æ€§ï¼Œåˆ™é€šè¿‡ç¨‹åºï¼ˆJS è„šæœ¬ã€Applet ç­‰ï¼‰å°†æ— æ³•è¯»å–åˆ° Cookie ä¿¡æ¯ï¼Œé˜²æ­¢ XSS æ”»å‡»äº§ç”Ÿã€‚</p>
</blockquote>
<h2 id="å¤šä¸ªäºŒçº§åŸŸåå…±äº«-cookie" data-numberify>å¤šä¸ªäºŒçº§åŸŸåå…±äº« Cookie<a class="anchor ms-1" href="#å¤šä¸ªäºŒçº§åŸŸåå…±äº«-cookie"></a></h2>
<p>æœåŠ¡å™¨çš„ IP é…ç½®äº†å¤šä¸ªåŸŸåè§£æï¼Œæ­¤æ—¶è®¾ç½® Cookie å°±éœ€è¦é…ç½®å¤šä¸ªç”Ÿæ•ˆåŸŸã€‚</p>
<p>ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨çš„ IP é…ç½®äº†åŸŸåæ³›è§£æ <code>*.linner.com</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">c</span><span class="p">.</span><span class="nf">SetCookie</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="s">&#34;.linner.com&#34;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
</span></span></code></pre></div><hr>
<h1 id="session" data-numberify>Session<a class="anchor ms-1" href="#session"></a></h1>
<p>Gin æ˜¯ä¸€ä¸ªè½»é‡çš„ Web æ¡†æ¶ï¼Œåœ¨ Gin ä¸­å¹¶ä¸ç›´æ¥å¯¹ Session æä¾›æ”¯æŒï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å…¶ä»–ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶è®© Gin æ”¯æŒ Sessionã€‚</p>
<p>åœ¨ä½¿ç”¨ Session å‰ï¼Œéœ€è¦ <code>get</code> å¯¹åº”çš„æ¨¡å—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">go get github.com/gin-contrib/sessions
</span></span></code></pre></div><p>ç„¶ååœ¨éœ€è¦ä½¿ç”¨åˆ° Session çš„åœ°æ–¹å¼•å…¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;github.com/gin-contrib/sessions&#34;</span>
</span></span></code></pre></div><p>æ¥ç€è®¾ç½® Session ä¸­é—´ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// åˆ›å»ºåŸºäº Cookie çš„å­˜å‚¨å¼•æ“ï¼Œsecret å‚æ•°æ˜¯åŠ å¯†å¯†é’¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">store</span> <span class="o">:=</span> <span class="nx">cookie</span><span class="p">.</span><span class="nf">NewStore</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&#34;secret&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">// é…ç½® Session ä¸­é—´ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">sessions</span><span class="p">.</span><span class="nf">Sessions</span><span class="p">(</span><span class="s">&#34;mysession&#34;</span><span class="p">,</span> <span class="nx">store</span><span class="p">))</span>
</span></span></code></pre></div><p>å…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">SetSession</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ä» Context ä¸­è·å– Session æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">session</span> <span class="o">:=</span> <span class="nx">sessions</span><span class="p">.</span><span class="nf">Default</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è®¾ç½® Session
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">session</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">,</span> <span class="s">&#34;lisi&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">session</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;nickname&#34;</span><span class="p">,</span> <span class="s">&#34;æå››&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// ä¿å­˜è®¾ç½®çš„ Sessionï¼Œè®¾ç½®å®Œæˆä¹‹åå¿…é¡»è¦è°ƒç”¨ Save()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">session</span><span class="p">.</span><span class="nf">Save</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">Status</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">GetSession</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ä» Context ä¸­è·å– Session æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">session</span> <span class="o">:=</span> <span class="nx">sessions</span><span class="p">.</span><span class="nf">Default</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è·å– Session
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">username</span> <span class="o">:=</span> <span class="nx">session</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">nickname</span> <span class="o">:=</span> <span class="nx">session</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;nickname&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;code&#34;</span><span class="p">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;data&#34;</span><span class="p">:</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;username&#34;</span><span class="p">:</span> <span class="nx">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="s">&#34;nickname&#34;</span><span class="p">:</span> <span class="nx">nickname</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">store</span> <span class="p">=</span> <span class="nx">cookie</span><span class="p">.</span><span class="nf">NewStore</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&#34;secret&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// è®¾ç½® Session ä¸­é—´ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">sessions</span><span class="p">.</span><span class="nf">Sessions</span><span class="p">(</span><span class="s">&#34;mysession&#34;</span><span class="p">,</span> <span class="nx">store</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/session&#34;</span><span class="p">,</span> <span class="nx">SetSession</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/session&#34;</span><span class="p">,</span> <span class="nx">GetSession</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="redis" data-numberify>Redis<a class="anchor ms-1" href="#redis"></a></h2>
<p><code>github.com/gin-contrib/sessions</code> æ”¯æŒé€šè¿‡ Redis ç¼“å­˜ Sessionï¼Œä½¿å…¶èƒ½å¤Ÿæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿã€‚</p>
<p>åœ¨ä½¿ç”¨å‰éœ€è¦å…ˆå¼•å…¥å…¶ Redis åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="err">$</span> <span class="k">go</span> <span class="nx">get</span> <span class="o">-</span><span class="nx">u</span> <span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">gin</span><span class="o">-</span><span class="nx">contrib</span><span class="o">/</span><span class="nx">sessions</span><span class="o">/</span><span class="nx">redis</span>
</span></span></code></pre></div><p>æ¥ç€é…ç½® Redis Storeï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// é…ç½® Redis Store
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">RedisStore</span><span class="p">()</span> <span class="p">(</span><span class="nx">store</span> <span class="nx">sessions</span><span class="p">.</span><span class="nx">Store</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">store</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">redis</span><span class="p">.</span><span class="nf">NewStore</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s">&#34;tcp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;localhost:6379&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;123456&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&#34;secret&#34;</span><span class="p">));</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">store</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">store</span> <span class="p">=</span> <span class="nf">RedisStore</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// è®¾ç½® Session ä¸­é—´ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">r</span><span class="p">.</span><span class="nf">Use</span><span class="p">(</span><span class="nx">sessions</span><span class="p">.</span><span class="nf">Sessions</span><span class="p">(</span><span class="s">&#34;mysession&#34;</span><span class="p">,</span> <span class="nx">store</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">POST</span><span class="p">(</span><span class="s">&#34;/session&#34;</span><span class="p">,</span> <span class="nx">SetSession</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/session&#34;</span><span class="p">,</span> <span class="nx">GetSession</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">logrus</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>redis.NewStore()</code> çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewStore</span><span class="p">(</span><span class="nx">size</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">network</span><span class="p">,</span> <span class="nx">address</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">keyPairs</span> <span class="o">...</span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="nx">Store</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>size</code>ï¼šæœ€å¤§è¿æ¥æ•°ï¼›</li>
<li><code>network</code>ï¼šè¿æ¥æ–¹å¼ï¼Œå€¼ä¸º <code>tcp</code> æˆ– <code>udp</code>ï¼›</li>
<li><code>address</code>ï¼šæœåŠ¡å™¨åœ°å€ï¼Œéœ€è¦æŒ‡å®šç«¯å£å·ï¼›</li>
<li><code>username</code>ï¼šRedis ç”¨æˆ·åï¼Œæ²¡æœ‰é…ç½®ç”¨æˆ·åå¯ä¼ å…¥ç©ºå­—ç¬¦ä¸²ï¼›</li>
<li><code>password</code>ï¼šRedis å¯†ç ï¼Œæ²¡æœ‰é…ç½®å¯†ç å¯ä¼ å…¥ç©ºå­—ç¬¦ä¸²ï¼›</li>
<li><code>keyPairs</code>ï¼šSession åŠ å¯†å¯†é’¥ã€‚</li>
</ul>
]]></content:encoded>
    </item>
    
  </channel>
</rss>

