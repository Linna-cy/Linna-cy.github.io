<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>SpringMVC on Linner&#39;s Blog</title>
    <link>/tags/springmvc/</link>
    <description>Recent content in SpringMVC on Linner&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <copyright>Copyright Â© 2020-2026 Linner. All Rights Reserved.
</copyright>
    <lastBuildDate>Mon, 20 Feb 2023 00:00:00 +0000</lastBuildDate><atom:link href="/tags/springmvc/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>SpringMVC åŸºç¡€</title>
      <link>/docs/spring/springmvc/base/</link>
      <pubDate>Mon, 20 Feb 2023 00:00:00 +0000</pubDate>
      
      <guid>/docs/spring/springmvc/base/</guid>
      <description><![CDATA[ç®€ä»‹ SpringMVCæ˜¯Springä¸‹çš„ä¸€ä¸ªç”¨äºWebè¡¨ç°å±‚å¼€å‘çš„æŠ€æœ¯ã€‚ç›¸æ¯”Servletï¼ŒSpringMVCæ›´åŠ é«˜æ•ˆå¿«æ·ã€‚ SpringMV]]></description>
      <content:encoded><![CDATA[<h1 id="ç®€ä»‹" data-numberify>ç®€ä»‹<a class="anchor ms-1" href="#ç®€ä»‹"></a></h1>
<p>SpringMVCæ˜¯Springä¸‹çš„ä¸€ä¸ªç”¨äºWebè¡¨ç°å±‚å¼€å‘çš„æŠ€æœ¯ã€‚ç›¸æ¯”Servletï¼ŒSpringMVCæ›´åŠ é«˜æ•ˆå¿«æ·ã€‚</p>
<p>SpringMVCæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æµè§ˆå™¨å‘é€è¯·æ±‚åˆ°TomcatæœåŠ¡å™¨ï¼›</li>
<li>Tomcatæ¥æ”¶è¯·æ±‚åï¼Œå°†è¯·æ±‚äº¤ç»™SpringMVCä¸­çš„<code>DispatcherServlet</code>ï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰æ¥å¤„ç†ã€‚</li>
<li><code>DispatcherServlet</code>æŒ‰ç…§å¯¹åº”è§„åˆ™å°†è¯·æ±‚åˆ†å‘åˆ°å¯¹åº”çš„<code>Bean</code>ã€‚</li>
<li><code>Bean</code>ç”±æˆ‘ä»¬è‡ªå·±ç¼–å†™æ¥å¤„ç†ä¸åŒçš„è¯·æ±‚ã€‚
æ¯ä¸ª<code>Bean</code>ä¸­å¯ä»¥å¤„ç†ä¸€ä¸ªæˆ–å¤šä¸ªä¸åŒçš„è¯·æ±‚
URLã€‚</li>
</ul>
<blockquote>
<p><code>DispatcherServlet</code>å’Œ<code>Bean</code>å¯¹è±¡éƒ½éœ€è¦äº¤ç»™Springå®¹å™¨æ¥è¿›è¡Œç®¡ç†ã€‚</p>
</blockquote>
<p>ç»¼ä¸Šï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™çš„å†…å®¹ä¸ºï¼š</p>
<ul>
<li>
<p><code>Bean</code>å¯¹è±¡ï¼›</p>
</li>
<li>
<p>è¯·æ±‚URLå’Œ<code>Bean</code>å¯¹è±¡å¯¹åº”å…³ç³»çš„é…ç½®ï¼›</p>
</li>
<li>
<p>æ„å»ºSpringå®¹å™¨ã€‚</p>
<p>å°†<code>DispatcherServlet</code>å’Œ<code>Bean</code>å¯¹è±¡äº¤ç»™å®¹å™¨ç®¡ç†ã€‚</p>
</li>
<li>
<p>é…ç½®TomcatæœåŠ¡å™¨ã€‚</p>
<p>ä½¿Tomcatèƒ½å¤Ÿè¯†åˆ«Springå®¹å™¨ï¼Œå¹¶å°†è¯·æ±‚äº¤ç»™å®¹å™¨ä¸­çš„<code>DispatcherServlet</code>æ¥åˆ†å‘è¯·æ±‚ã€‚</p>
</li>
</ul>
<p>é¡¹ç›®çš„åŸºæœ¬å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºWebå·¥ç¨‹ï¼ˆMavenç»“æ„ï¼‰ï¼Œå¹¶åœ¨å·¥ç¨‹çš„<code>pom.xml</code>ä¸­æ·»åŠ SpringMVCå’ŒServletåæ ‡ã€‚</li>
<li>åˆ›å»ºSpringMVCæ§åˆ¶å™¨ç±»ï¼ˆç­‰åŒäºServletåŠŸèƒ½ï¼‰ã€‚</li>
<li>åˆå§‹åŒ–SpringMVCç¯å¢ƒï¼ˆåŒSpringç¯å¢ƒï¼‰ï¼Œè®¾å®šSpringMVCåŠ è½½å¯¹åº”çš„<code>Bean</code>ã€‚</li>
<li>åˆå§‹åŒ–Servletå®¹å™¨ï¼ŒåŠ è½½SpringMVCç¯å¢ƒï¼Œå¹¶è®¾ç½®SpringMVCæŠ€æœ¯å¤„ç†çš„è¯·æ±‚ã€‚</li>
</ol>
<h2 id="spring-mvc-å·¥ä½œæµç¨‹" data-numberify>Spring MVC å·¥ä½œæµç¨‹<a class="anchor ms-1" href="#spring-mvc-å·¥ä½œæµç¨‹"></a></h2>
<p>SpringMVCçš„ä½¿ç”¨è¿‡ç¨‹å…±åˆ†ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li>
<p>å¯åŠ¨æœåŠ¡å™¨åˆå§‹åŒ–è¿‡ç¨‹ï¼›</p>
<ol>
<li>
<p>æœåŠ¡å™¨å¯åŠ¨ï¼Œæ‰§è¡Œ<code>ServletConfig</code>ç±»ï¼Œåˆå§‹åŒ–Webå®¹å™¨ã€‚</p>
</li>
<li>
<p>æ ¹æ®<code>getServletConfigClasses</code>è·å–æ‰€éœ€çš„SpringMVCé…ç½®ç±»ï¼ˆè¿™é‡Œæ˜¯<code>SpringMvcConfig</code>ï¼‰æ¥åˆå§‹åŒ–SpringMVCçš„å®¹å™¨ã€‚</p>
</li>
<li>
<p>åŠ è½½<code>SpringMvcConfig</code>é…ç½®ç±»ã€‚</p>
</li>
<li>
<p>æ‰§è¡Œ<code>@ComponentScan</code>åŠ è½½å¯¹åº”çš„<code>Bean</code>ã€‚</p>
<p>æ‰«ææŒ‡å®šåŒ…ä¸‹æ‰€æœ‰ç±»ä¸Šçš„æ³¨è§£ï¼Œå°†æ‰€æœ‰çš„Controllerç±»ï¼ˆå¦‚æœ‰<code>@Controller</code>ã€<code>@RestController</code>ç­‰æ³¨è§£çš„ç±»ï¼‰åŠ è½½åˆ°å®¹å™¨ä¸­ã€‚</p>
</li>
<li>
<p>åŠ è½½æ¯ä¸€ä¸ª<code>Controler</code>ã€‚</p>
<p>ä½¿ç”¨<code>@RequestMapping</code>å»ºç«‹è¯·æ±‚è·¯å¾„ä¸<code>Controler</code>ä¸­çš„æ–¹æ³•çš„å¯¹åº”å…³ç³»ã€‚</p>
</li>
<li>
<p>æ‰§è¡Œ<code>getServletMappings</code>æ–¹æ³•ï¼Œå®šä¹‰æ‰€æœ‰çš„è¯·æ±‚éƒ½é€šè¿‡SpringMVCã€‚å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="n">Spring</span><span class="o">[]</span>  <span class="nf">getServletMappings</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">Spring</span><span class="o">[]{</span><span class="s">&#34;/&#34;</span><span class="o">};</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>    
</span></span></code></pre></div><p><code>/</code>ä»£è¡¨æ‰€æ‹¦æˆªè¯·æ±‚çš„è·¯å¾„è§„åˆ™ï¼Œåªæœ‰è¢«æ‹¦æˆªåæ‰èƒ½äº¤ç»™SpringMVCæ¥å¤„ç†è¯·æ±‚ã€‚</p>
</li>
</ol>
</li>
<li>
<p>å•æ¬¡è¯·æ±‚è¿‡ç¨‹ã€‚</p>
<ol>
<li>æ ¹æ®è¯·æ±‚è·¯å¾„å‘é€è¯·æ±‚ã€‚</li>
<li>Webå®¹å™¨å°†ç¬¦åˆè®¾ç½®çš„è¯·æ±‚è·¯å¾„çš„è¯·æ±‚äº¤ç»™SpringMVCå¤„ç†ã€‚</li>
<li>è§£æè¯·æ±‚è·¯å¾„ã€‚</li>
<li>æ‰§è¡ŒåŒ¹é…å¯¹åº”è¯·æ±‚è·¯å¾„çš„æ–¹æ³•ã€‚</li>
<li>å°†æœ‰<code>@ResponseBody</code>æ–¹æ³•çš„è¿”å›å€¼ä½œä¸ºå“åº”ä½“è¿”å›ç»™è¯·æ±‚æ–¹ã€‚</li>
</ol>
</li>
</ol>
<hr>
<h1 id="é¡¹ç›®ç¯å¢ƒåŠç»“æ„" data-numberify>é¡¹ç›®ç¯å¢ƒåŠç»“æ„<a class="anchor ms-1" href="#é¡¹ç›®ç¯å¢ƒåŠç»“æ„"></a></h1>
<h2 id="é¡¹ç›®ç»“æ„" data-numberify>é¡¹ç›®ç»“æ„<a class="anchor ms-1" href="#é¡¹ç›®ç»“æ„"></a></h2>
<p>ä½¿ç”¨SpringMVCå¼€å‘çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p>
<ul>
<li>ğŸ“<code>project-file-name</code>
<ul>
<li>ğŸ“<code>src</code>
<ul>
<li>ğŸ“<code>main</code>
<ul>
<li>ğŸ“<code>java</code>
<ul>
<li>ğŸ“<code>com.linner</code>
<ul>
<li>ğŸ“<code>config</code> â€”â€” é…ç½®ç±»</li>
<li>ğŸ“<code>controller</code> â€”â€” è¡¨ç°å±‚</li>
<li>ğŸ“<code>dao</code> â€”â€” æŒä¹…å±‚</li>
<li>ğŸ“<code>domain</code> â€”â€” å®ä½“ç±»</li>
<li>ğŸ“<code>service</code> â€”â€” ä¸šåŠ¡å±‚</li>
</ul>
</li>
</ul>
</li>
<li>ğŸ“<code>resourcs</code></li>
<li>ğŸ“<code>webapp</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>è¿™ç§é¡¹ç›®ç»“æ„é‡‡ç”¨äº†SSMæ¶æ„ï¼Œå³ï¼š</p>
<ul>
<li>è¡¨ç°å±‚ï¼›</li>
<li>æŒä¹…å±‚ï¼›</li>
<li>ä¸šåŠ¡å±‚ã€‚</li>
</ul>
<p>é€šè¿‡IDEAåˆ›å»ºSpringMVCé¡¹ç›®æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>åˆ›å»ºåŸºç¡€çš„Maven-Archetype-Webappé¡¹ç›®ã€‚</p>
<p><picture><img class="img-fluid " alt="" src="/docs/spring/springmvc/base/1676947539616.png" loading="lazy" width="1599" height="589" />
</picture>

</p>
</li>
<li>
<p>è¡¥å…¨é¡¹ç›®ç»“æ„ï¼š</p>
<ul>
<li>ğŸ“<code>src</code>
<ul>
<li>ğŸ“<code>main</code>
<ul>
<li>ğŸ“<code>java</code></li>
<li>ğŸ“<code>resourcs</code></li>
<li>ğŸ“<code>webapp</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ä¿®æ”¹<code>pom.xml</code>æ–‡ä»¶ï¼š</p>
<p>å°†å¤šä½™çš„å†…å®¹åˆ é™¤ï¼Œç„¶åæ·»åŠ SpringMVCæ‰€éœ€çš„ä¾èµ–ã€‚å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl"><span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>com.linner<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>springmvc-demo<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;properties&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;maven.compiler.source&gt;</span>1.8<span class="nt">&lt;/maven.compiler.source&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;maven.compiler.target&gt;</span>1.8<span class="nt">&lt;/maven.compiler.target&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/properties&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- ... --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c">&lt;!-- ... --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/build&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/project&gt;</span>
</span></span></code></pre></div></li>
</ol>
<h2 id="åŸºç¡€ç¯å¢ƒ" data-numberify>åŸºç¡€ç¯å¢ƒ<a class="anchor ms-1" href="#åŸºç¡€ç¯å¢ƒ"></a></h2>
<p>Tomcat7 Mavenæ’ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>org.apache.tomcat.maven<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>tomcat7-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>2.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;configuration&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;port&gt;</span>80<span class="nt">&lt;/port&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;path&gt;</span>/<span class="nt">&lt;/path&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;uriEncoding&gt;</span>UTF-8<span class="nt">&lt;/uriEncoding&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/configuration&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/plugin&gt;</span>
</span></span></code></pre></div><p>åŸºç¡€ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!-- Servlet --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>javax.servlet-api<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>3.1.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Servletéœ€è¦ä¿®æ”¹ä½œç”¨èŒƒå›´ï¼Œå¦åˆ™ä¼šä¸Tomcatä¸­çš„servlet-apiåŒ…å‘ç”Ÿå†²çª --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- providedä»£è¡¨çš„æ˜¯è¯¥åŒ…åªåœ¨ç¼–è¯‘å’Œæµ‹è¯•çš„æ—¶å€™ç”¨ --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- SpringMVC --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-webmvc<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>5.2.10.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h2 id="dao-ç›¸å…³ä¾èµ–ç¯å¢ƒ" data-numberify>DAO ç›¸å…³ä¾èµ–ç¯å¢ƒ<a class="anchor ms-1" href="#dao-ç›¸å…³ä¾èµ–ç¯å¢ƒ"></a></h2>
<p>ä½¿ç”¨SpringMVCæ„å»ºWebé¡¹ç›®ï¼Œé™¤äº†ä»¥ä¸ŠåŸºç¡€é…ç½®å¤–ï¼Œè¿˜éœ€è¦å¯¼å…¥å…¶ä»–é…ç½®ã€‚</p>
<p>DAOç›¸å…³çš„åæ ‡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!-- Spring JDBC --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>spring-jdbc<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>5.2.10.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- MySQL --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>5.1.47<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- MyBatis --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>mybatis<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>3.5.6<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- MyBatis Springä¾èµ– --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>mybatis-spring<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>1.3.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- Druid æ•°æ®åº“è¿æ¥æ±  --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>druid<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>1.1.16<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h2 id="å…¶å®ƒä¾èµ–ç¯å¢ƒ" data-numberify>å…¶å®ƒä¾èµ–ç¯å¢ƒ<a class="anchor ms-1" href="#å…¶å®ƒä¾èµ–ç¯å¢ƒ"></a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!-- Jackson --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>jackson-databind<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>2.9.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- æ—¥å¿— --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>1.2.3<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- Thymeleafï¼ˆä¸å¸¸ç”¨ï¼‰ --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>org.thymeleaf<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>thymeleaf-spring5<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>3.0.12.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- æ–‡ä»¶ä¸Šä¼ ä¾èµ– --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>commons-fileupload<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>commons-fileupload<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>1.3.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- Test --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- Junit å•å…ƒæµ‹è¯• --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><hr>
<h1 id="é…ç½®" data-numberify>é…ç½®<a class="anchor ms-1" href="#é…ç½®"></a></h1>
<p>é…ç½®SpringMVCæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li><code>web.xml</code>é…ç½®æ–‡ä»¶</li>
<li>é…ç½®ç±»</li>
</ul>
<h2 id="é…ç½®æ–‡ä»¶æ–¹å¼" data-numberify>é…ç½®æ–‡ä»¶æ–¹å¼<a class="anchor ms-1" href="#é…ç½®æ–‡ä»¶æ–¹å¼"></a></h2>
<p>åœ¨<code>web.xml</code>ä¸­æ³¨å†ŒSpringMVCçš„å‰ç«¯æ§åˆ¶å™¨<code>DispatcherServlet</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE web-app PUBLIC
</span></span></span><span class="line"><span class="cl"><span class="cp"> &#34;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp"> &#34;http://java.sun.com/dtd/web-app_2_3.dtd&#34; &gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;web-app&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;servlet&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;servlet-name&gt;</span>springMVC<span class="nt">&lt;/servlet-name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- æŒ‡å®šSpringMVCå‰ç«¯æ§åˆ¶å™¨ï¼š --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/servlet&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;servlet-mapping&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;servlet-name&gt;</span>springMVC<span class="nt">&lt;/servlet-name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- 
</span></span></span><span class="line"><span class="cl"><span class="c">            é…å¯¹è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c">            / è¡¨ç¤ºå¤„ç†æ‰€æœ‰ä¸åŒ…æ‹¬.jspçš„è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c">            å› ä¸º.jspæœ‰è‡ªå·±çš„servletï¼Œå¦‚æœåœ¨DispatcherServletä¸­å¤„ç†.jspï¼Œä¼šå¯¼è‡´æ‰¾ä¸åˆ°ç›¸åº”é¡µé¢ï¼Œä»è€Œå¯¼è‡´æ¸²æŸ“å¤±è´¥
</span></span></span><span class="line"><span class="cl"><span class="c">        --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/servlet-mapping&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/webapp&gt;</span>
</span></span></code></pre></div><blockquote>
<p><code>&lt;url-pattern&gt;</code>ï¼š</p>
<ul>
<li><code>/</code>ï¼šè¡¨ç¤ºåŒ¹é…æ‰€æœ‰ä¸åŒ…æ‹¬<code>.jsp</code>çš„è¯·æ±‚ï¼›</li>
<li><code>/*</code>ï¼šèƒ½å¤ŸåŒ¹é…æ‰€æœ‰è¯·æ±‚ï¼ŒåŒ…æ‹¬<code>.jsp</code>ã€‚</li>
</ul>
</blockquote>
<p>æ‰©å±•é…ç½®ï¼š</p>
<p><code>web.xml</code>ä¸­çš„é…ç½®è¿˜å¯ä»¥å®šä¹‰åœ¨å…¶å®ƒæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚åœ¨<code>resourece</code>ä¸‹åˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶<code>springMVC.xml</code>ã€‚ç„¶ååœ¨<code>web.xml</code>æ·»åŠ æ–°é…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!-- 
</span></span></span><span class="line"><span class="cl"><span class="c">    é…ç½®SpringMVCçš„å‰ç«¯æ§åˆ¶å™¨
</span></span></span><span class="line"><span class="cl"><span class="c">    å¯¹æµè§ˆå™¨å‘é€çš„è¯·æ±‚ç»Ÿä¸€è¿›è¡Œå¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="c"> --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;webapp&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;servlet&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;servlet-name&gt;</span>springMVC<span class="nt">&lt;/servlet-name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- 
</span></span></span><span class="line"><span class="cl"><span class="c">            é€šè¿‡åˆå§‹åŒ–å‚æ•°æŒ‡å®šSpringMVCé…ç½®æ–‡ä»¶çš„ä½ç½®å’Œåç§°
</span></span></span><span class="line"><span class="cl"><span class="c">         --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;init-param&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!-- contextConfigLocationä¸ºå›ºå®šå€¼ --&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!-- 
</span></span></span><span class="line"><span class="cl"><span class="c">                ä½¿ç”¨ classpath: è¡¨ç¤ºä»ç±»è·¯å¾„æŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚mavenå·¥ç¨‹ä¸­çš„src/main/resources
</span></span></span><span class="line"><span class="cl"><span class="c">             --&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;param-value&gt;</span>classpath:springMVC.xml<span class="nt">&lt;/param-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/init-param&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- 
</span></span></span><span class="line"><span class="cl"><span class="c">            å°†å¯åŠ¨æ§åˆ¶DispatcherServletçš„åˆå§‹åŒ–æ—¶é—´æå‰åˆ°æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c">        --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/servlet&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- ... --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/webapp&gt;</span>
</span></span></code></pre></div><p>åœ¨<code>springMVC.xml</code>ä¸­é…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span> <span class="na">xmlns:mvc=</span><span class="s">&#34;http://www.springframework.org/schema/mvc&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- è‡ªåŠ¨æ‰«æåŒ… --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.linner.controller&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- é…ç½®Thymeleafè§†å›¾è§£æå™¨ï¼ˆä¸å¸¸ç”¨ï¼‰ --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;viewResolver&#34;</span> <span class="na">class=</span><span class="s">&#34;org.thymeleaf.spring5.view.ThymeleafViewResolver&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;order&#34;</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- è®¾ç½®ç¼–ç ï¼Œå°†ç¼–ç éƒ½è½¬ä¸º UTF-8 --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;characterEncoding&#34;</span> <span class="na">value=</span><span class="s">&#34;UTF-8&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;templateEngine&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.thymeleaf.spring5.SpringTemplateEngine&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;templateResolver&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">                        <span class="c">&lt;!-- è§†å›¾å‰ç¼€ --&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/templates/&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">                        <span class="c">&lt;!-- è§†å›¾åç¼€ --&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.html&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;templateMode&#34;</span> <span class="na">value=</span><span class="s">&#34;HTML5&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;characterEncoding&#34;</span> <span class="na">value=</span><span class="s">&#34;UTF-8&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/property&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/property&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- é™æ€èµ„æºè®¿é—® --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mvc:view-controller</span> <span class="na">path=</span><span class="s">&#34;/&#34;</span> <span class="na">view-name=</span><span class="s">&#34;index&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- 
</span></span></span><span class="line"><span class="cl"><span class="c">        å¤„ç†é™æ€èµ„æºï¼Œä¾‹å¦‚htmlã€jsã€cssã€jpg
</span></span></span><span class="line"><span class="cl"><span class="c">        è‹¥åªè®¾ç½®è¯¥æ ‡ç­¾ï¼Œåˆ™åªèƒ½è®¿é—®é™æ€èµ„æºï¼Œå…¶ä»–è¯·æ±‚åˆ™æ— æ³•è®¿é—®
</span></span></span><span class="line"><span class="cl"><span class="c">        æ­¤æ—¶å¿…é¡»è®¾ç½®&lt;mvc:annotation-driven/&gt;è§£å†³é—®é¢˜
</span></span></span><span class="line"><span class="cl"><span class="c">    --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mvc:default-servlet-handler/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- å¼€å¯mvcæ³¨è§£é©±åŠ¨ --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mvc:annotation-driven&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;mvc:message-converters&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!-- å¤„ç†å“åº”ä¸­æ–‡å†…å®¹ä¹±ç  --&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.http.converter.StringHttpMessageConverter&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;defaultCharset&#34;</span> <span class="na">value=</span><span class="s">&#34;UTF-8&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;supportedMediaTypes&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;list&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;value&gt;</span>text/html<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;value&gt;</span>application/json<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/list&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/property&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/mvc:message-converters&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/mvc:annotation-driven&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/beans&gt;</span>
</span></span></code></pre></div><blockquote>
<p>åœ¨è§†å›¾è§£æå™¨ä¸­è®¾ç½®äº†è§†å›¾å‰ç¼€<code>&lt;property name=&quot;prefix&quot; ...&gt;</code>å’Œè§†å›¾åç¼€<code>&lt;property name=&quot;suffix&quot; ...&gt;</code>ï¼Œé‚£ä¹ˆåœ¨Controllerçš„æ–¹æ³•ä¸­ï¼Œæƒ³è¦è·³è½¬åˆ°è§†å›¾æ—¶ï¼Œåªéœ€è¿”å›å¯¹åº”çš„è§†å›¾æ–‡ä»¶åç§°ï¼Œå¹¶å»æ‰å…¶åç¼€ã€‚ä¾‹å¦‚è®¿é—®<code>hello.html</code>åªéœ€è¿”å›<code>&quot;hello&quot;</code>ï¼Œä½†<code>hello.html</code>å¿…é¡»è¦åœ¨å¯¹åº”çš„å‰ç¼€è·¯å¾„ä¸­ã€‚</p>
</blockquote>
<p>SpringMVCç¼–ç è¿‡æ»¤å™¨ï¼ˆå¿…é¡»åœ¨<code>web.xml</code>ä¸­è¿›è¡Œæ³¨å†Œï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;webapp&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- é…ç½® SpringMVC çš„ç¼–ç è¿‡æ»¤å™¨ --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;filter&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="nt">&lt;/filter-class&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;init-param&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;param-name&gt;</span>encoding<span class="nt">&lt;/param-name&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/init-param&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;init-param&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;param-name&gt;</span>forceResponseEncoding<span class="nt">&lt;/param-name&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/init-param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/filter&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;filter-mapping&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/filter-mapping&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;servlet&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- ... --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/servlet&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- ... --&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/webapp&gt;</span>
</span></span></code></pre></div><blockquote>
<p>SpringMVCä¸­å¤„ç†ç¼–ç çš„è¿‡æ»¤å™¨ä¸€å®šè¦é…ç½®åˆ°å…¶ä»–è¿‡æ»¤å™¨ä¹‹å‰ï¼Œå¦åˆ™æ— æ•ˆã€‚</p>
</blockquote>
<h2 id="é…ç½®ç±»æ–¹å¼" data-numberify>é…ç½®ç±»æ–¹å¼<a class="anchor ms-1" href="#é…ç½®ç±»æ–¹å¼"></a></h2>
<p>ä½¿ç”¨é…ç½®ç±»åˆ™æ— éœ€åœ¨<code>webapp/WEB-INF</code>ä¸­æ·»åŠ <code>web.xml</code>æ–‡ä»¶ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©æ·»åŠ ï¼‰ã€‚</p>
<p>SpringMVCé¡¹ç›®è‡³å°‘éœ€è¦<code>ServletConfig</code>ã€<code>SpringConfig</code>å’Œ<code>SpringMvcConfig</code>è¿™ä¸‰ä¸ªé…ç½®ç±»ã€‚</p>
<ul>
<li>ServletConfigï¼šSpring MVCé¡¹ç›®åˆå§‹åŒ–ç±»ï¼Œä¹Ÿæ˜¯é¡¹ç›®çš„å…¥å£ï¼Œä½œç”¨ä¸<code>web.xmlç±»ä¼¼</code>ã€‚</li>
<li>SpringConfigï¼šæ§åˆ¶ä¸šåŠ¡ï¼ˆServiceï¼‰å’ŒåŠŸèƒ½ï¼ˆå¦‚DataSourceã€SqlSessionFactoryBeanã€ MapperScannerConfigurerç­‰ï¼‰ç›¸å…³çš„Beanã€‚</li>
<li>SpringMvcConfigï¼ˆWebConfigï¼‰ï¼šåŠ è½½è¡¨ç°å±‚Beanï¼ˆControllerï¼‰ã€‚</li>
</ul>
<p><code>ServletConfig</code>ï¼ˆWebé¡¹ç›®å…¥å£é…ç½®ç±»ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServletConfig</span> <span class="kd">extends</span> <span class="n">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æŒ‡å®šSpringçš„é…ç½®ç±»
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="n">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">getRootConfigClasses</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">Class</span><span class="o">[]{</span><span class="n">SpringConfig</span><span class="o">.</span><span class="na">class</span><span class="o">};</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æŒ‡å®šSpring MVCçš„é…ç½®ç±»
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="n">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">getServletConfigClasses</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">Class</span><span class="o">[]{</span><span class="n">SpringMvcConfig</span><span class="o">.</span><span class="na">class</span><span class="o">};</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æŒ‡å®šDispatcherServletçš„æ˜ å°„è·¯å¾„ï¼Œå³url-pattern
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getServletMappings</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;/&#34;</span><span class="o">};</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><blockquote>
<p><code>ServletConfig</code>æœ€é‡è¦çš„æ˜¯ç»§æ‰¿<code>AbstractAnnotationConfigDispatcherServletInitializer</code>è¿™ä¸ªç±»ï¼Œå¹¶ååˆ«é‡å†™å®ƒçš„ä¸‰ä¸ªæ–¹æ³•ã€‚</p>
<p>åœ¨Servlet3.0ç¯å¢ƒä¸­ï¼Œå®¹å™¨ä¼šåœ¨ç±»è·¯å¾„ä¸­æŸ¥æ‰¾å®ç°<code>javax.servlet.ServletContainerlnitializer</code>æ¥å£çš„ç±»ï¼Œå¦‚æœæ‰¾åˆ°çš„è¯å°±ç”¨å®ƒæ¥é…ç½®Servletå®¹å™¨ã€‚</p>
<p>Springæä¾›äº†è¿™ä¸ªæ¥å£çš„å®ç°ï¼Œåä¸º<code>SpringServletContainerlnitializer</code>ï¼Œè¿™ä¸ªç±»åè¿‡æ¥åˆä¼šæŸ¥æ‰¾å®ç°<code>WebApplicationInitializer</code>çš„ç±»å¹¶å°†é…ç½®çš„ä»»åŠ¡äº¤ç»™å®ƒä»¬æ¥å®Œæˆã€‚</p>
<p>Spring3.2å¼•lå…¥äº†ä¸€ä¸ªä¾¿åˆ©çš„<code>WebApplicationInitializer</code>åŸºç¡€å®ç°ï¼Œåä¸º<code>AbstractAnnotationConfigDispatcherServletlnitializer</code>ï¼Œå½“æˆ‘ä»¬çš„ç±»æ‰©å±•äº†<code>AbstractAnnotationConfigDispatcherServletInitializer</code>ï¼Œå¹¶å°†å…¶éƒ¨ç½²åˆ°Servlet3.Oå®¹å™¨çš„æ—¶å€™ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨å‘ç°å®ƒï¼Œå¹¶ç”¨å®ƒæ¥é…ç½®<code>Servlet</code>ä¸Šä¸‹æ–‡ã€‚</p>
</blockquote>
<p><code>SpringConfig</code>ï¼ˆå¯åŠ¨TomcatæœåŠ¡å™¨æ—¶åŠ è½½Springé…ç½®ç±»ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ComponentScan</span><span class="o">({</span><span class="s">&#34;com.linner.service&#34;</span><span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="nd">@PropertySource</span><span class="o">(</span><span class="s">&#34;classpath:jdbc.properties&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Import</span><span class="o">({</span><span class="n">JdbcConfig</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">MyBatisConfig</span><span class="o">.</span><span class="na">class</span><span class="o">})</span> <span class="c1">// å¼•å…¥å…¶å®ƒé…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@EnableTransactionManagement</span>    <span class="c1">// å¼€å¯äº‹åŠ¡ç®¡ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><blockquote>
<p>Springéœ€è¦ç®¡ç†çš„æ˜¯<code>service</code>åŒ…å’Œ<code>dao</code>åŒ…ã€‚ä½†<code>dao</code>åŒ…æœ€ç»ˆæ˜¯äº¤ç»™<code>MapperScannerConfigurer</code>å¯¹è±¡æ¥è¿›è¡Œæ‰«æå¤„ç†çš„ã€‚æ‰€ä»¥<code>SpringConfig</code>åªéœ€è¦æ‰«æåˆ°<code>service</code>åŒ…å³å¯ã€‚</p>
<p>æ¼”ç¤º<code>@ComponentScan</code>çš„å¦ä¸€ç§ç”¨æ³•ï¼ˆæ’é™¤<code>controller</code>åŒ…ä¸­çš„Beanï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;com.linner&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">excludeFilters</span><span class="o">=</span><span class="nd">@ComponentScan.Filter</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">type</span> <span class="o">=</span> <span class="n">FilterType</span><span class="o">.</span><span class="na">ANNOTATION</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">classes</span> <span class="o">=</span> <span class="n">Controller</span><span class="o">.</span><span class="na">class</span> <span class="c1">// æ’é™¤@Controllerå®šä¹‰çš„Bean
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></div><p>ä¸Šé¢æ–¹æ³•æœ¬è´¨æ˜¯ä½¿ç”¨<code>@ComponentScan</code>çš„<code>excludeFilters</code>å±æ€§è®¾ç½®è¿‡æ»¤è§„åˆ™ã€‚</p>
<ul>
<li><code>type</code>ï¼šè®¾ç½®æ’é™¤è§„åˆ™ã€‚
<ul>
<li><code>ANNOTATION</code>ï¼šæŒ‰ç…§æ³¨è§£æ’é™¤ã€‚</li>
<li><code>ASSIGNABLE_TYPE</code>ï¼šæŒ‰ç…§æŒ‡å®šçš„ç±»å‹è¿‡æ»¤ã€‚</li>
<li><code>ASPECTJ</code>ï¼šæŒ‰ç…§Aspectjè¡¨è¾¾å¼æ’é™¤ï¼ˆåŸºæœ¬ä¸Šä¸ä¼šç”¨ï¼‰ã€‚</li>
<li><code>REGEX</code>ï¼šæŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼æ’é™¤ã€‚</li>
<li><code>CUSTOM</code>ï¼šæŒ‰ç…§è‡ªå®šä¹‰è§„åˆ™æ’é™¤ã€‚</li>
</ul>
</li>
</ul>
<p><code>classes</code>ï¼šè®¾ç½®æ’é™¤çš„å…·ä½“æ³¨è§£ç±»ã€‚</p>
</blockquote>
<p><code>SpringMvcConfig</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ComponentScan</span><span class="o">({</span><span class="s">&#34;com.linner.controller&#34;</span><span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableWebMvc</span>   <span class="c1">// MVCæ³¨è§£é©±åŠ¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ç›¸å½“äº default-servlet-handler
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureDefaultServletHandling</span><span class="o">(</span><span class="n">DefaultServletHandlerConfigurer</span> <span class="n">configurer</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">configurer</span><span class="o">.</span><span class="na">enable</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * è§†å›¾æ§åˆ¶å™¨ view-controller
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="n">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&#34;/hello&#34;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&#34;hello&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ–‡ä»¶ä¸Šä¼ è§£æå™¨
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">MultipartResolver</span> <span class="nf">getMultipartResolver</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">CommonsMultipartResolver</span> <span class="n">commonsMultipartResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CommonsMultipartResolver</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">commonsMultipartResolver</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * å¼‚å¸¸å¤„ç†è§£æå™¨
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureHandlerExceptionResolvers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerExceptionResolver</span><span class="o">&gt;</span> <span class="n">exceptionResolvers</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">SimpleMappingExceptionResolver</span> <span class="n">exceptionResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleMappingExceptionResolver</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Properties</span> <span class="n">prop</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">prop</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&#34;java.lang.ArithmeticException&#34;</span><span class="o">,</span> <span class="s">&#34;error&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">exceptionResolver</span><span class="o">.</span><span class="na">setExceptionMappings</span><span class="o">(</span><span class="n">prop</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å¯ä»¥ä¸è®¾ç½®ï¼Œé»˜è®¤é”®å³ä¸º exception
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">exceptionResolver</span><span class="o">.</span><span class="na">setExceptionAttribute</span><span class="o">(</span><span class="s">&#34;exception&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">exceptionResolvers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">exceptionResolver</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ¨¡æ¿è§£æå™¨
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ITemplateResolver</span> <span class="nf">getTemplateResolver</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// è·å–å½“å‰çš„ WebApplicationContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">WebApplicationContext</span> <span class="n">webApplicationContext</span> <span class="o">=</span> <span class="n">ContextLoader</span><span class="o">.</span><span class="na">getCurrentWebApplicationContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ä½¿ç”¨WebApplicationContextè·å–ServletContextï¼Œå¹¶æ„é€ ServletContextTemplateResolver
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">ServletContextTemplateResolver</span> <span class="n">templateResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServletContextTemplateResolver</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">webApplicationContext</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// è®¾ç½®è§†å›¾å‰ç¼€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setPrefix</span><span class="o">(</span><span class="s">&#34;/WEB-INF/templates/&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è®¾ç½®è§†å›¾åç¼€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setSuffix</span><span class="o">(</span><span class="s">&#34;.html&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setTemplateMode</span><span class="o">(</span><span class="n">TemplateMode</span><span class="o">.</span><span class="na">HTML</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">templateResolver</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ¨¡æ¿å¼•æ“
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param templateResolver æ¨¡æ¿è§£æå™¨ï¼ˆè‡ªåŠ¨è£…é…ï¼Œ@Autowiredå¯å¿½ç•¥ä¸å†™ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">SpringTemplateEngine</span> <span class="nf">getTemplateEngine</span><span class="o">(</span><span class="n">ITemplateResolver</span> <span class="n">templateResolver</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">SpringTemplateEngine</span> <span class="n">templateEngine</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringTemplateEngine</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">templateEngine</span><span class="o">.</span><span class="na">setTemplateResolver</span><span class="o">(</span><span class="n">templateResolver</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">templateEngine</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * è®¾ç½®è§†å›¾è§£æå™¨
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param templateEngine æ¨¡æ¿å¼•æ“ï¼ˆè‡ªåŠ¨è£…é…ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ViewResolver</span> <span class="nf">getViewResolver</span><span class="o">(</span><span class="n">SpringTemplateEngine</span> <span class="n">templateEngine</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">ThymeleafViewResolver</span> <span class="n">viewResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThymeleafViewResolver</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">viewResolver</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">viewResolver</span><span class="o">.</span><span class="na">setTemplateEngine</span><span class="o">(</span><span class="n">templateEngine</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">viewResolver</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><blockquote>
<p>å…³äºSpring MVCçš„é…ç½®ç±»ï¼Œé™¤äº†æ‰«æç»„ä»¶å’Œé…ç½®æ¨¡æ¿è§£æå™¨å¤–ï¼ŒSpringæä¾›äº†ä¸¤ç§æ–¹å¼æ¥é…ç½®ï¼Œä¸€ç§æ˜¯å®ç°<code>WebMvcConfigurer</code>æ¥å£ï¼Œå¦ä¸€ç§æ˜¯ç»§æ‰¿<code>WebMvcConfigurationSupport</code>ã€‚ç”±äºJava 8çš„æ¥å£ä¸­æä¾›äº†<code>default</code>å…³é”®å­—æ¥ä¿®é¥°æ¥å£æ–¹æ³•ï¼Œä½¿å¾—æ¥å£å¯ä»¥å­˜åœ¨é»˜è®¤çš„å®ç°ï¼Œæ‰€ä»¥ä½¿ç”¨<code>WebMvcConfigurer</code>æ¥å£ä¹Ÿä¸å¿…å®ç°æ‰€æœ‰æ¥å£ã€‚è€Œåœ¨SpringBoot 2ä¸­ä½¿ç”¨<code>WebMvcConfigurationSupport</code>æœ‰å¯èƒ½ä¼šå¯¼è‡´SpringBootçš„è‡ªåŠ¨é…ç½®ä¸ç”Ÿæ•ˆï¼Œå¹¶ä¸”åœ¨Spring MVCä¸­ä½¿ç”¨<code>WebMvcConfigurationSupport</code>ä¹Ÿå¯èƒ½å¯¼è‡´é…ç½®ç±»ä¸ç”Ÿæ•ˆï¼Œæ‰€ä»¥æˆ‘ä¸ªäºº<b><u>æ¨èä½¿ç”¨<code>WebMvcConfigurer</code></u></b>ã€‚</p>
<p>å¦‚æœä½ ä½¿ç”¨<code>WebMvcConfigurationSupport</code>åå‘ç°æ‹¦æˆªå™¨ç­‰é…ç½®ä¸ç”Ÿæ•ˆï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•å®ç°<code>WebMvcConfigurer</code>æ¥å£æ¥è§£å†³é—®é¢˜ã€‚</p>
</blockquote>
<p>DAOç›¸å…³é…ç½®ç±»ï¼š</p>
<p><code>jdbc.properties</code>ï¼ˆæ•°æ®åº“é…ç½®ï¼Œæ”¾åœ¨é¡¹ç›®ä¸­<code>resources</code>ç›®å½•ä¸‹ï¼‰ï¼š</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">jdbc.driver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql:///spring_db?useSSL=false&amp;characterEncoding=utf-8
jdbc.username=root
jdbc.password=123456
</code></pre><p><code>JdbcConfig</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JdbcConfig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${jdbc.driver}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">driver</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${jdbc.url}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">url</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${jdbc.username}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${jdbc.password}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">DruidDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DruidDataSource</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClassName</span><span class="o">(</span><span class="n">driver</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">transactionManager</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">DataSourceTransactionManager</span> <span class="n">ds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataSourceTransactionManager</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">ds</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ds</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>MyBatisConfig</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBatisConfig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">SqlSessionFactoryBean</span> <span class="nf">sqlSessionFactory</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">SqlSessionFactoryBean</span> <span class="n">factoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SqlSessionFactoryBean</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">factoryBean</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">factoryBean</span><span class="o">.</span><span class="na">setTypeAliasesPackage</span><span class="o">(</span><span class="s">&#34;com.linner.domain&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">factoryBean</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">MapperScannerConfigurer</span> <span class="nf">mapperScannerConfigurer</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">MapperScannerConfigurer</span> <span class="n">msc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapperScannerConfigurer</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">msc</span><span class="o">.</span><span class="na">setBasePackage</span><span class="o">(</span><span class="s">&#34;com.linner.dao&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">msc</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><hr>
<h1 id="ä½¿ç”¨è¿‡æ»¤å™¨è½¬æ¢ç¼–ç " data-numberify>ä½¿ç”¨è¿‡æ»¤å™¨è½¬æ¢ç¼–ç <a class="anchor ms-1" href="#ä½¿ç”¨è¿‡æ»¤å™¨è½¬æ¢ç¼–ç "></a></h1>
<p>åœ¨<code>ServletConfig</code>ä¸­é‡å†™<code>AbstractAnnotationConfigDispatcherServletInitializer</code>çš„<code>getServletFilters()</code>æ¥æ³¨å†Œè¿‡æ»¤å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ³¨å†Œè¿‡æ»¤å™¨
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">protected</span> <span class="n">Filter</span><span class="o">[]</span> <span class="nf">getServletFilters</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// è®¾ç½®ç¼–ç ï¼Œå°†ç¼–ç éƒ½è½¬ä¸º UTF-8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">CharacterEncodingFilter</span> <span class="n">characterEncodingFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CharacterEncodingFilter</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">characterEncodingFilter</span><span class="o">.</span><span class="na">setEncoding</span><span class="o">(</span><span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">characterEncodingFilter</span><span class="o">.</span><span class="na">setForceEncoding</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">HiddenHttpMethodFilter</span> <span class="n">hiddenHttpMethodFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HiddenHttpMethodFilter</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">Filter</span><span class="o">[]{</span><span class="n">characterEncodingFilter</span><span class="o">,</span> <span class="n">hiddenHttpMethodFilter</span><span class="o">};</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><hr>
<h1 id="è¯·æ±‚ä¸å“åº”" data-numberify>è¯·æ±‚ä¸å“åº”<a class="anchor ms-1" href="#è¯·æ±‚ä¸å“åº”"></a></h1>
<p>SpringMVCæ˜¯Webå±‚çš„æ¡†æ¶ï¼Œä¸»è¦ä½œç”¨æ˜¯æ¥æ”¶è¯·æ±‚ã€æ¥æ”¶æ•°æ®ã€å“åº”ç»“æœã€‚</p>
<p>ç¼–å†™Controlleråªéœ€è¦åœ¨Controllerç±»ä¸Šä½¿ç”¨<code>@Controller</code>æ³¨è§£å³å¯ã€‚</p>
<h2 id="è¯·æ±‚æ˜ å°„-requestmapping" data-numberify>è¯·æ±‚æ˜ å°„ RequestMapping<a class="anchor ms-1" href="#è¯·æ±‚æ˜ å°„-requestmapping"></a></h2>
<p>æ˜ å°„è¯·æ±‚è·¯å¾„ä½¿ç”¨<code>@RequestMapping</code>æ³¨è§£ã€‚æ³¨è§£ä¸­çš„ä½¿ç”¨<code>value</code>å±æ€§æŒ‡å®šæ˜ å°„çš„è¯·æ±‚è·¯å¾„ï¼ˆç”±äºæ˜¯<code>value</code>å±æ€§ï¼Œæ‰€ä»¥å½“æ³¨è§£ä¸­æ— éœ€æŒ‡å®šå…¶å®ƒå‚æ•°æ—¶ï¼Œå¯ä»¥çœç•¥ï¼‰ã€‚</p>
<p><code>@RequestMapping</code>å¯ä»¥åˆ†åˆ«ä½œç”¨åœ¨ç±»å’Œæ–¹æ³•ä¸Šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Controller</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/user&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/helloSpring&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">helloSpring</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;Hello Spring!&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/helloWorld&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">helloWorld</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;Hello World!&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ul>
<li>
<p>æ–¹æ³•ä¸Šå®šä¹‰çš„<code>@RequestMapping</code>æ˜¯å…·ä½“çš„è¯·æ±‚æ–¹å¼ï¼ŒåŒ…æ‹¬è¯·æ±‚è·¯å¾„å’Œè¯·æ±‚æ–¹å¼ã€‚</p>
<p>å³ï¼Œå¦‚æœåœ¨æ–¹æ³•ä¸Šä½¿ç”¨äº†<code>@RequestMapping</code>å¹¶ä¸”æ²¡æœ‰åœ¨ç±»ä¸Šä½¿ç”¨<code>@RequestMapping</code>ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•çš„è¯·æ±‚è·¯å¾„å³ä¸ºæ–¹æ³•ä¸Š<code>@RequestMapping</code>ä¸­çš„å€¼ã€‚</p>
</li>
<li>
<p>ç±»ä¸Šå®šä¹‰çš„<code>@RequestMapping</code>æ˜¯è¯·æ±‚ç›®å½•ã€‚</p>
<p>å³ï¼Œå¦‚æœåœ¨æ–¹æ³•å’Œç±»ä¸Šå‡ä½¿ç”¨äº†<code>@RequestMapping</code>ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•çš„è¯·æ±‚è·¯å¾„éœ€è¦åŠ ä¸Šç±»<code>@RequestMapping</code>æ³¨è§£ä¸­å®šä¹‰çš„ç›®å½•ã€‚ä¾‹å¦‚ä¸Šæ–¹ä»£ç ä¸­çš„è¯·æ±‚è·¯å¾„ä¸º<code>/user/helloSpring</code>å’Œ<code>/user/helloWorld</code>ã€‚</p>
</li>
</ul>
<p><code>value</code>å±æ€§æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥æŒ‡å®šå¤šä¸ªè¯·æ±‚è·¯å¾„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">({</span><span class="s">&#34;hello&#34;</span><span class="o">,</span> <span class="s">&#34;helloWorld&#34;</span><span class="o">})</span>
</span></span></code></pre></div><p><code>@RequestMapping</code>é™¤äº†<code>value</code>å±æ€§å¤–ï¼Œè¿˜æœ‰<code>method</code>å±æ€§ã€‚<code>method</code>å±æ€§æ˜¯ç”¨æ¥æŒ‡å®šè¯·æ±‚æ–¹å¼çš„ï¼Œå¦‚ï¼š<code>@RequestMapping(method = RequestMethod.POST)</code>ï¼ˆåŒ¹é…POSTè¯·æ±‚æ–¹å¼ï¼‰ã€‚</p>
<blockquote>
<p>åœ¨å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œ<code>DispatcherServlet</code>ä¼šé¦–å…ˆæ ¹æ®<code>@RequestMapping</code>è·å–å¯¹åº”çš„æ§åˆ¶å™¨æ–¹æ³•ã€‚</p>
</blockquote>
<h2 id="æ¥æ”¶-query-å‚æ•°" data-numberify>æ¥æ”¶ Query å‚æ•°<a class="anchor ms-1" href="#æ¥æ”¶-query-å‚æ•°"></a></h2>
<p>Queryå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ‹¼æ¥åœ¨è¯·æ±‚è·¯å¾„åé¢ï¼Œä»¥<code>?</code>å¼€å§‹ï¼Œä½¿ç”¨<code>&amp;</code>åˆ†éš”æ¯ä¸ªå‚æ•°é¡¹çš„å‚æ•°ä¼ é€’æ–¹å¼ã€‚ä¾‹å¦‚ï¼š</p>
<pre tabindex="0"><code>http://localhost/user/hello?name=å¼ ä¸‰
</code></pre><p>æ¥æ”¶Queryå‚æ•°ï¼ŒGETå’ŒPOSTè¯·æ±‚çš„ç¼–å†™æ–¹å¼ä¸€è‡´ã€‚</p>
<p>å¦‚æœè¦ä½¿ç”¨ä¸åŒçš„æ–¹å¼æ¥æ”¶è¯·æ±‚ï¼Œå¯ä»¥ä¿®æ”¹<code>@RequestMapping</code>æ³¨è§£ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/save&#34;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
</span></span></code></pre></div><h3 id="æ™®é€šå‚æ•°" data-numberify>æ™®é€šå‚æ•°<a class="anchor ms-1" href="#æ™®é€šå‚æ•°"></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Controller</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/user&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ä½¿ç”¨ [http://localhost/user/hello?name=å¼ ä¸‰] è®¿é—®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// è¿”å›å“åº”ä½“ Hello å¼ ä¸‰!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/hello&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;Hello &#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#34;!&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ä½¿ç”¨ [http://localhost/user/login?name=å¼ ä¸‰&amp;password=abc] è®¿é—®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// è¿”å›å“åº”ä½“ OKï¼Œç»ˆç«¯è¾“å‡º userName=å¼ ä¸‰; password=abc
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">userName</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;userName=&#34;</span> <span class="o">+</span> <span class="n">userName</span> <span class="o">+</span> <span class="s">&#34;; password=&#34;</span> <span class="o">+</span> <span class="n">password</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ul>
<li>
<p>è¯·æ±‚å‚æ•°ï¼š</p>
<p><u>å®šä¹‰ç›¸åŒçš„Queryå‚æ•°åä¸æ–¹æ³•å½¢å‚å˜é‡åå³å¯æ¥æ”¶å‚æ•°ã€‚</u></p>
<p><u>å¦‚æœæƒ³è¦å½¢å‚åä¸Queryå‚æ•°åä¸åŒåˆ™å¯ä½¿ç”¨<code>@RequestParam</code>æ³¨è§£å®šä¹‰Queryå‚æ•°åã€‚</u></p>
<p>å¦‚æœæœ‰å¤šä¸ªè¯·æ±‚å‚æ•°åˆ™å®šä¹‰å¤šä¸ªæ–¹æ³•å‚æ•°ã€‚</p>
</li>
<li>
<p>è¿”å›å€¼ï¼š</p>
<p>è¿”å›å€¼ä½¿ç”¨<code>@ResponseBody</code>æ³¨è§£åç›´æ¥åœ¨æ–¹æ³•ä¸­ä½¿ç”¨<code>return</code>è¿”å›ã€‚è¿™é‡Œæ³¨è§£<code>@ResponseBody</code>æ˜¯æŒ‡å°†è¿”å›å€¼ä½œä¸ºå“åº”ä½“ã€‚</p>
</li>
</ul>
<h3 id="pojoç±»å‹å‚æ•°" data-numberify>POJOç±»å‹å‚æ•°<a class="anchor ms-1" href="#pojoç±»å‹å‚æ•°"></a></h3>
<p>ä½¿ç”¨POJOç±»å‹æ¥æ”¶å‚æ•°ï¼Œåªéœ€è¦è®©è¯·æ±‚å‚æ•°åä¸å½¢å‚å¯¹è±¡å±æ€§åç›¸åŒå³å¯ã€‚å¦‚æœæœ‰åµŒå¥—çš„POJOå‚æ•°ï¼Œè¯·æ±‚å‚æ•°åä¸å½¢å‚å¯¹è±¡å±æ€§åç›¸åŒï¼Œç„¶åæŒ‰ç…§å¯¹è±¡å±‚æ¬¡ç»“æ„å…³ç³»å³å¯æ¥æ”¶ã€‚</p>
<p>å®šä¹‰ä¸€ä¸ªPOJOç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">province</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">city</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// setterã€getter and toString...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Address</span> <span class="n">address</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// setterã€getter and toString...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>Controllerï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Controller</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/user&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è®¿é—® [http://localhost/user/login?id=123&amp;password=abc&amp;name=å¼ ä¸‰&amp;address.province=å¹¿ä¸œ&amp;address.city=å¹¿å·]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// è¿”å›å“åº”ä½“ OKï¼Œç»ˆç«¯è¾“å‡º Login: User{id=123, name=&#39;å¼ ä¸‰&#39;, password=&#39;abc&#39;, address=Address{province=&#39;å¹¿ä¸œ&#39;, city=&#39;å¹¿å·&#39;}}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Login: &#34;</span> <span class="o">+</span> <span class="n">user</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="æ•°ç»„é›†åˆç±»å‹å‚æ•°" data-numberify>æ•°ç»„ã€é›†åˆç±»å‹å‚æ•°<a class="anchor ms-1" href="#æ•°ç»„é›†åˆç±»å‹å‚æ•°"></a></h3>
<p>æ¥æ”¶æ•°ç»„å‚æ•°åªéœ€è®©è¯·æ±‚å‚æ•°åä¸å½¢å‚åç›¸åŒä¸”è¯·æ±‚å‚æ•°ä¸ºå¤šä¸ªå³å¯ï¼ˆå½¢å‚ä¸ºæ•°ç»„ç±»å‹ï¼‰ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Controller</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/user&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è®¿é—® [http://localhost/user/setHobbies?id=123&amp;hobbies=å”±æ­Œ,è·³èˆ,Rap,æ‰“ç¯®çƒ]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// è¿”å›å“åº”ä½“ OKï¼Œç»ˆç«¯è¾“å‡º User 123&#39;s hobbyies: [å”±æ­Œ, è·³èˆ, Rap, æ‰“ç¯®çƒ]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/setHobbies&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">setHobbies</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">hobbies</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;User &#34;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;&#39;s hobbies: &#34;</span> <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">hobbies</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨é›†åˆç±»å‹å½¢å‚æ¥æ”¶å‚æ•°ï¼Œä½¿ç”¨æ–¹å¼ä¸æ•°ç»„ä¸åŒï¼ˆä¼šæŠ¥é”™ï¼‰ã€‚å› ä¸ºSpringMVCå°†Listçœ‹åšæ˜¯ä¸€ä¸ªPOJOå¯¹è±¡æ¥å¤„ç†ï¼Œå°†å…¶åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶å‡†å¤‡æŠŠå‰ç«¯çš„æ•°æ®å°è£…åˆ°å¯¹è±¡ä¸­ï¼Œä½†æ˜¯Listæ˜¯ä¸€ä¸ªæ¥å£æ— æ³•åˆ›å»ºå¯¹è±¡ã€‚</p>
<p>ä½¿ç”¨é›†åˆç±»å‹å½¢å‚æ¥æ”¶å‚æ•°éœ€è¦ä½¿ç”¨<code>@RequestParam</code>ç»‘å®šå‚æ•°å…³ç³»ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Controller</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/user&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è®¿é—®æ–¹å¼ä¸æ•°ç»„å½¢å¼ç›¸åŒï¼Œå“åº”ä½“ä¸ç»ˆç«¯è¾“å‡ºä¹Ÿç›¸åŒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/setHobbies&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">setHobbies</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@RequestParam</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">hobbies</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;User &#34;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;&#39;s hobbies: &#34;</span> <span class="o">+</span> <span class="n">hobbies</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="æ—¥æœŸæ ¼å¼" data-numberify>æ—¥æœŸæ ¼å¼<a class="anchor ms-1" href="#æ—¥æœŸæ ¼å¼"></a></h3>
<p>ä½¿ç”¨<code>@DateTimeFormat</code>å¯ä»¥è®¾ç½®å‚æ•°çš„æ—¥æœŸæ ¼å¼ï¼Œå¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Controller</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/user&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// URL: http://localhost/user/setBirthday?id=123&amp;birthday=2023/1/1 18:23:40
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/setBirthday&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">setBirthday</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@DateTimeFormat</span><span class="o">(</span><span class="n">pattern</span> <span class="o">=</span> <span class="s">&#34;yyyy/MM/dd HH:mm:ss&#34;</span><span class="o">)</span> <span class="n">Date</span> <span class="n">birthday</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;User &#34;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;&#39;s birthday is &#34;</span> <span class="o">+</span> <span class="n">birthday</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="json-æ•°æ®å‚æ•°" data-numberify>JSON æ•°æ®å‚æ•°<a class="anchor ms-1" href="#json-æ•°æ®å‚æ•°"></a></h2>
<p>ä½¿ç”¨JSONä¼ è¾“éœ€è¦æ·»åŠ ç›¸åº”ä¾èµ–ã€‚SpringMVCé»˜è®¤ä½¿ç”¨çš„æ˜¯<code>jackson</code>æ¥å¤„ç†jsonçš„è½¬æ¢ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>jackson-databind<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>2.9.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>åœ¨é…ç½®ç±»ä¸­æ·»åŠ <code>@EnableWebMvc</code>æ³¨è§£æ¥å¼€å¯JSONæ•°æ®ç±»å‹è‡ªåŠ¨è½¬æ¢ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ComponentScan</span><span class="o">(</span><span class="s">&#34;com.linner.controller&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableWebMvc</span> <span class="c1">// å¼€å¯JSONæ•°æ®ç±»å‹è‡ªåŠ¨è½¬æ¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringMvcConfig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨JSONä¼ è¾“æ•°æ®åªéœ€è¦åœ¨å½¢å‚å‰æ·»åŠ <code>@ResponseBody</code>æ³¨è§£æ¥å°†å¤–éƒ¨ä¼ é€’çš„JSONæ•°æ®æ˜ å°„åˆ°å½¢å‚åˆ°å¯¹è±¡ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Controller</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/user&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Login: &#34;</span> <span class="o">+</span> <span class="n">user</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/setHobbies&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">setHobbies</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@RequestBody</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="cm">/* ä¹Ÿå¯ä»¥ä½¿ç”¨ String[] */</span> <span class="n">hobbies</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;User &#34;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;&#39;s hobbies: &#34;</span> <span class="o">+</span> <span class="n">hobbies</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ul>
<li>
<p><code>login()</code>ï¼š</p>
<p>URLï¼š<code>http://localhost/user/login</code></p>
<p>JSONï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;å¼ ä¸‰&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;123&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;address&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;province&#34;</span><span class="p">:</span> <span class="s2">&#34;å¹¿ä¸œ&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;city&#34;</span><span class="p">:</span> <span class="s2">&#34;å¹¿å·&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></div></li>
<li>
<p><code>setHobbies</code>ï¼š</p>
<p>URLï¼š<code>http://localhost/user/setHobbies2?id=123</code></p>
<p>JSONï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span><span class="s2">&#34;å”±æ­Œ&#34;</span><span class="p">,</span> <span class="s2">&#34;è·³èˆ&#34;</span><span class="p">,</span> <span class="s2">&#34;Rap&#34;</span><span class="p">,</span> <span class="s2">&#34;æ‰“ç¯®çƒ&#34;</span><span class="p">]</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="å“åº”-json-æ•°æ®" data-numberify>å“åº” JSON æ•°æ®<a class="anchor ms-1" href="#å“åº”-json-æ•°æ®"></a></h2>
<p>å“åº”JSONæ•°æ®éœ€è¦ä¾èµ–äº<code>@ResponseBody</code>ï¼ˆåœ¨Controllerä¸­ï¼‰å’Œ<code>@EnableWebMvc</code>ï¼ˆåœ¨é…ç½®ç±»ä¸­ï¼‰æ³¨è§£ã€‚å°†è¿”å›å€¼è®¾ç½®ä¸ºå®ä½“ç±»å¯¹è±¡ï¼Œè®¾ç½®è¿”å›å€¼ç±»å‹ä¸ºå®ä½“ç±»ç±»å‹ï¼Œå³å¯å®ç°è¿”å›å¯¹åº”å¯¹è±¡çš„JSONæ•°æ®ï¼š</p>
<p>å®ä½“ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// constructorã€setterã€getter and toString ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>Controller:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Controller</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/books&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BookController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/search&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Book</span> <span class="nf">search</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="s">&#34;Hello SpringMVC&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/searchName&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="nf">searchName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Search the book &#34;</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">List</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">name</span> <span class="o">+</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">i</span><span class="o">)));</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">books</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ul>
<li>
<p><code>searchName()</code>ï¼š</p>
<p>URLï¼š<code>http://localhost/books/searchName?name=SpringMVC</code>
è¿”å›JOSNï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;SpringMVC0&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;SpringMVC1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;SpringMVC2&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;SpringMVC3&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;SpringMVC4&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div></li>
<li>
<p><code>search()</code>ï¼š</p>
<p>URLï¼š<code>http://localhost/books/search?id=123</code>
è¿”å›JSONï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;SpringMVC&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="ant-é£æ ¼è·¯å¾„" data-numberify>Ant é£æ ¼è·¯å¾„<a class="anchor ms-1" href="#ant-é£æ ¼è·¯å¾„"></a></h2>
<p>åœ¨Anté£æ ¼ä¸­ï¼Œå®šä¹‰äº†ä»¥ä¸‹å‡ ç§ç¬¦å·ï¼š</p>
<ul>
<li><code>?</code>ï¼šè¡¨ç¤ºåŒ¹é…è¯·æ±‚èµ„æºç›®å½•ä¸­çš„<u>ä»»æ„å•ä¸ªå­—ç¬¦</u>ã€‚</li>
<li><code>*</code>ï¼šè¡¨ç¤ºåŒ¹é…è¯·æ±‚èµ„æºç›®å½•ä¸­çš„<u>ä»»æ„0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</u>ã€‚</li>
<li><code>/**/</code>ï¼šè¡¨ç¤ºåŒ¹é…è¯·æ±‚è·¯å¾„ä¸­ä»»æ„ä¸€å±‚æˆ–å¤šå±‚ç›®å½•ã€‚ä¾‹å¦‚<code>/**/user</code>å¯ä»¥åŒ¹é…<code>/abc/user</code>ã€<code>/abc/def/user</code>ç­‰ç­‰ã€‚</li>
</ul>
<h2 id="rest-é£æ ¼" data-numberify>REST é£æ ¼<a class="anchor ms-1" href="#rest-é£æ ¼"></a></h2>
<p>RESTï¼ˆRepresentational State Transferï¼Œè¡¨ç°å½¢å¼çŠ¶æ€è½¬æ¢ï¼‰ï¼Œæ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ã€‚RESTçš„ä¼˜ç‚¹æœ‰ï¼š</p>
<ul>
<li>éšè—èµ„æºçš„è®¿é—®è¡Œä¸ºï¼Œæ— æ³•é€šè¿‡åœ°å€å¾—çŸ¥å¯¹èµ„æºæ˜¯ä½•ç§æ“ä½œã€‚</li>
<li>ç®€åŒ–ä¹¦å†™ã€‚</li>
</ul>
<p>æŒ‰ç…§RESTé£æ ¼è®¿é—®èµ„æºæ—¶ä½¿ç”¨è¡Œä¸ºåŠ¨ä½œåŒºåˆ†å¯¹èµ„æºè¿›è¡Œäº†ä½•ç§æ“ä½œï¼š</p>
<ul>
<li>GETï¼šæŸ¥è¯¢ï¼›</li>
<li>POSTï¼šæ–°å¢ã€‚</li>
<li>PUTï¼šä¿®æ”¹ã€‚</li>
<li>DELETEï¼šåˆ é™¤ã€‚</li>
</ul>
<p>å¦‚ï¼š</p>
<ul>
<li>
<p><code>http://localhost/users</code> â€”â€” GETï¼š</p>
<p>æŸ¥è¯¢å…¨éƒ¨ç”¨æˆ·ä¿¡æ¯ï¼ˆæŸ¥è¯¢ï¼‰ã€‚</p>
</li>
<li>
<p><code>http://localhost/users/1</code> â€”â€” GETï¼šæŸ¥è¯¢æŒ‡å®šç”¨æˆ·ï¼ˆidä¸º1ï¼‰ä¿¡æ¯ï¼ˆæŸ¥è¯¢ï¼‰ã€‚</p>
</li>
<li>
<p><code>http://localhost/users</code> â€”â€” POSTï¼šæ·»åŠ ç”¨æˆ·ä¿¡æ¯ï¼ˆæ–°å¢/ä¿å­˜ï¼‰ã€‚</p>
</li>
<li>
<p><code>http://localhost/users</code> â€”â€” PUTï¼šä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼ˆä¿®æ”¹/æ›´æ–°ï¼‰ã€‚</p>
</li>
<li>
<p><code>http://localhost/users/1</code> â€”â€” DELETEï¼šåˆ é™¤ç”¨æˆ·ä¿¡æ¯ï¼ˆåˆ é™¤ï¼‰ã€‚</p>
</li>
</ul>
<blockquote>
<p>æè¿°æ¨¡å—çš„åç§°é€šå¸¸ä½¿ç”¨å¤æ•°ï¼Œè¡¨ç¤ºæ­¤ç±»èµ„æºï¼Œè€Œéå•ä¸ªèµ„æºã€‚</p>
</blockquote>
<p>Exampleï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Controller</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/users&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ·»åŠ ç”¨æˆ·
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * åˆ é™¤ç”¨æˆ·
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/{id}&#34;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">delete</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä¿®æ”¹ç”¨æˆ·
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">PUT</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">update</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/{id}&#34;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">searchById</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">searchAll</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä¸Šæ–¹Controllerä¸­æ¯ä¸ªæ–¹æ³•çš„<code>@RequestMapping</code>ä¸­éƒ½ä½¿ç”¨äº†<code>method</code>å…ƒç´ æ¥ç¡®å®šè¯·æ±‚æ–¹å¼ã€‚å¹¶ä¸”æ ¹æ®éœ€è¦<code>save()</code>å’Œ<code>update()</code>éƒ½æ¥æ”¶ä¸€ä¸ªJSONæ•°æ®ã€‚</p>
<p><code>delete()</code>å’Œ<code>searchById()</code>éƒ½ä½¿ç”¨äº†è·¯å¾„å‚æ•°ï¼ˆ<code>value = &quot;\{id}&quot;</code>ï¼‰ã€‚æŒ‡å®šè·¯å¾„å‚æ•°åï¼Œéœ€è¦åœ¨æ–¹æ³•å‚æ•°åˆ—è¡¨ä¸­æ·»åŠ åç§°ç›¸åŒçš„å‚æ•°ï¼Œå¹¶ä¸”ç”¨<code>@PathVariable</code>æ³¨è§£ï¼ˆ<code>public String delete(@PathVariable int id)</code>ï¼‰ã€‚</p>
<p>è·¯å¾„å‚æ•°å¯ä»¥å®šä¹‰å¤šä¸ªï¼Œå¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/{id}/{name}&#34;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">searchById</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@PathVariable</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å¦‚æœæƒ³è¦è·¯å¾„å‚æ•°åä¸å½¢å‚åä¸åŒï¼Œéœ€è¦åœ¨<code>@PathVariable</code>ä¸­æ³¨æ˜å¯¹åº”å…³ç³»ï¼Œå¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/{id}&#34;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">delete</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s">&#34;OK&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="restful-å¿«é€Ÿå¼€å‘" data-numberify>RESTful å¿«é€Ÿå¼€å‘<a class="anchor ms-1" href="#restful-å¿«é€Ÿå¼€å‘"></a></h3>
<ul>
<li>
<p>ä½¿ç”¨<code>@RestController</code>æ³¨è§£ï¼š</p>
<p>å°†<code>@ResponseBody</code>æ³¨è§£æåˆ°ç±»ä¸Šï¼Œè®©æ‰€æœ‰çš„æ–¹æ³•éƒ½æœ‰<code>@ResponseBody</code>çš„åŠŸèƒ½ã€‚
<code>@RestController</code>æ³¨è§£æ­£å¥½ç›¸å½“äº<code>@Controller</code>åŠ ä¸Š<code>@ResponseBody</code>çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨<code>@RestController</code>æ›¿ä»£å®ƒä»¬ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨<code>@GetMapping</code>ã€<code>@PostMapping</code>ã€<code>@PutMapping</code>ã€<code>@DeleteMapping</code>ç­‰æ›¿ä»£<code>@RequestMapping</code>ã€‚</p>
<p>ä¾‹å¦‚<code>@GetMapping</code>å°±ç›¸å½“äº<code>RequestMapping(method = RequestMethod.GET)</code>ã€‚</p>
</li>
</ul>
<p>Exampleï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/books&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BookController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æœç´¢å…¨éƒ¨ä¹¦ç±
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAll</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;All Books&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * æœç´¢å›¾ä¹¦
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/{id}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getById</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;Get by id &#34;</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä¿å­˜å›¾ä¹¦
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@PostMapping</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;Save &#34;</span> <span class="o">+</span> <span class="n">book</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ä¿®æ”¹å›¾ä¹¦
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@PutMapping</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">update</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;Update &#34;</span> <span class="o">+</span> <span class="n">book</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * åˆ é™¤å›¾ä¹¦
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">&#34;/{id}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">delete</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;Delete by id&#34;</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="params-è¯·æ±‚å‚æ•°æ˜ å°„åŒ¹é…" data-numberify>Params è¯·æ±‚å‚æ•°æ˜ å°„åŒ¹é…<a class="anchor ms-1" href="#params-è¯·æ±‚å‚æ•°æ˜ å°„åŒ¹é…"></a></h2>
<p><code>params</code>æ˜¯<code>@RequestMapping</code>ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œè¯¥å±æ€§é€šè¿‡è¯·æ±‚çš„è¯·æ±‚å‚æ•°åŒ¹é…è¯·æ±‚æ˜ å°„ã€‚</p>
<p>ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><code>&quot;param&quot;</code>ï¼šè¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦<code>param</code>è¿™ä¸ªè¯·æ±‚å‚æ•°ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="o">{</span><span class="s">&#34;login&#34;</span><span class="o">},</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&#34;username&#34;</span><span class="o">)</span>
</span></span></code></pre></div><p>è¯·æ±‚è·¯å¾„ç¤ºä¾‹ï¼š</p>
<pre tabindex="0"><code>http://localhost/login?username=zhangsan
</code></pre></li>
<li>
<p><code>&quot;!param&quot;</code>ï¼šå¦å®šåŒ¹é…ï¼Œè¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»ä¸èƒ½æºå¸¦<code>param</code>è¯·æ±‚å‚æ•°ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="o">{</span><span class="s">&#34;login&#34;</span><span class="o">},</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&#34;!username&#34;</span><span class="o">)</span>
</span></span></code></pre></div><p>å¦‚æœè¯·æ±‚è·¯å¾„ä¸­åŒ…å«å‚æ•°<code>username</code>å°†ä¸ä¼šåŒ¹é…åˆ°è¯¥<code>@RequestMapping</code>ã€‚</p>
</li>
<li>
<p><code>&quot;param=value&quot;</code>ï¼šç­‰å€¼åŒ¹é…ï¼Œè¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦<code>param</code>è¯·æ±‚å‚æ•°ï¼Œä¸”<code>param</code>å‚æ•°çš„å€¼å¿…é¡»ä¸º<code>value</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="o">{</span><span class="s">&#34;login&#34;</span><span class="o">},</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&#34;username=admin&#34;</span><span class="o">)</span>
</span></span></code></pre></div><p>è¯·æ±‚è·¯å¾„ä¸ºï¼š</p>
<pre tabindex="0"><code>http://localhost/login?username=admin
</code></pre></li>
<li>
<p><code>&quot;param!=value&quot;</code>ï¼šéå€¼åŒ¹é…ï¼Œè¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦<code>param</code>è¯·æ±‚å‚æ•°ï¼Œä½†<code>param</code>çš„å€¼ä¸èƒ½ä¸º<code>value</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="o">{</span><span class="s">&#34;login&#34;</span><span class="o">},</span> <span class="n">params</span> <span class="o">=</span> <span class="s">&#34;username!=admin&#34;</span><span class="o">)</span>
</span></span></code></pre></div><p>å¦‚æœè¯·æ±‚è·¯å¾„æºå¸¦å‚æ•°<code>username</code>ä¸”å€¼ä¸º<code>admin</code>åˆ™åŒ¹é…å¤±è´¥ã€‚</p>
</li>
<li>
<p><code>{expression1[, expression2[, ...]]}</code>ï¼š</p>
<p><code>params</code>æ˜¯å­—ç¬¦ä¸²æ•°ç»„ç±»å‹ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªå‚æ•°è§„åˆ™ï¼Œå…¶ä¸­<code>expression</code>å¯ä»¥æ˜¯ä»¥ä¸Šä»»ä½•ç±»å‹çš„å­—ç¬¦ä¸²è¡¨è¾¾å¼ä¸­çš„ä»»ä½•ä¸€ç§ã€‚</p>
</li>
</ul>
<p><code>params</code>åªå¯¹å…¶æŒ‡å®šçš„å‚æ•°æœ‰è¦æ±‚ï¼Œæ²¡æœ‰è¢«å…¶æŒ‡å®šçš„å‚æ•°å¹¶æ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚</p>
<p>å¦‚æœè¯·æ±‚çš„è·¯å¾„å’Œæ–¹å¼éƒ½æ»¡è¶³<code>@RequestMapping</code>ï¼Œä½†æ˜¯ä¸<code>params</code>æŒ‡å®šçš„è§„åˆ™ä¸ä»˜ï¼Œå¦‚æœæ­¤æ—¶æ²¡æœ‰å…¶å®ƒæ˜ å°„æ¥åŒ¹é…è¿™ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ç»™æµè§ˆå™¨<code>400</code>é”™è¯¯ã€‚</p>
<h2 id="headers-è¯·æ±‚å¤´åŒ¹é…" data-numberify>headers è¯·æ±‚å¤´åŒ¹é…<a class="anchor ms-1" href="#headers-è¯·æ±‚å¤´åŒ¹é…"></a></h2>
<p><code>headers</code>æ˜¯<code>@RequestMapping</code>çš„å±æ€§ï¼Œå®ƒæŒ‡å®šè¯·æ±‚çš„è¯·æ±‚å¤´ä¿¡æ¯åŒ¹é…è§„åˆ™ã€‚</p>
<p><code>headers</code>çš„å­—ç¬¦ä¸²è¡¨è¾¾å¼è¯­æ³•ä¸<code>params</code>ååˆ†ç›¸ä¼¼ï¼š</p>
<ul>
<li>
<p><code>&quot;header&quot;</code>ï¼šè¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦<code>header</code>è¯·æ±‚å¤´ä¿¡æ¯ã€‚</p>
</li>
<li>
<p><code>&quot;!header&quot;</code>ï¼šè¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»ä¸èƒ½æºå¸¦<code>header</code>è¯·æ±‚å¤´ä¿¡æ¯ã€‚</p>
</li>
<li>
<p><code>&quot;header=value&quot;</code>ï¼šè¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦<code>header</code>è¯·æ±‚å¤´ä¿¡æ¯ä¸”<code>header=value</code>ã€‚</p>
<p>è¯·æ±‚å¤´ä¸­ä½¿ç”¨çš„æ˜¯<code>:</code>åˆ†éš”å¼€çš„é”®å€¼å¯¹ï¼Œ<code>:</code>å·¦è¾¹æ˜¯é”®ï¼ˆå³ä¸Šè¿°ä¸­çš„<code>header</code>ï¼‰ï¼Œå³è¾¹æ˜¯å€¼ï¼ˆå³ä¸Šè¿°ä¸­çš„<code>value</code>ï¼‰ã€‚åªéœ€è¦å°†<code>:</code>æ›¿æ¢ä¸º<code>=</code>å³æ˜¯å¯¹åº”çš„<code>headers</code>å­—ç¬¦ä¸²è¡¨è¾¾å¼ã€‚</p>
</li>
<li>
<p><code>&quot;header!=value&quot;</code>ï¼šè¦æ±‚è¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦<code>header</code>è¯·æ±‚å¤´ä¿¡æ¯ä¸”<code>header!=value</code>ã€‚</p>
</li>
<li>
<p><code>{expression1[, expression2[, ...]]}</code>ï¼š<code>headers</code>å±æ€§åŒæ ·æ˜¯å­—ç¬¦ä¸²æ•°ç»„ç±»å‹ï¼Œå¯ä»¥åœ¨<code>{}</code>ä¸­ä½¿ç”¨ä¸Šè¿°ä»»ä½•è¡¨è¾¾å¼ã€‚</p>
</li>
</ul>
<p>å½“<code>@RequestMapping</code>å…¶å®ƒæ¡ä»¶éƒ½æ»¡è¶³ï¼Œé™¤äº†<code>headers</code>æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›<code>404</code>é”™è¯¯ã€‚</p>
<hr>
<h1 id="åŸŸå¯¹è±¡å…±äº«æ•°æ®" data-numberify>åŸŸå¯¹è±¡å…±äº«æ•°æ®<a class="anchor ms-1" href="#åŸŸå¯¹è±¡å…±äº«æ•°æ®"></a></h1>
<p><code>request</code>åŸŸå¯¹è±¡å…±äº«æ•°æ®çš„å¸¸ç”¨æ–¹å¼å¤§è‡´æœ‰5ç§ï¼š</p>
<ol>
<li>é€šè¿‡<code>ServletAPI</code>è·å–ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰ã€‚å³é€šè¿‡<code>ServletRequest</code>æˆ–<code>HttpServletRequest</code>å¯¹è±¡è·å–<code>request</code>åŸŸã€‚</li>
<li>é€šè¿‡<code>ModelAndView</code>è·å–ã€‚</li>
<li>é€šè¿‡<code>Model</code>è·å–ã€‚</li>
<li>é€šè¿‡<code>Map&lt;String, Object&gt;</code>è·å–ã€‚</li>
<li>é€šè¿‡<code>ModelMap</code>è·å–ã€‚</li>
</ol>
<h2 id="servletapi" data-numberify>ServletAPI<a class="anchor ms-1" href="#servletapi"></a></h2>
<p>è·å–<code>request</code>åŸŸå¯¹è±¡å…±äº«æ•°æ®çš„æ–¹å¼ä¹‹ä¸€å°±æ˜¯ä½¿ç”¨<code>ServletAPI</code>ã€‚å³ï¼Œåœ¨Controllerå¯¹è±¡ä¸­çš„æ˜ å°„æ–¹æ³•ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª<code>ServletRequest</code>æˆ–<code>HttpServletRequest</code>å¯¹è±¡å‚æ•°ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/testServletAPI&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">testServletAPI</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;testScope&#34;</span><span class="o">,</span> <span class="s">&#34;Hello ServletAPI!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">testRequestScope</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><blockquote>
<p>è·å–<code>response</code>ä¹Ÿæ˜¯ç±»ä¼¼çš„æ–¹æ³•ã€‚åœ¨å‚æ•°åˆ—è¡¨ä¸­æŒ‡å®šä¸€ä¸ª<code>ServletResponse</code>æˆ–<code>HttpServletResponse</code>å¯¹è±¡å‚æ•°ã€‚</p>
</blockquote>
<h2 id="model" data-numberify>Model<a class="anchor ms-1" href="#model"></a></h2>
<p><code>Model</code>æ˜¯SpringMVCæä¾›çš„ä¸“ç”¨äºå…±äº«<code>request</code>åŸŸå¯¹è±¡æ•°æ®ã€‚</p>
<p>ä½¿ç”¨<code>Model</code>çš„æ–¹å¼ä¸ä½¿ç”¨<code>ServletAPI</code>ç±»ä¼¼ï¼Œåœ¨å½¢å‚åˆ—è¡¨ä¸­æŒ‡å®šä¸€ä¸ª<code>Model</code>ç±»å‹çš„å‚æ•°å³å¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/testModel&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">testModel</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å†™å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;testRequestScope&#34;</span><span class="o">,</span> <span class="s">&#34;Hello Model!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¯»å–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">testRequestScope</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">model</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;testRequestScope&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">testRequestScope</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">testRequestScope</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="map-string-object" data-numberify>Map String Object<a class="anchor ms-1" href="#map-string-object"></a></h2>
<p>ä½¿ç”¨<code>Map&lt;String, Object&gt;</code>å…±äº«<code>request</code>åŸŸå¯¹è±¡æ•°æ®ï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿæ˜¯åœ¨å½¢å‚åˆ—è¡¨ä¸­å®šä¹‰ä¸€ä¸ª<code>Map&lt;String, Object&gt;</code>ç±»å‹å½¢å‚ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/testMap&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">testMap</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å†™å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;testRequestScope&#34;</span><span class="o">,</span> <span class="s">&#34;Hello Map!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¯»å–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">testRequestScope</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;testRequestScope&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">testRequestScope</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">testRequestScope</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="modelmap" data-numberify>ModelMap<a class="anchor ms-1" href="#modelmap"></a></h2>
<p><code>ModelMap</code>çš„ç”¨æ³•ä¸<code>Map</code>ååˆ†ç±»ä¼¼ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/testModelMap&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">testModelMap</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">modelMap</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å†™å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">modelMap</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;testRequestScope&#34;</span><span class="o">,</span> <span class="s">&#34;Hello ModelMap!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¯»å–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">testRequestScope</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">modelMap</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;testRequestScope&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">testRequestScope</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">testRequestScope</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="modelandview" data-numberify>ModelAndView<a class="anchor ms-1" href="#modelandview"></a></h2>
<p><code>ModelAndView</code>æ˜¯SpringMVCæä¾›çš„ç”¨äºå…±äº«<code>request</code>åŸŸå¯¹è±¡æ•°æ®å’Œè§†å›¾è§£æè·³è½¬çš„APIã€‚</p>
<p>é€šè¿‡<code>ModelAndView</code>å…±äº«<code>request</code>åŸŸæ•°æ®ï¼Œæ— éœ€åœ¨å½¢å‚ä¸­æŒ‡å®šè¯¥ç±»å‹å‚æ•°ï¼Œåªéœ€åœ¨æ–¹æ³•ä¸­<code>new</code>ä¸€ä¸ªå³å¯ã€‚ä½†æ˜¯ä½¿ç”¨<code>ModelAndView</code>éœ€è¦å°†è¯¥ç±»å‹å¯¹è±¡ä½œä¸ºè¿”å›å€¼è¿”å›ã€‚</p>
<p>é™¤äº†ä½¿ç”¨åŸç”Ÿ<code>ServletAPI</code>ä¹‹å¤–ï¼Œä½¿ç”¨å…¶å®ƒæ–¹æ³•ï¼ˆå¦‚ä¸Š<code>Map</code>ã€<code>Model</code>ã€<code>ModelMap</code>ç­‰ï¼‰å…±äº«<code>request</code>åŸŸæ•°æ®ï¼Œæœ€ç»ˆSpringMVCéƒ½ä¼šå°†æ¨¡å‹æ•°æ®å’Œè§†å›¾å°è£…åˆ°<code>ModelAndView</code>ä¸­ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/testModelAndView&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">ModelAndView</span> <span class="nf">testModelAndView</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ModelAndView</span> <span class="n">mav</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ModelAndView</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¤„ç†æ¨¡å‹æ•°æ®ï¼Œå³å‘è¯·æ±‚åŸŸrequestå…±äº«æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">mav</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">&#34;testRequestScope&#34;</span><span class="o">,</span> <span class="s">&#34;Hello ModelAndView!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è®¾ç½®è§†å›¾åç§°ï¼ˆè¿”å›è§†å›¾éœ€è¦æœ‰å¯¹åº”çš„é¡µé¢ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">mav</span><span class="o">.</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&#34;success&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¯»å–æ•°æ®ï¼ˆç¬¬ä¸€æ¬¡å†™å…¥åå¯èƒ½è¯»å–å¤±è´¥ï¼Œå› ä¸ºåªæœ‰åœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åæ‰èƒ½çœŸæ­£å†™å…¥ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">testRequestScope</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">mav</span><span class="o">.</span><span class="na">getModel</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;testRequestScope&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">testRequestScope</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">mav</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>success.html</code>ï¼ˆåœ¨<code>Webapp/WEB-INF/templates/</code>ä¸‹åˆ›å»ºï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;zh&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Success!<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Success!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><blockquote>
<p>å…¶å®<code>ModelAndView</code>ä¹Ÿå¯ä»¥ä½œä¸ºControlleræ–¹æ³•çš„å‚æ•°ä½¿ç”¨ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨<code>ModelAndView</code>è®¾ç½®è§†å›¾å¯¹è±¡æ— è®ºæ˜¯å¦ä½¿ç”¨<code>@ResponseBody</code>ï¼Œè¿”å›çš„å§‹ç»ˆæ˜¯è§†å›¾ã€‚</p>
</blockquote>
<h2 id="mapmodel-å’Œ-modelmap" data-numberify>Mapã€Model å’Œ ModelMap<a class="anchor ms-1" href="#mapmodel-å’Œ-modelmap"></a></h2>
<p>åœ¨ä½¿ç”¨<code>Map&lt;String, Object&gt;</code>ã€<code>Model</code>å’Œ<code>ModelMap</code>æ—¶SpringMVCä¼ å…¥çš„éƒ½æ˜¯<code>BindingAwareModelMap</code>ç±»å‹å¯¹è±¡ã€‚</p>
<ul>
<li>
<p><code>Model</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒå®šä¹‰äº†<code>addAllAttributes()</code>ã€<code>getAttribute()</code>ç­‰æ¥å£æ–¹æ³•ã€‚</p>
</li>
<li>
<p><code>ModelMap</code>ç»§æ‰¿äº†<code>LinkedHashMap&lt;String, Object&gt;</code>ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯å±äº<code>Map</code>çš„å­ç±»ã€‚<code>ModelMap</code>ç»™å‡ºäº†<code>addAllAttributes()</code>ã€<code>getAttribute()</code>ç­‰æ¥å£çš„å®ç°ã€‚</p>
</li>
<li>
<p><code>BindingAwareModelMap</code>ç»§æ‰¿è‡ª<code>ExtendedModelMap</code>ç±»ï¼Œè€Œ<code>ExtendedModelMap</code>åˆæ˜¯<code>ModelMap</code>çš„å­ç±»å’Œ<code>Model</code>æ¥å£çš„å®ç°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExtendedModelMap</span> <span class="kd">extends</span> <span class="n">ModelMap</span> <span class="kd">implements</span> <span class="n">Model</span> <span class="o">{</span> 
</span></span><span class="line"><span class="cl">    <span class="cm">/* ... */</span> 
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>BindingAwareModelMap</code>é‡å†™äº†<code>Map</code>çš„<code>put()</code>å’Œ<code>putAll()</code>ï¼Œä½¿å¾—å®ƒèƒ½ä½œä¸º<code>Map</code>æ¥è¯»å†™<code>request</code>åŸŸã€‚</p>
</li>
</ul>
<p>ç»¼ä¸Šï¼Œ<code>BindingAwareModelMap</code>å¯ä»¥ä½œä¸º<code>Model</code>ã€<code>Map&lt;String, Object&gt;</code>å’Œ<code>ModelMap</code>ä¼ å…¥Controlleræ–¹æ³•ä¸­ã€‚</p>
<p>åœ¨æµè§ˆå™¨å‘é€è¯·æ±‚åï¼Œå®é™…ä¸Šè°ƒç”¨Controllerä¸­å¯¹åº”æ–¹æ³•çš„æ˜¯<code>DispatcherServlet</code>ä¸­çš„<code>doDispatch()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doDispatch</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ModelAndView</span> <span class="n">mv</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1">// Actually invoke the handler.ï¼ˆå®é™…çš„è¯·æ±‚å¤„ç†è€…ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mv</span> <span class="o">=</span> <span class="n">ha</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// æœ€åè¿”å›ä¸€ä¸ªå°è£…å¥½çš„ModelAndViewå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            
</span></span><span class="line"><span class="cl">            <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">processDispatchResult</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="n">mv</span><span class="o">,</span> <span class="n">dispatchException</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span><span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><blockquote>
<p>é€šè¿‡æ–­ç‚¹è°ƒè¯•æœ€åå‘ç°ï¼Œæ— è®ºæ˜¯<code>Map</code>ã€<code>Model</code>ã€<code>ModelMap</code>è¿˜æ˜¯<code>ModelAndView</code>ï¼Œå®ƒä»¬æœ€åéƒ½ä¼šè¢«å°è£…ä¸º<code>ModelAndView</code>ï¼ˆå³ä½¿Controlleræ–¹æ³•è¿”å›çš„æ˜¯<code>ModelAndView</code>ï¼ŒControlleræ–¹æ³•ä¸­çš„<code>ModelAndView</code>å’Œ<code>DispatcherServlet</code>å¯¹è±¡çš„<code>doDispatch()</code>ä¸­çš„<code>ModelAndView</code>åœ°å€ä¹Ÿå¹¶ä¸ç›¸åŒï¼‰ã€‚</p>
</blockquote>
<blockquote>
<p>åœ¨<code>processDispatchResult()</code>ä¸­è°ƒç”¨äº†ä¸‹æ–¹æ‰€ç¤ºæ–¹æ³•æ¥è¿›è¡Œè§†å›¾æ¸²æŸ“ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">render</span><span class="o">(</span><span class="n">mv</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span></code></pre></div></blockquote>
<h2 id="å‘-session-åŸŸå…±äº«æ•°æ®" data-numberify>å‘ Session åŸŸå…±äº«æ•°æ®<a class="anchor ms-1" href="#å‘-session-åŸŸå…±äº«æ•°æ®"></a></h2>
<p>ä½¿ç”¨åŸç”Ÿ<code>ServletAPI</code>å…±äº«ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/testSession&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">testSession</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å†™å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;testSessionScope&#34;</span><span class="o">,</span> <span class="s">&#34;Hello Session!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¯»å–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">testSessionScope</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;testSessionScope&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">testSessionScope</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">testSessionScope</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>Sessionå¯ä»¥ä»RequeståŸŸä¸­è·å–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/testSessionInServlet&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">testSession</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä»RequeståŸŸä¸­è·å–Session
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å†™å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;testSessionScope&#34;</span><span class="o">,</span> <span class="s">&#34;Hello Session In Servlet!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¯»å–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">testSessionScope</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;testSessionScope&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">testSessionScope</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">testSessionScope</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="å‘-application-åŸŸå…±äº«æ•°æ®" data-numberify>å‘ Application åŸŸå…±äº«æ•°æ®<a class="anchor ms-1" href="#å‘-application-åŸŸå…±äº«æ•°æ®"></a></h2>
<p>é€šè¿‡SessionåŸŸè·å–<code>ServletContext</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/testApplication&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">testApplication</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä»SessionåŸŸä¸­è·å–ServletContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ServletContext</span> <span class="n">application</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å†™å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">application</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;testSessionScope&#34;</span><span class="o">,</span> <span class="s">&#34;Hello Application!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¯»å–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">testSessionScope</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">application</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;testSessionScope&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">testSessionScope</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">testSessionScope</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>é€šè¿‡RequeståŸŸè·å–<code>ServletContext</code>ï¼ˆä¸æ¨èï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/testApplicationInServlet&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">testApplication</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä»RequeståŸŸä¸­è·å–ServletContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ServletContext</span> <span class="n">application</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å†™å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">application</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;testSessionScope&#34;</span><span class="o">,</span> <span class="s">&#34;Hello Application In Servlet !&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¯»å–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">testSessionScope</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">application</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;testSessionScope&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">testSessionScope</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">testSessionScope</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><hr>
<h1 id="è¯·æ±‚æŠ¥æ–‡è½¬æ¢" data-numberify>è¯·æ±‚æŠ¥æ–‡è½¬æ¢<a class="anchor ms-1" href="#è¯·æ±‚æŠ¥æ–‡è½¬æ¢"></a></h1>
<p><code>HttpMessageConverter</code>å³æŠ¥æ–‡ä¿¡æ¯è½¬æ¢å™¨ï¼Œèƒ½å°†è¯·æ±‚æŠ¥æ–‡è½¬æ¢ä¸ºJavaå¯¹è±¡ï¼Œæˆ–å°†Javaå¯¹è±¡è½¬æ¢ä¸ºå“åº”æŠ¥æ–‡</p>
<p><code>HttpMessageConverter</code>æä¾›äº†ä¸¤ä¸ªæ³¨è§£å’Œä¸¤ä¸ªç±»å‹ï¼š</p>
<ul>
<li>
<p><code>@ResponseBody</code>ï¼šå³ä¸Šæ–¹Controlleræ–¹æ³•ä¸­ä½¿ç”¨çš„å°†è¿”å›å€¼ï¼ˆJavaå¯¹è±¡ï¼‰ä½œä¸ºå“åº”ä½“å‘é€ç»™æµè§ˆå™¨çš„æ³¨è§£ã€‚</p>
</li>
<li>
<p><code>ResponseEntity</code>ï¼šå¯ä»¥ä½œä¸ºControlleræ–¹æ³•çš„è¿”å›å€¼è¿”å›ï¼Œå¹¶å“åº”ç»™æµè§ˆå™¨ã€‚</p>
</li>
<li>
<p><code>@RequestBody</code>ï¼šå°†Controlleræ–¹æ³•å½¢å‚æŒ‡å®šä¸ºè¯·æ±‚ä½“ï¼Œå¹¶æ¥æ”¶ä»æµè§ˆå™¨å‘é€è¿‡æ¥çš„è¯·æ±‚ä½“ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/testRequestBody&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">testRequestBody</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">String</span> <span class="n">requestBody</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">requestBody</span> <span class="o">=</span> <span class="s">&#34;RequestBody{&#39;&#34;</span> <span class="o">+</span> <span class="n">requestBody</span> <span class="o">+</span> <span class="s">&#34;&#39;}&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">requestBody</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></li>
<li>
<p><code>RequestEntity</code>ï¼šæ˜¯å°è£…è¯·æ±‚æŠ¥æ–‡çš„ä¸€ç§ç±»å‹ï¼Œåœ¨Controlleræ–¹æ³•å½¢å‚ä¸­ä½¿ç”¨ï¼Œå®ƒè·å¾—çš„æ˜¯<u>æ•´ä¸ªè¯·æ±‚æŠ¥æ–‡</u>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/testRequestEntity&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">testRequestEntity</span><span class="o">(</span><span class="n">RequestEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">requestEntity</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">HttpHeaders</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">requestEntity</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">requestEntity</span><span class="o">.</span><span class="na">getBody</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">response</span> <span class="o">=</span> <span class="s">&#34;RequestEntity{&#34;</span> <span class="o">+</span> <span class="n">headers</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;}\nRequestBody{&#39;&#34;</span> <span class="o">+</span> <span class="n">body</span> <span class="o">+</span> <span class="s">&#34;&#39;}&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">response</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></li>
</ul>
<p>å¾€å“åº”ä½“å†™å…¥ä¿¡æ¯è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨åŸç”Ÿ<code>ServletAPI</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/testResponse&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testResponse</span><span class="o">(</span><span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">print</span><span class="o">(</span><span class="s">&#34;Hello Response!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><hr>
<h1 id="æ–‡ä»¶ä¸Šä¼ ä¸‹è½½" data-numberify>æ–‡ä»¶ä¸Šä¼ ä¸‹è½½<a class="anchor ms-1" href="#æ–‡ä»¶ä¸Šä¼ ä¸‹è½½"></a></h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>commons-fileupload<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>commons-fileupload<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>1.3.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h2 id="responseentity-å®ç°ä¸‹è½½" data-numberify>ResponseEntity å®ç°ä¸‹è½½<a class="anchor ms-1" href="#responseentity-å®ç°ä¸‹è½½"></a></h2>
<p>å°†<code>ResponseEntity&lt;byte[]&gt;</code>ä½œä¸ºè¿”å›å€¼ï¼Œåœ¨å…¶ä¸­è®¾ç½®å¥½å¯¹åº”çš„å“åº”å¤´ã€å“åº”ä½“å’ŒçŠ¶æ€ç ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/testDown&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="nf">testResponseEntity</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–ServletContextå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ServletContext</span> <span class="n">servletContext</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–æœåŠ¡å™¨ä¸­æ–‡ä»¶çš„çœŸå®è·¯å¾„ getRealPath()å¦‚æœä¸å¸¦å‚æ•°çš„è¯è·å–çš„æ˜¯æœåŠ¡å™¨çš„éƒ¨ç½²è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">realPath</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;/static/img/test.png&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;RealPath: &#34;</span> <span class="o">+</span> <span class="n">realPath</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºè¾“å…¥æµ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">FileInputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">realPath</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºå­—èŠ‚æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">is</span><span class="o">.</span><span class="na">available</span><span class="o">()];</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å°†æµå†™åˆ°å­—èŠ‚æ•°ç»„ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºHttpHeaderså¯¹è±¡è®¾ç½®å“åº”å¤´ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">MultiValueMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpHeaders</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è®¾ç½®ä¸‹è½½æ–¹å¼ä»¥åŠä¸‹è½½æ–‡ä»¶çš„åå­—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">headers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;Content-Disposition&#34;</span><span class="o">,</span> <span class="s">&#34;attachment;filename=test.png&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è®¾ç½®å“åº”çŠ¶æ€ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">HttpStatus</span> <span class="n">statusCode</span> <span class="o">=</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºResponseEntityå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">responseEntity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">bytes</span><span class="o">,</span> <span class="n">headers</span><span class="o">,</span> <span class="n">statusCode</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å…³é—­è¾“å…¥æµ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">responseEntity</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸‹è½½æ–‡ä»¶ä¹‹å‰ï¼Œéœ€è¦é€šè¿‡Sessionè·å–å½“å‰è¦ä¸‹è½½æ–‡ä»¶çš„çœŸå®è·¯å¾„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ServletContext</span> <span class="n">servletContext</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">realPath</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;/static/img/test.png&#34;</span><span class="o">);</span>
</span></span></code></pre></div><p>è·å–äº†çœŸå®è·¯å¾„åï¼Œé€šè¿‡<code>FileInputStream</code>å°†æ–‡ä»¶è¯»å–å¹¶å†™å…¥å­—èŠ‚æ•°ç»„<code>byte[]</code>ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">FileInputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">realPath</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">is</span><span class="o">.</span><span class="na">available</span><span class="o">()];</span>
</span></span><span class="line"><span class="cl"><span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span></code></pre></div><p>ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œéœ€è¦åœ¨å“åº”å¤´ä¸­è®¾ç½®ä¸‹è½½æ–¹å¼ä»¥åŠæ–‡ä»¶åï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">MultiValueMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpHeaders</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä»¥é™„ä»¶æ–¹å¼ä¸‹è½½æ–‡ä»¶ï¼Œå¹¶ä¸”é»˜è®¤æ–‡ä»¶åä¸ºtest.png
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">headers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;Content-Disposition&#34;</span><span class="o">,</span> <span class="s">&#34;attachment;filename=test.png&#34;</span><span class="o">);</span>
</span></span></code></pre></div><p>æœ€åå°†å­—èŠ‚æ•°ç»„ä½œä¸ºå“åº”ä½“ï¼Œå†åŠ ä¸Šå“åº”å¤´å’ŒçŠ¶æ€ç ç­‰ä¿¡æ¯ï¼Œåˆ›å»º<code>ResponseEntity</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">responseEntity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">bytes</span><span class="o">,</span> <span class="n">headers</span><span class="o">,</span> <span class="n">statusCode</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="n">responseEntity</span><span class="o">;</span>
</span></span></code></pre></div><h2 id="æ–‡ä»¶ä¸Šä¼ " data-numberify>æ–‡ä»¶ä¸Šä¼ <a class="anchor ms-1" href="#æ–‡ä»¶ä¸Šä¼ "></a></h2>
<p>æ–‡ä»¶ä¸Šä¼ ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>commons-fileupload<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>commons-fileupload<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>1.3.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>åœ¨<code>springMVC.xml</code>ä¸­é…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!-- é…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨ï¼Œå°†ä¸Šä¼ çš„æ–‡ä»¶å°è£…ä¸ºMultipartFile --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;multipartResolver&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.multipart.commons.CommonsMultipartResolver&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></div><p>æ–‡ä»¶ä¸Šä¼ å®ç°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/testUp&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ResponseBody</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">testUp</span><span class="o">(</span><span class="n">MultipartFile</span> <span class="n">photo</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">photo</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–ä¸Šä¼ æ–‡ä»¶çš„åç¼€å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">suffixName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">fileName</span><span class="o">.</span><span class="na">lastIndexOf</span><span class="o">(</span><span class="s">&#34;.&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å°†UUIDä½œä¸ºæ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">uuid</span> <span class="o">=</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å°†UUIDå’Œåç¼€åæ‹¼æ¥åçš„ç»“æœä½œä¸ºæœ€ç»ˆçš„æ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">fileName</span> <span class="o">=</span> <span class="n">uuid</span> <span class="o">+</span> <span class="n">suffixName</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// éœ€è¦é€šè¿‡ ServletContext è·å–æœåŠ¡å™¨ä¸­ photo ç›®å½•çš„è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ServletContext</span> <span class="n">servletContext</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// photo å…¶å®ä¹Ÿå¯ä»¥ç”¨ photo.getName() æ›¿ä»£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">photoPath</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;photo&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">photoPath</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ¤æ–­photoPathæ‰€å¯¹åº”è·¯å¾„æ˜¯å¦å­˜åœ¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è‹¥ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºç›®å½•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">file</span><span class="o">.</span><span class="na">mkdir</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">finalPath</span> <span class="o">=</span> <span class="n">photoPath</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="n">fileName</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">photo</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">finalPath</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">fileName</span> <span class="o">+</span> <span class="s">&#34; OK!&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œéœ€è¦è€ƒè™‘æ–‡ä»¶ä¹‹é—´æ–‡ä»¶åçš„å†²çªé—®é¢˜ï¼Œå¯ä»¥é€šè¿‡å°†æ–‡ä»¶åæ”¹ä¸ºUUIDè§£å†³ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// è·å–ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">photo</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è·å–ä¸Šä¼ æ–‡ä»¶çš„åç¼€å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">String</span> <span class="n">suffixName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">fileName</span><span class="o">.</span><span class="na">lastIndexOf</span><span class="o">(</span><span class="s">&#34;.&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å°†UUIDä½œä¸ºæ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">String</span> <span class="n">uuid</span> <span class="o">=</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å°†UUIDå’Œåç¼€åæ‹¼æ¥åçš„ç»“æœä½œä¸ºæœ€ç»ˆçš„æ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">fileName</span> <span class="o">=</span> <span class="n">uuid</span> <span class="o">+</span> <span class="n">suffixName</span><span class="o">;</span>
</span></span></code></pre></div><hr>
<h1 id="æ‹¦æˆªå™¨" data-numberify>æ‹¦æˆªå™¨<a class="anchor ms-1" href="#æ‹¦æˆªå™¨"></a></h1>
<p>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰æ˜¯ä¸€ç§åŠ¨æ€æ‹¦æˆªæ–¹æ³•è°ƒç”¨çš„æœºåˆ¶ï¼Œåœ¨SpringMVCä¸­åŠ¨æ€æ‹¦æˆªæ§åˆ¶å™¨æ–¹æ³•çš„æ‰§è¡Œã€‚æ‹¦æˆªå™¨å¯ä»¥åœ¨æŒ‡å®šçš„å‘é‚£ä¸ªå‘è°ƒç”¨å‰åæ‰§è¡Œé¢„å…ˆè®¾å®šçš„ä»£ç ï¼Œå¯ä»¥é˜»æ­¢åŸå§‹æ–¹æ³•çš„æ‰§è¡Œã€‚æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨åœ¨ä½œç”¨å’Œæ‰§è¡Œé¡ºåºä¸Šå¾ˆç›¸ä¼¼ã€‚å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><picture><img class="img-fluid " alt="æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„å…³ç³»" src="/docs/spring/springmvc/base/1630676903190.png" loading="lazy" width="1221" height="390" />
</picture>

</p>
<p>åˆ›å»ºæ‹¦æˆªå™¨ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span>  <span class="c1">// ç”±SpringMVCæ¥ç®¡ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BookInterceptor</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;preHandle...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;postHandle...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;afterCompletion...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="æ‹¦æˆªå™¨é…ç½®ç±»" data-numberify>æ‹¦æˆªå™¨é…ç½®ç±»<a class="anchor ms-1" href="#æ‹¦æˆªå™¨é…ç½®ç±»"></a></h2>
<p>ç¼–å†™æ‹¦æˆªå™¨é…ç½®ç±»æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>å®ç°<code>WebMvcConfigurer</code>æ¥å£ï¼›</li>
<li>ç»§æ‰¿<code>WebMvcConfigurationSupport</code>ç±»å¹¶é‡å†™æ–¹æ³•ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ‰«æinterceptoråŒ…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@ComponentScan</span><span class="o">(</span><span class="s">&#34;com.linner.interceptor&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringMvcSupport</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurationSupport</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>  <span class="c1">// è‡ªåŠ¨è£…é…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="n">BookInterceptor</span> <span class="n">bookInterceptor</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="n">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">            æ·»åŠ ï¼ˆå£°æ˜ï¼‰æ‹¦æˆªå™¨å¹¶é…ç½®æ‹¦æˆªè§„åˆ™
</span></span></span><span class="line"><span class="cl"><span class="cm">            å¯ä»¥åŒæ—¶é…ç½®å¤šä¸ªè§„åˆ™
</span></span></span><span class="line"><span class="cl"><span class="cm">            å¦‚æœä¸æ·»åŠ æ‹¦æˆªè§„åˆ™ï¼Œé»˜è®¤æ‹¦æˆªæ‰€æœ‰è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="cm">        */</span>
</span></span><span class="line"><span class="cl">        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="n">bookInterceptor</span><span class="o">).</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">&#34;/books&#34;</span><span class="o">,</span> <span class="s">&#34;/books/*&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è®©SpringMVCæ‰«æåˆ°æ‹¦æˆªå™¨çš„é…ç½®ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ComponentScan</span><span class="o">({</span><span class="s">&#34;com.linner.controller&#34;</span><span class="o">,</span> <span class="s">&#34;com.linner.config&#34;</span><span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableWebMvc</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringMvcConfig</span> <span class="o">{}</span>
</span></span></code></pre></div><p>æ‹¦æˆªå™¨çš„é…ç½®ç±»<code>SpingMvcSupport</code>å¯ä»¥ä¹¦å†™åœ¨<code>SpringMvcConfig</code>ä¸­ï¼Œä»¥ç®€åŒ–ä¹¦å†™ï¼ˆå¹¶æ¼”ç¤ºç»§æ‰¿<code>WebMvcConfigurer</code>ç¼–å†™æ‹¦æˆªå™¨é…ç½®ç±»ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ComponentScan</span><span class="o">({</span><span class="s">&#34;com.linner.controller&#34;</span><span class="o">,</span> <span class="s">&#34;com.linner.interceptor&#34;</span><span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableWebMvc</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringMvcConfig</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">BookInterceptor</span> <span class="n">bookInterceptor</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="n">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="n">bookInterceptor</span><span class="o">).</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">&#34;/books&#34;</span><span class="o">,</span> <span class="s">&#34;/books/*&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="æ‹¦æˆªå™¨æ‰§è¡Œè¿‡ç¨‹" data-numberify>æ‹¦æˆªå™¨æ‰§è¡Œè¿‡ç¨‹<a class="anchor ms-1" href="#æ‹¦æˆªå™¨æ‰§è¡Œè¿‡ç¨‹"></a></h2>
<p>è¿è¡Œç¨‹åºï¼Œå‘é€<code>books</code>å¼€å¤´çš„è¯·æ±‚ï¼ˆå¦‚<code>http://localhost/books</code>ï¼‰ï¼Œç»ˆç«¯ä¼šæœ‰å¦‚ä¸‹è¾“å‡ºï¼š</p>
<pre tabindex="0"><code>preHandle...
getAll...
postHandle...
afterCompletion...
</code></pre><p>æ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</p>
<ol>
<li>æ‰§è¡Œ<code>preHandle()</code>ã€‚
<ul>
<li><code>preHandle()</code>è¿”å›å€¼ä¸º<code>true</code>ï¼š
<ol>
<li>æ‰§è¡Œè¯·æ±‚è·¯å¾„ç›¸åº”çš„æ–¹æ³•æˆ–ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨çš„<code>preHandle()</code>ã€‚</li>
<li>åˆ¤æ–­æ˜¯å¦æ‰§è¡Œ<code>postHandle()</code>ï¼š
<ul>
<li>Controllerè¢«æ‰§è¡Œï¼ˆåç»­æ‹¦æˆªå™¨é“¾ä¸­æ²¡æœ‰ä¸€ä¸ª<code>preHandle()</code>è¿”å›å€¼ä¸º<code>false</code>ï¼‰ï¼Œæ‰§è¡Œ<code>postHandle()</code>ã€‚</li>
<li>Controlleræ²¡æœ‰è¢«æ‰§è¡Œï¼ˆåç»­æ‹¦æˆªå™¨é“¾ä¸­å­˜åœ¨ä¸€ä¸ª<code>preHandle()</code>è¿”å›å€¼ä¸º<code>false</code>ï¼‰ï¼Œä¸æ‰§è¡Œ<code>postHandle()</code>ã€‚</li>
</ul>
</li>
<li>æ‰§è¡Œ<code>afterCompletion()</code>ã€‚</li>
</ol>
</li>
<li><code>preHandle()</code>è¿”å›å€¼ä¸º<code>false</code>ã€‚</li>
</ul>
</li>
<li>ç»“æŸã€‚</li>
</ol>
<p>å½“é…ç½®å¤šä¸ªæ‹¦æˆªå™¨æ—¶ï¼Œå½¢æˆæ‹¦æˆªå™¨é“¾ã€‚å¤šä¸ª<code>preHandle()</code>æŒ‰ç…§Interceptorè¢«å£°æ˜é¡ºåºæ‰§è¡Œï¼›å¤šä¸ª<code>postHandle()</code>æŒ‰ç…§Interceptorè¢«å£°æ˜é¡ºåºé€†åºæ‰§è¡Œã€‚å³ï¼Œ<u>æ‹¦æˆªå™¨é“¾çš„è¿è¡Œé¡ºåºä»¥æ‹¦æˆªå™¨æ·»åŠ é¡ºåºä¸ºå‡†</u>ã€‚</p>
<p>å½“æ‹¦æˆªå™¨ä¸­å‡ºç°å¯¹åŸå§‹å¤„ç†å™¨çš„æ‹¦æˆªï¼Œåé¢çš„æ‹¦æˆªå™¨å‡ç»ˆæ­¢è¿è¡Œã€‚å½“æ‹¦æˆªå™¨è¿è¡Œä¸­æ–­ï¼Œä»…è¿è¡Œé…ç½®åœ¨å‰é¢çš„æ‹¦æˆªå™¨çš„<code>afterCompletion()</code>æ“ä½œï¼ˆ<code>afterCompletion()</code>ä»£è¡¨å½“å‰æ‹¦æˆªå™¨æ‰§è¡Œå®Œæˆï¼Œä¸åç»­æ‹¦æˆªå™¨é“¾ä¸­<code>preHandle()</code>çš„è¿”å›å€¼å’ŒControlleræ˜¯å¦è¢«æ‰§è¡Œæ— å…³ï¼‰ã€‚</p>
<p>å‡è®¾ç°åœ¨æœ‰å¦‚ä¸‹ä¸¤ä¸ªæ‹¦æˆªå™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FirstInterceptor</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;FirstInterceptor preHandle...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;FirstInterceptor postHandle...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;FirstInterceptor afterCompletion...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LaterInterceptor</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;LaterInterceptor preHandle...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;LaterInterceptor postHandle...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;LaterInterceptor afterCompletion...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å®ƒä»¬åœ¨æ‹¦æˆªå™¨ç±»ä¸­çš„æ·»åŠ é¡ºåºä¸ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">FirstInterceptor</span> <span class="n">firstInterceptor</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">LaterInterceptor</span> <span class="n">laterInterceptor</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="n">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¦‚æœæ²¡æœ‰é…ç½®æ‹¦æˆªè·¯å¾„ï¼Œåˆ™é»˜è®¤æ‹¦æˆªæ‰€æœ‰è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="n">firstInterceptor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">regisrty</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="n">laterInterceptor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è®¿é—®ä»»æ„èµ„æºåï¼Œç»ˆç«¯è¾“å‡ºï¼š</p>
<pre tabindex="0"><code>FirstInterceptor preHandle...
LaterInterceptor preHandle...
LaterInterceptor postHandle...
FirstInterceptor postHandle...
LaterInterceptor afterCompletion...
FirstInterceptor afterCompletion...
</code></pre><p>å®é™…ä¸Šåœ¨<code>DispatcherServlet</code>çš„<code>doDispatch()</code>æ–¹æ³•ä¸­ï¼Œåœ¨æ‰§è¡Œ<code>mv = ha.handle(...)</code>ä¹‹å‰è¿›è¡Œäº†ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doDispatch</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ‹¦æˆªå™¨é“¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">HandlerExecutionChain</span> <span class="n">mappedHandler</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// è·å–æ‹¦æˆªå™¨é“¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mappedHandler</span> <span class="o">=</span> <span class="n">getHandler</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">noHandlerFound</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// æ‰§è¡Œç›¸åº”Interceptorçš„preHandle
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(!</span><span class="n">mappedHandler</span><span class="o">.</span><span class="na">applyPreHandle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Actually invoke the handler.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mv</span> <span class="o">=</span> <span class="n">ha</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// æ‰§è¡Œç›¸åº”Interceptorçš„postHandle
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mappedHandler</span><span class="o">.</span><span class="na">applyPostHandle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mv</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// å¤„ç†è°ƒåº¦ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// åŒ…å«äº†ModelAndViewçš„è¿›ä¸€æ­¥å¤„ç†ï¼ˆæ¸²æŸ“è§†å›¾ã€å¤„ç†æ¨¡å‹ï¼‰ã€è¿˜æœ‰Interceptorçš„afterCompletion()è°ƒç”¨ç­‰ç­‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">processDispatchResult</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="n">mv</span><span class="o">,</span> <span class="n">dispatchException</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å³<code>HandlerExecutionChain</code>ï¼ˆæ§åˆ¶å™¨æ‰§è¡Œé“¾ï¼‰å¯¹è±¡çš„<code>applyPreHandle()</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * preHandleæ‰§è¡Œé“¾
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kt">boolean</span> <span class="nf">applyPreHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¯»å–interceptorListä¸­çš„interceptorï¼Œå¹¶é€ä¸ªæ‰§è¡Œå®ƒä»¬çš„preHandleæ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">.</span><span class="na">interceptorList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è·å–interceptor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">HandlerInterceptor</span> <span class="n">interceptor</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">interceptorList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ‰§è¡Œinterceptor.preHandle
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// å¦‚æœæœ‰ä¸€ä¸ªinterceptorè¿”å›äº†falseï¼Œåˆ™ç«‹å³æ‰§è¡ŒtriggerAfterCompletion()å¹¶è¿”å›false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(!</span><span class="n">interceptor</span><span class="o">.</span><span class="na">preHandle</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">handler</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">triggerAfterCompletion</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è®°å½•æ‹¦æˆªå™¨é“¾ä¸­è¿”å›falseçš„å‰ä¸€ä¸ªæ‹¦æˆªå™¨ä¸‹æ ‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">this</span><span class="o">.</span><span class="na">interceptorIndex</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>applyPostHandle()</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * postHandleæ‰§è¡Œé“¾
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">applyPostHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">ModelAndView</span> <span class="n">mv</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æŒ‰ç…§å€’åºï¼Œé€ä¸ªæ‰§è¡Œinterceptor.postHandle()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">interceptorList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">HandlerInterceptor</span> <span class="n">interceptor</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">interceptorList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">interceptor</span><span class="o">.</span><span class="na">postHandle</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">handler</span><span class="o">,</span> <span class="n">mv</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>triggerAfterCompletion()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * afterCompletionæ‰§è¡Œé“¾
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">triggerAfterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä»interceptorIndexå¼€å§‹ï¼Œå€’åºæ‰§è¡Œinterceptor.afterCompletion()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// å³triggerAfterCompletion()åªä¼šæ‰§è¡Œé‚£äº›è¿”å›trueçš„interceptorçš„afterCompletion()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">interceptorIndex</span><span class="o">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">HandlerInterceptor</span> <span class="n">interceptor</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">interceptorList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">interceptor</span><span class="o">.</span><span class="na">afterCompletion</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">handler</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">ex2</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;HandlerInterceptor.afterCompletion threw exception&#34;</span><span class="o">,</span> <span class="n">ex2</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸€åˆ‡æ­£å¸¸è¿è¡Œå®Œæˆåï¼Œè°ƒç”¨Interceptorçš„<code>afterCompletion()</code>çš„æƒ…å†µæœ‰ç‚¹å¤æ‚ï¼ˆ<code>DispatcherServlet</code>ä¸­çš„<code>processDispatchResult()</code>ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">processDispatchResult</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Nullable</span> <span class="n">HandlerExecutionChain</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">ModelAndView</span> <span class="n">mv</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Nullable</span> <span class="n">Exception</span> <span class="n">exception</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Did the handler return a view to render?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">mv</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">mv</span><span class="o">.</span><span class="na">wasCleared</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ¸²æŸ“è§†å›¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">render</span><span class="o">(</span><span class="n">mv</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1">// åœ¨å¤„ç†å®Œå…¶å®ƒè°ƒåº¦ç»“æœåï¼Œé€šè¿‡mappedHandler.triggerAfterCompletion()æ¥è°ƒç”¨interceptor.afterCompletion()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Exception (if any) is already handled..
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">mappedHandler</span><span class="o">.</span><span class="na">triggerAfterCompletion</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><blockquote>
<p>åœ¨<code>DispatcherServlet</code>çš„<code>doDispatch()</code>æ–¹æ³•ä¸­è¿˜æœ‰è®¸å¤š<code>try ... catch</code>ï¼Œå½“æ•æ‰åˆ°å¼‚å¸¸æ—¶ï¼Œ<code>doDispatch()</code>ä¹Ÿä¼šé€šè¿‡<code>triggerAfterCompletion()</code>æ–¹æ³•æ¥è°ƒç”¨<code>mappedHandler.triggerAfterCompletion()</code>ã€‚</p>
</blockquote>
<p>æ›´å…·ä¸Šè¿°ä»£ç æ€»ç»“å‡º<code>HandlerExecutionChain</code>ä¸­çš„æ‰§è¡Œæƒ…å†µï¼š</p>
<ul>
<li>
<p><code>applyPreHandle()</code>ï¼šåœ¨æ‰§è¡ŒControlleræ–¹æ³•ä¹‹å‰æ‰§è¡Œã€‚</p>
</li>
<li>
<p><code>applyPostHandle()</code>ï¼šæ‰§è¡Œäº†Controlleræ–¹æ³•ä¹‹åæ‰§è¡Œã€‚</p>
</li>
<li>
<p><code>triggerAfterCompletion()</code>ï¼š</p>
<p>ä¸¤ç§æ‰§è¡Œæƒ…å†µï¼š</p>
<ul>
<li>æ‰§è¡Œ<code>applyPreHandle()</code>æ—¶ï¼Œæœ‰ä¸€ä¸ªæ‹¦æˆªå™¨è¿”å›äº†<code>false</code>ï¼›</li>
<li>æ‰§è¡Œå®Œ<code>applyPostHandle()</code>ä¹‹åï¼Œä¸”æ— é”™è¯¯æ—¶æ‰§è¡Œï¼ˆå³<code>processDispatchResult()</code>ä¸­çš„<code>triggerAfterCompletion()</code>ï¼‰ï¼›</li>
<li>æ‰§è¡Œ<code>applyPreHandle()</code>ã€<code>applyPostHandle()</code>å’ŒControlleræ–¹æ³•è¿‡ç¨‹ä¸­ï¼Œå‡ºç°å¼‚å¸¸æ—¶æ‰§è¡Œï¼ˆå‡ºç°å¼‚å¸¸æ—¶æ˜¯åœ¨<code>DispatcherServlet</code>çš„<code>triggerAfterCompletion()</code>ä¸­è°ƒç”¨ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h2 id="é…ç½®æ–‡ä»¶é…ç½®æ‹¦æˆªå™¨" data-numberify>é…ç½®æ–‡ä»¶é…ç½®æ‹¦æˆªå™¨<a class="anchor ms-1" href="#é…ç½®æ–‡ä»¶é…ç½®æ‹¦æˆªå™¨"></a></h2>
<p>é™¤äº†ä½¿ç”¨é…ç½®ç±»å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼æ¥é…ç½®æ‹¦æˆªå™¨ã€‚</p>
<p>ä½¿ç”¨<code>&lt;mvc:interceptors&gt;</code>æ¥é…ç½®æ‹¦æˆªå™¨ã€‚æ·»åŠ æ‹¦æˆªå™¨çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä½¿ç”¨<u><code>&lt;bean class=&quot;...&quot;/&gt;</code></u>ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨<u><code>&lt;ref bean=&quot;...&quot;/&gt;</code></u>ï¼Œè¿™ä¸¤ç§æ–¹å¼æœ¬è´¨ä¸Šæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;mvc:interceptors&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;asia.linner.interceptor.FirstInterceptor&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- beanä¸­æŒ‡å®šçš„æ˜¯Beançš„é»˜è®¤idï¼Œå³é¦–å­—æ¯å°å†™çš„ç±»å --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&#34;laterInterceptor&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/mvc:interceptors&gt;</span>
</span></span></code></pre></div><p>åœ¨<code>&lt;mvc:interceptors&gt;</code>ä¸­å¯ä»¥ä½¿ç”¨<code>&lt;mvc:interceptor&gt;</code>æ¥é…ç½®å…·ä½“çš„æ‹¦æˆªè§„åˆ™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;mvc:interceptors&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mvc:interceptor&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- &lt;mvc:mapping&gt;: æ‹¦æˆªè·¯å¾„ --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&#34;/**&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- &lt;mvc:exclude-mapping&gt;: æ’é™¤è·¯å¾„ï¼ˆä¸æ‹¦æˆªï¼‰ --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&#34;/users&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;mvc:exclude-mapping</span> <span class="na">path=</span><span class="s">&#34;/users/**&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- å‡è®¾åªæœ‰userså’Œbooksè¿™ä¸¤ä¸ªè¯·æ±‚ --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&#34;bookInterceptor&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/mvc:interceptor&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/mvc:interceptors&gt;</span>
</span></span></code></pre></div><hr>
<h1 id="é™æ€èµ„æºå¤„ç†å™¨" data-numberify>é™æ€èµ„æºå¤„ç†å™¨<a class="anchor ms-1" href="#é™æ€èµ„æºå¤„ç†å™¨"></a></h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringMvcSupport</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurationSupport</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">addResourceHandlers</span><span class="o">(</span><span class="n">ResourceHandlerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ”¾è¡Œå•ä¸ªç›®å½•ï¼ˆWebappç›®å½•ä¸‹ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">registry</span><span class="o">.</span><span class="na">addResourceHandler</span><span class="o">(</span><span class="s">&#34;/pages/**&#34;</span><span class="o">).</span><span class="na">addResourceLocations</span><span class="o">(</span><span class="s">&#34;/pages/&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ä¹Ÿå¯ä»¥å°†Webappæ•´ä¸ªç›®å½•éƒ½æ·»åŠ ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// registry.addResourceHandler(&#34;/**&#34;).addResourceLocations(&#34;classpath:/&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ul>
<li><code>addResourceHandler()</code>ï¼šå®šä¹‰è®¿é—®èµ„æºè·¯å¾„ã€‚</li>
<li><code>addResourceLocations()</code>ï¼šå®šä¹‰è®¿é—®è·¯å¾„æ—¶çš„é™æ€èµ„æºç›®å½•ã€‚</li>
</ul>
<hr>
<h1 id="å¼‚å¸¸å¤„ç†" data-numberify>å¼‚å¸¸å¤„ç†<a class="anchor ms-1" href="#å¼‚å¸¸å¤„ç†"></a></h1>
<p>Spring MVC è‡ªå¸¦äº†ä¸¤ä¸ªå¼‚å¸¸å¤„ç†å™¨åˆ†åˆ«æ˜¯<code>SimpleMappingExceptionResolver</code>å’Œ<code>DefaultHandlerExceptionResolver</code>ã€‚</p>
<p>å…¶ä¸­<code>DefaultHandlerExceptionResolver</code>æ˜¯ç”±Spring MVCå®šä¹‰çš„é»˜è®¤å¼‚å¸¸å¤„ç†å™¨ï¼Œå®ƒçš„<code>doResolveException()</code>å®šä¹‰äº†ä¸€äº›å¸¸è§çš„å¼‚å¸¸å¤„ç†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="n">ModelAndView</span> <span class="nf">doResolveException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">HttpRequestMethodNotSupportedException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleHttpRequestMethodNotSupported</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">HttpRequestMethodNotSupportedException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">HttpMediaTypeNotSupportedException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleHttpMediaTypeNotSupported</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">HttpMediaTypeNotSupportedException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">HttpMediaTypeNotAcceptableException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleHttpMediaTypeNotAcceptable</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">HttpMediaTypeNotAcceptableException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">MissingPathVariableException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleMissingPathVariable</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">MissingPathVariableException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">MissingServletRequestParameterException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleMissingServletRequestParameter</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">MissingServletRequestParameterException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">ServletRequestBindingException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleServletRequestBindingException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">ServletRequestBindingException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">ConversionNotSupportedException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleConversionNotSupported</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">ConversionNotSupportedException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">TypeMismatchException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleTypeMismatch</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">TypeMismatchException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">HttpMessageNotReadableException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleHttpMessageNotReadable</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">HttpMessageNotReadableException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">HttpMessageNotWritableException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleHttpMessageNotWritable</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">HttpMessageNotWritableException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">MethodArgumentNotValidException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleMethodArgumentNotValidException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">MethodArgumentNotValidException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">MissingServletRequestPartException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleMissingServletRequestPartException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">MissingServletRequestPartException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">BindException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleBindException</span><span class="o">((</span><span class="n">BindException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">NoHandlerFoundException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleNoHandlerFoundException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">NoHandlerFoundException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">AsyncRequestTimeoutException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">handleAsyncRequestTimeoutException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">AsyncRequestTimeoutException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">handlerEx</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isWarnEnabled</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;Failure while trying to resolve exception [&#34;</span> <span class="o">+</span> <span class="n">ex</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">,</span> <span class="n">handlerEx</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>SimpleMappingExceptionResolver</code>æ˜¯Spring MVCæä¾›çš„è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨ã€‚</p>
<h2 id="åŸºäºé…ç½®çš„å¼‚å¸¸å¤„ç†" data-numberify>åŸºäºé…ç½®çš„å¼‚å¸¸å¤„ç†<a class="anchor ms-1" href="#åŸºäºé…ç½®çš„å¼‚å¸¸å¤„ç†"></a></h2>
<p>åœ¨<code>springMVC.xml</code>ä¸­é…ç½®å¼‚å¸¸å¤„ç†å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;beans&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- ... --&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- é…ç½®å¼‚å¸¸å¤„ç† --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;exceptionMappings&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;props&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">                    è®¾ç½®è¦å¤„ç†çš„å¼‚å¸¸å’Œè¿”å›çš„è§†å›¾
</span></span></span><span class="line"><span class="cl"><span class="c">                    propçš„keyï¼šè¡¨ç¤ºå¤„ç†å™¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸
</span></span></span><span class="line"><span class="cl"><span class="c">                    propçš„å€¼ï¼šè¡¨ç¤ºè‹¥å‡ºç°æŒ‡å®šå¼‚å¸¸æ—¶ï¼Œè®¾ç½®ä¸€ä¸ªæ–°çš„è§†å›¾åç§°ï¼Œè·³è½¬åˆ°æŒ‡å®šé¡µé¢
</span></span></span><span class="line"><span class="cl"><span class="c">                 --&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&#34;java.lang.ArithmeticException&#34;</span><span class="nt">&gt;</span>error<span class="nt">&lt;/prop&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/props&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/property&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!-- 
</span></span></span><span class="line"><span class="cl"><span class="c">            å°†å¼‚å¸¸ä¿¡æ¯å…±äº«åœ¨è¯·æ±‚åŸŸä¸­çš„é”®
</span></span></span><span class="line"><span class="cl"><span class="c">            exceptionAttributeè®¾ç½®ä¸€ä¸ªå±æ€§åï¼Œå°†å‡ºç°çš„å¼‚å¸¸ä¿¡æ¯åœ¨è¯·æ±‚åŸŸä¸­è¿›è¡Œå…±äº«
</span></span></span><span class="line"><span class="cl"><span class="c">         --&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;exceptionAttribute&#34;</span> <span class="na">value=</span><span class="s">&#34;ex&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/beans&gt;</span>
</span></span></code></pre></div><p>åœ¨ç›¸åº”è·¯å¾„ï¼ˆå¦‚<code>/WEB-INF/templates/</code>ï¼‰ä¸‹åˆ›å»ºå¼‚å¸¸è§†å›¾ï¼ˆå¦‚<code>error.html</code>ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;zh&#34;</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&#34;http://www.thymeleaf.org&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Error<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>å‡ºç°å¼‚å¸¸<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&#34;${ex}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><blockquote>
<p>æ³¨ï¼šä½¿ç”¨Thymeleafç®¡ç†Htmlè§†å›¾ï¼Œéœ€è¦åœ¨<code>&lt;html&gt;</code>æ ‡ç­¾ä¸­å£°æ˜<code>xmlns:th=&quot;http://www.thymeleaf.org&quot;</code>ã€‚</p>
</blockquote>
<h2 id="åŸºäºæ³¨è§£çš„å¼‚å¸¸å¤„ç†" data-numberify>åŸºäºæ³¨è§£çš„å¼‚å¸¸å¤„ç†<a class="anchor ms-1" href="#åŸºäºæ³¨è§£çš„å¼‚å¸¸å¤„ç†"></a></h2>
<p>ä½¿ç”¨<code>@ControllerAdvice</code>æ ‡æ³¨åœ¨å¼‚å¸¸å¤„ç†ç±»ä¸Šï¼Œè¿™æ ·çš„å¼‚å¸¸å¤„ç†ç±»ä¸Controllerç±»ä¼¼ã€‚åœ¨ç±»çš„æ–¹æ³•ä¸Šç”¨<code>@ExceptionHandler</code>æŒ‡å®šè¦å¤„ç†çš„å¼‚å¸¸ï¼Œ<code>@ExceptionHandler</code>çš„<code>value</code>å±æ€§æ¥æ”¶ä¸€ä¸ªClassç±»å‹çš„æ•°ç»„ï¼Œæ„å‘³ç€å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªå¼‚å¸¸ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@ControllerAdvice</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExceptionController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@ExceptionHandler</span><span class="o">({</span>
</span></span><span class="line"><span class="cl">            <span class="n">ArithmeticException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">NullPointerException</span><span class="o">.</span><span class="na">class</span>
</span></span><span class="line"><span class="cl">    <span class="o">})</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">testException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">Exception</span> <span class="n">ex</span> <span class="cm">/* å½“å‰å‡ºç°çš„å¼‚å¸¸ */</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ç”¨Modelè®¾ç½®å±æ€§ï¼Œå°†å¼‚å¸¸ä¿¡æ¯è¿”å›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;exception&#34;</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;error&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨<code>ExceptionController</code>ä¸­ç”¨<code>@ExceptionHandler</code>æ ‡æ³¨çš„æ–¹æ³•ï¼Œåœ¨å®ƒçš„å‚æ•°åˆ—è¡¨ä¸­å®šä¹‰ä¸€ä¸ª<code>Exception</code>ç±»å‹çš„å‚æ•°ï¼Œå¯ç”¨äºè·å–å½“å‰å¤„ç†çš„å®é™…çš„å¼‚å¸¸ã€‚</p>
<hr>
<h1 id="é‡å®šå‘" data-numberify>é‡å®šå‘<a class="anchor ms-1" href="#é‡å®šå‘"></a></h1>
<p>Spring MVCé»˜è®¤çš„æ–¹å¼æ˜¯<code>forward</code>ï¼ˆå³è½¬å‘ï¼‰ï¼Œè€Œè¦ä½¿ç”¨<code>redirect</code>éœ€è¦åœ¨è§†å›¾åç§°ä¸­æ·»åŠ <code>redirect:</code>è¯´æ˜ã€‚Spring MVCé‡å®šå‘æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Controller</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * é€šè¿‡è¿”å›ç±»å‹ä¸ºStringçš„æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª&#34;redirect:...&#34;çš„å­—ç¬¦ä¸²è¿›è¡Œé‡å®šå‘
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return é‡å®šå‘çš„è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/test1&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">test1</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;redirect:/index.html&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * é€šè¿‡ModelAndViewè®¾ç½®è§†å›¾åç§°ä¸º&#34;redirect:...&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/test2&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ModelAndView</span> <span class="nf">test2</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">ModelAndView</span><span class="o">(</span><span class="s">&#34;redirect:/test1&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ç›¸å½“äºï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">        ModelAndView mav = new ModelAndView();
</span></span></span><span class="line"><span class="cl"><span class="cm">        mav.setViewName(&#34;redirect:/index&#34;);
</span></span></span><span class="line"><span class="cl"><span class="cm">        return mav;
</span></span></span><span class="line"><span class="cl"><span class="cm">        */</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * é€šè¿‡åŸç”ŸServletAPI
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/test3&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test3</span><span class="o">(</span><span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&#34;/test1&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><hr>
<h1 id="spring-mvc-æ‰§è¡Œæµç¨‹" data-numberify>Spring MVC æ‰§è¡Œæµç¨‹<a class="anchor ms-1" href="#spring-mvc-æ‰§è¡Œæµç¨‹"></a></h1>
<h2 id="å¸¸ç”¨ç»„ä»¶" data-numberify>å¸¸ç”¨ç»„ä»¶<a class="anchor ms-1" href="#å¸¸ç”¨ç»„ä»¶"></a></h2>
<ul>
<li>
<p><strong>DispatcherServlet</strong>ï¼š<strong>å‰ç«¯æ§åˆ¶å™¨</strong>ï¼Œç”±æ¡†æ¶æä¾›ã€‚</p>
<p>ä½œç”¨ï¼šç»Ÿä¸€å¤„ç†è¯·æ±‚å’Œå“åº”ï¼Œæ•´ä¸ªæµç¨‹æ§åˆ¶çš„ä¸­å¿ƒï¼Œç”±å®ƒè°ƒç”¨å…¶å®ƒç»„ä»¶å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ã€‚</p>
<blockquote>
<p>Controllerã€Interceptorã€HandlerExceptionResolverç­‰ç­‰éƒ½ç”±å®ƒæ¥è°ƒç”¨ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>HandlerMapping</strong>ï¼š<strong>å¤„ç†å™¨æ˜ å°„å™¨</strong>ï¼Œç”±æ¡†æ¶æä¾›ã€‚</p>
<p>ä½œç”¨ï¼šæ ¹æ®è¯·æ±‚çš„<code>url</code>ã€<code>method</code>ç­‰ä¿¡æ¯æŸ¥æ‰¾ç›¸åº”çš„Handlerï¼ˆå³æ§åˆ¶å™¨æ–¹æ³•ï¼‰ã€‚</p>
<blockquote>
<p>å°±æ˜¯è¯·æ±‚ä¸­çš„<code>@RequestMapping</code>ã€<code>@GetMapping</code>ã€<code>@PostMapping</code>ç­‰ç­‰ã€‚å°†è¯·æ±‚å’Œæ§åˆ¶å™¨æˆ–æ§åˆ¶å™¨æ–¹æ³•è¿›è¡Œæ˜ å°„ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>Handler</strong>ï¼š<strong>å¤„ç†å™¨</strong>ï¼ˆæ§åˆ¶å™¨æ–¹æ³•ï¼‰ï¼Œç”±å·¥ç¨‹å¸ˆå¼€å‘ã€‚</p>
<p>ä½œç”¨ï¼šåœ¨DispatcherServletçš„æ§åˆ¶ä¸‹ï¼ŒHandlerå¯¹å…·ä½“çš„ç”¨æˆ·è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚</p>
</li>
<li>
<p><strong>HandlerAdapter</strong>ï¼š<strong>å¤„ç†å™¨é€‚é…å™¨</strong>ï¼Œç”±æ¡†æ¶æä¾›ã€‚</p>
<p>ä½œç”¨ï¼šé€šè¿‡HandlerAdapteræ‰§è¡Œå¤„ç†å™¨ï¼ˆæ§åˆ¶å™¨æ–¹æ³•ï¼‰ã€‚</p>
<blockquote>
<p>ç”±HandlerMappingæ‰¾åˆ°å¯¹åº”çš„Handlerï¼Œæ¥ç€ç”±HandlerAdapteræ‰§è¡Œå¯¹åº”çš„Handlerã€‚</p>
</blockquote>
</li>
<li>
<p><strong>ViewResolver</strong>ï¼š<strong>è§†å›¾è§£æå™¨</strong>ï¼Œç”±æ¡†æ¶æä¾›ã€‚</p>
<p>ä½œç”¨ï¼šè¿›è¡Œè§†å›¾è§£æï¼Œå¾—åˆ°ç›¸åº”çš„è§†å›¾ï¼Œä¾‹å¦‚ï¼šThymeleafViewã€InternalResourceViewï¼ˆä¾‹å¦‚forwardï¼Œå³è½¬å‘æ—¶ï¼‰ã€RedirectViewï¼ˆä¾‹å¦‚redirectï¼Œå³é‡å®šå‘æ—¶ï¼‰ã€‚</p>
</li>
<li>
<p><strong>Viw</strong>ï¼š<strong>è§†å›¾</strong>ï¼Œç”±æ¡†æ¶æˆ–è§†å›¾æŠ€æœ¯æä¾›ã€‚</p>
<p>ä½œç”¨ï¼šå°†æ¨¡å‹æ•°æ®é€šè¿‡é¡µé¢å±•ç¤ºç»™ç”¨æˆ·ã€‚</p>
</li>
</ul>
<h2 id="dispatcherservlet-ç»§æ‰¿é“¾" data-numberify>DispatcherServlet ç»§æ‰¿é“¾<a class="anchor ms-1" href="#dispatcherservlet-ç»§æ‰¿é“¾"></a></h2>
<p><code>DispatcherServlet</code> $\xrightarrow{extends}$ <code>FrameworkServlet</code> $\xrightarrow{extends}$ <code>HttpServletBean</code> $\xrightarrow{extends}$ <code>HttpServlet</code> $\xrightarrow{extends}$ <code>GenericServlet</code> $\xrightarrow{implements}$ <code>Servlet</code></p>
<h2 id="dispatcherservlet-åˆå§‹åŒ–è¿‡ç¨‹" data-numberify>DispatcherServlet åˆå§‹åŒ–è¿‡ç¨‹<a class="anchor ms-1" href="#dispatcherservlet-åˆå§‹åŒ–è¿‡ç¨‹"></a></h2>
<p>DispatcherServletåˆå§‹åŒ–è¿‡ç¨‹éœ€è¦æ ¹æ®å®ƒçš„ç»§æ‰¿é“¾ï¼ŒæŸ¥æ‰¾æ¯ä¸ªç±»æˆ–æ¥å£çš„<code>init()</code>æ–¹æ³•ã€‚</p>
<ul>
<li>
<p><code>Servlet.init(ServletConfig)</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">ServletConfig</span> <span class="n">config</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">;</span>
</span></span></code></pre></div></li>
<li>
<p><code>GenericServlet</code>ï¼š</p>
<p><code>GenericServlet</code>ä¸ä»…å®ç°äº†<code>Servlet.init(ServletConfig)</code>è¿˜ç»™å‡ºäº†ä¸€ä¸ªæœªå®ç°çš„<code>init()</code>ã€‚</p>
<p><code>init(ServletConfig config)</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">ServletConfig</span> <span class="n">config</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">.</span><span class="na">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">.</span><span class="na">init</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>init()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{}</span>
</span></span></code></pre></div></li>
<li>
<p><code>HttpServlet</code>ï¼š</p>
<p><code>HttpServlet</code>å¹¶æ²¡æœ‰é‡å†™<code>GenericServlet.init(ServletConfig)</code>æˆ–<code>GenericServlet.init()</code>ã€‚</p>
</li>
<li>
<p><code>HttpServletBean</code>ï¼š</p>
<p><code>HttpServletBean</code>å®ç°äº†<code>GenericServlet.init()</code>å¹¶ä¸”ç»™å‡ºäº†ä¸€ä¸ªæœªå®ç°çš„<code>initServletBean()</code>ã€‚</p>
<p><code>init()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Set bean properties from init parameters.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Let subclasses do whatever initialization they like.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">initServletBean</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>initServletBean()</code>ï¼šåˆå§‹åŒ–ServletBeanã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initServletBean</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{}</span>
</span></span></code></pre></div></li>
<li>
<p><code>FrameworkServlet</code>ï¼š</p>
<p><code>FrameworkServlet</code>å®ç°äº†<code>HttpServletBean.initServletBean()</code>ï¼Œå¹¶ä¸”ç»™å‡ºäº†<code>initServletBean()</code>çš„å®ç°ã€‚</p>
<p><code>initServletBean()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">initServletBean</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// åˆå§‹åŒ–WebApplicationContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">this</span><span class="o">.</span><span class="na">webApplicationContext</span> <span class="o">=</span> <span class="n">initWebApplicationContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">initFrameworkServlet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* catch ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>initWebApplicationContext()</code>ï¼šåˆå§‹åŒ–WebApplicationContextã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="n">WebApplicationContext</span> <span class="nf">initWebApplicationContext</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–å½“å‰çš„WebApplicationContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WebApplicationContext</span> <span class="n">rootContext</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">            <span class="n">WebApplicationContextUtils</span><span class="o">.</span><span class="na">getWebApplicationContext</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">WebApplicationContext</span> <span class="n">wac</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ¤æ–­å½“å‰WebApplicationContextæ˜¯å¦ä¸ºç©ºï¼ˆç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶æ’ä¸ºç©ºï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">webApplicationContext</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// A context instance was injected at construction time -&gt; use it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">wac</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">webApplicationContext</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">wac</span> <span class="k">instanceof</span> <span class="n">ConfigurableWebApplicationContext</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">ConfigurableWebApplicationContext</span> <span class="n">cwac</span> <span class="o">=</span> <span class="o">(</span><span class="n">ConfigurableWebApplicationContext</span><span class="o">)</span> <span class="n">wac</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(!</span><span class="n">cwac</span><span class="o">.</span><span class="na">isActive</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// The context has not yet been refreshed -&gt; provide services such as
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// setting the parent context, setting the application context id, etc
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="o">(</span><span class="n">cwac</span><span class="o">.</span><span class="na">getParent</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// The context instance was injected without an explicit parent -&gt; set
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="c1">// the root application context (if any; may be null) as the parent
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">cwac</span><span class="o">.</span><span class="na">setParent</span><span class="o">(</span><span class="n">rootContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// è£…é…å¹¶åˆ·æ–°WebApplicationContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">configureAndRefreshWebApplicationContext</span><span class="o">(</span><span class="n">cwac</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">        å¦‚æœwacä¸ºç©ºåˆ™æŸ¥æ‰¾WebApplicationContext
</span></span></span><span class="line"><span class="cl"><span class="cm">        ï¼ˆç¬¬ä¸€æ¬¡æ‰§è¡Œå®Œåwacè¿˜æ˜¯ä¸ºç©ºï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•WebApplicationContextï¼‰
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">wac</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// No context instance was injected at construction time -&gt; see if one
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// has been registered in the servlet context. If one exists, it is assumed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// that the parent context (if any) has already been set and that the
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// user has performed any initialization such as setting the context id
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">wac</span> <span class="o">=</span> <span class="n">findWebApplicationContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¦‚æœwacä¸ºç©ºåˆ™åˆ›å»ºä¸€ä¸ªWebApplicationContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">wac</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// No context instance is defined for this servlet -&gt; create a local one
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// åˆ›å»ºä¸€ä¸ªWebApplicationContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">wac</span> <span class="o">=</span> <span class="n">createWebApplicationContext</span><span class="o">(</span><span class="n">rootContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// æ²¡æœ‰æ¥æ”¶åˆ°åˆ·æ–°äº‹ä»¶æ—¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">refreshEventReceived</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Either the context is not a ConfigurableApplicationContext with refresh
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// support or the context injected at construction time had already been
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// refreshed -&gt; trigger initial onRefresh manually here.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">onRefreshMonitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// åˆ·æ–°WebApplicationContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">onRefresh</span><span class="o">(</span><span class="n">wac</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">publishContext</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Publish the context as a servlet context attribute.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// å°†ServletContextä½œä¸ºå±æ€§ï¼Œè·å–å®ƒçš„å±æ€§å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">String</span> <span class="n">attrName</span> <span class="o">=</span> <span class="n">getServletContextAttributeName</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å°†IOCå®¹å™¨åœ¨åº”ç”¨åŸŸå…±äº«
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">getServletContext</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">attrName</span><span class="o">,</span> <span class="n">wac</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">wac</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>createWebApplicationContext(WebApplicationContext)</code>ï¼šé€šè¿‡WebApplicationContextåˆ›å»ºWebApplicationContextã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="n">WebApplicationContext</span> <span class="nf">createWebApplicationContext</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">WebApplicationContext</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">createWebApplicationContext</span><span class="o">((</span><span class="n">ApplicationContext</span><span class="o">)</span> <span class="n">parent</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>createWebApplicationContext(ApplicationContext)</code>ï¼šé€šè¿‡ApplicationContextåˆ›å»ºWebApplicationContextã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="n">WebApplicationContext</span> <span class="nf">createWebApplicationContext</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">ApplicationContext</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">contextClass</span> <span class="o">=</span> <span class="n">getContextClass</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(!</span><span class="n">ConfigurableWebApplicationContext</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">contextClass</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">ApplicationContextException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#34;Fatal initialization error in servlet with name &#39;&#34;</span> <span class="o">+</span> <span class="n">getServletName</span><span class="o">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#34;&#39;: custom WebApplicationContext class [&#34;</span> <span class="o">+</span> <span class="n">contextClass</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#34;] is not of type ConfigurableWebApplicationContext&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Web IOC å®¹å™¨å¯¹è±¡ï¼ˆå³SpringMVC IOCï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ConfigurableWebApplicationContext</span> <span class="n">wac</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">            <span class="o">(</span><span class="n">ConfigurableWebApplicationContext</span><span class="o">)</span> <span class="n">BeanUtils</span><span class="o">.</span><span class="na">instantiateClass</span><span class="o">(</span><span class="n">contextClass</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// é…ç½®ç¯å¢ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">wac</span><span class="o">.</span><span class="na">setEnvironment</span><span class="o">(</span><span class="n">getEnvironment</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* 
</span></span></span><span class="line"><span class="cl"><span class="cm">        æ•´åˆSpringå’ŒSpringMVCæ—¶ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="cm">        è®¾ç½®SpringMVCçš„çˆ¶å®¹å™¨ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="cm">        è®©Springå’ŒSpringMVCçš„IOCå®¹å™¨èƒ½æ— ç¼è¡”æ¥
</span></span></span><span class="line"><span class="cl"><span class="cm">        SpringMVC IOCå®¹å™¨æ˜¯Spring IOCå®¹å™¨çš„å­å®¹å™¨
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="n">wac</span><span class="o">.</span><span class="na">setParent</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">configLocation</span> <span class="o">=</span> <span class="n">getContextConfigLocation</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">configLocation</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">wac</span><span class="o">.</span><span class="na">setConfigLocation</span><span class="o">(</span><span class="n">configLocation</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è£…é…å¹¶åˆ·æ–°WebApplicationContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">configureAndRefreshWebApplicationContext</span><span class="o">(</span><span class="n">wac</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">wac</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>onRefresh()</code>ï¼šåˆ·æ–°WebApplicationContextã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onRefresh</span><span class="o">(</span><span class="n">ApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// For subclasses: do nothing by default.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ç”±å­ç±»å»å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><blockquote>
<p>FrameworkServleteåˆ›å»ºWebApplicationContextåï¼Œåˆ·æ–°å®¹å™¨ï¼Œè°ƒç”¨<code>onRefresh(wac)</code>ï¼Œæ­¤æ–¹æ³•åœ¨<code>DispatcherServlet</code>è¿›è¡Œäº†é‡å†™ï¼ˆå®ç°ï¼‰ã€‚</p>
</blockquote>
<p><code>getServletContextAttributeName()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// FrameworkServletçš„å…¨ç±»å.CONTEXT.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">SERVLET_CONTEXT_PREFIX</span> <span class="o">=</span> <span class="n">FrameworkServlet</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;.CONTEXT.&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">getServletContextAttributeName</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å‰ç¼€+Servletå‹å¥½åç§°ï¼ˆå³å‰ç¼€ + &lt;servlet-name&gt;ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">SERVLET_CONTEXT_PREFIX</span> <span class="o">+</span> <span class="n">getServletName</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></li>
<li>
<p><code>DispatcherServlet</code>ï¼š</p>
<p>å®ç°äº†<code>FrameworkServlet.onRefresh()</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onRefresh</span><span class="o">(</span><span class="n">ApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">initStrategies</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>initStrategies()</code>ï¼š<code>DispatcherServlet</code>åˆå§‹åŒ–ç­–ç•¥ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initStrategies</span><span class="o">(</span><span class="n">ApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆå§‹åŒ–å¤šä¸ªè§£æå™¨ï¼Œä¾‹å¦‚æ–‡ä»¶ä¸Šä¼ è§£æå™¨ç­‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">initMultipartResolver</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">initLocaleResolver</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆå§‹åŒ–æ¨¡æ¿è§£æå™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">initThemeResolver</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆå§‹åŒ–å¤„ç†å™¨æ˜ å°„å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">initHandlerMappings</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆå§‹é˜¿è™å¤„ç†å™¨é€‚é…å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">initHandlerAdapters</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆå§‹åŒ–å¼‚å¸¸å¤„ç†å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">initHandlerExceptionResolvers</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆå§‹åŒ–è½¬æ¢å™¨ï¼Œå°†è¯·æ±‚è½¬æ¢ä¸ºè§†å›¾åç§°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">initRequestToViewNameTranslator</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆå§‹åŒ–è§†å›¾è§£æå™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">initViewResolvers</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">initFlashMapManager</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="dispatcherservlet-è¯·æ±‚å¤„ç†è¿‡ç¨‹" data-numberify>DispatcherServlet è¯·æ±‚å¤„ç†è¿‡ç¨‹<a class="anchor ms-1" href="#dispatcherservlet-è¯·æ±‚å¤„ç†è¿‡ç¨‹"></a></h2>
<ul>
<li>
<p><code>Servlet</code>å’Œ<code>GenericServlet</code>ï¼š</p>
<p><code>Servlet</code>æä¾›äº†<code>service()</code>æ¥å£ï¼Œ<code>GenericServlet</code>å¹¶æœªå¯¹å…¶è¿›è¡Œå®ç°ã€‚</p>
<p><code>service(ServletRequest, ServletResponse)</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">res</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">;</span>
</span></span></code></pre></div></li>
<li>
<p><code>HttpServlet</code>ï¼š</p>
<p><code>service()</code>ç”±<code>HttpServlet</code>å®ç°ã€‚å¹¶ä¸”<code>HttpServlet</code>è¿˜æä¾›äº†<code>service(HttpServletRequest, HttpServletResponse)</code>ã€‚</p>
<p><code>service(ServletRequest, ServletResponse)</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">res</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">HttpServletRequest</span>  <span class="n">request</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(!(</span><span class="n">req</span> <span class="k">instanceof</span> <span class="n">HttpServletRequest</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">            <span class="n">res</span> <span class="k">instanceof</span> <span class="n">HttpServletResponse</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">ServletException</span><span class="o">(</span><span class="s">&#34;non-HTTP request or response&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è½¬æ¢ä¸ºHttpServletRequestå’ŒHttpServletResponse
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">request</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpServletRequest</span><span class="o">)</span> <span class="n">req</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpServletResponse</span><span class="o">)</span> <span class="n">res</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">service</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><blockquote>
<p><code>HttpServlet.service(ServletRequest, ServletResponse)</code>çš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†<code>ServletRequest</code>å’Œ<code>ServletResponse</code>åˆ†åˆ«è½¬æ¢ä¸º<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>ï¼Œç„¶åè°ƒç”¨<code>HttpServlet.service(HttpServletRequest, HttpServletResponse)</code>ã€‚</p>
</blockquote>
<p><code>service(HttpServletRequest, HttpServletResponse)</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–è¯·æ±‚æ–¹å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">String</span> <span class="n">method</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getMethod</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è¯·æ±‚çš„åˆ†å‘å¤„ç†ï¼Œæ ¹æ®è¯·æ±‚æ–¹å¼è°ƒç”¨ç›¸åº”æ–¹æ³•ï¼ˆå¦‚è°ƒç”¨doGetï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">METHOD_GET</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">lastModified</span> <span class="o">=</span> <span class="n">getLastModified</span><span class="o">(</span><span class="n">req</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">lastModified</span> <span class="o">==</span> <span class="o">-</span><span class="n">1</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// servlet doesn&#39;t support if-modified-since, no reason
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// to go through further expensive logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">doGet</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">long</span> <span class="n">ifModifiedSince</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getDateHeader</span><span class="o">(</span><span class="n">HEADER_IFMODSINCE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">ifModifiedSince</span> <span class="o">&lt;</span> <span class="n">lastModified</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// If the servlet mod time is later, call doGet()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// Round down to the nearest second for a proper compare
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// A ifModifiedSince of -1 will always be less
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">maybeSetLastModified</span><span class="o">(</span><span class="n">resp</span><span class="o">,</span> <span class="n">lastModified</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">doGet</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">resp</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">HttpServletResponse</span><span class="o">.</span><span class="na">SC_NOT_MODIFIED</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">METHOD_HEAD</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">lastModified</span> <span class="o">=</span> <span class="n">getLastModified</span><span class="o">(</span><span class="n">req</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">maybeSetLastModified</span><span class="o">(</span><span class="n">resp</span><span class="o">,</span> <span class="n">lastModified</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">doHead</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">METHOD_POST</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">doPost</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">METHOD_PUT</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">doPut</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">METHOD_DELETE</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">doDelete</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">METHOD_OPTIONS</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">doOptions</span><span class="o">(</span><span class="n">req</span><span class="o">,</span><span class="n">resp</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">METHOD_TRACE</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">doTrace</span><span class="o">(</span><span class="n">req</span><span class="o">,</span><span class="n">resp</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Note that this means NO servlet supports whatever
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// method was requested, anywhere on this server.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></li>
<li>
<p><code>HttpServletBean</code>ï¼š</p>
<p>æ²¡æœ‰å¯¹<code>HttpServlet.service()</code>å’Œ<code>HttpServlet</code>ä¸­<code>do</code>å¼€å¤´çš„å¤„ç†è¯·æ±‚åˆ†å‘çš„æ–¹æ³•è¿›è¡Œé‡å†™ã€‚</p>
</li>
<li>
<p><code>FrameworkServlet</code>ï¼š</p>
<p>é‡å†™äº†<code>HttpServlet.service(HttpServletRequest, HttpServletResponse)</code>å’Œ<code>HttpServlet</code>ä¸­<code>do</code>å¼€å¤´çš„å¤„ç†è¯·æ±‚åˆ†å‘çš„æ–¹æ³•ã€‚</p>
<p><code>service(HttpServletRequest, HttpServletResponse)</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">HttpMethod</span> <span class="n">httpMethod</span> <span class="o">=</span> <span class="n">HttpMethod</span><span class="o">.</span><span class="na">resolve</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¯·æ±‚æ–¹å¼ä¸ºPATCHæˆ–nullæ—¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">httpMethod</span> <span class="o">==</span> <span class="n">HttpMethod</span><span class="o">.</span><span class="na">PATCH</span> <span class="o">||</span> <span class="n">httpMethod</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ‰§è¡Œè¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">processRequest</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">.</span><span class="na">service</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>processRequest()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">processRequest</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ‰§è¡ŒæœåŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">doService</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* catch ... */</span>
</span></span><span class="line"><span class="cl">    <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨<code>FrameworkServlet</code>ä¸­çš„<code>doGet()</code>ã€<code>doPost()</code>ã€<code>doPut()</code>å’Œ<code>doDelete()</code>ä¸­éƒ½æ˜¯ç›´æ¥è°ƒç”¨<code>processRequest()</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">processRequest</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span></code></pre></div><p>åœ¨<code>doOptions()</code>å’Œ<code>doTrace()</code>ä¸­ä¹Ÿæœ‰å¯¹<code>processRequest()</code>æ–¹æ³•çš„è°ƒç”¨ã€‚</p>
<p><code>doService()</code>ï¼šäº¤ç”±å­ç±»å®ç°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">doService</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">throws</span> <span class="n">Exception</span><span class="o">;</span>
</span></span></code></pre></div></li>
<li>
<p><code>DispatcherServlet</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doService</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">logRequest</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Keep a snapshot of the request attributes in case of an include,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// to be able to restore the original attributes after the include.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Make framework objects available to handlers and view objects.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æœ€ç»ˆè°ƒç”¨doDispatch()æ¥å¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">doDispatch</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!</span><span class="n">WebAsyncUtils</span><span class="o">.</span><span class="na">getAsyncManager</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">isConcurrentHandlingStarted</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Restore the original attribute snapshot, in case of an include.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">attributesSnapshot</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">restoreAttributesAfterInclude</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">attributesSnapshot</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>doDispatch()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doDispatch</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">HttpServletRequest</span> <span class="n">processedRequest</span> <span class="o">=</span> <span class="n">request</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">        æ‰§è¡Œé“¾
</span></span></span><span class="line"><span class="cl"><span class="cm">        HandlerExecutionChainåŒ…å«ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š
</span></span></span><span class="line"><span class="cl"><span class="cm">        - handlerï¼šä¸è¯·æ±‚æ‰€åŒ¹é…çš„æ§åˆ¶å™¨æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="cm">        - interceptorListï¼šå¤„ç†æ§åˆ¶å™¨æ–¹æ³•çš„æ‰€æœ‰æ‹¦æˆªå™¨é›†åˆï¼Œå³æ‹¦æˆªå™¨é“¾
</span></span></span><span class="line"><span class="cl"><span class="cm">        - interceptorIndexï¼šæ‹¦æˆªå™¨ç´¢å¼•ï¼Œæ§åˆ¶æ‹¦æˆªå™¨afterCompletion()çš„æ‰§è¡Œ
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="n">HandlerExecutionChain</span> <span class="n">mappedHandler</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">boolean</span> <span class="n">multipartRequestParsed</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">WebAsyncManager</span> <span class="n">asyncManager</span> <span class="o">=</span> <span class="n">WebAsyncUtils</span><span class="o">.</span><span class="na">getAsyncManager</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ModelAndView</span> <span class="n">mv</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Exception</span> <span class="n">dispatchException</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">processedRequest</span> <span class="o">=</span> <span class="n">checkMultipart</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">multipartRequestParsed</span> <span class="o">=</span> <span class="o">(</span><span class="n">processedRequest</span> <span class="o">!=</span> <span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Determine handler for the current request.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// è·å–å½“å‰è¯·æ±‚çš„æ‰§è¡Œé“¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mappedHandler</span> <span class="o">=</span> <span class="n">getHandler</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">noHandlerFound</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Determine handler adapter for the current request.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">                è·å–å½“å‰è¯·æ±‚çš„å¤„ç†å™¨é€‚é…å™¨
</span></span></span><span class="line"><span class="cl"><span class="cm">                é€šè¿‡æ§åˆ¶å™¨æ–¹æ³•åˆ›å»ºå¯¹åº”çš„å¤„ç†å™¨é€‚é…å™¨ï¼Œä»è€Œèƒ½è°ƒç”¨æ‰€å¯¹åº”çš„æ§åˆ¶å™¨æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="cm">             */</span>
</span></span><span class="line"><span class="cl">            <span class="n">HandlerAdapter</span> <span class="n">ha</span> <span class="o">=</span> <span class="n">getHandlerAdapter</span><span class="o">(</span><span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Process last-modified header, if supported by the handler.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// æ‰§è¡Œæ‹¦æˆªå™¨é“¾çš„ preHandleï¼Œæ­£åºæ‰§è¡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(!</span><span class="n">mappedHandler</span><span class="o">.</span><span class="na">applyPreHandle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Actually invoke the handler.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// é€šè¿‡HandlerAdapteræ¥è°ƒç”¨è¯·æ±‚å¤„ç†ï¼Œæœ€ç»ˆè·å¾—ModelAndViewå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mv</span> <span class="o">=</span> <span class="n">ha</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">asyncManager</span><span class="o">.</span><span class="na">isConcurrentHandlingStarted</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">applyDefaultViewName</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">mv</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// æ‰§è¡Œæ‹¦æˆªå™¨é“¾çš„ postHandleï¼Œå€’åºæ‰§è¡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mappedHandler</span><span class="o">.</span><span class="na">applyPostHandle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mv</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* catch ... */</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ‰§è¡Œå®Œè¯·æ±‚çš„åç»­å¤„ç†ï¼Œå¦‚è§†å›¾æ¸²æŸ“ã€å¼‚å¸¸å¤„ç†ç­‰ç­‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">processDispatchResult</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="n">mv</span><span class="o">,</span> <span class="n">dispatchException</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* catch ... */</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* finally ... */</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>processDispatchResult()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">processDispatchResult</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Nullable</span> <span class="n">HandlerExecutionChain</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">ModelAndView</span> <span class="n">mv</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Nullable</span> <span class="n">Exception</span> <span class="n">exception</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">boolean</span> <span class="n">errorView</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å¼‚å¸¸å¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">exception</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">exception</span> <span class="k">instanceof</span> <span class="n">ModelAndViewDefiningException</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;ModelAndViewDefiningException encountered&#34;</span><span class="o">,</span> <span class="n">exception</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// è·å–å¼‚å¸¸é¡µé¢çš„è§†å›¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">mv</span> <span class="o">=</span> <span class="o">((</span><span class="n">ModelAndViewDefiningException</span><span class="o">)</span> <span class="n">exception</span><span class="o">).</span><span class="na">getModelAndView</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Did the handler return a view to render?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">mv</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">mv</span><span class="o">.</span><span class="na">wasCleared</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è§†å›¾æ¸²æŸ“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">render</span><span class="o">(</span><span class="n">mv</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* else ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Exception (if any) is already handled..
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// æ‰§è¡Œæ‹¦æˆªå™¨é“¾çš„ afterCompletionï¼Œå€’åºæ‰§è¡Œï¼ˆæ­¤å¤„æ‰€æœ‰çš„å¼‚å¸¸å·²ç»è¢«å¤„ç†å®Œæˆï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">mappedHandler</span><span class="o">.</span><span class="na">triggerAfterCompletion</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="mvc-æ‰§è¡Œæµç¨‹" data-numberify>MVC æ‰§è¡Œæµç¨‹<a class="anchor ms-1" href="#mvc-æ‰§è¡Œæµç¨‹"></a></h2>
<ol>
<li>
<p>ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè¯·æ±‚è¢«SpringMVCå‰ç«¯æ§åˆ¶å™¨<code>DispatcherServlet</code>æ•è·ã€‚</p>
</li>
<li>
<p><code>DispatcherServlet</code>å¯¹è¯·æ±‚URLè¿›è¡Œè§£æï¼Œå¾—åˆ°è¯·æ±‚èµ„æºæ ‡è¯†ç¬¦ï¼ˆURIï¼‰ï¼Œåˆ¤æ–­è¯·æ±‚URIå¯¹åº”çš„æ˜ å°„ï¼š</p>
<ul>
<li>
<p>å¦‚æœæ²¡æœ‰å¯¹åº”çš„æ˜ å°„ï¼š</p>
<p>åˆ¤æ–­æ˜¯å¦é…ç½®äº†<code>mvc:default-servlet-handler</code>ï¼ˆé»˜è®¤å¤„ç†å™¨ï¼‰ã€‚</p>
<ul>
<li>
<p>å¦‚æœæ²¡é…ç½®ï¼Œåˆ™æ§åˆ¶å°æŠ¥æ˜ å°„æŸ¥æ‰¾ä¸åˆ°ï¼Œå‘å®¢æˆ·ç«¯å±•ç¤º404é”™è¯¯ã€‚</p>
</li>
<li>
<p>å¦‚æœæœ‰é…ç½®ï¼Œåˆ™è®¿é—®ç›®æ ‡èµ„æºï¼ˆä¸€èˆ¬ä¸ºé™æ€èµ„æºï¼Œå¦‚JSã€CSSã€HTMLç­‰ç­‰ï¼‰ã€‚</p>
<p>å¦‚æœæ‰¾ä¸åˆ°å®¢æˆ·ç«¯ä¹Ÿä¼šå±•ç¤º404é”™è¯¯ã€‚</p>
</li>
</ul>
</li>
<li>
<p>å¦‚æœå­˜åœ¨å¯¹åº”çš„æ˜ å°„åˆ™æ¥ç€æ‰§è¡Œä¸‹é¢çš„æµç¨‹ã€‚</p>
</li>
</ul>
</li>
<li>
<p>æ ¹æ®è¯¥URIï¼Œè°ƒç”¨<code>HandlerMapping</code>è·å¾—è¯¥<code>Handler</code>é…ç½®çš„æ‰€æœ‰ç›¸å…³çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬<code>Handler</code>å¯¹è±¡ä»¥åŠ<code>Handler</code>å¯¹è±¡å¯¹åº”çš„æ‹¦æˆªå™¨ï¼‰ï¼Œæœ€åä»¥<code>HandlerExecutionChain</code>æ‰§è¡Œé“¾å¯¹è±¡çš„å½¢å¼è¿”å›ã€‚</p>
</li>
<li>
<p><code>DispatcherServlet</code>æ ¹æ®è·å¾—çš„<code>Handler</code>ï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„<code>HandlerAdapter</code>ã€‚</p>
</li>
<li>
<p>å¦‚æœæˆåŠŸè·å¾—<code>HandlerAdapter</code>ï¼Œæ­¤æ—¶å°†å¼€å§‹æ‰§è¡Œæ‹¦æˆªå™¨çš„<code>preHandler()</code>æ–¹æ³•ã€‚</p>
<p>æ ¹æ®æ‹¦æˆªå™¨é“¾çš„é¡ºåºï¼Œæ­£åºæ‰§è¡Œã€‚</p>
</li>
<li>
<p>æå–<code>Request</code>ä¸­çš„æ¨¡å‹æ•°æ®ï¼Œå¡«å……<code>Handler</code>å…¥å‚ï¼Œå¼€å§‹æ‰§è¡Œ<code>Handler</code>ï¼ˆ<code>Controller</code>)æ–¹æ³•ï¼Œå¤„ç†è¯·æ±‚ã€‚</p>
<p>åœ¨å¡«å……Handlerçš„å…¥å‚è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®ä½ çš„é…ç½®ï¼ŒSpringå°†å¸®ä½ åšä¸€äº›é¢å¤–çš„å·¥ä½œï¼š</p>
<ul>
<li>
<p><code>HttpMessageConveter</code>ï¼š å°†è¯·æ±‚æ¶ˆæ¯ï¼ˆå¦‚JSONã€XMLç­‰æ•°æ®ï¼‰è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡ï¼Œæˆ–å°†å¯¹è±¡è½¬æ¢ä¸ºæŒ‡å®šçš„å“åº”ä¿¡æ¯ã€‚</p>
</li>
<li>
<p>æ•°æ®è½¬æ¢ï¼šå¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œæ•°æ®è½¬æ¢ã€‚</p>
<p>å¦‚<code>String</code>è½¬æ¢æˆ<code>Integer</code>ã€<code>Double</code>ç­‰ã€‚</p>
</li>
<li>
<p>æ•°æ®æ ¼å¼åŒ–ï¼šå¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œæ•°æ®æ ¼å¼åŒ–ã€‚</p>
<p>å¦‚å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ ¼å¼åŒ–æ•°å­—æˆ–æ ¼å¼åŒ–æ—¥æœŸç­‰ã€‚</p>
</li>
<li>
<p>æ•°æ®éªŒè¯ï¼šéªŒè¯æ•°æ®çš„æœ‰æ•ˆæ€§ï¼ˆé•¿åº¦ã€æ ¼å¼ç­‰ï¼‰ï¼ŒéªŒè¯ç»“æœå­˜å‚¨åˆ°<code>BindingResult</code>æˆ–<code>Error</code>ä¸­ã€‚</p>
</li>
<li>
<p><code>Handler</code>æ‰§è¡Œå®Œæˆåï¼Œå‘<code>DispatcherServlet</code>è¿”å›ä¸€ä¸ª<code>ModelAndView</code>å¯¹è±¡ã€‚</p>
</li>
</ul>
</li>
<li>
<p>å¦‚æœ<code>Handler</code>è¢«æˆåŠŸæ‰§è¡Œï¼Œåˆ™å¼€å§‹æ‰§è¡Œæ‹¦æˆªå™¨çš„<code>postHandle()</code>æ–¹æ³•ã€‚</p>
<p>æ ¹æ®æ‹¦æˆªå™¨é“¾çš„é¡ºåºï¼Œå€’åºæ‰§è¡Œã€‚</p>
</li>
<li>
<p>æ ¹æ®è¿”å›çš„<code>ModelAndView</code>ï¼ˆæ­¤æ—¶ä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨å¼‚å¸¸ï¼šå¦‚æœå­˜åœ¨å¼‚å¸¸ï¼Œåˆ™æ‰§è¡Œ<code>HandlerExceptionResolver</code>è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼‰é€‰æ‹©ä¸€ä¸ªé€‚åˆçš„<code>ViewResolver</code>è¿›è¡Œè§†å›¾è§£æï¼Œæ ¹æ®<code>Model</code>å’Œ<code>View</code>ï¼Œæ¥æ¸²æŸ“è§†å›¾ã€‚</p>
</li>
<li>
<p>æ¸²æŸ“è§†å›¾å®Œæ¯•æ‰§è¡Œæ‹¦æˆªå™¨çš„<code>afterCompletion()</code>æ–¹æ³•ã€‚</p>
<p>æ ¹æ®æ‹¦æˆªå™¨é“¾çš„é¡ºåºï¼Œå€’åºæ‰§è¡Œã€‚</p>
</li>
<li>
<p>å°†æ¸²æŸ“ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
</li>
</ol>
]]></content:encoded>
    </item>
    
  </channel>
</rss>

