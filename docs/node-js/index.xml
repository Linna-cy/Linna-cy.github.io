<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Node.js on Linner&#39;s Blog</title>
    <link>/docs/node-js/</link>
    <description>Recent content in Node.js on Linner&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <copyright>Copyright © 2020-2023 Linner. All Rights Reserved.
</copyright>
    <lastBuildDate>Fri, 18 Aug 2023 09:21:24 +0000</lastBuildDate><atom:link href="/docs/node-js/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>TypeScript 介绍</title>
      <link>/docs/node-js/typescript/</link>
      <pubDate>Fri, 18 Aug 2023 09:21:24 +0000</pubDate>
      
      <guid>/docs/node-js/typescript/</guid>
      <description><![CDATA[TypeScript 是 JavaScript 的超集，扩展了 JavaScript 的语法，因此现有的 JavaScript 代码可与 TypeScript 一起工作无需任何修改TypeScript 是一种给 JavaScript 添加特性的语言扩展。增加的功能包括： 类]]></description>
      <content:encoded><![CDATA[<p>TypeScript 是 JavaScript 的超集，扩展了 JavaScript 的语法，因此现有的 JavaScript 代码可与 TypeScript 一起工作无需任何修改TypeScript 是一种给 JavaScript 添加特性的语言扩展。增加的功能包括：</p>
<ul>
<li>类型批注和编译时类型检查。</li>
<li>类型推断。</li>
<li>类型擦除。</li>
<li>接口。</li>
<li>枚举。</li>
<li>Mixin。</li>
<li>泛型编程。</li>
<li>名字空间。</li>
<li>元组。</li>
<li>Await。</li>
</ul>
<hr>
<h1 id="安装-typescript" data-numberify>安装 TypeScript<a class="anchor ms-1" href="#安装-typescript"></a></h1>
<p>安装TypeScript：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install -g typescript
</span></span></code></pre></div><p>安装完成后可以使用 <code>tsc</code> 命令来执行 TypeScript 的相关代码。查看 TypeScript 版本号：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">tsc -v
</span></span></code></pre></div><hr>
<h1 id="hello" data-numberify>Hello<a class="anchor ms-1" href="#hello"></a></h1>
<p>新建一个<code>hello.ts</code>（通常使用 <code>.ts</code> 作为 TypeScript 代码文件的扩展名）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello TypeScript!&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p>执行以下命令将 TypeScript 转换为 JavaScript 代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">tsc hello.ts
</span></span></code></pre></div><p>执行完成后会在当前目录下生成一个<code>hello.js</code>（与执行<code>tsc</code>时指定的<code>.ts</code>同名的<code>.js</code>文件）。然后使用<code>node</code>来执行<code>hello.js</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">node hello.js
</span></span></code></pre></div><hr>
<h1 id="变量声明" data-numberify>变量声明<a class="anchor ms-1" href="#变量声明"></a></h1>
<p>在TypeScript中声明变量，可以像JS那样去声明变量，当然也可以为变量指定类型：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">var</span> <span class="p">[</span><span class="nx">variableName</span><span class="p">]</span> <span class="o">:</span> <span class="p">[</span><span class="nx">variableType</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
</span></span></code></pre></div><p>类型断言（Type Assertion）可以用来手动指定一个值的类型，即允许变量从一种类型更改为另一种类型：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">type</span><span class="p">&gt;</span><span class="nx">value</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 或者使用 as
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="kr">as</span> <span class="kr">type</span>
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
    <item>
      <title>Node.js Nodemon 模块</title>
      <link>/docs/node-js/nodemon/</link>
      <pubDate>Sat, 12 Aug 2023 13:01:59 +0000</pubDate>
      
      <guid>/docs/node-js/nodemon/</guid>
      <description><![CDATA[Nodemon是一种监听项目文件变动，让项目文件在修改时可以自动重启项目的工具。使用Nodemon时，当代码被修改，Nodemon会自动帮我]]></description>
      <content:encoded><![CDATA[<p>Nodemon是一种监听项目文件变动，让项目文件在修改时可以自动重启项目的工具。使用Nodemon时，当代码被修改，Nodemon会自动帮我们重启项目，极大方便了开发和调试。</p>
<p>Nodemon项目地址：<a href="https:/www.npmjs.com/package/nodemon">https:/www.npmjs.com/package/nodemon</a>。</p>
<p>使用Nodemon时，一般是在全局进行安装：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm i nodemon -g
</span></span></code></pre></div><p>安装完Nodemon后，可以使用<code>nodemon</code>命令来启动项目，这样当项目文件被修改时，<code>nodemon</code>会自动完成项目的重启。例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nodemon app.js
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
    <item>
      <title>NPM 与包</title>
      <link>/docs/node-js/npm-and-package/</link>
      <pubDate>Tue, 08 Aug 2023 08:17:55 +0000</pubDate>
      
      <guid>/docs/node-js/npm-and-package/</guid>
      <description><![CDATA[包 在Node.js中，第三方模块又称为包。第三方模块与包的概念相同，仅仅在称呼上有差异。包是由第三方个人或团队开发出来的，免费供所有人使用。]]></description>
      <content:encoded><![CDATA[<h1 id="包" data-numberify>包<a class="anchor ms-1" href="#包"></a></h1>
<p>在Node.js中，第三方模块又称为<strong>包</strong>。第三方模块与包的概念相同，仅仅在称呼上有差异。包是由第三方个人或团队开发出来的，免费供所有人使用。</p>
<blockquote>
<p>Node.js中的包都是免费且开源的，不需要付费即可下载使用。</p>
</blockquote>
<p>包是基于内置模块封装出来的，提供了更高级、更方便的API，极大地提高了开发效率。</p>
<hr>
<h1 id="npm" data-numberify>NPM<a class="anchor ms-1" href="#npm"></a></h1>
<p>在 <strong>npm, Inc.</strong> 公司旗下的网站<a href="https://www.npmjs.com" target="_blank" rel="noopener noreferrer">https://www.npmjs.com<i class="fas fa-external-link-square-alt ms-1"></i></a>上，可以搜索到任何你需要的包。该网站是全球最大的包共享平台。在该网站上，你还能浏览到对应包的相关文档。</p>
<p><strong>npm, Inc.</strong> 公司提供了地址为<a href="https://registry.npmjs.org/" target="_blank" rel="noopener noreferrer">https://registry.npmjs.org/<i class="fas fa-external-link-square-alt ms-1"></i></a>的服务器，来对外共享所有的包。可以通过该服务器来下载所需的包。</p>
<p>使用该服务器，需要对应的包管理工具才能进行包下载。这个包管理工具的名字叫做Node Package Manager（简称<code>npm</code>包管理工具），这个包管理工具随着Node.js的安装包一起被安装到了用户的电脑上。</p>
<p><code>npm</code>命令的基本使用方式可以查看<a href="/docs/node-js/introduction/#npm">Node.js 介绍——NPM</a>。</p>
<p>在使用<code>npm</code>初次为当前项目安装包后，项目文件夹下会多出一个<code>node_modules</code>文件夹和<code>package-lock.json</code>配置文件。其中：</p>
<ul>
<li><code>node_modules</code>：存放所有已安装到项目中的包。<code>require()</code>导入第三方包时，就是从该目录中查找并加载包。</li>
<li><code>package-lock.json</code>：记录<code>node_modules</code>下的每一个包的下载信息。例如包名、版本号、下载地址等。</li>
</ul>
<blockquote>
<p>一般<code>node_modules</code>和<code>package-lock.json</code>都无需用户修改，由<code>npm</code>自行管理。</p>
</blockquote>
<hr>
<h1 id="语义化版本号" data-numberify>语义化版本号<a class="anchor ms-1" href="#语义化版本号"></a></h1>
<p>通常情况下，包的版本号是以“点分十进制”形式进行定义的，总共有三位数字，其中每一位数字所代表的的含义如下：</p>
<ul>
<li>第1位数字：大版本（可能与之前的大版本不兼容）。</li>
<li>第2位数字：功能版本。</li>
<li>第3位数字：Bug修复版本。</li>
</ul>
<hr>
<h1 id="npm-包" data-numberify>NPM 包<a class="anchor ms-1" href="#npm-包"></a></h1>
<h2 id="包管理配置文件" data-numberify>包管理配置文件<a class="anchor ms-1" href="#包管理配置文件"></a></h2>
<p><code>npm</code>规定，在项目根目录中，必须提供一个<code>package.json</code>的包管理配置文件。<code>package.json</code>用来记录与项目有关的一些配置
信息，例如：</p>
<ul>
<li>项目的名称、版本号、描述等。</li>
<li>项目依赖的包。</li>
<li>分环境管理包。</li>
</ul>
<p>在多人协作时，如果将项目中所使用的第三方包也一起共享给他人，会导致包的体积过大。而这些第三方包均由<code>npm</code>包共享服务器提供。所以在共享时可以仅提供项目源代码，而将<code>node_modules</code>（第三方包所在目录）剔除，在他人使用项目时连网下载第三方包即可。通过<code>package.json</code>记录的包相关信息，可以在剔除<code>node_modules</code>目录后，在团队成员之间共享项目的源代码。</p>
<p>在使用Git作为代码仓库共享时，可以在<code>.gitignore</code>中添加<code>node_modules</code>，从而使Git忽略<code>node_modules</code>。例如忽略仓库下所有<code>node_modules</code>文件夹（或文件）：</p>
<pre tabindex="0"><code class="language-gitignore" data-lang="gitignore">**/node_modules
</code></pre><p><code>npm</code>包管理工具提供了一个快捷命令，可以在执行命令时所处的目录中，快速创建<code>package.json</code>这个包管理配置文件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm init -y
</span></span></code></pre></div><p>运行<code>npm init</code>之后，项目文件下生成的<code>package.json</code>内容大致如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;first-package&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;main&#34;</span><span class="p">:</span> <span class="s2">&#34;index.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;test&#34;</span><span class="p">:</span> <span class="s2">&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;keywords&#34;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;license&#34;</span><span class="p">:</span> <span class="s2">&#34;ISC&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>
<p><code>name</code>：包的名称。</p>
<p>项目根目录的名称并不一定需要与<code>name</code>相同，但是通常情况下，可以让项目根目录的名称与<code>name</code>相同，以方便查找。</p>
<p>需要注意的是，包的名称是不能重复的。因为在NPM服务器上，包的名称具有唯一性。在对包进行命名之前，可以先从<a href="https://www.npmjs.com" target="_blank" rel="noopener noreferrer">NPM官网<i class="fas fa-external-link-square-alt ms-1"></i></a>上查找名称是否被占用。</p>
</li>
<li>
<p><code>version</code>：包的版本。</p>
</li>
<li>
<p><code>description</code>：描述信息。</p>
</li>
<li>
<p><code>main</code>：入口文件。</p>
</li>
<li>
<p><code>keywords</code>：关键字。</p>
</li>
<li>
<p><code>author</code>：作者。</p>
</li>
<li>
<p><code>license</code>：开源协议。</p>
<p>更多License许可协议的相关内容，可参考<a href="https://www.jianshu.com/p/86251523e898" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/86251523e898<i class="fas fa-external-link-square-alt ms-1"></i></a></p>
</li>
</ul>
<blockquote>
<p>注：上述命令只能在英文的目录下成功运行。所以，项目文件夹的名称一定要使用英文命名，在项目路径中最好也不要使用中文，不能出现空格。</p>
</blockquote>
<h2 id="依赖包管理" data-numberify>依赖包管理<a class="anchor ms-1" href="#依赖包管理"></a></h2>
<p><code>package.json</code>还记录了用户使用<code>npm install</code>命令安装的包信息。运行<code>npm install</code>命令安装包的时候，<code>npm</code>会自动把包的名称和版本号，记录到<code>package.json</code>中的<code>dependencies</code>节点；相应的运行<code>npm uninstall</code>时，<code>npm</code>会自动把包的对应信息从<code>package.json</code>中剔除。</p>
<p>例如在项目中安装<code>jquery</code>和<code>art-template</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install jquery art-template
</span></span></code></pre></div><p>安装成功后，<code>package.json</code>会新增如下内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">/*</span> <span class="err">...</span> <span class="err">*/</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;dependencies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;art-template&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.13.2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;jquery&#34;</span><span class="p">:</span> <span class="s2">&#34;^3.7.0&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>当使用他人提供的剔除了<code>node_modules</code>的项目时，需要先把项目所需的包下载到项目中，才能将项目运行起来。</p>
<p>如果在使用前未将项目所需包下载，会有类似下方的报错：</p>
<pre tabindex="0"><code>Error: Cannot find module &#39;xxx&#39;
</code></pre><p>只需要在项目中使用<code>npm install</code>（或<code>npm i</code>），<code>npm</code>就会自动根据项目下的<code>package.json</code>文件，将项目所需的包下载到<code>node_modules</code>中。</p>
<h2 id="包的分类" data-numberify>包的分类<a class="anchor ms-1" href="#包的分类"></a></h2>
<p>被安装到项目的<code>node_modules</code>目录中的包，都是项目包。项目包又分为两类：</p>
<ul>
<li><strong>开发依赖包</strong>：只在开发阶段才会用到，在项目上线之后并不会用到的包。这些包的信息会被记录到<code>package.json</code>的<code>devDependencies</code>节点中。</li>
<li><strong>核心依赖包</strong>：在项目流程的整个期间（开发阶段和项目上线之后）都会用到。这些包的信息会被记录到<code>package.json</code>的<code>dependencies</code>节点中。</li>
<li><strong>全局包</strong>：在Linxu中，全局包的安装包会被放在<code>/usr/local</code>下或者<code>node</code>的安装目录下。例如，使用<code>nvm</code>安装的Node.js，它的<code>node_modules</code>在<code>~/.nvm/versions/node/v20.5.0/lib/</code>路径下（如果你使用的版本不同，将<code>v20.5.0</code>替换成对应的版本即可）。</li>
</ul>
<p>将包作为全局安装，仅需在<code>npm install</code>（或<code>npm i</code>）命令上提供<code>-g</code>参数即可。</p>
<p>在安装包时，可以给<code>npm install</code>（或<code>npm i</code>）命令提供参数<code>--save-dev</code>（可简写为<code>-D</code>），这样安装好的包，它们的信息会记录到<code>devDependencies</code>节点中。如果不指定提供参数<code>--save-dev</code>（或<code>-D</code>），那么它们的信息默认就会记录在<code>dependencies</code>节点中。<code>npm install</code>（或<code>npm i</code>）命令的<code>--save-dev</code>（或<code>-D</code>）参数使用方式如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 四种通用的写法：</span>
</span></span><span class="line"><span class="cl">npm install package-name@version -D
</span></span><span class="line"><span class="cl">npm install package-name@version --save-dev
</span></span><span class="line"><span class="cl">npm i package-name@version -D
</span></span><span class="line"><span class="cl">npm i package-name@version --save-dev
</span></span></code></pre></div><blockquote>
<p>注：<code>--save-dev</code>（或<code>-D</code>）是<code>npm install</code>（或<code>npm i</code>）命令的参数，它可以放在<code>npm install</code>（或<code>npm i</code>）命令下的任意位置。也就是说，<code>--save-dev</code>（或<code>-D</code>）参数可以放在包名前面。</p>
</blockquote>
<h2 id="包结构" data-numberify>包结构<a class="anchor ms-1" href="#包结构"></a></h2>
<p>在Node.js中，一个规范的包，它的组成结构必须符合以下要求：</p>
<ul>
<li>
<p>一个包必须以单独的目录存在。</p>
</li>
<li>
<p>包的顶级目录下必须包含包管理配置文件<code>package.json</code>。</p>
</li>
<li>
<p><code>package.json</code>中必须包含<code>name</code>（包名）、<code>version</code>（版本号）和<code>main</code>（包的入口）这三个属性。</p>
<p><code>main</code>属性定义了包的入口的为哪个文件。例如在使用第三方包时，<code>require()</code>加载的就是第三方包顶级目录的<code>package.json</code>中<code>main</code>属性定义的那个<code>.js</code>文件。</p>
<p>默认情况下，使用<code>npm init</code>初始化包时，<code>package.json</code>的<code>main</code>属性定义的是<code>index.js</code>文件。即，将<code>index.js</code>作为默认的包入口文件。</p>
</li>
</ul>
<p>在包的顶级目录下，还可以创建一个<code>README.md</code>作为包的说明文档。</p>
<p>关于包结构的更多约束，可访问<a href="https://classic.yarnpkg.com/en/docs/package-json" target="_blank" rel="noopener noreferrer">https://classic.yarnpkg.com/en/docs/package-json<i class="fas fa-external-link-square-alt ms-1"></i></a>。</p>
<p>自定义工具包（<code>linner-tools</code>）案例：</p>
<p><code>linner-tools</code>的结构：</p>
<ul>
<li>根目录：<code>linner-tools</code>。</li>
<li>根目录下的基本配置文件：
<ul>
<li>
<p>包管理配置文件：<code>package.json</code>。</p>
<p><code>package.json</code>使用<code>npm init -y</code>自动生成。生成成功后按照自己的情况对<code>package.json</code>进行修改即可。</p>
</li>
<li>
<p>包入口文件：<code>index.js</code>。</p>
</li>
<li>
<p>说明文档：<code>README.md</code>。</p>
<p>说明文档根据实际情况，使用Markdown语法编写即可。</p>
</li>
</ul>
</li>
</ul>
<p>在<code>linner-tools/src</code>下编写<code>dateFormat.js</code>和<code>htmlEscape.js</code>两个模块：</p>
<ul>
<li>
<p><code>dateFormat.js</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 格式化时间
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param {String} dateTimeStr
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">dateFormat</span><span class="p">(</span><span class="nx">dateTimeStr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">dt</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">dateTimeStr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">year</span> <span class="o">=</span> <span class="nx">dt</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">month</span> <span class="o">=</span> <span class="nx">padZero</span><span class="p">(</span><span class="nx">dt</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">date</span> <span class="o">=</span> <span class="nx">padZero</span><span class="p">(</span><span class="nx">dt</span><span class="p">.</span><span class="nx">getDate</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">hours</span> <span class="o">=</span> <span class="nx">padZero</span><span class="p">(</span><span class="nx">dt</span><span class="p">.</span><span class="nx">getHours</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">minutes</span> <span class="o">=</span> <span class="nx">padZero</span><span class="p">(</span><span class="nx">dt</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">secondes</span> <span class="o">=</span> <span class="nx">padZero</span><span class="p">(</span><span class="nx">dt</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sb">`</span><span class="si">${</span><span class="nx">year</span><span class="si">}</span><span class="sb">.</span><span class="si">${</span><span class="nx">month</span><span class="si">}</span><span class="sb">.</span><span class="si">${</span><span class="nx">date</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">hours</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">minutes</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">secondes</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">padZero</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">9</span> <span class="o">?</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">n</span> <span class="o">:</span> <span class="nx">n</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 向外暴露 dateFormat() 方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dateFormat</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
<li>
<p><code>htmlEscape.js</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 转义 HTML 标签
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param {String} htmlStr
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">htmlEscape</span><span class="p">(</span><span class="nx">htmlStr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">htmlStr</span><span class="p">.</span><span class="nx">replace</span><span class="p">((</span><span class="sr">/&lt;|&gt;|&#34;|&amp;/g</span><span class="p">),</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">switch</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;&lt;&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s1">&#39;&amp;lt;&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;&gt;&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s1">&#39;&amp;gt;&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;&#34;&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s1">&#39;&amp;quot;&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s1">&#39;&amp;amp;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 还原转义后的 HTML 字符
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param {String} str 
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @returns 
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">htmlUnEscape</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">((</span><span class="sr">/&amp;lt;|&amp;gt;|&amp;quot;|&amp;amp;/g</span><span class="p">),</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">switch</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;&amp;lt;&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s1">&#39;&lt;&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;&amp;gt;&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s1">&#39;&gt;&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;&amp;quot;&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s1">&#39;&#34;&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s1">&#39;&amp;amp;&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="s1">&#39;&amp;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 向外暴露 htmlEscape() 和 htmlUnEscape() 方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">htmlEscape</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">htmlUnEscape</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
</ul>
<p>在<code>linner-tools</code>目录下编写<code>index.js</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * linner-tools 包入口文件
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 方式一：直接接收 dateFormat 中特定的成员（花括号中的变量名要与模块中的成员名相同）
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 如果有多个成员要接收，可以在花括号中定义多个变量进行接收
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">dateFormat</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./src/dateFormat&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">escape</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./src/htmlEscape&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dateFormat</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span><span class="nx">escape</span>   <span class="c1">// 方式二：使用展开运算符 &#34;...&#34;（更推荐使用）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>创建一个与<code>linner-tools</code>目录同级的<code>linner-tools-test.js</code>进行简单的测试：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">linnerTools</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./linner-tools&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 测试格式化时间的功能
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">datetime</span> <span class="o">=</span> <span class="nx">linnerTools</span><span class="p">.</span><span class="nx">dateFormat</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">datetime</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;--------------------&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 测试 HTML 转义功能
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">htmlStr</span> <span class="o">=</span> <span class="s1">&#39;&lt;h1 title=&#34;abc&#34;&gt;这是h1标签&lt;span&gt;123&amp;nbsp;&lt;/span&gt;&lt;/h1&gt;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">linnerTools</span><span class="p">.</span><span class="nx">htmlEscape</span><span class="p">(</span><span class="nx">htmlStr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;--------------------&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 测试反转义 HTML 功能
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">htmlStr</span> <span class="o">=</span> <span class="nx">linnerTools</span><span class="p">.</span><span class="nx">htmlUnEscape</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">htmlStr</span><span class="p">);</span>
</span></span></code></pre></div><p>输出结果大致如下：</p>
<pre tabindex="0"><code>2023.08.9 14:24:29
--------------------
&amp;lt;h1 title=&amp;quot;abc&amp;quot;&amp;gt;这是h1标签&amp;lt;span&amp;gt;123&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;/h1&amp;gt;
--------------------
&lt;h1 title=&#34;abc&#34;&gt;这是h1标签&lt;span&gt;123&amp;nbsp;&lt;/span&gt;&lt;/h1&gt;
</code></pre><h2 id="包的发布与删除" data-numberify>包的发布与删除<a class="anchor ms-1" href="#包的发布与删除"></a></h2>
<p>发布包之前，需要先在 <a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer">NPM 官网<i class="fas fa-external-link-square-alt ms-1"></i></a>上注册一个账号，注册时需要使用邮箱验证。</p>
<p>注册完毕后需要在<code>npm</code>上进行登录，在登录之前需要将镜像切换为NPM官方源。</p>
<p>使用下方任意一种方式切换即可：</p>
<ul>
<li>
<p>使用<code>nrm</code>切换源：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nrm use npm
</span></span></code></pre></div></li>
<li>
<p>使用<code>npm</code>切换源：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm config <span class="nb">set</span> registry https://registry.npmjs.org/
</span></span></code></pre></div></li>
</ul>
<p>可以使用下方任意一条命令验证是否切换成功：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nrm ls
</span></span><span class="line"><span class="cl">npm config get registry
</span></span></code></pre></div><p>切换到NPM官方源后，就可以使用下方命令进行登录：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm login
</span></span><span class="line"><span class="cl"><span class="c1"># 输入这条命令之后，有两种登录方式</span>
</span></span><span class="line"><span class="cl"><span class="c1"># （对于旧的Node.js版本）一种是直接在终端中提示你需要输入用户名（username）、密码（password）和邮箱（email）等</span>
</span></span><span class="line"><span class="cl"><span class="c1"># （对于新的Node.js版本）另外一种是给你一个登录链接，让你在浏览器中打开，并且使用用户名密码或者邮箱验证码等方式进行登录</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 第二种方式并不要求你运行的NPM和你打开登录链接的机器是同一台</span>
</span></span></code></pre></div><p>登录成功后会提示你：</p>
<pre tabindex="0"><code>Logged in on https://registry.npmjs.org/.
</code></pre><p>登录成功后，进入项目根目录<code>linner-tools</code>，运行下方命令进行发布：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm publish
</span></span></code></pre></div><p>发布成功后会有如下提示：</p>
<pre tabindex="0"><code>npm notice Publishing to https://registry.npmjs.org/ with tag latest and default access
+ linner-tools@1.0.0
</code></pre><blockquote>
<p>注：</p>
<p>如果发布的包名称与服务器上现有的包名称重复或者过于相似，在运行<code>npm publish</code>时会有如下提示：</p>
<pre tabindex="0"><code>npm ERR! 403 403 Forbidden - PUT https://registry.npmjs.org/linner-tools - Package name too similar to existing package linner-tools; try renaming your package to &#39;@linner/linner-tools&#39; and publishing with &#39;npm publish --access=public&#39; instead
</code></pre><p>发布包时需要慎重，尽量不要往NPM上发布没有意义的包。</p>
</blockquote>
<p>删除已发布的包：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm unpublish package-name --force
</span></span></code></pre></div><p>例如删除<code>linner-tools</code>这个包，可以运行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm unpublish linner-tools@1.0.0 --force
</span></span></code></pre></div><p>删除成功后，终端会有类似下方的提示：</p>
<pre tabindex="0"><code>npm WARN using --force Recommended protections disabled.
- linner-tools@1.0.0
</code></pre><p>在删除包时，需要注意以下几点：</p>
<ul>
<li><code>npm unpublish</code>命令只能删除72小时以内发布的包。</li>
<li>使用<code>npm unpublish</code>删除的包，在24小时内不允许重复发布。</li>
</ul>
<hr>
<h1 id="模块的加载机制" data-numberify>模块的加载机制<a class="anchor ms-1" href="#模块的加载机制"></a></h1>
<p>模块（包）在第一次被加载后会被缓存。无论什么模块，Node.js都会优先从缓存中加载它们，从而提高模块的加载效率。这也就意味着，即使多次调用<code>require()</code>加载同一个模块，模块也只会在第一次被<code>require()</code>加载时执行。即多次调用<code>require()</code>加载同一个模块不会导致模块中的代码被多次执行。</p>
<p>演示Node.js模块加载机制：</p>
<ul>
<li>
<p>首先新建一个<code>myModule.js</code>文件，编写如下内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello! This is my module!&#39;</span><span class="p">);</span>
</span></span></code></pre></div></li>
<li>
<p>然后再新建一个<code>testMyModule.js</code>，编写3条<code>require()</code>语句：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./myModule&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./myModule&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./myModule&#39;</span><span class="p">);</span>
</span></span></code></pre></div></li>
<li>
<p>运行<code>testMyModule.js</code>，最后执行结果如下：</p>
<pre tabindex="0"><code>Hello! This is my module!
</code></pre></li>
</ul>
<p><code>Hello! This is my module!</code>只被打印了一次。</p>
<h2 id="内置模块的加载机制" data-numberify>内置模块的加载机制<a class="anchor ms-1" href="#内置模块的加载机制"></a></h2>
<p>Node.js内置模块的优先级，在所有模块中是最高的。例如<code>require('fs')</code>始终返回内置的<code>fs</code>模块，即使在<code>node_modules</code>目录下也有一个相同名称的<code>fs</code>包。</p>
<h2 id="自定义模块的加载机制" data-numberify>自定义模块的加载机制<a class="anchor ms-1" href="#自定义模块的加载机制"></a></h2>
<p>在使用<code>require()</code>加载自定义模块时，必须使用以<code>./</code>或<code>../</code>开头的相对路径。如果没有使用相对路径，Node.js会将其作为内置模块或第三方模块进行加载。</p>
<p>在使用<code>require()</code>导入自定义模块时，如果没有指定文件扩展名，则Node.js会按以下顺序尝试进行加载：</p>
<ol>
<li>按照<u>确切的文件名</u>尝试进行加载。</li>
<li>补全<u><code>.js</code></u>扩展名后，尝试进行加载。</li>
<li>补全<u><code>.json</code></u>扩展名后，尝试进行加载。</li>
<li>补全<u><code>.node</code></u>扩展名后，尝试进行加载。</li>
<li>最后会尝试加载同名的目录（即包，这里加载是按目录名称去匹配的）。</li>
<li>如果上方没有一项加载成功，则终端显示报错信息。</li>
</ol>
<h2 id="第三方模块的加载机制" data-numberify>第三方模块的加载机制<a class="anchor ms-1" href="#第三方模块的加载机制"></a></h2>
<p>如果传递给<code>require()</code>的模块标识符不是一个内置模块，也没有使用相对路径标识，则Node.js会从当前模块的父目录（也就是当前模块所在的目录）开始，尝试从<code>node_modules</code>文件夹中加第三方模块。</p>
<p>如果Node.js没有找到对应的第三方模块，会移动到再上一层的父目录中，进行加载，直到移动到文件系统的根目录为止。</p>
<p>例如在<code>/home/linner/node/myModule.js</code>调用了<code>require('tools')</code>，Node.js会按照以下顺序查找：</p>
<ol>
<li><code>/home/linner/node/node_modules/tools</code></li>
<li><code>/home/linner/node_modules/tools</code></li>
<li><code>/home/node_modules/tools</code></li>
<li><code>/node_modules/tools</code></li>
</ol>
<h2 id="目录模块的加载机制" data-numberify>目录模块的加载机制<a class="anchor ms-1" href="#目录模块的加载机制"></a></h2>
<p>在将目录作为模块标识符，传递给<code>require()</code>进行加载时，Node.js会在目录下查找<code>package.json</code>：</p>
<ul>
<li>如果目录下存在<code>package.json</code>，则查找<code>package.json</code>中的<code>main</code>属性：
<ul>
<li>
<p>如果<code>package.json</code>存在<code>main</code>属性，那么就将<code>main</code>属性定义的文件作为<code>require()</code>加载的入口。</p>
<p>如果<code>main</code>属性定义的文件不存在，那么就尝试将目录下的<code>index.js</code>文件作为加载入口。此时模块或许能正常加载，但是Node.js会在终端输出警告消息：</p>
<pre tabindex="0"><code>(node:7393) [DEP0128] DeprecationWarning: Invalid &#39;main&#39; field in &#39;xxx/package.json&#39; of &#39;xxx.js&#39;. Please either fix that or report it to the module author
(Use `node --trace-deprecation ...` to show where the warning was created)
</code></pre></li>
<li>
<p>如果<code>package.json</code>不存在<code>main</code>属性，将尝试加载目录下的<code>index.js</code>文件（加载成功的话并不会有报错或警告信息）。</p>
</li>
</ul>
</li>
<li>如果目录下不存在<code>package.json</code>，也是尝试加载目录下的<code>index.js</code>文件（加载成功的话并不会有报错或警告信息）。</li>
</ul>
<p>从以上加载模块的步骤中可以看出，<code>index.js</code>是作为Node.js的默认入口文件而存在。如果<code>index.js</code>文件不存在，模块加载失败，Node.js会在终端报告模块缺失：</p>
<pre tabindex="0"><code>Error: Cannot find module &#39;xxx&#39;
</code></pre>]]></content:encoded>
    </item>
    
    <item>
      <title>Node.js 模块化</title>
      <link>/docs/node-js/modularization/</link>
      <pubDate>Mon, 07 Aug 2023 14:23:19 +0000</pubDate>
      
      <guid>/docs/node-js/modularization/</guid>
      <description><![CDATA[模块化概念 模块化是指解决一个复杂问题时，自顶向下逐层把系统划分成若干模块的过程。对于整个系统来说，模块是可组合、可分解和可更换的单元。 在模块]]></description>
      <content:encoded><![CDATA[<h1 id="模块化概念" data-numberify>模块化概念<a class="anchor ms-1" href="#模块化概念"></a></h1>
<p>模块化是指解决一个复杂问题时，自顶向下逐层把系统划分成若干模块的过程。对于整个系统来说，模块是可组合、可分解和可更换的单元。</p>
<p>在模块化时，要遵守固定的规则（模块化规范），把一个大文件拆成独立并互相依赖的多个小模块。</p>
<p>进行模块化拆分的好处：</p>
<ul>
<li>提高了代码的复用性。</li>
<li>提高了代码的可维护性。</li>
<li>可以实现按需加载。</li>
<li>遵守同样的模块化规范，有利于降低沟通的成本，极大地方便了各个模块之间的相互调用，利人利己。</li>
</ul>
<hr>
<h1 id="nodejs-模块化" data-numberify>Node.js 模块化<a class="anchor ms-1" href="#nodejs-模块化"></a></h1>
<p>Node.js中根据模块来源的不同，将模块分为了3大类，分别是：</p>
<ul>
<li>
<p><strong>内置模块</strong>：由Node.js官方提供，例如<code>fs</code>、<code>path</code>、<code>http</code>等。</p>
</li>
<li>
<p><strong>自定义模块</strong>：用户自定义的模块。在Node.js中，用户创建的每个<code>.js</code>文件，都属于自定义模块。</p>
<p>在将<code>.js</code>文件加载为模块时，需要指定其路径（<code>.js</code>后缀可以省略，也可以加上）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">myModule</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./custom&#39;</span><span class="p">)</span>
</span></span></code></pre></div></li>
<li>
<p><strong>第三方模块</strong>：由其他用户开发的模块，并非官方提供或用户创建的模块。使用第三方模块前需要先进行下载（例如使用<code>npm</code>安装的模块）。</p>
</li>
</ul>
<blockquote>
<p>注：使用<code>require()</code>方法加载模块时，会同时执行被加载模块中的代码。</p>
</blockquote>
<h2 id="模块作用域" data-numberify>模块作用域<a class="anchor ms-1" href="#模块作用域"></a></h2>
<p>模块作用域是指在模块中定义的变量、方法等成员，只能在当前模块内被访问。</p>
<p>模块作用域可以防止全局变量污染的问题。</p>
<h2 id="commonjs-模块化规范" data-numberify>CommonJS 模块化规范<a class="anchor ms-1" href="#commonjs-模块化规范"></a></h2>
<p>Node.js遵循了CommonJS模块化规范，CommonJS规定了模块的特性和各模块之间相互依赖的方式。</p>
<p>CommonJS规定：</p>
<ul>
<li>每个模块内部，<code>module</code>变量代表当前模块。</li>
<li><code>module</code>变量是一个对象，它的<code>exports</code>属性（即<code>module.exports</code>）是对外的接口。</li>
<li>加载某个模块，其实是加载该模块的<code>module.exports</code>属性。<code>require()</code>方法用于加载模块。</li>
</ul>
<h2 id="module-对象" data-numberify>Module 对象<a class="anchor ms-1" href="#module-对象"></a></h2>
<p><code>module</code>对象存放了当前模块中的基本信息。在一个空的<code>js</code>文件中打印<code>module</code>对象的结果如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">Module</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">exports</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">parent</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;/root/study-js/modularization/module-object.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">loaded</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">children</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">paths</span><span class="o">:</span> <span class="p">[</span> 
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;/root/study-js/modularization/node_modules&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;/root/study-js/node_modules&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;/root/node_modules&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;/node_modules&#39;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">]</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>module</code>对象的属性：</p>
<ul>
<li><code>filename</code>：当前模块文件的全路径名。</li>
<li><code>exports</code>：向外共享成员、接口。</li>
</ul>
<h2 id="向外共享模块内成员" data-numberify>向外共享模块内成员<a class="anchor ms-1" href="#向外共享模块内成员"></a></h2>
<p>在自定义模块时，可以使用<code>module.exports</code>对象，将模块内的成员向外部的其他模块共享，供外界使用。在外界使用<code>require()</code>方法导入模块时，<code>require()</code>方法提供的就是<code>module.exports</code>所指向的对象。</p>
<p>为<code>module.exports</code>对象挂载成员时，有两种方式：</p>
<ol>
<li>
<p>为<code>module.exports</code>对象创建成员：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// 在 module.exports 对象上挂载属性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="s1">&#39;Linner&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 在 module.exports 对象上挂载方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">hello</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello Orther Module!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 挂载常量属性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">COLOR</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">COLOR</span> <span class="o">=</span> <span class="nx">COLOR</span>
</span></span></code></pre></div></li>
<li>
<p>定义一个<code>module.exports</code>对象：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// 定义 module.exports 对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;Linner&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">hello</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello Orther Module!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">COLOR</span><span class="o">:</span> <span class="s1">&#39;black&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></li>
</ol>
<p>使用这两种方式来挂载，区别不大，可以在其它模块中打印输出进行观察（假设创建的<code>.js</code>文件名为<code>module-exports.js</code>）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">me</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./module-exports&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 打印其他模块的 module.exports
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">me</span><span class="p">);</span>
</span></span></code></pre></div><p>向外共享模块作用域中的成员，除了使用<code>module.exports</code>对象外，还可以使用<code>exports</code>对象。默认情况下，<code>exports</code>和<code>moudle.exports</code>指向的是同一个对象。最终共享的结果，是以<code>module.exports</code>指向的对象为准。</p>
<p>在<code>exports-object.js</code>中编写：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="s1">&#39;Linner&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">hello</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 验证 exports 和 module.exports 指向的是否为同一个对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;exports&#39;</span><span class="p">,</span> <span class="nx">exports</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;module.exports&#39;</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Are they equal?&#39;</span><span class="p">,</span> <span class="nx">exports</span> <span class="o">===</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 如果直接为 exports 对象赋值
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 此时 exports 和 module.exports 指向的就不是同一个对象了
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;Zhangsan&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">age</span><span class="o">:</span> <span class="s1">&#39;20&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Assign a value to the exports:&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;exports&#39;</span><span class="p">,</span> <span class="nx">exports</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;module.exports&#39;</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Are they equal?&#39;</span><span class="p">,</span> <span class="nx">exports</span> <span class="o">===</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">);</span>
</span></span></code></pre></div><p>然后在<code>test-exports.js</code>中进行测试：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">eo</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./exports-object&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;The module.exports in exports-object:&#34;</span><span class="p">,</span> <span class="nx">eo</span><span class="p">);</span>
</span></span></code></pre></div><p>运行<code>test-exports.js</code>输出结果如下：</p>
<pre tabindex="0"><code>exports { username: &#39;Linner&#39;, age: null, hello: [Function] }
module.exports { username: &#39;Linner&#39;, age: null, hello: [Function] }
Are they equal? true
Assign a value to the exports:
exports { username: &#39;Zhangsan&#39;, age: &#39;20&#39; }
module.exports { username: &#39;Linner&#39;, age: null, hello: [Function] }
Are they equal? false
The module.exports in exports-object: { username: &#39;Linner&#39;, age: null, hello: [Function] }
</code></pre><p>在<code>exports-object.js</code>中添加新的代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/* 省略其它代码... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;Lisi&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">age</span><span class="o">:</span> <span class="s1">&#39;23&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">gender</span><span class="o">:</span> <span class="s1">&#39;man&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Assign a value to the module.exports:&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;exports&#39;</span><span class="p">,</span> <span class="nx">exports</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;module.exports&#39;</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Are they equal?&#39;</span><span class="p">,</span> <span class="nx">exports</span> <span class="o">===</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">);</span>
</span></span></code></pre></div><p>再次运行<code>test-exports.js</code>，输出结果如下：</p>
<pre tabindex="0"><code>exports { username: &#39;Linner&#39;, age: null, hello: [Function] }
module.exports { username: &#39;Linner&#39;, age: null, hello: [Function] }
Are they equal? true
Assign a value to the exports:
exports { username: &#39;Zhangsan&#39;, age: &#39;20&#39; }
module.exports { username: &#39;Linner&#39;, age: null, hello: [Function] }
Are they equal? false
Assign a value to the module.exports:
exports { username: &#39;Zhangsan&#39;, age: &#39;20&#39; }
module.exports { username: &#39;Lisi&#39;, age: &#39;23&#39;, gender: &#39;man&#39; }
Are they equal? false
The module.exports in exports-object: { username: &#39;Lisi&#39;, age: &#39;23&#39;, gender: &#39;man&#39; }
</code></pre><p>总结：如果对<code>exports</code>或<code>module.exports</code>只进行添加成员对象的操作，不直接给它们赋值，那么<code>exports</code>和<code>module.exports</code>指向的始终都是同一个对象。如果对<code>exports</code>或<code>module.exports</code>进行了赋值操作，那么<code>exports</code>和<code>module.exports</code>指向的就不是同一个对象，但是<u>向外共享的成员还是以<code>module.exports</code>为准</u>。</p>
<blockquote>
<p>注：为了防止混乱，不要再同一个模块中同时使用<code>exports</code>和<code>module.exports</code>。建议使用<code>module.exports</code>。</p>
</blockquote>
]]></content:encoded>
    </item>
    
    <item>
      <title>Node.js HTTP 模块</title>
      <link>/docs/node-js/http-module/</link>
      <pubDate>Mon, 07 Aug 2023 08:05:53 +0000</pubDate>
      
      <guid>/docs/node-js/http-module/</guid>
      <description><![CDATA[http模块是Node.js官方提供的、用于创建Web服务器的模块。通过http模块提供的http.createServer()方法，就能像]]></description>
      <content:encoded><![CDATA[<p><code>http</code>模块是Node.js官方提供的、用于创建Web服务器的模块。通过<code>http</code>模块提供的<code>http.createServer()</code>方法，就能像Web服务器一样对外提供Web资源服务。</p>
<p>在Node.js中无需使用第三方Web服务器软件，通过<code>http</code>模块就能模拟服务器软件，从而对外提供Web服务。</p>
<p><code>http</code>模块主要用于搭建HTTP服务端和客户端，使用HTTP服务器或客户端功能必须调用<code>http</code>模块。在Node.js中使用Web服务的基本步骤如下：</p>
<ol>
<li>
<p>导入<code>http</code>模块：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span>
</span></span></code></pre></div></li>
<li>
<p>创建Web服务器实例。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">()</span>
</span></span></code></pre></div></li>
<li>
<p>为服务器实例绑定<code>request</code>事件，监听客户端的请求。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Someone visit our web server.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* Request Handle... */</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div></li>
<li>
<p>启动服务器。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="c1">// 监听 8080 端口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server running at http://127.0.0.1:8080&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* Started Handle... */</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div></li>
</ol>
<p>HTTP Demo如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// 1. 导入 http 模块
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 2. 创建 web 服务器实例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 3. 为服务器实例绑定 request 事件，监听客户端请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置响应头信息
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 状态码：200
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 内容类型: 文本
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 发送响应数据 &#34;Hello World!&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;Hello World!\n&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Someone visit our web server.&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 4. 启动服务器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server running at http://127.0.0.1:8080&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>在<code>server.on()</code>方法的回调函数的参数列表中，<code>req</code>就是Request（请求）对象，<code>res</code>就是Response（响应）对象。</p>
<hr>
<h1 id="request-对象" data-numberify>Request 对象<a class="anchor ms-1" href="#request-对象"></a></h1>
<p>Request 对象用于获取客户端发送给服务端的请求信息。</p>
<p>获取请求信息（<code>http.createServer()</code>也能注册回调函数，下方演示了使用方式）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">createServer</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;http&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Request URL: &#39;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>         <span class="c1">// 请求URL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Request Method: &#39;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="p">);</span>   <span class="c1">// 请求方式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server running at http://127.0.0.1:8080&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><hr>
<h1 id="response-对象" data-numberify>Response 对象<a class="anchor ms-1" href="#response-对象"></a></h1>
<p>Request 对象用于服务端响应给客户端数据。</p>
<p>Request 对象响应数据的方式是，调用<code>res.end()</code>方法。就如HTTP Demo中所示。下方展示了另外一个Demo，该Demo展示了Response对象的使用，还展示了<code>http.Server</code>对象的链式调用，并且通过给响应头设置字符集的方式解决中文乱码问题：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">createServer</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;http://127.0.0.1:8080&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">createServer</span><span class="p">().</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 设置响应数据类型并解决中文乱码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain; charset=utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 发送响应数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="sb">`请求地址: </span><span class="si">${</span><span class="nx">url</span><span class="si">}${</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb">\n请求方式: </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 当调用了 res.end() 之后，就表示响应已经结束了，此时再进行任何响应都是无效的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server running at &#39;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><hr>
<h1 id="根据-url-进行响应" data-numberify>根据 URL 进行响应<a class="anchor ms-1" href="#根据-url-进行响应"></a></h1>
<p>使用Node.js的<code>http</code>模块，为文件系统模块中<a href="/docs/node-js/node-fs/#%e6%a1%88%e4%be%8b2">案例2</a>生成的<code>clock</code>页面搭建Web Server：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// res.setHeader(&#39;Content-Type&#39;, &#39;text/html; charset=utf-8&#39;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// URL处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">DIR_NAME</span> <span class="o">=</span> <span class="s1">&#39;clock&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">url</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">url</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">DIR_NAME</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 匹配以&#39;/index&#39;开头的URL请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;/index&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">url</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">DIR_NAME</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 资源路径拼接
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">PATH</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 读取文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">PATH</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 展示错误消息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="sb">`&lt;h1&gt;404 Error! </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb"> Not Found!&lt;/h1&gt;`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 发送相应数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server listen at http://127.0.0.1:8080/&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
    <item>
      <title>Node.js 事件循环</title>
      <link>/docs/node-js/event/</link>
      <pubDate>Sun, 06 Aug 2023 14:46:07 +0000</pubDate>
      
      <guid>/docs/node-js/event/</guid>
      <description><![CDATA[Node.js 是单进程单线程应用程序，但是因为 V8 引擎提供的异步执行回调接口，通过这些接口可以处理大量的并发，所以性能非常高。 Node.js 几乎每一个 API 都是支持回调函]]></description>
      <content:encoded><![CDATA[<p>Node.js 是单进程单线程应用程序，但是因为 V8 引擎提供的异步执行回调接口，通过这些接口可以处理大量的并发，所以性能非常高。</p>
<p>Node.js 几乎每一个 API 都是支持回调函数的。</p>
<p>Node.js 基本上所有的事件机制都是用设计模式中观察者模式实现。</p>
<p>Node.js 单线程类似进入一个<code>while(true)</code>的事件循环，直到没有事件观察者时退出。每个异步事件都生成一个事件观察者，如果有事件发生就调用该回调函数。</p>
<hr>
<h1 id="事件驱动程序" data-numberify>事件驱动程序<a class="anchor ms-1" href="#事件驱动程序"></a></h1>
<p>Node.js 使用事件驱动模型。在事件驱动模型中，会生成一个主循环来监听事件，当检测到事件时触发回调函数：</p>
<p><picture><img class="img-fluid " alt="事件驱动流程" src="/docs/node-js/event/uTools_1691333689230.png" loading="lazy" width="626" height="252" />
</picture>

</p>
<p>这套流程有点类似于观察者模式，事件相当于一个主题（Subject），而所有注册到这个事件上的处理函数相当于观察者（Observer）。当主题发生改变（事件触发）时，通知观察者进行更新（触发相应的回调函数）。</p>
<hr>
<h1 id="事件模块" data-numberify>事件模块<a class="anchor ms-1" href="#事件模块"></a></h1>
<p>Node.js 有多个内置的事件，可以通过引入 <code>events</code> 模块，并通过实例化 <code>EventEmitter</code> 类来绑定和监听事件，如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// 引入 events 模块
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">events</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 创建 EventEmitter 对象
</span></span></span><span class="line"><span class="cl"><span class="cm"> * EventEmitter可用于注册事件处理和触发事件
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">eventEmitter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">events</span><span class="p">.</span><span class="nx">EventEmitter</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 绑定 data_received 事件处理程序
</span></span></span><span class="line"><span class="cl"><span class="cm"> * eventEmitter.on() 方法：
</span></span></span><span class="line"><span class="cl"><span class="cm"> * - 参数1：绑定的事件名称
</span></span></span><span class="line"><span class="cl"><span class="cm"> * - 参数2：触发事件时执行的回调函数
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">DATA_RECEIVED</span> <span class="o">=</span> <span class="s1">&#39;data_received&#39;</span> 
</span></span><span class="line"><span class="cl"><span class="nx">eventEmitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">DATA_RECEIVED</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Receiving Successful!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 绑定 connection 事件处理程序
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">CONNECTION</span> <span class="o">=</span> <span class="s1">&#39;connection&#39;</span> 
</span></span><span class="line"><span class="cl"><span class="nx">eventEmitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">CONNECTION</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Connected Successful!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 触发 data_received 事件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">eventEmitter</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">DATA_RECEIVED</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 触发 connection 事件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">eventEmitter</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">CONNECTION</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Executed...&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p>执行结果如下：</p>
<pre tabindex="0"><code>Connected Successful!
Receiving Successful!
Executed...
</code></pre>]]></content:encoded>
    </item>
    
    <item>
      <title>Node.js 文件系统模块</title>
      <link>/docs/node-js/fs/</link>
      <pubDate>Sun, 06 Aug 2023 07:35:26 +0000</pubDate>
      
      <guid>/docs/node-js/fs/</guid>
      <description><![CDATA[使用fs模块，首先需要导入： const fs = require(&#39;fs&#39;) 读取文件 下方是一个通过fs.readFile()读取文件的示例： // 1. 导入fs模块，来操作文件 const fs = require(&#39;fs&#39;) /** *]]></description>
      <content:encoded><![CDATA[<p>使用<code>fs</code>模块，首先需要导入：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
</span></span></code></pre></div><hr>
<h1 id="读取文件" data-numberify>读取文件<a class="anchor ms-1" href="#读取文件"></a></h1>
<p>下方是一个通过<code>fs.readFile()</code>读取文件的示例：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// 1. 导入fs模块，来操作文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 2. 调用 fs.readFile() 方法读取文件
</span></span></span><span class="line"><span class="cl"><span class="cm"> *  - 参数1（必须）：读取文件的存放路径
</span></span></span><span class="line"><span class="cl"><span class="cm"> *  - 参数2（可选）：读取文件时采用的编码格式，默认指定utf8
</span></span></span><span class="line"><span class="cl"><span class="cm"> *  - 参数3（必须）：回调函数，拿到读取失败（err）和成功的结果（dataStr）
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">&#39;test.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">dataStr</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 2.1 打印失败的结果
</span></span></span><span class="line"><span class="cl"><span class="cm">     *   - 如果读取成功，则 err 的值为 null，dataStr的值为 文件的内容
</span></span></span><span class="line"><span class="cl"><span class="cm">     *   - 如果读取失败，则 err 的值为 错误对象，dataStr的值为 undefined
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-------------&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 2.2 打印成功的结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dataStr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><code>fs.readFile()</code>用于异步读取文件。当<code>fs.readFile()</code>读取到文件之后，会将信息传递给<code>err</code>和<code>dataStr</code>对象。<code>err</code>对象可用于读取成功与否的判断，并且记录了读取失败时的信息；<code>dataStr</code>对象记录了读取到的文件内容。</p>
<p>判断文件是否读取成功：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">fileName</span> <span class="o">=</span> <span class="s1">&#39;test.txt&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">fileName</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">dataStr</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;readFileErr: &#39;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Read &#39;</span> <span class="o">+</span> <span class="nx">fileName</span> <span class="o">+</span> <span class="s1">&#39; success!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dataStr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><code>fs</code>模块还有一个<code>readFileSync()</code>方法，用于同步地文件读取，它与<code>readFile()</code>异步地文件读取区别如下：</p>
<ul>
<li>
<p><code>readFile()</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">readFile</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Program started...&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">fileName</span> <span class="o">=</span> <span class="s1">&#39;test.txt&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nx">readFile</span><span class="p">(</span><span class="nx">fileName</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">dataStr</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-------------&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;readFileErr: &#39;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Read &#39;</span> <span class="o">+</span> <span class="nx">fileName</span> <span class="o">+</span> <span class="s1">&#39; success!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dataStr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-------------&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Program ended...&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p>输出结果：</p>
<pre tabindex="0"><code>Program started...
Program ended...
-------------
Read test.txt success!
Hello Node.js!
-------------
</code></pre><p>可以发现异步地文件读取，不会立即执行回调函数，而是直接执行下一条指令，直到文件读取成功才执行回调。</p>
</li>
<li>
<p><code>readFileSync()</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">readFileSync</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;fs&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// readFileSync() 不能注册回调函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">fileData</span> <span class="o">=</span> <span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;test.txt&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">fileData</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-------------&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Readed Success!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 没有指定字符集的话是返回一个 Buffer 对象，所以要将其转为 String
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">fileContent</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">fileData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fileContent</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-------------&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Readed Error!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Program ended...&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p>输出：</p>
<pre tabindex="0"><code>Program started...
-------------
Readed Success!
Hello Node.js!
-------------
Program ended...
</code></pre></li>
</ul>
<hr>
<h1 id="写入内容" data-numberify>写入内容<a class="anchor ms-1" href="#写入内容"></a></h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// 1. 导入fs.writeFile() 方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">writeFile</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 2. 调用 fs.wirteFile() 方法，写入文件的内容
</span></span></span><span class="line"><span class="cl"><span class="cm"> *  - 参数1（必须）：文件的存放路径
</span></span></span><span class="line"><span class="cl"><span class="cm"> *  - 参数2（必须）：要写入文件的内容
</span></span></span><span class="line"><span class="cl"><span class="cm"> *  - 参数3（可选）：设置文件模式
</span></span></span><span class="line"><span class="cl"><span class="cm"> *  - 参数4（必须）：回调函数
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">writeFile</span><span class="p">(</span><span class="s1">&#39;test1.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;Writes new content&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 2.1 如果文件写入成功，则 err == null
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 2.3 如果文件写入失败，则 err == 错误对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><blockquote>
<p>注：要触发文件不存在，<code>err</code>返回错误对象的前提是路径也不存在，否则<code>fs.wirteFile()</code>默认会创建一个新文件并写入。例如你当前目录下不存在<code>test</code>这个目录的话，可以将路径改成<code>test/test.txt</code>来让<code>err</code>返回错误对象。</p>
</blockquote>
<p>判断文件写入是否成功：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">writeFile</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;fs&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">writeFile</span><span class="p">(</span><span class="s1">&#39;test.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;Writes new content...&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;writeFileErr: &#39;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Writing Success!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><code>fs.writeFile()</code>也有与<code>fs.readFile()</code>类似的同步写入函数<code>fs.writeFileSync()</code>，作用与<code>fs.readFileSync()</code>类似。</p>
<hr>
<h1 id="路径动态拼接问题" data-numberify>路径动态拼接问题<a class="anchor ms-1" href="#路径动态拼接问题"></a></h1>
<p>在使用<code>fs</code>模块操作文件时，如果提供的操作路径是以<code>./</code>或<code>../</code>开头的相对路径时，很容易出现路径动态拼接错误的问题。</p>
<p>演示路径动态拼接问题：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">readFile</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">readFile</span><span class="p">(</span><span class="s1">&#39;./test.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Reading Success!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span></span></code></pre></div><p>切换到上层目录，执行该JS，会发现报错：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ <span class="nb">cd</span> ..
</span></span><span class="line"><span class="cl">$ node js/path-problem.js
</span></span><span class="line"><span class="cl">ENOENT: no such file or directory, open <span class="s1">&#39;./test.txt&#39;</span>
</span></span></code></pre></div><p>这是因为代码在运行的时候，会<u>以执行Node命令时所处的目录</u>，动态拼接出被操作文件的完整路径。</p>
<p>在使用<code>fs</code>模块操作文件时，可以通过<code>__dirname</code>直接提供完整的路径，不要提供以<code>./</code>或<code>../</code>开头的相对路径，从而防止路径动态拼接的问题。</p>
<p>修改如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">readFile</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 出现路径拼接问题，是因为使用了 &#39;./&#39; 或 &#39;../&#39; 之类的相对路径
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Node在运行JS时，会将这类相对路径进行处理，使用当前JS文件所在的目录拼接在打开的文件路径上
</span></span></span><span class="line"><span class="cl"><span class="cm"> * __dirname 表示当前JS文件所处的目录
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">readFile</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/test.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Reading Success!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>再次执行，文件可以成功打开。</p>
<hr>
<h1 id="path-模块处理路径" data-numberify>Path 模块处理路径<a class="anchor ms-1" href="#path-模块处理路径"></a></h1>
<p><code>path</code>模块是Node.js官方提供的、用来处理路径的模块。它提供了一系列的方法和属性，用来满足用户对路径的处理需求。</p>
<p>常用的方法有：</p>
<ul>
<li><code>path.join()</code>：将多个路径片段拼接成一个完整的路径字符串。</li>
<li><code>path.basename()</code>：从路径字符串中，将文件名解析出来。</li>
<li><code>path.extname()</code>：从路径字符串中，将文件名扩展名解析出来。</li>
</ul>
<p>使用之前需要先导入<code>path</code>模块：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p><code>path.join()</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// path.join() 将参数列表中的字符串进行路径拼接，并返回拼接结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">pathStr</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/dir1&#39;</span><span class="p">,</span> <span class="s1">&#39;dir2/dir3&#39;</span><span class="p">,</span> <span class="s1">&#39;../&#39;</span><span class="p">,</span> <span class="s1">&#39;./dir4&#39;</span><span class="p">,</span> <span class="s1">&#39;dir5&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">pathStr</span><span class="p">);</span>
</span></span></code></pre></div><p>输出结果如下：</p>
<pre tabindex="0"><code>/dir1/dir2/dir4/dir5
</code></pre><blockquote>
<p>注：<code>path.join()</code>方法仅用于路径拼接，相当于路径字符串的处理，不对路径的存在与否进行检查。</p>
</blockquote>
<p>利用<code>path.join()</code>替代<code>+</code>号拼接路径：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">readFile</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">join</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">readFile</span><span class="p">(</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;test.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><code>path.basename()</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fpath</span> <span class="o">=</span> <span class="s1">&#39;/var/local/html/blog/index.html&#39;</span> <span class="c1">// 文件存放路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 根据路径解析文件（目录）名
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">fullName</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">fpath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">nameWithoutExt</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">fpath</span><span class="p">,</span> <span class="s1">&#39;.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fullName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">nameWithoutExt</span><span class="p">);</span>
</span></span></code></pre></div><p>输出结果如下：</p>
<pre tabindex="0"><code>index.html
index
</code></pre><p><code>path.basename(path[, ext])</code>参数和返回值：</p>
<ul>
<li>
<p><code>path</code>（必选）：表示要解析的路径字符串。</p>
</li>
<li>
<p><code>ext</code>（可选）：表示文件扩展名（后缀）。</p>
<p>经过测试后你会发现，<code>path.basename()</code>只是将最后一段字符串解析出来，然后将其后缀中与<code>ext</code>相同的部分去除后返回。</p>
</li>
<li>
<p>返回值：路径中的最后一部分（有可能是文件名，也有可能是目录名）。当指定扩展名时，返回的有可能是不包含扩展名的名称。</p>
</li>
</ul>
<p>与<code>path.join()</code>类似<code>path.basename()</code>仅仅是做关于路径的字符串解析，并不关心实际上是否存在这样的路径。<code>path.basename()</code>解析到的不仅是文件名，还可以是目录名。并且<code>path.basename()</code>在解析后缀时，如果当前路径的<code>basename</code>没有相应的后缀，<code>path.basename()</code>会将整个<code>basename</code>返回。</p>
<p><code>path.extname()</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fpath</span> <span class="o">=</span> <span class="s1">&#39;/var/local/html/blog/index.html&#39;</span> <span class="c1">// 文件存放路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">extName</span> <span class="o">=</span>  <span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">fpath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">extName</span><span class="p">);</span>
</span></span></code></pre></div><p>输出结果为：</p>
<pre tabindex="0"><code>.html
</code></pre><hr>
<h1 id="案例" data-numberify>案例<a class="anchor ms-1" href="#案例"></a></h1>
<h2 id="案例1" data-numberify>案例1<a class="anchor ms-1" href="#案例1"></a></h2>
<p>使用fs文件系统模块，将文件中的考试数据，整理到新的文件中。</p>
<p>创建一个<code>score.txt</code>文件，内容如下：</p>
<pre tabindex="0"><code>小红=99 小白=100 小黄=70 小黑=66 小绿=88
</code></pre><p>编写JS：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// 1. 导入 fs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 2. 读取文件内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">&#39;score.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">dataStr</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 3. 判断是否读取成功
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;readFileErr: &#39;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// console.log(&#39;Reading Success!&#39;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// console.log(dataStr);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 4.1 按照空格分割
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">arrOld</span> <span class="o">=</span> <span class="nx">dataStr</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// console.log(arrOld);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 4.2 循环分割后的数组，对每项数据进行替换操作
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">arrNew</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">arrOld</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">arrNew</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// console.log(arrNew);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 4.3 把新数组中的每项进行合并，得到新字符串
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">newStr</span> <span class="o">=</span> <span class="nx">arrNew</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\r\n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// console.log(newStr);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 5. 把处理完的成绩，写入新文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="s1">&#39;score-ok.txt&#39;</span><span class="p">,</span> <span class="nx">newStr</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;writeFileErr: &#39;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Writing Success!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>处理完的结果大致如下：</p>
<pre tabindex="0"><code>小红: 99
小白: 100
小黄: 70
小黑: 66
小绿: 88
</code></pre><h2 id="案例2" data-numberify>案例2<a class="anchor ms-1" href="#案例2"></a></h2>
<p>使用<code>fs</code>和<code>path</code>模块将下方HTML文件拆分成对应的<code>html</code>、<code>css</code>和<code>js</code>文件，并写入到<code>clock</code>目录下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;ie=edge&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>index首页<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">html</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">body</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">background-image</span><span class="p">:</span> <span class="nb">linear-gradient</span><span class="p">(</span><span class="kc">to</span> <span class="kc">bottom</span> <span class="kc">right</span><span class="p">,</span> <span class="kc">red</span><span class="p">,</span> <span class="kc">gold</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nc">box</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">width</span><span class="p">:</span> <span class="mi">400</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">height</span><span class="p">:</span> <span class="mi">250</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">border-radius</span><span class="p">:</span> <span class="mi">6</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">left</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">top</span><span class="p">:</span> <span class="mi">40</span><span class="kt">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">box-shadow</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="mi">1</span><span class="kt">px</span> <span class="mi">10</span><span class="kt">px</span> <span class="mh">#fff</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">text-shadow</span><span class="p">:</span> <span class="mi">0</span><span class="kt">px</span> <span class="mi">1</span><span class="kt">px</span> <span class="mi">30</span><span class="kt">px</span> <span class="kc">white</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">justify-content</span><span class="p">:</span> <span class="kc">space-around</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">font-size</span><span class="p">:</span> <span class="mi">70</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">user-select</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c">/* 盒子投影 */</span>
</span></span><span class="line"><span class="cl">      <span class="kp">-webkit-</span><span class="n">box-reflect</span><span class="p">:</span> <span class="kc">below</span> <span class="mi">0</span><span class="kt">px</span> <span class="kp">-webkit-</span><span class="nf">gradient</span><span class="p">(</span><span class="kc">linear</span><span class="p">,</span> <span class="kc">left</span> <span class="kc">top</span><span class="p">,</span> <span class="kc">left</span> <span class="kc">bottom</span><span class="p">,</span> <span class="nf">from</span><span class="p">(</span><span class="kc">transparent</span><span class="p">),</span> <span class="nf">color-stop</span><span class="p">(</span><span class="mi">0</span><span class="kt">%</span><span class="p">,</span> <span class="kc">transparent</span><span class="p">),</span> <span class="nf">to</span><span class="p">(</span><span class="nb">rgba</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mf">.2</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;box&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;HH&#34;</span><span class="p">&gt;</span>00<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>:<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;mm&#34;</span><span class="p">&gt;</span>00<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>:<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;ss&#34;</span><span class="p">&gt;</span>00<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 定时器，每隔 1 秒执行 1 次
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">dt</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">HH</span> <span class="o">=</span> <span class="nx">dt</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">mm</span> <span class="o">=</span> <span class="nx">dt</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">ss</span> <span class="o">=</span> <span class="nx">dt</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 为页面上的元素赋值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#HH&#39;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">padZero</span><span class="p">(</span><span class="nx">HH</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#mm&#39;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">padZero</span><span class="p">(</span><span class="nx">mm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#ss&#39;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">padZero</span><span class="p">(</span><span class="nx">ss</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 补零函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">padZero</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">n</span> <span class="o">&gt;</span> <span class="mi">9</span> <span class="o">?</span> <span class="nx">n</span> <span class="o">:</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">n</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p><code>html-handle.js</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// 1.1 导入 fs 和 path 模块
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 1.2 定义正则表达式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">regStyle</span> <span class="o">=</span> <span class="sr">/&lt;style&gt;[\s\S]*&lt;\/style&gt;/</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">regScript</span> <span class="o">=</span> <span class="sr">/&lt;script&gt;[\s\S]*&lt;\/script&gt;/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 1.3 设置目录名并创建目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">DIR_NAME</span> <span class="o">=</span> <span class="s1">&#39;clock&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">DIR_FULL_PATH</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="nx">DIR_NAME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">DIR_FULL_PATH</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">mkdirSync</span><span class="p">(</span><span class="nx">DIR_FULL_PATH</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 2.1 读取文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">),</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 2.2 读取失败时
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 2.3 读取成功后，调用对应的3个方法解析出css，js和html文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">resolveCSS</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">resolveJS</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">resolveHTML</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 3.1 处理 CSS 样式文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">resolveCSS</span><span class="p">(</span><span class="nx">htmlStr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 3.2 使用正则提取页面的 &lt;style&gt;&lt;/style&gt;标签
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">regStr</span> <span class="o">=</span> <span class="nx">regStyle</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">htmlStr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 3.3 将提取出来的字符串，进行替换
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// console.log(regStr);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">newCSS</span> <span class="o">=</span> <span class="nx">regStr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;&lt;style&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;&lt;/style&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// console.log(newCSS);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 3.4 将提取的样式写入到新文件中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">fullPath</span> <span class="o">=</span>  <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="nx">DIR_NAME</span><span class="p">,</span> <span class="s1">&#39;index.css&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">,</span> <span class="nx">newCSS</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Writing css successful!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 4.1 处理 JS 样式文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">resolveJS</span><span class="p">(</span><span class="nx">htmlStr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 4.2 使用正则提取页面的 &lt;script&gt;&lt;/script&gt;标签
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">regStr</span> <span class="o">=</span> <span class="nx">regScript</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">htmlStr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 4.3 将提取出来的字符串，进行替换
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">newJS</span> <span class="o">=</span> <span class="nx">regStr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;&lt;script&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;&lt;/script&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 4.4 将提取的样式写入到新文件中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">fullPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="nx">DIR_NAME</span><span class="p">,</span> <span class="s1">&#39;index.js&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">,</span> <span class="nx">newJS</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Writing js successful!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 5. 处理 html 文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">resolveHTML</span><span class="p">(</span><span class="nx">htmlStr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 5.1 将内嵌的 &lt;style&gt; 和 &lt;script&gt; 替换为外联的 &lt;link&gt; 和 &lt;script&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">newHTML</span> <span class="o">=</span> <span class="nx">htmlStr</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regStyle</span><span class="p">,</span> <span class="s1">&#39;&lt;link rel=&#34;stylesheet&#34; href=&#34;./index.css&#34; /&gt;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regScript</span><span class="p">,</span> <span class="s1">&#39;&lt;script src=&#34;./index.js&#34;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 5.2 将替换完成之后的 html 代码，写入到 index.html 中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">fullPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="nx">DIR_NAME</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">,</span> <span class="nx">newHTML</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Writing html successful!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
    <item>
      <title>Node.js 入门</title>
      <link>/docs/node-js/introduction/</link>
      <pubDate>Sun, 06 Aug 2023 06:48:14 +0000</pubDate>
      
      <guid>/docs/node-js/introduction/</guid>
      <description><![CDATA[Node.js是一个基于Chrome V8引擎的JavaScript运行环境。 浏览器可以当作是JavaScript的前端运行环境；Node.j]]></description>
      <content:encoded><![CDATA[<p>Node.js是一个基于Chrome V8引擎的JavaScript运行环境。</p>
<p>浏览器可以当作是JavaScript的前端运行环境；Node.js可以看作是JavaScript的后端运行环境。但是在Node.js中无法调用DOM和BOM等浏览器内置API。</p>
<p>Node.js的安装这里就不介绍了，推荐使用NVM来管理Node.js：<a href="/blog/2023/08/nvm-%e5%ae%89%e8%a3%85/">NVM安装</a>。</p>
<p>查看Node.js的版本：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">node -v
</span></span></code></pre></div><p>升级<code>npm</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo npm install npm -g
</span></span></code></pre></div><hr>
<h1 id="npm" data-numberify>NPM<a class="anchor ms-1" href="#npm"></a></h1>
<p>NPM（Node Package Manager）是 Node.js 的包管理工具，用于在 Node.js 环境中安装、管理和共享代码模块。NPM 是随同 Node.js 一起安装的，默认集成在 Node.js 安装包中。它通过命令行接口提供了一系列命令，用于管理 Node.js 应用程序所需的模块，同时也可以在前端开发中使用。</p>
<p>查看<code>npm</code>的版本：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm -v
</span></span></code></pre></div><p>以下是 NPM 的一些重要功能和用途：</p>
<ul>
<li>模块管理：NPM 允许开发者轻松地安装、更新和删除 Node.js 模块。</li>
<li>依赖管理：通过在项目的 <code>package.json</code> 文件中定义依赖项和版本范围，NPM 可以管理项目所需的各个模块的版本依赖关系。这样，当共享项目时，其他开发者可以执行 <code>npm install</code> 命令安装项目所需的模块及其指定的版本。</li>
<li>脚本管理：NPM 允许在项目的 <code>package.json</code> 文件中定义脚本命令，开发者可以使用 <code>npm run &lt;script&gt;</code> 命令来运行这些脚本。这方便了开发者在项目中自定义和组织各种构建、测试、部署等任务。</li>
<li>模块共享：NPM 是一个庞大的开源模块生态系统，开发者可以将自己编写的模块发布到 NPM 供其他开发者使用。通过 <code>npm publish</code> 命令，开发者可以将自己的模块发布到 NPM 上，并通过 <code>npm install</code> 命令在其他项目中安装和使用这些模块。</li>
</ul>
<p>NPM模块管理命令：</p>
<ul>
<li>
<p>安装模块：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install package-name<span class="o">[</span>@version<span class="o">]</span>      <span class="c1"># 本地安装</span>
</span></span><span class="line"><span class="cl">npm install package-name<span class="o">[</span>@version<span class="o">]</span> -g   <span class="c1"># 全局安装</span>
</span></span></code></pre></div><ul>
<li>
<p>本地安装：将安装包放在 <code>./node_modules</code> 下（运行 <code>npm</code> 命令时所在的目录），如果没有 <code>node_modules</code> 目录，会在当前执行 <code>npm</code> 命令的目录下生成 <code>node_modules</code> 目录。</p>
<p>本地安装的NPM包可以通过 <code>require()</code> 来引入本地安装的包。</p>
</li>
<li>
<p>全局安装：将安装包放在 <code>/usr/local</code> 下或者 <code>node</code> 的安装目录。</p>
<p>全局安装的NPM包可以直接在命令行使用。</p>
</li>
<li>
<p><code>npm link</code>：</p>
<p>在一个包文件夹内执行<code>npm link</code>可以在全局文件内创建一个指向执行<code>npm link</code>命令目录的符号链接。</p>
<p>其它目录下执行 <code>npm link package-name</code> 命令，将会创建一个从全局安装的 <code>package-name</code> NPM包到当前文件内 <code>node_modules</code> 目录下的符号链接。包的名称可能有作用域前缀，如果有，<code>package-name</code> 也要对应加上。</p>
</li>
<li>
<p><code>npm i</code>：</p>
<p><code>npm</code>为<code>npm install</code>命令提供了一个简便的写法，你可以像使用<code>npm install</code>命令一样使用<code>npm i</code>，例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm i package-name<span class="o">[</span>@version<span class="o">]</span>    <span class="c1"># 本地安装</span>
</span></span><span class="line"><span class="cl">npm i package-name<span class="o">[</span>@version<span class="o">]</span> -g <span class="c1"># 全局安装</span>
</span></span></code></pre></div></li>
</ul>
<blockquote>
<p>如果出现以下错误：</p>
<pre tabindex="0"><code>npm err! Error: connect ECONNREFUSED 127.0.0.1:8087
</code></pre><p>可以关闭代理：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm config <span class="nb">set</span> proxy null
</span></span></code></pre></div></blockquote>
</li>
<li>
<p>卸载模块：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm uninstall package-name
</span></span></code></pre></div><p>卸载后，可以到 <code>/node_modules/</code> 目录下查看包是否还存在，或者使用以下命令查看：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm ls
</span></span></code></pre></div></li>
<li>
<p>搜索模块：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm search express
</span></span></code></pre></div></li>
</ul>
<p><code>cnpm</code>的用法与<code>npm</code>类似，例如安装模块可以使用<code>cnpm install</code>，卸载模块可以使用<code>npm uninstall</code>。更多<code>cnpm</code>的用法可以查看 <a href="https://npmmirror.com/" target="_blank" rel="noopener noreferrer">npmmirror 镜像站<i class="fas fa-external-link-square-alt ms-1"></i></a>。</p>
<hr>
<h1 id="设置-npm-镜像源" data-numberify>设置 NPM 镜像源<a class="anchor ms-1" href="#设置-npm-镜像源"></a></h1>
<p>有两种方式可以加快<code>npm</code>下载包的速度：</p>
<ul>
<li>
<p>为<code>npm</code>设置淘宝镜像源（推荐）：</p>
<p>给<code>npm</code>设置淘宝镜像：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm config <span class="nb">set</span> registry https://registry.npmmirror.com/
</span></span></code></pre></div><p>查看当前包下载服务器地址：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm config get registry
</span></span></code></pre></div></li>
<li>
<p>使用淘宝提供的<code>cnpm</code>包管理器：</p>
<p>使用淘宝镜像安装<code>cnpm</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo npm install -g cnpm --registry<span class="o">=</span>https://registry.npmmirror.com
</span></span></code></pre></div></li>
</ul>
<p><code>npm</code>镜像的提供者不止一家，如果要方便地切换多个镜像源，可以使用<code>nrm</code>镜像管理工具：</p>
<ul>
<li>
<p>安装<code>nrm</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install nrm -g
</span></span></code></pre></div></li>
<li>
<p>查看所有可用的下载源：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nrm ls
</span></span></code></pre></div><p>结果如下所示：</p>
<pre tabindex="0"><code>  npm ---------- https://registry.npmjs.org/
  yarn --------- https://registry.yarnpkg.com/
  tencent ------ https://mirrors.cloud.tencent.com/npm/
  cnpm --------- https://r.cnpmjs.org/
* taobao ------- https://registry.npmmirror.com/
  npmMirror ---- https://skimdb.npmjs.com/registry/
</code></pre><p>当前正在使用的下载源前方会使用一个<code>*</code>符号来提示。</p>
</li>
<li>
<p>切换下载源：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nrm use source-name
</span></span></code></pre></div><p>例如切换淘宝镜像：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nrm use taobao
</span></span></code></pre></div></li>
</ul>
<hr>
<h1 id="hello-nodejs" data-numberify>Hello Node.js<a class="anchor ms-1" href="#hello-nodejs"></a></h1>
<p>使用Node.js运行JavaScript，首先需要创建一个<code>.js</code>文件。例如<code>hello.js</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Hello Node.js!&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>然后在终端中运行<code>node</code>命令来运行该JS文件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">node hello.js
</span></span></code></pre></div><hr>
<h1 id="导入模块" data-numberify>导入模块<a class="anchor ms-1" href="#导入模块"></a></h1>
<p>Node.js中，导入模块使用下方语法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">module</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;module-name&#39;</span><span class="p">)</span>
</span></span></code></pre></div><hr>
<h1 id="repl-交互式解释器" data-numberify>REPL 交互式解释器<a class="anchor ms-1" href="#repl-交互式解释器"></a></h1>
<p>Node.js REPL（Read Eval Print Loop，交互式解释器）是Node.js的终端交互式解释器，类似Python那样。</p>
<p>使用Node REPL的方法是在终端直接使用<code>node</code>命令：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ node
</span></span><span class="line"><span class="cl">&gt; console.log<span class="o">(</span><span class="s2">&#34;Hello Node.js!&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">Hello Node.js!
</span></span><span class="line"><span class="cl">undefined
</span></span><span class="line"><span class="cl">&gt; <span class="m">1</span> + <span class="m">4</span>
</span></span><span class="line"><span class="cl"><span class="m">5</span>
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
  </channel>
</rss>

